\documentclass[12pt]{article}
\input{../Bibliography/commoncommands}

\begin{document}

\vspace{1.0in}
\section{Unstructured Geometry: The \texorpdfstring{{\tt GEOM}}{GEOM} Namelist Group (Table \ref{tbl:GEOM})}
\label{info:GEOM}

Unstructured geometric solids are defined using the {\tt \&GEOM}\ namelist. These solids consist of vertices and triangular faces.
A simple form is given by

\begin{verbatim}
&GEOM ID='chair'

      VERTS=X1,Y1,Z1,...,XM,YM,ZM,

      FACES=F1_1,F1_2,F1_3,...,FN_1,FN_2,FN_3,

      SCALE=[1],
      AZIM=[0],
      ELEV=[0],

      XYZ0=[0,0,0],
      XYZ=[0,0,0],
/
\end{verbatim}

\noindent The keyword {\tt ID}\ specifies the name of the object.  The object's vertices and triangular faces are specified using the {\tt VERTS}\ and {\tt FACES}\ keywords.  {\tt VERTS}\ is a list of $(x,y,z)$ coordinates and {\tt FACES}\ is a list of vertex indices, 3 indices for each triangular face\footnote{Parameters within [] indicate default values}.  Each index ranges from 1 to the number of vertices found on this {\tt \&GEOM}\ line.

An object may be translated, scaled and rotated.  An object may be translated by $(x,y,z)$ using {\tt XYZ=x,y,z}.  An object may be scaled or magnified by $sx$, $sy$, $sz$ along each of 3 dimensions independently using {\tt SCALE=sx,sy,sz}. An object may be flipped by using a negative scale factor.  An object may be rotated by using {\tt AZIM}\ and {\tt ELEV}.  AZIM is used to specify an azimuthal rotation angle about a vertical axis centered at an origin defined by {\tt XYZ0}.  ELEV specifies an elevation angle.  An object may also be rotated about an arbitrary axis.  {\tt GAXIS} is used to specify this axis.  GROTATE is used to specify the amount of rotation about this axis.  All rotation angles are in degrees.

One may create an object using previously defined objects. These objects are specified using the {\tt GEOM\_IDS}\ keyword.  An example is given by

{%\footnotesize
\begin{verbatim}
&GEOM ID='group 1'

      XYZ=[0,0,0],
      AZIM=[0],
      ELEV=[0],

      GEOM_IDS(1)='chair',  DSCALE(1)=..., DAZIM(1)=..., DELEV(1)...
                            DXYZ0(1:3,1)=..., DXYZ(1:3,1)=...,
      GEOM_IDS(2)='couch',  DSCALE(2)=..., DAZIM(2)=..., DELEV(2)...
                            DXYZ0(1:3,2)=..., DXYZ(1:3,2)=...,
/
\end{verbatim}
}

\noindent where {\tt GEOM\_IDS}\ is used incorporate a chair and couch into the group.  These two objects must be defined in previous {\&GEOM}\ lines (forward references are not allowed).   One may scale, rotate and translate objects as they are placed in the group using {\tt DSCALE}\, for scaling, {\tt DAZIM} and {\tt DELEV} for rotation and {\tt DXYZ} for translation. The {\tt DXYZ0}\ and {\tt DXYZ}\ keywords are two dimensional.  The first coordinate specifies the spatial component (1 for x, 2 for y, 3 for z or 1:3 for x, y, z).  The second coordinate specifies the object number in the {\tt GEOM\_IDS}\ array. The keyword, {\tt COMPONENT\_ONLY}\, if .TRUE., indicates that the geometry only occurs in other geometry definitions and is not itself a part of the FDS model.

An object's position and orientation my change with time.  These changes are specified using various keywords that end with {\tt \_DOT}.  See Table \ref{tbl:GEOM} for a complete list of these keywords. In the following example, {\tt AZIM\_DOT} is used to vary the azimuthal rotation angle by 1 deg/s.  Similarly, the position may be changed by using {\tt XYZ\_DOT}.  For example, {\tt XYZ\_DOT=0.0,0.0,1.0}\ would cause an object to move 1~m/s in a vertical direction.
\begin{verbatim}
&GEOM VERTS=...,FACES=....,AZIM=0.0,AZIM_DOT=1.0 /
\end{verbatim}

\vspace{\baselineskip}

% This section is under construction!

\section{\texorpdfstring{{\tt GEOM}}{GEOM} (Unstructured Geometry Parameters)}

\begin{longtable}{@{\extracolsep{\fill}}|l|l|l|l|l|}
\caption[Unstructured geometry parameters ({\ct GEOM} namelist group)]{For more information see Section~\ref{info:GEOM}.}
\label{tbl:GEOM} \\
\hline
\multicolumn{5}{|c|}{{\ct GEOM} (Unstructured Geometry Parameters)} \\
\hline \hline
\endfirsthead
\caption[]{Continued} \\
\hline
\multicolumn{5}{|c|}{{\ct GEOM} (Unstructured Geometry Parameters)} \\
\hline \hline
\endhead
{\ct AZIM}         & Real                   & Section~\ref{info:GEOM}            &  deg      &    0.0                   \\ \hline
{\ct AZIM\_DOT}    & Real                   & Section~\ref{info:GEOM}            &  deg/s    &    0.0                   \\ \hline
{\ct COMPONENT\_ONLY} & LOGICAL             & Section~\ref{info:GEOM}            &           &  {\ct .FALSE.}           \\ \hline
{\ct ELEV}         & Real                   & Section~\ref{info:GEOM}            &  deg      &    0.0                   \\ \hline
{\ct ELEV\_DOT}    & Real                   & Section~\ref{info:GEOM}            &  deg/s    &    0.0                   \\ \hline
{\ct DAZIM}        & array of Reals         & Section~\ref{info:GEOM}            &  deg      &    0.0                   \\ \hline
{\ct DELEV}        & array of Reals         & Section~\ref{info:GEOM}            &  deg      &    0.0                   \\ \hline
{\ct DSCALE}       & array of Real Triplets & Section~\ref{info:GEOM}            &           &   1.0                    \\ \hline
{\ct DXYZ}         & array of Real Triplets & Section~\ref{info:GEOM}            &   m       &   0.0                    \\ \hline
{\ct ELEV}         & Real                   & Section~\ref{info:GEOM}            &  deg      &    0.0                   \\ \hline
{\ct ELEV\_DOT}    & Real                   & Section~\ref{info:GEOM}            &  deg/s    &    0.0                   \\ \hline
{\ct FACES}        & array of Integer Triplets     & Section~\ref{info:GEOM}     &           &    0                     \\ \hline
{\ct GAXIS}        & Real Triplet           & Section~\ref{info:GEOM}            &           &                          \\ \hline
{\ct GROTATE}      & Real Triplet           & Section~\ref{info:GEOM}            &           &                          \\ \hline
{\ct GEOM\_IDS}    & Real                   & Section~\ref{info:GEOM}            &           &                          \\ \hline
{\ct ID}           & Character              & Section~\ref{info:GEOM}            &           &   {\ct 'geom'}           \\ \hline
{\ct SCALE}        & Real Triplet           & Section~\ref{info:GEOM}            &           &   1.0                    \\ \hline
{\ct SCALE\_DOT}   & Real Triplet           & Section~\ref{info:GEOM}            &  1/s      &   1.0                    \\ \hline
{\ct SURF\_ID}     & Character              & Section~\ref{info:GEOM}            &           &  {\ct 'INERT'}           \\ \hline
{\ct TEXTURE\_CENTER} & Real Triplet        & Section~\ref{info:GEOM}            &   m       &   0.0,0.0,0.0            \\ \hline
{\ct TEXTURE\_MAP} & Character              & Section~\ref{info:GEOM}            &           &  {\ct 'null'}            \\ \hline
{\ct TEXTURE\_HEIGHT} & Character              & Section~\ref{info:GEOM}            &           & 1.0                   \\ \hline
{\ct TEXTURE\_TYPE}   & Character              & Section~\ref{info:GEOM}            &           & {\ct 'XY'}            \\ \hline
{\ct TEXTURE\_WIDTH} & Character              & Section~\ref{info:GEOM}            &           & 1.0                    \\ \hline
{\ct VERTS}        & array of Real Triplets & Section~\ref{info:GEOM}            &   m       &   0.0                    \\ \hline
{\ct XYZ0}         & Real Triplet           & Section~\ref{info:GEOM}            &   m       &   0.0                    \\ \hline
{\ct XYZ}          & Real Triplet           & Section~\ref{info:GEOM}            &   m       &   0.0                    \\ \hline
{\ct XYZ\_DOT}     & Real Triplet           & Section~\ref{info:GEOM}            &   m/s     &   0.0                    \\ \hline

\end{longtable}


\vspace{\baselineskip}

\section{Geometry, Isosurface Files}
\label{out:GEOMETRY}

(add to FDS user's guide 20.13 when ready)

Both immersed geometric surfaces (generalized obstructions) and FDS generated isosurfaces are stored using a file format described in this section. Iso-surface files are used to store one or more surfaces where the specified {\ct QUANTITY} is a specified value. FDS outputs iso-surface data at fixed time intervals.  These surfaces are defined in terms of vertices and triangles.  A vertex consists of an $(x,y,z)$ coordinate. A triangle consists of 3 connected vertices.  The file format allows one to specify objects that change with time. Static geometry is defined once and displayed by Smokeview unchanged at each time step. Dynamic geometry is defined at each time step either in terms of nodes and faces or in terms of a translation and two rotations (azimuthal and elevation) of dynamic geometry defined in the first time step. These files are written out from {\ct dump.f90} using lines equivalent to the following:
\begin{lstlisting}
! header

WRITE(LU_GEOM) ONE
WRITE(LU_GEOM) VERSION
WRITE(LU_GEOM) N_FLOATS
IF (N_FLOATS>0) WRITE(LU_GEOM) (FLOAT_HEADER(I),I=1,N_FLOATS)
WRITE(LU_GEOM) N_INTS
IF (N_INTS>0) WRITE(LU_GEOM) (INT_HEADER(I),I=1,N_INTS)

! static geometry - geometry specified once and appearing at all time steps

WRITE(LU_GEOM) N_VERT_S, N_FACE_S
IF (N_VERT_S>0)  WRITE(LU_GEOM) (Xvert_S(I),Yvert_S(I),Zvert_S(I),I=1,N_VERT_S)
IF (N_FACE_S>0)  THEN
   WRITE(LU_GEOM) (FACE1_S(I),FACE2_S(I),FACE3_S(I),I=1,N_FACE_S)
   WRITE(LU_GEOM) (GEOM_S(I),I=1,N_FACE_S
ENDIF

! dynamic geometry - geometry specified and appearing for each time step

WRITE(LU_GEOM) STIME, GEOM_TYPE
IF (GEOM_TYPE.EQ.0) THEN
  WRITE(LU_GEOM) N_VERT_D, N_FACE_D
  IF (N_VERT_D>0) WRITE(LU_GEOM)(Xvert_D(I),Yvert_D(I),Zvert_D(I),I=1,N_VERT_D)
  IF (N_FACE_D>0) THEN
     WRITE(LU_GEOM) (FACE1_D(I),FACE2_D(I),FACE3_D(I),I=1,N_FACE_D)
     WRITE(LU_GEOM) (GEOM_D(I),I=1,N_FACE_D)
  ENDIF
ELSE IF (GEOM_TYPE.EQ.1) THEN
  DO I = 1, N_GEOMS
     WRITE(LU_GEOM) TRAN_X(I), TRAN_Y(I), TRAN_Z(I), SCALE_X(I), SCALE_X(I), SCALE_X(I), AZ(I), ELEV(I)
  END DO
ENDIF
              .
              .
\end{lstlisting}
\begin{itemize}
\item {\ct ONE}\ has the value 1. Smokeview uses this number to determine whether the computer creating the geometry file and the computer viewing the geometry file use the same or different byte swap (endian) conventions for storing floating point numbers.
\item {\ct VERSION}\ currently has value 0 and indicates the version number of this file format.
\item {\ct N\_FLOATS, N\_INTS} The number of floating point and integer data items stored at the beginning of the file.
\item {\ct FLOAT\_HEADER, INT\_HEADER} Floating point and integer data stored at the beginning of the file.
\item {\ct STIME} is the FDS simulation time.
\item {\ct N\_VERT\_S, N\_FACE\_S, N\_VERT\_D, N\_FACE\_D}\ are the number of static and dynamic vertices and faces.
\item {\ct Xvert\_S, Yvert\_S, Zvert\_S, Xvert\_D, Yvert\_D, Zvert\_D}\ are the static and dynamic vertex coordinates.
\item {\ct FACE1\_S, FACE2\_S, FACE3\_S,FACE1\_D, FACE2\_D, FACE3\_D}\ are the static and dynamic vertex indices for each face (triangle).  The indices are numbered relative to how vertices were written out earlier.
\item {\ct GEOM\_S, GEOM\_D}\ are the static and dynamic GEOM indices for each face (color indices for isosurface files).
\item {\ct GEOM\_TYPE}\ is flag indicating how dynamic geometry is represented. If {\ct GEOM\_TYPE}\ is 0 then time dependent geometry is written out in terms of nodes and faces using the same format as the static geometry. If {\ct GEOM\_TYPE}\ is 1 then time dependent geometry is written out in terms of a scaling, translation and rotation for each GEOM defined at the first time step.
\end{itemize}

\end{document}

