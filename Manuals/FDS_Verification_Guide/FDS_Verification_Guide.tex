\documentclass[11pt]{book}
\usepackage{mathptm,times}
\usepackage[pdftex]{graphicx}
%\usepackage{hyperref}

\usepackage{pdfsync}
\usepackage[pdftex,
        colorlinks=true,
        urlcolor=linkblue,     % \href{...}{...} external (URL)
        citecolor=linkred,     % citation number colors
        linkcolor=linknavy,    % \ref{...} and \pageref{...}
        pdftitle={Fire Dynamics Simulator (Version 6) Verification Guide},
        pdfauthor={Randall McDermott, Kevin McGrattan, Craig Weinschenk, Simo Hostikka, Jason Floyd},
        pdfsubject={Verification Guide},
        pdfkeywords={FDS, Fire Model, NIST, Engineering Laboratory},
        pdfproducer={pdflatex},
        pagebackref,
        pdfpagemode=UseNone,
        bookmarksopen=true,
        plainpages=false]{hyperref}
\usepackage{color}
\definecolor{linknavy}{rgb}{0,0,0.50196}
\definecolor{linkred}{rgb}{1,0,0}
\definecolor{linkblue}{rgb}{0,0,1}
\usepackage{caption}
\usepackage{graphpap}
\usepackage{rotating}
\usepackage{epsfig,psfrag}
\usepackage{geometry}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage{lscape}
\usepackage{amssymb}
\usepackage{makeidx} % Create index at end of document
\usepackage[nottoc,notlof,notlot]{tocbibind} % Put the bibliography and index in the ToC
\usepackage{float}
\usepackage{lastpage} % Automatic last page number reference.
\usepackage[T1]{fontenc}
\usepackage{upquote}
\usepackage{amsmath}
\newcommand{\nopart}{\expandafter\def\csname Parent-1\endcsname{}} % To fix table of contents in pdf.
\newcommand{\ct}{\tt\small}


\setlength{\textwidth}{6.5in}
\setlength{\textheight}{9.0in}
\setlength{\topmargin}{0.in}
\setlength{\headheight}{0.in}
\setlength{\headsep}{0.in}
\setlength{\parindent}{0.25in}
\setlength{\oddsidemargin}{0.0in}
\setlength{\evensidemargin}{0.0in}





\begin{document}

\bibliographystyle{unsrt}

% include commands for bios, titles etc used in multiple documents
\input{../Bibliography/commoncommands}

\newcommand{\dod}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\DoD}[2]{\frac{D #1}{D #2}}
\newcommand{\dsods}[2]{\frac{\partial^2 #1}{\partial #2^2}}
\newcommand{\dx}{\delta x}
\newcommand{\dy}{\delta y}
\newcommand{\dz}{\delta z}
\newcommand{\x}{x}
\newcommand{\y}{y}
\newcommand{\z}{z}
\newcommand{\dt}{\delta t}
\newcommand{\dn}{\delta n}
\newcommand{\cH}{{\cal H}}
\newcommand{\hu}{u}
\newcommand{\hv}{v}
\newcommand{\hw}{w}
\newcommand{\la}{\lambda}
%\newcommand{\bO}{\mbox{\boldmath $\Omega$}}
\newcommand{\bO}{{\Omega}}
\newcommand{\bo}{{\bf \omega}}
%\newcommand{\btau}{\mbox{\boldmath $\tau$}}
\newcommand{\btau}{{\bf \tau}}
\newcommand{\bdelta}{{\bf \delta}}
\newcommand{\sumym}{\sum (Y_i/W_i)}
\newcommand{\oW}{\overline{W}}
\newcommand{\om}{\omega}
\newcommand{\omx}{\omega_x}
\newcommand{\omy}{\omega_y}
\newcommand{\omz}{\omega_z}
\newcommand{\erf}{\hbox{erf}}
\newcommand{\erfc}{\hbox{erfc}}
\newcommand{\bF}{{\bf F}}
\newcommand{\bof}{{\bf f}}
\newcommand{\bq}{{\bf q}}
\newcommand{\br}{{\bf r}}
\newcommand{\bu}{{\bf u}}
\newcommand{\bx}{{\bf x}}
\newcommand{\bk}{{\bf k}}
\newcommand{\bv}{{\bf v}}
\newcommand{\bg}{{\bf g}}
\newcommand{\bn}{{\bf n}}
\newcommand{\bS}{{\bf S}}
\newcommand{\dS}{d{\bf S}}
\newcommand{\bs}{{\bf s}}
\newcommand{\bI}{{\bf I}}
\newcommand{\hp}{{\cal H}}
\newcommand{\trho}{\tilde{\rho}}
\newcommand{\dph}{{\delta\phi}}
\newcommand{\dth}{{\delta\theta}}
\newcommand{\tp}{\tilde{p}}
\newcommand{\dQ}{\dot{Q}}
\newcommand{\dq}{\dot{q}}
\newcommand{\dm}{\dot{m}}
\newcommand{\ha}{\frac{1}{2}}
\newcommand{\ft}{\frac{4}{3}}
\newcommand{\ot}{\frac{1}{3}}
\newcommand{\fofi}{\frac{4}{5}}
\newcommand{\of}{\frac{1}{4}}
\newcommand{\twth}{\frac{2}{3}}
\newcommand{\R}{{\cal R}}
\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand{\RE}{\hbox{Re}}
\newcommand{\LE}{\hbox{Le}}
\newcommand{\PR}{\hbox{Pr}}
\newcommand{\PE}{\hbox{Pe}}
\newcommand{\NU}{\hbox{Nu}}
\newcommand{\SC}{\hbox{Sc}}
\newcommand{\SH}{\hbox{Sh}}
\newcommand{\WE}{\hbox{We}}
\newcommand{\COTWO}{{\tiny \hbox{CO}_2}}
\newcommand{\OTWO}{{\tiny \hbox{O}_2}}
\newcommand{\CO}{{\tiny \hbox{CO}}}
\newcommand{\F}{{\tiny \hbox{F}}}

\pagestyle{empty}

\begin{minipage}[t][9in][s]{6.5in}

\huge
\flushright{NIST Special Publication 1018}

\vspace{1in}

\Huge
\flushright{Fire Dynamics Simulator \\
Technical Reference Guide \\ \LARGE Volume 2: Verification}

\normalsize

\vfill

\flushright{
\includegraphics[width=1.3in]{../Bibliography/VTT_BLACK_L} \\
VTT Technical Research Centre of Finland \\ [.3in]
\includegraphics[width=2.in]{../Bibliography/nistident_flright_vec}
}

\end{minipage}

\newpage

\hspace{5in}

\newpage

\begin{minipage}[t][9in][s]{6.5in}

\huge
\flushright{NIST Special Publication 1018}

\vspace{1.in}

\Huge
\flushright{Fire Dynamics Simulator \\
Technical Reference Guide \\ \LARGE Volume 2: Verification }

\vspace{.5in}

\normalsize
\flushright{
Fire Research Division \\
Engineering Laboratory  \\
Gaithersburg, Maryland, USA \\
\hspace{1.in} \\
VTT Technical Research Centre of Finland \\
{\em Espoo, Finland} }
\flushright{\includegraphics[width=1in]{../Bibliography/VTT_BLACK_L} }

\vspace{.25in}

\flushright{\today \\
FDS Version 6.0 \\
\emph{SVN Repository}~$Revision$}


\vfill

\flushright{\includegraphics[width=1in]{../Bibliography/doc} }

\titlesigs

\end{minipage}




\newpage

\frontmatter

\pagestyle{plain}

\input{../Bibliography/authors}


\chapter{Preface}

This is Volume 2 of the FDS Technical Reference Guide. Volume 1 describes the mathematical model and
numerical method. Volume 3 documents past and present experimental validation work. Instructions for
using FDS are contained in a separate User's Guide~\cite{FDS_Users_Guide}.

The three volumes of the FDS Technical Reference Guide are based in part on the ``Standard Guide for
Evaluating the Predictive Capability of Deterministic Fire Models,'' ASTM~E~1355~\cite{ASTM:E1355}.
ASTM~E~1355 defines {\em model evaluation} as ``the process of quantifying
the accuracy of chosen results from a model when applied for a specific use.''
The model evaluation process consists of two main components: verification and validation.
{\em Verification} is a process to check the correctness of the solution of the
governing equations. Verification does not imply that the governing equations are
appropriate; only that the equations are being solved correctly.
{\em Validation} is a process to determine the appropriateness of the governing equations as a mathematical
model of the physical phenomena of interest. Typically, validation involves comparing
model results with experimental measurement. Differences that cannot be explained in terms of
numerical errors in the model or uncertainty in the measurements
are attributed to the assumptions and simplifications of the physical model.

Evaluation is critical to establishing both the acceptable uses
and limitations of a model. Throughout its development, FDS has undergone various forms of evaluation.
This volume provides a survey of verification work conducted to date to evaluate FDS.




\chapter{Acknowledgments}

\label{acksection}

The following individuals contributed to the verification process of FDS.
\begin{itemize}
\item Chris Lautenburger and Carlos Fernandez-Pello contributed the ``two-reaction'' test case.
\item Matthias M\"{u}nch of the Freie Universit\"{a}t Berlin provided useful test cases for the basic flow solver.
\item Clara Cruz, a student at the University of Puerto Rico and Summer Undergraduate Fellow at NIST, helped develop useful Matlab scripts to automate
the process of compiling this Guide.
\item Bryan Klein of NIST developed the source code version control system that is an essential part of the verification process.
\item Joonas Ryyn\"{a}nen of VTT, Finland, designed and documented the FED/FIC test cases.
\end{itemize}



\tableofcontents
\clearpage
\listoffigures
\clearpage
\listoftables


\mainmatter


\chapter{What is Verification?}

The terms {\em verification} and {\em validation} are often used interchangeably to mean the process of checking the
accuracy of a numerical model. For many, this entails comparing model predictions with experimental measurements. However,
there is now a fairly broad-based consensus that comparing model and experiment is largely what is considered {\em validation}. So what is
{\em verification}? ASTM~E~1355~\cite{ASTM:E1355}, ``Standard Guide for
Evaluating the Predictive Capability of Deterministic Fire Models,'' defines verification as
\begin{quote}
The process of determining that the implementation of a calculation method accurately
represents the developer's conceptual description of the calculation method and the solution to the calculation method.
\end{quote}
and it defines validation as
\begin{quote}
The process of determining the degree to which a calculation method is an accurate representation of the real world
from the perspective of the intended uses of the calculation method.
\end{quote}
Simply put, verification is a check of the math; validation is a check of the physics. If the model predictions closely match
the results of experiments, using whatever metric is appropriate, it is assumed by most that the model suitably describes, via
its mathematical equations, what is happening. It is also assumed that the solution of these equations must be correct. So why do
we need to perform model verification? Why not just skip to validation and be done with it? The reason is that rarely do model and
measurement agree so well in all applications that anyone would just accept its results unquestionably. Because there is
inevitably differences between model and experiment, we need to know if these differences are due to limitations or errors in
the numerical solution, or the physical sub-models, or both.

Whereas model validation consists mainly of comparing predictions with measurements, as documented for FDS in Volume 3 of the
Technical Reference Guide, model verification consists of a much broader range of activities, from checking the computer program
itself to comparing calculations to analytical (exact) solutions to considering the sensitivity of the dozens of numerical
parameters. The next chapter discusses these various activities, and the rest of the Guide is devoted mainly to comparisons of
various sub-model calculations with analytical solutions.








\chapter{Survey of Past Verification Work}

This chapter documents work of the past few decades at NIST, VTT and elsewhere to verify the algorithms within FDS.




\section{Analytical Tests}

\label{Analytical Tests}

Most complex combustion processes, including fire, are turbulent and time-dependent. There are no closed-form mathematical solutions for the
fully-turbulent, time-dependent Navier-Stokes equations. CFD provides an approximate solution for the non-linear partial differential equations by
replacing them with discretized algebraic equations that can be solved using a powerful computer. While there is no general analytical solution for
fully-turbulent flows, certain sub-models address phenomenon that do have analytical solutions, for example, one-dimensional heat conduction through
a solid. These analytical solutions can be used to test sub-models within a complex code such as FDS. The developers of FDS routinely use such
practices to verify the correctness of the coding of the model~\cite{Mell:1,McGrattan:4}. Such verification efforts are relatively simple and routine
and the results may not always be published nor included in the documentation. Examples of routine analytical testing include:
\begin{itemize}
\item The radiation solver has been verified with scenarios where
simple objects, like cubes or flat plates, are positioned in simple, sealed compartments. All convective motion is turned off, the object is given a
fixed surface temperature and emissivity of one (making it a black body radiator). The heat flux to the cold surrounding walls is recorded and
compared to analytical solutions.  These studies help determine the appropriate number of solid angles to be set as the default.
\item Solid objects are heated with a fixed heat flux, and the
interior and surface temperatures as a function of time are compared to analytical solutions of the one-dimensional heat transfer equation. These
studies help determine the number of nodes to use in the solid phase heat transfer model. Similar studies are performed to check the pyrolysis models
for thermoplastic and charring solids.
\item Early in its development, the hydrodynamic solver that evolved
to form the core of FDS was checked against analytical solutions of simplified fluid flow phenomena. These studies were conducted at the National
Bureau of Standards (NBS)\footnote{The National Institute of Standards and Technology (NIST) was formerly known as the National Bureau of Standards.}
by Rehm, Baum and co-workers~\cite{Rehm:SIAM83,Rehm:SIAM84,Baum:CST84,Rehm:ANM85}. The emphasis of this early work was to test the stability and
consistency of the basic hydrodynamic solver, especially the velocity-pressure coupling that is vitally important in low Mach number applications.
Many numerical algorithms developed up to that point in time were intended for use in high-speed flow applications, like aerospace. Many of the
techniques adopted by FDS were originally developed for meteorological models, and as such needed to be tested to assess whether they would be
appropriate to describe relatively low-speed flow within enclosures.
\item A fundamental decision made by Rehm and Baum early in the FDS
development was to use a direct (rather than iterative) solver for the pressure. In the low Mach number formulation of the Navier-Stokes equations,
an elliptic partial differential equation for the pressure emerges, often referred to as the Poisson equation. Most CFD methods use iterative
techniques to solve the governing conservation equations to avoid the necessity of directly solving the Poisson equation. The reason for this is that
the equation is time-consuming to solve numerically on anything but a rectilinear grid. Because FDS is designed specifically for rectilinear grids,
it can exploit fast, direct solvers of the Poisson equation, obtaining the pressure field with one pass through the solver to machine accuracy. FDS
employs double-precision (8 byte) arithmetic, meaning that the relative difference between the computed and the exact solution of the discretized
Poisson equation is on the order of $10^{-12}$. The fidelity of the numerical solution of the entire system of equations is tied to the
pressure/velocity coupling because often simulations can involve hundreds of thousands of time steps, with each time step consisting of two solutions
of the Poisson equation to preserve second-order accuracy. Without the use of the direct Poisson solver, build-up of numerical error over the course
of a simulation could produce spurious results. Indeed, an attempt to use single-precision (4 byte) arithmetic to conserve machine memory led to
spurious results simply because the error per time step built up to an intolerable level.
\end{itemize}



\section{Numerical Tests}

\label{Numerical Tests}


Numerical techniques used to solve the governing equations within a model can be a source of error in the predicted results.  The hydrodynamic model
within FDS is second-order accurate in space and time.  This means that the error terms associated with the approximation of the spatial partial
derivatives by finite differences is of the order of the square of the grid cell size, and likewise the error in the approximation of the temporal
derivatives is of the order of the square of the time step. As the numerical grid is refined, the ``discretization error'' decreases, and a more
faithful rendering of the flow field emerges.  The issue of grid sensitivity is extremely important to the proper use of the model and will be taken
up in the next chapter.

A common technique of testing flow solvers is to systematically refine the numerical grid until the computed solution does not change, at which point
the calculation is referred to as a Direct Numerical Solution (DNS) of the governing equations.  For most practical fire scenarios, DNS is not
possible on conventional computers. However, FDS does have the option of running in DNS mode, where the Navier-Stokes equations are solved without
the use of sub-grid scale turbulence models of any kind. Because the basic numerical method is the same for LES and DNS, DNS calculations are a very
effective way to test the basic solver, especially in cases where the solution is steady-state. Throughout its development, FDS has been used in DNS
mode for special applications.  For example, FDS (or its core algorithms) have been used at a grid resolution of roughly 1~mm to look at flames
spreading over paper in a microgravity environment~\cite{McGrattan:C&F1996,Kashiwagi:CS1996,Mell:CS98,Mell:CS00,Prasad:CS2002,Nakamura:C&F2002}, as
well as "g-jitter" effects aboard spacecraft~\cite{Mell:g-jitter}. Simulations have been compared to experiments performed aboard the US Space
Shuttle.  The flames are laminar and relatively simple in structure, and the comparisons are a qualitative assessment of the model solution. Similar
studies have been performed comparing DNS simulations of a simple burner flame to laboratory experiments~\cite{Mukhopadhyay:1}. Another study
compared FDS simulations of a counterflow diffusion flames to experimental measurements and the results of a one-dimensional multi-step kinetics
model~\cite{Hamins:NASA}.

Early work with the hydrodynamic solver compared two-dimensional simulations of gravity currents with salt-water experiments~\cite{McGrattan:1}. In
these tests, the numerical grid was systematically refined until almost perfect agreement with experiment was obtained. Such convergence would not be
possible if there were a fundamental flaw in the hydrodynamic solver.




\section{Sensitivity Analysis}

A sensitivity  analysis considers the  extent to which  uncertainty in model  inputs influences  model output.  Model parameters  can  be the
physical properties of solids  and gases, boundary conditions, initial conditions, {\em  etc.} The parameters  can also be  purely numerical, like
the size  of the numerical grid. FDS  typically requires the user to  provide several  dozen different  types of  input  parameters that describe the
geometry, materials,  combustion phenomena, {\em etc.} By design,  the user  is  not expected  to  provide numerical  parameters besides the grid
size,  although the optional numerical parameters are described in both the Technical Reference Guide and the User's Guide.

FDS does not  limit the range of most of  the input parameters because applications often push beyond the  range for which the model has been
validated.  FDS is still used  for research at NIST, VTT, and elsewhere, and the developers do not presume to know in all cases what the acceptable range
of   any  parameter  is.  Plus,  FDS   solves  the  fundamental conservation  equations  and  is   much  less  susceptible  to  errors resulting
from  input parameters  that  stray  beyond  the limits  of simpler empirical models.  However, the user is warned  that he/she is responsible for
the prescription of all parameters.   The FDS manuals can only provide guidance.

The grid size is the  most important numerical parameter in the model, as it  dictates the spatial  and temporal accuracy of  the discretized partial
differential equations.  The heat  release rate  is  the most important physical parameter,  as it is the source  term in the energy equation.
Property data, like  the thermal conductivity, density, heat of vaporization,  heat capacity, {\em  etc.}, ought to be  assessed in terms of their
influence on  the heat release rate. Validation studies have shown that FDS predicts well the transport of heat and smoke when the HRR is prescribed.
In  such cases, minor changes in the properties of  bounding  surfaces  do  not  have  a  significant  impact  on  the results. However, when the HRR
is not prescribed, but rather predicted by the  model using  the thermophysical properties  of the  fuels, the model output is sensitive to even
minor changes in these properties.

The sensitivity  analyses described in this chapter  are all performed in basically the same way. For a given scenario, best estimates of all the
relevant  physical  and  numerical  parameters are  made,  and  a ``baseline'' simulation is performed. Then, one by one, parameters are varied by a
given percentage, and the changes in predicted results are recorded.  This is  the simplest  form of  sensitivity  analysis. More sophisticated
techniques that involve  the simultaneous  variation of several  parameters  are impractical  with  a  CFD  model because  the computation time is
too long and the number of parameters too large to perform  the  necessary  number  of calculations  to  generate  decent statistics.



\subsection{Grid Sensitivity}

\label{gridsen}

The most  important decision made by a  model user is the  size of the numerical grid. In  general, the finer the numerical  grid, the better the
numerical solution of  the equations. FDS is second-order accurate in  space and  time,  meaning that  halving  the grid  cell size  will decrease
the discretization  error in  the governing  equations  by a factor  of 4.  Because  of  the non-linearity  of  the equations,  the decrease in
discretization error does not necessarily translate into a comparable decrease  in the error of  a given FDS  output quantity. To find out  what
effect a  finer grid has  on the solution,  model users usually  perform some  form of  grid  sensitivity study  in which  the numerical grid  is
systematically refined until  the output quantities do not change  appreciably with each refinement. Of  course, with each halving of  the grid cell
size,  the time required  for the simulation increases by  a factor of $2^4=16$  (a factor of two  for each spatial coordinate, plus  time). In  the
end, a  compromise is  struck between model accuracy and computer capacity.

Some   grid    sensitivity   studies   have    been   documented   and published. Since FDS was  first publicly released in 2000, significant changes
in  the   combustion  and   radiation  routines   have  been incorporated into the model. However, the basic transport algorithm is the  same, as  is
the  critical importance  of  grid sensitivity.  In compiling   sensitivity  studies,   only  those   that   examined  the sensitivity of routines no
longer used have been excluded.

As part of  a project to evaluate  the use of FDS version  1 for large scale   mechanically  ventilated   enclosures,  Friday~\cite{Friday:1}
performed a  sensitivity analysis to find  the approximate calculation time based on varying grid sizes. A propylene fire with a nominal heat release
rate was  modeled in FDS. There was  no mechanical ventilation and  the fire  was assumed  to grow  as a  function of  the  time from ignition
squared.  The  compartment  was   a  3~m  by  3~m  by  6.1~m space. Temperatures  were sampled 12~cm  below the ceiling.  Four grid sizes   were
chosen  for   the   analysis:   30~cm,  15~cm,   10~cm, 7.5~cm. Temperature  estimates were  not found to  change dramatically with different grid
dimensions.

Using FDS  version 1, Bounagui {\em  et al.}~\cite{Bounagui:1} studied the effect of grid size on simulation results to determine the nominal grid
size for future work. A propane burner 0.1~m by 0.1~m was modeled with  a heat  release rate  of  1500~kW.   A similar analysis was performed using
Alpert's ceiling  jet correlation~\cite{SFPE:Alpert}  that also showed better  predictions   with smaller grid sizes.  In a  related study,  Bounagui
{\em  et al.}~\cite{Bounagui:2} used  FDS to  evaluate  the emergency  ventilation  strategies in  the Louis-Hippolyte-La Fontaine Tunnel in
Montreal, Canada.


Xin~\cite{Xin:NFPA2004}  used FDS  to  model a  methane fueled  square burner (1~m  by 1~m) in  the open. Engineering correlations  for plume
centerline temperature and velocity  profiles were compared with model predictions to assess the influence of the numerical grid and the size of the
computational domain. The  results showed that FDS is sensitive to grid size effects, especially  in the region near the fuel surface, and domain
size  effects when the domain width is  less than twice the plume  width.  FDS  uses   a  constant  pressure  assumption  at  open boundaries.  This
assumption  will affect  the plume  behavior  if the boundary of the computational domain is too close to the plume.

Ierardi  and Barnett~\cite{Ierardi:1} used  FDS version  3 to  model a 0.3~m square methane diffusion burner with heat release rate values in the
range of 14.4~kW to 57.5~kW. The physical domain used was 0.6~m by 0.6~m with uniform grid spacings of  15, 10, 7.5, 5, 3, 1.5~cm for all three
coordinate  directions. For both  fire sizes, a grid  spacing of 1.5~cm  was found  to  provide  the best  agreement  when compared  to McCaffrey's
centerline    plume    temperature     and    velocity correlations~\cite{SFPE:Heskestad}.  Two similar  scenarios  that form the basis for Alpert's
ceiling  jet correlation were also modeled with FDS. The first scenario was a  1~m by 1~m, 670~kW ethanol fire under a 7~m   high  unconfined
ceiling.   The  planar   dimensions  of   the computational domain were 14~m by  14~m. Four uniform grid spacings of 50, 33.3, 25, and 20~cm were
used in the modeling. The best agreement for  maximum  ceiling  jet  temperature  was  with  the  33.3~cm  grid spacing. The best  agreement for
maximum ceiling jet  velocity was for the  50~cm grid  spacing. The  second scenario  was a  0.6~m  by 0.6~m 1000~kW ethanol fire under a 7.2~m high
unconfined ceiling. The planar dimensions of  the computational domain  were 14.4~m by  14.4~m. Three uniform  grid  spacings  of  60,  30,  and
20~cm  were  used  in  the modeling. The  results show that  the 60~cm grid spacing  exhibits the best  agreement with  the correlations  for both
maximum  ceiling jet temperature and velocity on a qualitative basis.

Petterson~\cite{Petterson:1} also completed work assessing the optimal grid size for FDS version 2. The FDS model predictions of varying grid sizes
were  compared to two separate fire  experiments: The University of Canterbury  McLeans Island  Tests and the  US Navy Hangar  Tests in Hawaii.  The
first  set  of  tests utilized  a  room with  approximate dimensions of  2.4~m by  3.6~m by  2.4~m and fire  sizes of  55~kW and 110~kW. The  Navy
Hangar  tests were performed  in a  hangar measuring 98~m by 74~m by 15~m in height and had fires in the range of 5.5~MW to 6.6~MW. The results  of
this study indicate that  FDS simulations with grids of 0.15~m had temperature predictions as accurate as models with grids as  small as 0.10~m. Each
of these grid  sizes produced results within   15~\%   of   the   University   of   Canterbury   temperature measurements. The 0.30~m grid  produced
less accurate results. For the comparison of the Navy Hangar tests, grid sizes ranging from 0.60~m to 1.80~m yielded results of comparable accuracy.

Musser~{\em et  al.}~\cite{Musser:1} investigated  the use of  FDS for course grid  modeling of non-fire and fire  scenarios. Determining the
appropriate  grid  size was  found  to  be  especially important  with respect  to heat  transfer  at heated  surfaces.  The convective  heat
transfer  from the  heated surfaces  was most  accurate when  the near surface grid cells were smaller than the depth of the thermal boundary layer.
However, a  finer grid  size  produced better  results at  the expense of computational time. Accurate contaminant dispersal modeling required a
significantly finer grid. The results of her study indicate that  non-fire simulations  can be  completed more  quickly  than fire simulations
because  the time  step is not  limited by the  large flow speeds in a fire plume.


\subsection{Sensitivity of Large Eddy Simulation Parameters}

FDS  uses the  Smagorinsky form  of  the Large  Eddy Simulation  (LES) technique.  This  means  that   instead  of  using  the  actual  fluid
viscosity, the model uses a viscosity of the form
\be
  \mu_{\hbox{\tiny LES}} =  \rho \,  (C_s\, \Delta)^2  \, |S|
\ee
where $C_s$  is an empirical constant, $\Delta$ is a length on the order of the size of a grid  cell,  and  the  deformation   term  $|S|$  is
related  to  the Dissipation Function (see FDS Technical Reference Guide~\cite{FDS_Math_Guide} for details). Related to the ``turbulent  viscosity'' are  comparable
expressions  for  the thermal conductivity  and  material diffusivity:  \be  k_{\hbox{\tiny LES}}  = \frac{\mu_{\hbox{\tiny  LES}}   \;  c_p}{\PR_t}
\quad   ;  \quad  (\rho D)_{\hbox{\tiny  LES}}  =\frac{\mu_{\hbox{\tiny  LES}}}{\SC_t}  \ee  where $\PR_t$ and $\SC_t$ are the turbulent Prandtl and Schmidt numbers, respectively.
Thus, $C_s$, $\PR_t$  and $\SC_t$ are  a set  of  empirical constants.  Most  FDS users
simply use  the default values  of (0.2,0.5,0.5), but some have  explored their effect on the solution of the equations.

In an effort  to validate FDS with some  simple room temperature data, Zhang~{\em et al.}~\cite{Zhang:2}  tried different combinations of the
Smagorinsky parameters,  and suggested the current  default values. Of the  three parameters,  the  Smagorinsky constant  $C_s$  is the  most
sensitive.   Smagorinsky~\cite{Smagorinsky:1}  originally  proposed  a value of 0.23,  but researchers over the past  three decades have used values
ranging  from 0.1  to 0.23. There  are also refinements  of the original  Smagorinsky  model~\cite{Deardorff:1,Germano:1,Lilly:1} that do  not
require the  user  to  prescribe  the constants,  but  rather generate them automatically as part of the numerical scheme.

\subsection{Sensitivity of Radiation Parameters}

Radiative heat  transfer is  included in FDS  via the solution  of the radiation  transport equation for  a non-scattering  gray gas,  and in some
limited  cases using  a wide band  model. The equation  is solved using  a technique  similar to  finite volume  methods  for convective transport,
thus the  name given  to it  is the  Finite  Volume Method (FVM).  There  are  several  limitations  of  the  model.  First,  the absorption
coefficient  for the smoke-laden gas is  a complex function of  its  composition  and   temperature.  Because  of  the  simplified combustion  model,
the  chemical  composition of  the  smokey  gases, especially  the  soot content,  can  effect  both  the absorption  and emission  of thermal
radiation.  Second, the  radiation transport  is discretized via  approximately 100 solid angles. For  targets far away from  a  localized source  of
radiation,  like  a growing  fire,  the discretization can  lead to a non-uniform distribution  of the radiant energy. This can be seen in the
visualization of surface temperatures, where  ``hot spots'' show  the effect  of the  finite number  of solid angles. The  problem can  be lessened
by  the inclusion of  more solid angles, but at  a price of longer computing times.  In most cases, the radiative flux  to far-field targets is  not
as important  as those in the near-field, where coverage by the default number of angles is much better.

Hostikka {\em et al.} examined the sensitivity of the radiation solver to changes in  the assumed soot production, number  of spectral bands, number
of control  angles, and  flame temperature.  Some of  the more interesting findings were:
\begin{itemize}
\item  Changing  the  soot  yield  from 1~\%  to  2~\%  increased  the
radiative flux from a simulated methane burner about 15~\%
\item Lowering  the soot  yield to zero  decreased the  radiative flux
about 20~\%.
\item Increasing  the number of  control angles by  a factor of  3 was
necessary  to  ensure  the  accuracy  of the  model  at  the  discrete measurement locations.
\item Changing the number of spectral  bands from 6 to 10 did not have
a strong effect on the results.
\item Errors of 100~\% in heat  flux were caused by errors of 20~\% in
absolute temperature.
\end{itemize}
The  sensitivity  to  flame   temperature  and  soot  composition  are consistent with  combustion theory, which states that  the source term of the
radiative transport equation  is a function of  the absorption coefficient  multiplied  by the  absolute  temperature  raised to  the fourth  power.
The  number of  control angles  and spectral  bands are user-controlled numerical  parameters whose sensitivities  ought to be checked  for  each
new  scenario.  The  default  values  in  FDS  are appropriate for  most large scale fire  scenarios, but may  need to be refined for  more detailed
simulations  such as a  low-sooting methane burner.


\subsection{Sensitivity of Thermophysical Properties of Solid Fuels}

An  extensive amount  of  verification and  validation  work with  FDS version 4  has been  performed by Hietaniemi,  Hostikka, and  Vaari at VTT,
Finland~\cite{Hietaniemi:1}. The case  studies are  comprised of fire  experiments   ranging  in   scale  from  the   cone  calorimeter (ISO~5660-1)
to  full-scale fire  tests such as  the room  corner test (ISO~9705).  Comparisons are also  made between  FDS results  and data obtained  in the
SBI (Single  Burning Item)  Euro-classification test apparatus (EN  13823) as  well as  data obtained in  two {\em  ad hoc} experimental
configurations:  one is similar  to the room  corner test but has only  partial linings and the other is a  space to study fires in building
cavities.

All of the  case studies involve real materials  whose properties must be prescribed  so as to conform  to the assumption in  FDS that solids are of
uniform composition backed by a material that is either cold or totally insulating. Sensitivity of the various physical properties and the boundary
conditions were tested. Some of the findings were:
\begin{itemize}
\item  The measured  burning  rates of  various  materials often  fell
between two FDS  predictions in which cold or  insulated backings were assumed for the solid surfaces. FDS lacks a multi-layer solid model.
\item  The ignition  time of  upholstery is  sensitive to  the thermal
properties  of the  fabric covering,  but the  steady burning  rate is sensitive to the properties of the underlying foam.
\item Moisture content of wooden fuels is very important and difficult
to measure.
\item Flame spread  over complicated objects, like cables  laid out in
trays, can be modeled if the  surface area of the simplified object is comparable to that  of the real object. This  suggests sensitivity not only to
physical properties,  but also geometry.  It is  difficult to quantify the extent of the geometrical sensitivity.
\end{itemize}
There is  little quantification of  the observed sensitivities  in the study. Fire  growth curves can be  linear to exponential  in form, and small
changes in  fuel  properties  can lead  to  order of  magnitude changes  in heat  release rate  for unconfined  fires. The  subject is
discussed  in the  FDS  Validation Guide (Volume 3 of the Technical Reference Guide).
where it is  noted in many of the studies  that predicting fire growth is difficult.

Recently, Lautenberger, Rein and Fernandez-Pello~\cite{Lautenberger:FSJ} developed a method to automate the
process of  estimating material properties to input  into FDS. The methodology involves simulating a  bench-scale test with the model and iterating
via a  "genetic"  algorithm  to obtain  an  optimal set  of material  properties for  that  particular item.  Such techniques  are necessary because
most bench-scale apparatus do not provide a complete set of thermal properties.



\section{Code Checking}
\label{Code Checking}

An examination of the structure of the computer program can be used to detect potential errors in the numerical solution of the governing equations.
The coding can be verified by a third party either manually or automatically with profiling programs to detect irregularities and
inconsistencies~\cite{ASTM:E1355}.

At NIST, VTT, and elsewhere, FDS has been compiled and run on computers manufactured by IBM, Hewlett-Packard, Sun Microsystems, Digital Equipment
Corporation, Apple, Silicon Graphics, Dell, Compaq, and various other personal computer vendors. The operating systems on these platforms include
Unix, Linux, Microsoft Windows, and Mac OSX. Compilers used include Lahey Fortran, Digital Visual Fortran, Intel Fortran, IBM XL Fortran, HPUX
Fortran, Forte Fortran for SunOS, the Portland Group Fortran, and several others. Each combination of hardware, operating system and compiler
involves a slightly different set of compiler and run-time options and a rigorous evaluation of the source code to test its compliance with the
Fortran 90 ISO/ANSI standard~\cite{F90}. FDS is now compliant with the Fortran~2003 standard. Through this process, out-dated and potentially harmful code is updated or eliminated, and often the code is
streamlined to improve its optimization on the various machines. However, simply because the FDS source code can be compiled and run on a wide
variety of platforms does not guarantee that the numerics are correct. It is only the starting point in the process because it at least rules out the
possibility that erratic or spurious results are due to the platform on which the code is running.

Beyond hardware issues, there are several useful techniques for checking the FDS source code that have been developed over the years. One of the
best ways is to exploit symmetry. FDS is filled with thousands of lines of code in which the partial derivatives in the conservation equations are
approximated as finite differences. It is very easy in this process to make a mistake. Consider, for example, the finite difference approximation of
the thermal diffusion term in the $ijk$th cell of the three-dimensional grid:
\begin{eqnarray*}
(\nabla \cdot k \nabla T)_{ijk} &\approx&
              \frac{1}{\dx}
         \left[k_{i+\ha,jk}\frac{T_{i+1,jk}-T_{ijk}}{\dx}
              -k_{i-\ha,jk}\frac{T_{ijk}-T_{i-1,jk}}{\dx}\right]+  \nonumber \\
            &&\frac{1}{\dy}
         \left[k_{i,j+\ha,k}\frac{T_{i,j+1,k}-T_{ijk}}{\dy}
              -k_{i,j-\ha,k}\frac{T_{ijk}-T_{i,j-1,k}}{\dy}\right]+ \nonumber \\
            &&\frac{1}{\dz}
         \left[k_{ij,k+\ha}\frac{T_{ij,k+1}-T_{ijk}}{\dz}
              -k_{ij,k-\ha}\frac{T_{ijk}-T_{ij,k-1}}{\dz}\right]
\end{eqnarray*}
which is written as follows in the Fortran source code:
\begin{verbatim}
      DTDX = (TMP(I+1,J,K)-TMP(I,J,K))*RDXN(I)
      KDTDX(I,J,K) = .5*(KP(I+1,J,K)+KP(I,J,K))*DTDX
      DTDY = (TMP(I,J+1,K)-TMP(I,J,K))*RDYN(J)
      KDTDY(I,J,K) = .5*(KP(I,J+1,K)+KP(I,J,K))*DTDY
      DTDZ = (TMP(I,J,K+1)-TMP(I,J,K))*RDZN(K)
      KDTDZ(I,J,K) = .5*(KP(I,J,K+1)+KP(I,J,K))*DTDZ

      DELKDELT = (KDTDX(I,J,K)-KDTDX(I-1,J,K))*RDX(I) +
     .           (KDTDY(I,J,K)-KDTDY(I,J-1,K))*RDY(J) +
     .           (KDTDZ(I,J,K)-KDTDZ(I,J,K-1))*RDZ(K)
\end{verbatim}
This is one of the simpler constructs because the pattern that emerges within the lines of code make it fairly easy to check. However, a mis-typing
of an {\ct I} or a {\ct J}, a plus or a minus sign, or any of a hundred different mistakes can cause the code to fail, or worse produce the wrong
answer. A simple way to eliminate many of these mistakes is to run simple scenarios that have perfectly symmetric initial and boundary conditions.
For example, put a hot cube in the exact center of a larger cold compartment, turn off gravity, and watch the heat diffuse from the hot cube into the
cold gas. Any simple error in the coding of the energy equation will show up almost immediately. Then, turn on gravity, and in the absence of any
coding error, a perfectly symmetric plume will rise from the hot cube. This checks both the coding of the energy and the momentum equations. Similar
checks can be made for all of the three dimensional finite difference routines. So extensive are these types of checks that the release version of
FDS has a routine that generates a tiny amount of random noise in the initial flow field so as to eliminate any false symmetries that might arise in
the numerical solution.

The process of adding new routines to FDS is as follows: typically the routine is written by one person who takes
the latest version of the source code, adds the new routine, and writes a theoretical and numerical description for the FDS Technical Reference
Guide, plus a description of the input parameters for the FDS User's Guide. The new version of FDS is then tested with a number of benchmark
scenarios that exercise the range of the new parameters.  Provisional acceptance of the new routine is based on several factors: (1) it produces more
accurate results when compared to experimental measurement, (2) the theoretical description is sound, and (3) any empirical parameters are obtainable
from the open literature or standard bench-scale apparatus.  If the new routine is accepted, it is added to the working version of the software and
evaluated by running the standard verification and validation test cases. Assuming that there are no intractable issues that arise
during the testing period, the new routine eventually becomes part of the release version of FDS.

Even with all the code checking, it is still possible for errors to go unnoticed. One remedy is the fact that the source code for
FDS is publicly released. Although it consists of on the order of 100,000 lines of Fortran statements, various independent researchers have been
able to work with it, add enhancements needed for very specific applications or for research purposes, and report back to the developers bugs that
have been detected. The source code is organized into 27 separate files, each containing subroutines related to a particular feature of the model,
like the mass, momentum, and energy conservation equations, sprinkler activation and sprays, the pressure solver, {\em etc.} The lengthiest routines
are devoted to input, output and initialization.  Most of those working with the source code do not concern themselves with these lengthy routines
but rather focus on the finite-difference algorithm contained in a few of the more important files. Most serious errors are found in these files, for
they contain the core of the algorithm. The external researchers provide feedback on the organization of the code and its internal documentation,
that is, comments within the source code itself.  Plus, they must compile the code on their own computers, adding to its portability.



\chapter{The Basic Flow Solver}


In this chapter we present test cases aimed at exercising the advective, pressure, and viscous terms, as well as the time integration for non-reacting flows.


\section{2D Analytical Solution to Navier-Stokes}
\label{ns2d}

In this section we present an analytical solution that is useful for confirming the convergence rates of the truncation errors in the discretization of the terms in
the governing equations. Consider the 2D incompressible Navier-Stokes equations
\begin{equation}
\label{eqn_NS}
\frac{\partial \mathbf{u}}{\partial t} + \mathbf{u} \cdot \nabla \mathbf{u} = - \nabla{p} + \nu \nabla^2 \mathbf{u} \,\mbox{,}
\end{equation}
where the velocity is given by $\mathbf{u} = [u, v]^T$, and the kinematic viscosity and pressure are denoted $\nu$ and $p$, respectively.
An analytical solution of these equations is given by \cite{McDermott:NS2D}
\begin{eqnarray}
\label{eqn_usoln}
u(x,y,t) &=& 1 - A\cos(x-t)\sin(y-t)\,e^{-2\nu t} \,\mbox{,} \\
v(x,y,t) &=& 1 + A\sin(x-t)\cos(y-t)\,e^{-2\nu t} \,\mbox{,}
\end{eqnarray}
\begin{equation}
p(x,y,t) = -\frac{A^2}{4} \left[ \cos(2(x-t))+\cos(2(y-t))\right]e^{-4\nu t} \,\mbox{.}
\end{equation}
Here, $A$ represents an arbitrary amplitude and is assumed to take a value of 2 in this example.
Note that this solution satisfies continuity for all time,
\begin{equation}
\label{eqn_divfree}
\nabla\cdot\mathbf{u} = 0 \,\mbox{,}
\end{equation}
is spatially periodic on an interval $2\pi$ in each direction, and is temporally periodic on $2\pi$ if $\nu=0$; otherwise, the solution decays exponentially.
Below we present two series of tests which demonstrate the second-order accuracy of the FDS numerical scheme and thus provide a strong form of code verification
for the advective and viscous terms which are exercised.

The physical domain of the problem is a square of side $L=2\pi$.  The grid spacing is uniform $\delta x = \delta y = L/N$ in each direction
with $N =\{8,16,32,64\}$ for each test series.  The staggered grid locations are denoted $x_i = i \, \delta x$ and $y_j = j \, \delta y$, and the cell
centers are marked by an overbar, $\bar{x}_i = x_i - \delta x/2$ and $\bar{y}_j = y_j - \delta y/2$.

First, we present qualitative results for the case in which $\nu=0$.  Thus, only the advective discretization and the time integration are being tested.
Figure \ref{fig_ns2d_smv} shows the initial and final $(t=2\pi)$ numerical solution for the case $N=64$.
As mentioned, with $\nu=0$ the solution is periodic in time and this figure demonstrates that, as should be the case, the FDS numerical solution is unaltered after one flow-through time.

\begin{figure}[t]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/ns2d_64_start} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/ns2d_64_end} }
   \end{tabular*}
   \caption{Initial and final states of the $u$-component of velocity.}
   \label{fig_ns2d_smv}
\end{figure}

Next, in Figure \ref{fig_ns2d_timehistory}, we show time histories of the $u$-component of velocity at the center of the domain for the case in which $\nu = 0.1$.
It is clearly seen that the FDS solution (thin line) converges to the analytical solution (thick line).
Note that the analytical solution is evaluated at the same location as the FDS staggered grid location for the $u$-component
of velocity, $(x_{N/2},\bar{y}_{N/2})$, which is different in each case, $N =\{8,16,32,64\}$.

\begin{figure}[t]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/ns2d_8_nupt1} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/ns2d_16_nupt1} } \\
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/ns2d_32_nupt1} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/ns2d_64_nupt1} }
   \end{tabular*}
   \caption[Velocity time history, qualitative convergence]{Time history of the $u$-component of velocity half a grid cell below the center of the domain for a range of grid resolutions.
   The domain is a square of side $L = 2\pi$ m.  The $N \times N$ grid is uniform.  Progressing from left to right and top to bottom we have resolutions $N =\{8,16,32,64\}$
   clearly showing convergence of the FDS numerical solution (open circles) to the analytical solution (solid line).
   The case is run with constant properties, $\rho=1$ kg/m$^3$ and $\mu = 0.1$ kg/m/s, and a CFL of 0.25.}
   \label{fig_ns2d_timehistory}
\end{figure}

Figure \ref{fig_ns2d_convergence} is the key quantitative result of this verification test.  In this figure we plot the rms error, $\varepsilon_{\mbox{\scriptsize rms}}$,
in the $u$-component of velocity against the grid spacing.  The error is defined by
\begin{equation}
\label{eqn_rmserror}
\varepsilon_{\mbox{\scriptsize rms}} \equiv \sqrt{ \frac{1}{M} \sum_{k=1}^{M} \left[ U_{ij}^k - u(x_i,\bar{y}_j,t_k) \right]^2 } \,\mbox{,}
\end{equation}
where $M$ is the number of time steps and $k$ is the time step index.  The spatial indices are $(i=N/2,j=N/2)$ and $U_{ij}^k$ represents the FDS value for the $u$-component of
velocity at the staggered storage location for cell $(i,j)$ at time step $k$; $u(x_i,\bar{y}_j,t_k)$ is the analytical solution for the $u$-component at
the corresponding location in space and time.  The figure confirms that the advective terms, the viscous terms, and the time integration in the FDS code are convergent and second-order accurate.

\begin{figure}[t]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/ns2d_error.pdf} } &
      \scalebox{1}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/ns2d_nupt1_error.pdf} }
   \end{tabular*}
   \caption[Navier-Stokes convergence study]{(Left) Convergence rate for the $u$-component of velocity with $\nu = 0$ showing that the advective terms in the FDS code are second-order accurate.  The triangles represent the rms error in the $u$-component for grid spacings of $\delta x = L/N$ where $L = 2\pi$ m and $N = \{8,16,32,64\}$. The solid line represents first-order accuracy and the dashed line represents second-order accuracy. The simulation is run to a time of $t = 2\pi$~s with a CFL of $0.25$.  The $u$-component at the center of the domain is compared with the analytical solution at the same location.  (Right) Same case, except $\nu=0.1$, showing that the viscous terms in the FDS code are second-order accurate.}
   \label{fig_ns2d_convergence}
\end{figure}



\clearpage


\section{2D Vortex Simulation}
\label{two_dimensional_vortex}

In this section we present another case that demonstrates the second-order accuracy of the FDS code. FDS was used to model an analytically stable flow pattern consisting of a single stable vortex in a constant flow field. The ability of FDS to maintain the geometry of the vortex over time provides a good measure of the order of accuracy achieved by the FDS transport scheme.

The vortex is the gradient of the potential field,
\begin{equation}
\label{eqn_vort2d}
\Psi_{0} (x,z) = \Gamma \ \exp \left[ - \frac{x^{2} + z^{2}}{2 \ R_{c}^{2}} \right],
\end{equation}
where $\Gamma$ is a parameter that determines the intensity of the vortex and $R_{c}$ sets its characteristic size. This flow pattern is defined such that the point at the center of the two vortices is at $(x,z) = (0,0)$. The velocity components are determined by taking the gradient of the potential field,
\begin{eqnarray}
\label{eqn_uvel}
u (x,z) &\equiv& U_{0} + \frac{\partial}{\partial z} \Psi_{0} = U_{0} - \frac{\Gamma \ z}{R_{c}^{2}} \ Exp \left[ - \frac{x^{2} + z^{2}}{2 \ R_{c}^{2}} \right], \\
w (x,z) &\equiv& - \frac{\partial}{\partial x} \Psi_{0} = \frac{\Gamma \ x}{R_{c}^{2}} \ Exp \left[ - \frac{x^{2} + z^{2}}{2 \ R_{c}^{2}} \right],
\end{eqnarray} where $u$ and $w$ refer to velocity in the $x$- and $z$-directions respectively. For our purposes we need only analyze one component of the velocity field. We will focus our attention on the $u$-component of velocity.


We define the computational domain as a two-dimensional square region, $L=0.3112$ m on a side, with periodic boundary conditions. The domain is discretized on a range of square, two-dimensional meshes of $40^{2}$, $80^{2}$, $160^{2}$, and $320^{2}$ grid cells. For the purposes of this test, we set the flow parameters as
$$
\begin{array}{lll}
U_{0} &&= 35 \ \mathrm{m / s}, \\
R_{c} &= L / 20 &= 0.01.556 \ \mathrm{m}, \\
\Gamma &= 0.04 \ U_{0} \ R_{c} \ \sqrt{e} &= 0.03.59157.
\end{array}
$$

The constant flow field and periodic boundary conditions cause the vortex to loop through the computational domain. The `flow-through' time, $t_{f}$, may be defined as the time period required for the stable vortex to return to its original spatial coordinates,
\begin{equation*}
t_{f} = L / U_{0} \simeq 8.8914 \times 10^{-3} \ \mathrm{s}.
\end{equation*}
In order to ensure that our numerical simulation can converge to the analytical solution, we must ensure that the Courant-Friedrichs-Lewy (CFL) condition is met. By defining the time-step, $dt$, relative to the grid-cell size, $dx$, such that
\begin{equation*}
dt = \frac{dx}{2 U_{0}},
\end{equation*}
we can maintain a CFL value of 0.5, which is well below the maximum CFL value of one.

\begin{figure}[h!]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \includegraphics[width=3.2in]{SCRIPT_FIGURES/vort2d_80_uzgraph} &
      \includegraphics[width=3.2in]{SCRIPT_FIGURES/vort2d_160_uzgraph}
   \end{tabular*}
   \caption{$u$-velocity along the $z$-axis at $x=0$ plotted for each of the vortex's first four loops through the computational domain. (Left) $80^{2}$ grid cell model. (Right) $160^{2}$ grid cell model.}
   \label{fig_vort2d_axisvelocity}
\end{figure}

A plot of $u$-velocity values just along the $z$-axis provides a simple characterization of the vortex's geometry. The extent to which this geometry changes over time provides a qualitative measure of the accuracy of the transport algorithm. Figure \ref{fig_vort2d_axisvelocity} displays such plots for two different grid resolutions. Each line represents a plot taken for a different number of flow-through times such that the red lines represent the vortex after it has undergone the most loops through the computational domain while the green lines represent the vortex in the initial first couple of loops. The broken black line in these plots represents the stable analytical solution. As the vortex undergoes more loops through the computational domain, its velocity profile diverges further and further from the analytically stable profile. While divergence still occurs on the finer mesh, the extent to which it diverges after the same number of flow-through times is significantly smaller.

\begin{center}
   \begin{figure}[h!]
         \includegraphics[width=6.0in]{SCRIPT_FIGURES/vort2d_error}
      \caption{Rms error between simulated and analytical $u$-velocity values along the $z$-axis plotted for each grid resolution at each of three subsequent passes of the vortex through the computational domain.}
      \label{fig_vort2d_error}
   \end{figure}
\end{center}

The rate with which the simulated profiles converge to the analytical ones by means of grid refinement describes the order of error experienced as a result of our numerical methods. In Figure \ref{fig_vort2d_error} we plot the rms error resulting from differences between the simulated and analytical profiles for each grid resolution. A log-log plot is used so that power relations appear as straight lines. The three color lines represents the rms error as a function of grid-cell size for each of three subsequent loops of the vortex through the computational domain. The broken and solid black lines represent the plot gradient corresponding to first and second order error respectively. While the error increases with each flow-through time, the gradients of the lines are roughly parallel to the solid black line, indicating second order error in our numerical methods.

\subsection{Time-Dependent Solution}

In order to analyze the stability of the vortex at times other than the flow-through time, it was necessary to derive the time-dependent solution. Given the periodic boundary conditions, the time-dependent governing equation and its corresponding $u$-velocity field are
\begin{equation}
\label{eqn_vort2d_timedep}
\Psi (x,z,t) = \Psi_{0} \ Exp \left[\frac{2 \ U_{0} \ x \ t - U_{0}^{2} \ t^{2}}{2 \ R_{c}^{2}} \right],
\end{equation}
\begin{equation}
\label{eqn_uvel_timedep}
u (x,z,t) = U_{0} - \Psi_{0} \ \frac{z}{R_{c}^{2}} \ Exp \left[\frac{2 \ U_{0} \ x \ t - U_{0}^{2} \ t^{2}}{2 \ R_{c}^{2}} \right].
\end{equation}

\begin{figure}[h!]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \includegraphics[width=3.2in]{SCRIPT_FIGURES/vort2d_80_upgraph} &
      \includegraphics[width=3.2in]{SCRIPT_FIGURES/vort2d_160_upgraph}
   \end{tabular*}
   \caption{Simulated and analytical values of $u$-velocity at a point plotted as a function of time over a time period equal to four times the flow-through time. (Left) $80^{2}$ grid cell model. (Right) $160^{2}$ grid cell model.}
   \label{fig_vort2d_pointvelocity}
\end{figure}

We collected $u$-velocity data for a single point in the computational domain, on the lower left fringe of the vortex. Plotting this data over the analytical time-dependent solution portrays exactly where and to what extent the numerical model deviates from the analytical as time progresses. Over time, the original peak that marks the passage of the vortex through the point becomes surrounded by smaller secondary peaks. Figure \ref{fig_vort2d_pointvelocity} shows this data for each of our four meshes, demonstrating the accuracy of each model.



\clearpage


\section{Decaying Isotropic Turbulence}
\label{decaying_isotropic_turbulence}

In this section we present a canonical flow for LES which tests whether the subgrid stress model has been coded properly. In some cases the difference between verification and validation is not so clear.  Once a model is well-established and validated it may actually be used as a form of verification.  Granted, such a test is not as strong a verification as the convergence study shown in Section \ref{ns2d}.  Nevertheless, these tests are often quite useful in discovering problems within the code.  The case we examine in this section, decaying isotropic turbulence, is highly sensitive to errors in the advective and diffusive terms because the underlying physics is inherently three-dimensional and getting the problem right depends strongly on a delicate balance between vorticity dynamics and dissipation.  An even more subtle yet extremely powerful verification test is also presented in this section when we set both the molecular and turbulent viscosities to zero and confirm that the integrated kinetic energy within the domain remains constant.   In the absence of any form of viscosity, experience has shown that the slightest error in the advective terms or the pressure projection will cause the code to go unstable.  This verification is therefore stronger than one might initially expect.

In this section we test the FDS model against the low Reynolds number (Re) data of Comte-Bellot and Corrsin (CBC) \cite{CBC}. Viscous effects are important in this data set for a well-resolved LES, testing the model's Re dependence.  Following \cite{SdBK}, we use a periodic box of side $L = 9 \times 2\pi$ centimeters ($\approx 0.566$ m) and $\nu = 1.5 \times 10^{-5}$ $\mbox{m}^2/\mbox{s}$ for the kinematic viscosity. The non-dimensional times for this data set are: $x/M = 42$ (initial condition), $98$, and $171$, where $M$ is the characteristic mesh spacing of the CBC wind tunnel and $x$ is the downstream location of the data station. Considering the mean velocity in the CBC wind tunnel experiment, these correspond to dimensional times of $t = 0.00$, $0.28$, and $0.66$ seconds in our simulations.

The initial condition for the FDS simulation is generated by superimposing Fourier modes with random phases such that the spectrum matches that of the initial CBC data.  An iterative procedure is employed where the field is allowed to decay for small time increments subject to Navier-Stokes physics, each wavenumber is then injected with energy to again match the initial filtered CBC spectrum.  The specific filter used here is discussed in \cite{McDermott:2005b}.

To provide the reader with a qualitative sense of the flow, Figure \ref{fig_cbc_smv} shows the initial and final states of the velocity field in the 3D periodic domain.  The flow is unforced and so if viscosity is present the total energy decays with time due to viscous dissipation.

\subsection{Constant Smagorinsky}

Because the viscous scales are unresolved, a subgrid stress model is required. Here the stress is closed using the gradient diffusion hypothesis and the eddy viscosity is modeled by the constant coefficient Smagorinsky model with the coefficient taken to be $C_s = 0.2$ (see the Technical Reference Guide for further details).

The decay curves for two grid resolutions are shown plotted on the left in Figure \ref{fig_cbc_energy}.  For an LES code such as FDS which uses a physically-based subgrid model, an important verification test is to run this periodic isotropic turbulence simulation in the absence of both molecular and turbulent viscosity.  For so-called ``energy-conserving'' explicit numerics the integrated energy will remain nearly constant in time.  This is demonstrated by the blue line in the top-left plot in Figure \ref{fig_cbc_energy}.  The deviations from identical energy conservation (to machine precision) are due solely to the time discretization (the spatial terms are conservative as discussed in \cite{Morinishi}) and converge to zero as the time step goes to the zero.  Note that strict energy conservation requires implicit time integration \cite{Ham,McDermott:2007b} and, as shown by the red curve on the same plot where only molecular viscosity is present in the simulation, this cost is unwarranted given that the molecular dissipation rate clearly overshadows the relatively insignificant amount of numerical dissipation caused by the explicit method.  The FDS result using the Smagorinsky eddy viscosity (the black solid line) matches the CBC data (red open circles) well for the $32^3$ case (top-left).  However, the FDS results are slightly too dissipative in the $64^3$ case (bottom-left).  This is due to a well-known limitation of the constant coefficient Smagorinsky model: namely, that the eddy viscosity does not converge to zero at the appropriate rate as the filter width (here equivalent to the grid spacing) is decreased.
\begin{figure}[t]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/csmag_64_000} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/csmag_64_689} }
   \end{tabular*}
   \caption{\label{fig_cbc_smv} Initial and final states of the isotropic turbulence field.}
\end{figure}

To the right of each decay curve plot in Figure \ref{fig_cbc_energy} is the corresponding spectral data comparison.  The three black solid lines are the CBC spectral data for the points in time corresponding to dimensional times of $t = 0.00$, $0.28$, and $0.66$ seconds in our simulations.  As described above, the initial FDS velocity field (represented by the black dots) is specified to match the CBC data up to the grid Nyquist limit.  From there the spectral energy decays rapidly as discussed in \cite{McDermott:2005b}.  For each of the spectral plots on the right, the results of interest are the values of the red and blue dots and how well these match up with the corresponding CBC data.  For the $32^3$ case (top-right) the results are remarkably good.  Interestingly, the results for the more highly resolved $64^3$ case are not as good.  This is because the viscous scales are rather well-resolved at the later times in the experiment and, as mentioned, it is well-known that the constant coefficient Smagorinsky model is too dissipative under such conditions.

\begin{figure}[t]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/csmag_32_decay.pdf} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/csmag_32_spectra.pdf} } \\
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/csmag_64_decay.pdf} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/csmag_64_spectra.pdf} }
   \end{tabular*}
   \caption[Integrated and spectral energy decay for Comte-Bellot Corrsin experiment using constant coefficient Smagorinsky.]{\label{fig_cbc_energy} \small (Left) Time histories of integrated kinetic energy corresponding to the grid resolutions on the right side of the figure.  In the $32^3$ case (top), the CBC data (open circles) are obtained by applying a filter to the CBC energy spectra at the Nyquist limit for an $N=32$ grid.  Similarly, for the $64^3$ case (bottom), the CBC data are obtained from filtered spectra for an $N=64$ grid.  Notice that the integrated FDS results for the $32^3$ case compare better with the filtered CBC data than the $64^3$ results.  This is a well-known limitation of the constant coefficient Smagorinsky model: namely, that the eddy viscosity does not converge to zero at the appropriate rate as the filter width (here equivalent to the grid spacing) is decreased. (Right) Energy spectra for the $32^3$ case (top) and the $64^3$ case (bottom).  The solid black lines are the spectral data of Comte-Bellot and Corrsin at three different points in time corresponding to downstream positions in the turbulent wind tunnel.  The initial condition for the velocity field (spectra shown as black dots) in the FDS simulation is prescribed such that the energy spectrum matches the initial CBC data.  The FDS energy spectra corresponding to the subsequent CBC data are shown by the red and blue dots. The vertical dashed line represents the wavenumber of the grid Nyquist limit. }
\end{figure}

Overall, the agreement between the FDS simulations and the CBC data is satisfactory and any discrepancies can be explained by limitations of the model.  Therefore, as a verification the results here are positive in that nothing points to coding errors.




\clearpage

\subsection{Dynamic Smagorinsky}
\label{dynamic_smagorinsky_model}

In the previous section, all calculations were performed with a constant and uniform Smagorinsky coefficient, $C_s = 0.2$.  For the canonical case of homogeneous decaying isotropic turbulence -- \emph{at sufficiently high Reynolds number} -- this model is sufficient.  However, we noticed that, even for the isotropic turbulence problem, when the grid Reynolds number is low (i.e., the flow is well-resolved) the constant coefficient model tends to over predict the dissipation of kinetic energy (see Figure \ref{fig_cbc_energy}).  This is because the eddy viscosity does not converge to zero at the proper rate; so long as strain is present in the flow (the magnitude of the stain rate tensor is nonzero), the eddy viscosity will be nonzero.  This violates a guiding principle in LES development: that the method should converge to a DNS if the flow field is sufficiently resolved \cite{McDermott:2007}.

The dynamic procedure for calculating the model coefficient ({\tt TURBULENCE\_MODEL=`DYNAMIC SMAGORINSKY'} on {\tt MISC}) alleviates this problem.  The basis of the model is that the coefficient should be the same for two different filter scales within the inertial subrange.  Details of the procedure are explained in the following references \cite{Germano:1991,PinoMartin:2000,Moin:1991,Lund:1997,FDS_Math_Guide}.  Here we present results for the implementation of the dynamic model in FDS.  In Figure~\ref{fig_c_smag} we show contours of the Smagorinsky coefficient $C_s(\mathbf{x},t)$ at a time midway through a $64^3$ simulation of the CBC experiment.  Notice that the coefficient ranges from 0.00 to roughly 0.30 within the domain with the average value falling around 0.17.

\begin{figure}[t]
   \begin{center}
      \includegraphics[height=3.00in]{SCRIPT_FIGURES/dsmag_64_300}
      \caption{\label{fig_c_smag} Smagorinsky coefficient for a $64^3$ simulation of the CBC experiment.}
   \end{center}
\end{figure}

Next, in Figure \ref{fig_dynsmag_cbc}, we show results for the dynamic model analogous to Figure \ref{fig_cbc_energy}.  For the $32^3$ case the result is not dramatically different than the constant coefficient model.  In fact, one might argue that the $32^3$ constant coefficient results are slightly better.  But there are several reasons why we should not stop here and conclude that the constant coefficient model is superior.  First, as pointed out in Pope Exercise 13.34 \cite{Pope:2000}, $38^3$ is required to resolve 80\% of the total kinetic energy (for this flow) and thus put the cutoff wavenumber within the inertial subrange of turbulent length scales.  Pope recommends that simulations which are under-resolved by this criterion should be termed ``very large-eddy simulations'' -- weather forecasting is a typical example.  For a $32^3$ LES, the test filter width in the dynamic model falls at a resolution of $16^3$, clearly outside the inertial range.  A tacit assumption underlying the original interpretation of the dynamic model is that both the grid filter scale and the test filter scale should fall within the inertial range, since this is the range in which the scales of turbulent motion (in theory) exhibit fractal-like, scale similar behavior (recently the procedure has been derived from other arguments \cite{Pope:2004}).  With this in mind, it is perhaps not surprising that the dynamic model does not perform optimally for the low resolution case.  In the higher resolution $64^3$ case, however, the dynamic model does perform better than the constant coefficient model -- and this is the desired result: we want better performance at higher resolution.  As can be seen from the energy spectra (lower right), the energy near the grid Nyquist limit is more accurately retained by the dynamic model.  This equates to better flow structure with fewer grid cells.  Thus, for practical calculations of engineering interest the small computational overhead of computing the coefficient may be recuperated by a reduction is cell count.

\begin{figure}[h]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/dsmag_32_decay.pdf} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/dsmag_32_spectra.pdf} } \\
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/dsmag_64_decay.pdf} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/dsmag_64_spectra.pdf} }
   \end{tabular*}
   \caption[Integrated and spectral energy decay for Comte-Bellot Corrsin experiment using dynamic Smagorinsky.]{\label{fig_dynsmag_cbc} Dynamic Smagorinsky model results (analogous to Figure \ref{fig_cbc_energy}) for integrated kinetic energy (left) and spectra (right).}
\end{figure}

\clearpage

\subsection{Deardorff}
\label{Deardorff_model}

\begin{figure}[h]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/deardorff_32_decay.pdf} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/deardorff_32_spectra.pdf} } \\
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/deardorff_64_decay.pdf} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/deardorff_64_spectra.pdf} }
   \end{tabular*}
   \caption[Integrated and spectral energy decay for Comte-Bellot Corrsin experiment using Deardorff's model.]{\label{fig_deardorff_cbc} Deardorff model results (analogous to Figure \ref{fig_cbc_energy}) for integrated kinetic energy (left) and spectra (right).}
\end{figure}

\clearpage

\subsection{Vreman}
\label{Vreman_model}

\begin{figure}[h]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/vreman_32_decay.pdf} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/vreman_32_spectra.pdf} } \\
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/vreman_64_decay.pdf} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/vreman_64_spectra.pdf} }
   \end{tabular*}
   \caption[Integrated and spectral energy decay for Comte-Bellot Corrsin experiment using Vreman's model.]{\label{fig_vreman_cbc} Vreman model results (analogous to Figure \ref{fig_cbc_energy}) for integrated kinetic energy (left) and spectra (right).}
\end{figure}

\clearpage

\section{Jet Centerline Velocity Decay}

{\bf Gregor J\"ager, BFT Cognos GmbH, Germany}\\

\noindent The jet\_ series in the Validation/Turbulent\_Jet directory tests the ability of subgrid stress closure (turbulence model) to correctly capture the transition from laminar to turbulent flow and subsequent momentum decay for an incompressible jet.

The FDS solution is compared with expermimental observations from K\"ummel \cite{Kummel:2007}. In the initial region of the jet, $x<x_0$, the velocity $u$ is constant near the axis and is equal to the velocity at the nozzle orifice ($u_0$). For a rectangular nozzle orifice of height $h = 0.8$ and width $b = 0.8$, the initial length is calculate by
\begin{equation}
x_0 = \frac{h}{m}
\end{equation}
where the mixed number $m$ is between 0.12 and 0.20.

In the transition region, viscous mixing spreads over the entire jet flow and the flow velocity along the axis decreases. The mean flow velocity at the jet centerline $u_{max}(x)$ is calculate by
\begin{equation}
u_{max}(x) =    \frac{x_0}{x}\sqrt{\frac{b}{h}} = \frac{1}{mx} \sqrt{bh}
\end{equation}

Four turublence models are tested: (1) Constant Smagorinsky (csmag), (2) Dynamic Smagorinsky (dsmag), (3) Deardorff (FDS default), and (4) Vreman.  The results are plotted in Fig.~\ref{fig_jet_decay}. For each model, two grid resolutions are run, corresponding to $h/\delta x = 8$ (colored dotted lines) and $h/\delta x=16$ (colored solid lines).
\begin{center}
\begin{figure}[h]
  \includegraphics[width=\textwidth]{SCRIPT_FIGURES/jet_decay.pdf}
  \caption[Jet Centerline Velocity Decay]{Centerline velocity decay for a high Reynods number jet (Re$_h = 1 \times 10^5$) with a square orifice of side $h$.  FDS results (colored lines) are shown for various turbulence models at two grid resolutions.  For comparison, analytical results (black lines) are shown for two values of the mixing number $m$.}
  \label{fig_jet_decay}
\end{figure}
\end{center}

\clearpage

\section{FDS Wall Flows Part I: Straight Channels}
\label{fds_wall_flows1}

Wall flows are challenging for large-eddy simulation (LES) \cite{Baggett:1997,Baggett:1998,Cabot:1995,Pope:2000,Sagaut:2001}.  In spite of their promise and sophistication, practical LES codes are resigned to \emph{model} the wall shear stress as opposed to \emph{resolving} the dynamically important length scales near the wall.

FDS uses the Werner and Wengle (WW) wall model \cite{Werner:1991} and the rough wall log law from Pope \cite{Pope:2000} for modeling turbulent flow around complex geometry and complex terrain.  Such models are required in order for FDS to accurately model, for example, tunnel fires, smoke transport in complex architectures, and wildland-urban interface (WUI) fires. As a minimum requirement, a wall model should accurately reproduce the mean wall stress for flow in a straight channel.  We verify that this is true for FDS by reproducing the Moody chart, a plot of friction factor versus Reynolds number for pipe flow \cite{Moody:1944}.

The remainder of this section is organized as follows. In Section \ref{formulation} we describe the model formulation. Then, in Section \ref{results}, we conduct a verification study of the wall boundary conditions for laminar and turbulent flows in FDS.  From this study we are able to draw quantitative conclusions in Section \ref{conclusions} about the accuracy of the channel flow simulations for smooth and rough walls.

\subsection{Formulation}
\label{formulation}

Details of the FDS formulation are given in the Technical Guide \cite{FDS_Math_Guide}.  Here we provide only the salient components of the model necessary for treatment of constant density channel flow.

The filtered continuity and momentum equations are:
\begin{equation}
\label{eqn_cont}
\frac{\partial \bar{u}_i}{\partial x_i} = 0 \,\mbox{,}
\end{equation}
\begin{equation}
\label{eqn_mom1}
\frac{\partial \bar{u}_i}{\partial t} + \frac{\partial \bar{u}_i \bar{u}_j}{\partial x_j} = -\frac{1}{\rho} \left[ \frac{\mbox{d}p}{\mbox{d}x_i} + \frac{\partial \tilde{p}}{\partial x_i} + \frac{\partial \bar{\tau}_{ij}}{\partial x_j} + \frac{\partial \tau_{ij}^{r}}{\partial x_j} \right]\,\mbox{,}
\end{equation}
where $\tau_{ij}^{r}$ is the deviatoric part of the residual stress tensor, here modeled by gradient diffusion with dynamic Smagorinsky \cite{Germano:1991} used for the eddy viscosity.  In this work we specify a constant pressure drop $\mbox{d}p/\mbox{d}x$ in the streamwise direction to drive the flow.  The hyrdrodynamic pressure $\tilde{p}$ is obtained from a Poisson equation which enforces (\ref{eqn_cont}).

When (\ref{eqn_mom1}) is integrated over a cell adjacent to a smooth wall in an LES it turns out that the most difficult term to handle is the viscous stress at the wall, e.g. $\bar{\tau}_{xz}|_{z=0}$, because the wall-normal gradient of the streamwise velocity component cannot be resolved.  Note that the sgs stress at the wall is identically zero.  We have, therefore, an entirely different situation than exists in the bulk flow at high Reynolds number where the viscous terms are negligible and the sgs stress is of critical importance.  The quality of the sgs model still influences the wall stress, however, since other components of the sgs tensor affect the value of the near-wall velocity and hence the resulting viscous stress determined by the wall model.  In particular, it is important that the sgs model is \emph{convergent} (in the sense that the LES formulation reduces to a DNS as the filter width becomes small) so that as the grid is refined we can expect more accurate results from the simulation.  For smooth walls the model used for $\tau_w = \bar{\tau}_{xz}|_{z=0}$ in this work is the Werner and Wengle model \cite{Werner:1991} which is described in detail in the FDS Tech Guide.

For rough walls the momentum flux normal to the wall is balanced by inviscid drag forces on the surface elements \cite{TennekesLumley}.  In this case FDS models the stress by a rough wall log law (see Pope \cite{Pope:2000}).  Details are provided in the Tech Guide.

\subsection{Results}
\label{results}

\subsubsection{Laminar}
\label{laminar}

As verification of the no-slip boundary condition and further verification of the momentum solver in FDS, we perform a simple 2D laminar (Poiseuille) flow calculation of
flow through a straight channel.
The height of the channel is $H=1$ m and the length of the channel is $L=8$ m.
The number of grid cells in the streamwise direction $x$ is $N_x = 8$.  The number of cells in the wall-normal direction $z$ is varied $N_z = \{8,16,32,64\}$.
The fluid density is $\rho = 1.2$ kg m$^{-3}$ and the viscosity is $0.025$ kg m$^{-1}$ s$^{-1}$.
The mean pressure drop is prescribed to be $\mbox{d}p/\mbox{d}x = -1$ Pa m$^{-1}$ resulting in Re$_H \approx 160$.  The (Moody) friction factor $f$, which satisfies
\begin{equation}
\label{eqn_moodyf}
\Delta p = f \frac{L}{H} \frac{1}{2} \rho \bar{u}^2 \,\mbox{,}
\end{equation}
is determined from the steady state mean velocity $\bar{u}$ which is output by FDS for the specified pressure drop.  The exact friction factor for this flow is $f_{exact} = 24/\mbox{Re}_H$.  The friction factor error $|f-f_{exact}|$ is plotted for a range of grid spacings $\delta z = H/N_z$ in Figure \ref{fig_poiseuille_convergence} demonstrating second-order convergence of the laminar velocity field.
\begin{figure}
   \begin{center}
      \scalebox{.7}{\includegraphics{SCRIPT_FIGURES/poiseuille_convergence.pdf}}
      \caption[Convergence for laminar (Poiseuille) flow in a 2D channel]{\label{fig_poiseuille_convergence} FDS exhibits second-order convergence for laminar (Poiseuille) flow in a 2D channel.}
   \end{center}
\end{figure}

\subsubsection{Turbulent}
\label{turbulent}

\paragraph{Smooth Walls}

To verify the WW wall model for turbulent flow we perform 3D LES of a square channel with periodic boundaries in the streamwise direction and a constant and uniform mean pressure gradient driving the flow.  The problem set up is nearly identical to the laminar cases of the previous section except here we perform 3D calculations and maintain cubic cells as we refine the grid: we hold the ratio 8:1:1 between $N_x$:$N_y$:$N_z$ for all cases.  The cases shown below are identified by their grid resolution in the $z$ direction.  The velocity field is initially at rest and develops in time to a mean steady state driven by the specified mean pressure gradient.  The presence of a steady state is the result of a balance between the streamwise pressure drop and the integrated wall stress from the WW model.  FDS outputs the planar average velocity in the streamwise direction and once a steady state is reached this value is used to compute the Reynolds number and the friction factor.  Table \ref{tab_zplus} provides a case matrix: nine cases for three values of specified pressure drop and three grid resolutions.  The nominal Reynolds number (obtained post-run) is listed along with the friction factor from the most refined FDS case and the friction factor computed (iteratively) from the Colebrook equation,
\begin{equation}
\label{eqn_colebrook}
\frac{1}{\sqrt{f}} = -2.0 \log_{\scriptsize 10} \left( \frac{z_0/H}{3.7} + \frac{2.51}{\mbox{Re}_H\sqrt{f}} \right) \,\mbox{,}
\end{equation}
which is a fit to the turbulent range of the Moody chart (for example, see Ref.~\cite{MYO}).  The parameter $z_0/H$ is the relative
roughness where $H$ is the hydraulic diameter of the pipe or channel and Re$_H$ is the Reynolds number based on $H$.
To provide a qualitative picture of the flow field, Figure~\ref{fig_channel_flow_setup} shows contours of streamwise velocity
for the case $\mbox{d}p/\mbox{d}x = -1$ Pa m$^{-1}$ and $N_z=32$.
\begin{table}
\begin{center}
\caption[Case matrix for Moody chart]{\label{tab_zplus} Case matrix and friction factor results for turbulent channel flow with smooth walls.
The height of the first grid cell $\delta z$ is given in viscous units $z^+$ for each case.  Additionally, the table gives the nominal Reynolds number Re$_H$ and the FDS friction factor results compared to the Colebrook equation (\ref{eqn_colebrook}).}
\vspace{0.5cm}
\begin{tabular}{|*{9}{l|}}
\hline
$\mbox{d}p/\mbox{d}x$   & \multicolumn{3}{c|}{$z^+$} &  Re$_H$  & $f$ FDS  & $f$ Colebrook & rel. error \\
\hline (Pa/m)          & $N_z=8$          & $N_z=16$          & $N_z=32$          &                   & $(N_z=32)$ & Eq. (\ref{eqn_colebrook}) & \% \\
\hline\hline -0.01  & 190              & 95                & 47                & $5.9\times 10^4$  & 0.0212     & 0.0202   & 4.8                 \\
\hline -1.    & $1.9\times 10^3$ & 950               & 470               & $7.5\times 10^5$  & 0.0128     & 0.0122   & 4.6                 \\
\hline -100.  & $1.9\times 10^4$ & $9.5\times 10^3$  & $4.7\times 10^3$  & $9.8\times 10^6$  & 0.0077     & 0.0081   & 6.0                 \\
\hline
\end{tabular}
\end{center}
\end{table}
\begin{figure}
   \begin{center}
      \scalebox{0.6}{\includegraphics{FIGURES/channel_flow_setup.pdf}}
      \caption[LES of square duct flow]{\label{fig_channel_flow_setup} LES of square duct flow with smooth walls and periodic streamwise boundaries using dynamic Smagorinsky and the Werner Wengle wall model.  For this image $N_z=32$ and the mean pressure drop is $\mbox{d}p/\mbox{d}x = -1$ Pa m$^{-1}$ resulting in Re$_H = 7.5\times 10^5$ and a friction factor of $f=0.0128$.}
   \end{center}
\end{figure}

\paragraph{Rough Walls}

With the same grid set up as described above the smooth walls, a series of cases labeled as {\tt z0*} in the repository were run at various roughness heights, grid resolutions, and Reynolds numbers.  The results are presented together with the smooth wall cases in Fig.~\ref{fig_fds_moody_chart}.  The laminar cases provide accurate results for two different Reynolds numbers.  As can bee seen, both the smooth wall and rough wall treatments behave well over the range tested.
\begin{figure}
   \begin{center}
      \scalebox{0.9}{\includegraphics{SCRIPT_FIGURES/fds_moody_chart.pdf}}
      \caption[FDS Moody chart]{\label{fig_fds_moody_chart} The FDS Moody chart: friction factor, $f$, versus Reynolds number, Re. The solid line for $\mbox{Re} < 2000$ is the analytical result for 2D Poiseuille flow, $f=24/\mbox{Re}$. The solid lines for $\mbox{Re}>2000$ (from the Colebrook equation (\ref{eqn_colebrook})) are for turbulent flow at various levels of relative roughness $z_0/H$ shown on the right axis.  Stars are DNS results from FDS at a single grid resolution ($N_z=64$). Symbols are FDS results for 3D LES with dynamic Smagorinsky.  Black symbols show results for the Werner Wengle wall model at three grid resolutions ($N_z=\{8,16,32\}$).  Colored symbols are FDS results for the rough wall cases at different grid resolutions and relative roughnesses as differentiated by the symbol shapes.}
   \end{center}
\end{figure}

\subsection{Conclusions}
\label{conclusions}

In this work the FDS wall model has been verified for both laminar and turbulent flow through straight channels with smooth or rough walls.  It is shown that for the laminar (DNS) case FDS is second-order accurate.  It is suggested elsewhere that, as a rule of thumb, 10 \% accuracy is the best that can be expected from friction factor calculations of turbulent flow \cite{MYO}.  The Werner and Wengle wall model is adapted to variable density flows (though only constant density flows are tested here) for smooth walls and it is shown that FDS is capable of reproducing friction factors for a broad range of Reynolds numbers to within 6.0 \% relative accuracy.  A log law for rough walls is adopted to FDS with similar results.

\clearpage

\section{Analytical Solutions to the Continuity Equation}

Analytical solutions for primitive flow variables (density, velocity, pressure, etc.) are useful in the development and testing of numerical schemes for computational fluid dynamics (CFD).  For example, an analytical solution to the 2D incompressible Navier-Stokes (NS) equations is presented in Section \ref{ns2d} and is used to verify the spatial and temporal accuracy of momentum equation.  However, to our knowledge, there are no similar (i.e., time dependent and periodic in space) analytical solutions for the compressible NS equations, which could be used for verification of both compressible and variable-density low-Mach flow solvers.

The aim of the present work is to take a small step toward developing such analytical solutions.  The main idea is that, given a specified velocity field, the continuity equation can be rearranged into a linear hyperbolic PDE for the logarithm of the density.  Let $\rho$ denote the density and let $\mathbf{u} = [u,v]^T$ denote the velocity. The continuity equation (conservation of mass) can then be written as
\begin{equation}
\label{eqn_continuity}
\frac{\partial \ln \rho}{\partial t} + \mathbf{u} \cdot \nabla \ln \rho + \nabla\cdot \mathbf{u} = 0 \,\mbox{.}
\end{equation}
Further, for certain, simple specifications of the velocity, this PDE can be solved using the method of characteristics.

In what follows we present 1D and 2D solutions to (\ref{eqn_continuity}) for two basic irrotational flow fields.  All the solutions are periodic in space.  The first configuration is a pulsating flow that cycles between compressing the fluid toward the center and then the corners of the domain.  In the second configuration, time periodicity is achieved by using a constant and uniform advection velocity in combination with the compression waves.  This results in a solution with a qualitatively different character than the first.

\subsection{Pulsating 1D solution}
\label{soln_1d}

We specify the velocity as
\begin{equation}
\label{eqn_velocity1d}
u(x,t)  = B \sin(x) \cos(\omega t) \,\mbox{,}
\end{equation}
where $B$ is a constant amplitude and $\omega$ is the frequency of the compression cycle. The velocity divergence in 1D is then
\begin{equation}
\label{eqn_pdesource1d}
\frac{\partial u}{\partial x} = B \cos(x) \cos(\omega t) \,\mbox{.}
\end{equation}

Let $q \equiv \ln \rho$ (this notation is used through out this work).  The 1D continuity equation can then be written as the following linear hyperbolic PDE:
\begin{equation}
\label{eqn_cont1d}
\frac{\partial q}{\partial t} + B \sin(x) \cos(\omega t) \frac{\partial q}{\partial x} + B \cos(x) \cos(\omega t) = 0 \,\mbox{,}
\end{equation}
which can be solved using the method of characteristics to obtain the solution
\begin{equation}
\label{eqn_1dsoln}
q(x,t) = q(x_0[x,t],0) + \ln \left\{ \frac{ 1 + \tan^2\left(\frac{x_0[x,t]}{2}\right) \exp\left(\frac{2B}{\omega}\sin[\omega t]\right) }{ 1 + \tan^2\left(\frac{x_0[x,t]}{2}\right) } \right\} - \frac{B}{\omega} \sin(\omega t) \,\mbox{,}
\end{equation}
where the initial position is given by
\begin{equation}
\label{eqn_initialposition1d}
x_0(x,t) = 2 \arctan\left( \tan\left[\frac{x}{2}\right] \exp\left[-\frac{B}{\omega}\sin(\omega t)\right] \right) \,\mbox{.}
\end{equation}
Note that we have taken the initial time to be zero, as is done throughout this work.


\subsection{Pulsating 2D solution}
\label{soln_2d}

There is a simple extension of the 1D stationary wave solution to 2D. In this section we consider the velocity field $\mathbf{u}=[u,v]^T$ with components and velocity divergence given by
\begin{eqnarray}
\label{eqn_u2d}
u(x,t) &=& B \sin(x) \cos(\omega t) \,\mbox{,} \vspace{0.2cm}\\
v(y,t) &=& B \sin(y) \cos(\omega t) \,\mbox{,}
\end{eqnarray}
\begin{equation}
\label{eqn_div2d}
\nabla\cdot\mathbf{u} = B(\cos[x] + \cos[y]) \cos(\omega t) \,\mbox{,}
\end{equation}
where, again, $B$ is a constant amplitude and $\omega$ is the compression frequency.  The 2D continuity equation may then be written as
\begin{equation}
\label{eqn_cont2d}
\frac{\partial q}{\partial t} + B \sin(x) \cos(\omega t) \frac{\partial q}{\partial x} + B \sin(y) \cos(\omega t) \frac{\partial q}{\partial y} + B( \cos[x] + \cos[y]) \cos(\omega t) = 0 \,\mbox{,}
\end{equation}
where, again, $q \equiv \ln \rho(\mathbf{x},t)$.

The solution to (\ref{eqn_cont2d}) can be obtained by adding the solutions of the following two PDEs:
\begin{eqnarray}
\label{eqn_linearpdes}
\frac{\partial q_1}{\partial t} + B \sin(x) \cos(\omega t) \frac{\partial q_1}{\partial x} + B \cos(x) \cos(\omega t) &=& 0 \,\mbox{,} \vspace{0.3cm} \\
\frac{\partial q_2}{\partial t} + B \sin(y) \cos(\omega t) \frac{\partial q_2}{\partial y} + B \cos(y) \cos(\omega t) &=& 0 \,\mbox{.}
\end{eqnarray}
Thus, utilizing (\ref{eqn_1dsoln}) and (\ref{eqn_initialposition1d}), and replacing $q_1(x_0[x,t],0) + q_2(y_0[y,t],0)$ with $q_0(x,y,t)$, we find that the solution to (\ref{eqn_cont2d}) is
\begin{eqnarray}
\label{eqn_2dsoln}
q(x,y,t) &=& q_0(x,y,t) \nonumber\vspace{0.3cm}\\
&+& \ln \left\{ \frac{1 + a(x_0[x,t]) \exp \left( \frac{2B}{\omega} \sin[\omega t] \right)}{1 + a(x_0[x,t])} \right\} \nonumber\vspace{0.3cm}\\
&+& \ln \left\{ \frac{1 + a(y_0[y,t]) \exp \left( \frac{2B}{\omega} \sin[\omega t] \right)}{1 + a(y_0[y,t])} \right\} \nonumber\vspace{0.3cm}\\
&-& \frac{2B}{\omega} \sin(\omega t) \,\mbox{,}
\end{eqnarray}
where
\begin{equation}
\label{eqn_a}
a(z) \equiv \tan^2\left(\frac{z}{2}\right) \,\mbox{,}
\end{equation}
and the initial positions are given by
\begin{eqnarray}
\label{eqn_initpos2d}
x_0(x,t) &=& 2 \arctan\left( \tan\left[\frac{x}{2}\right] \exp\left[-\frac{B}{\omega}\sin(\omega t)\right] \right) \,\mbox{,} \vspace{0.3cm}\\
y_0(y,t) &=& 2 \arctan\left( \tan\left[\frac{y}{2}\right] \exp\left[-\frac{B}{\omega}\sin(\omega t)\right] \right) \,\mbox{.}
\end{eqnarray}
Note that the initial condition $q_0(x,y,t)$ is restricted to cases where $\frac{\partial q_0}{\partial x}$ is independent of $y$ and $\frac{\partial q_0}{\partial y}$ is independent of $x$.  That is, the function $q_0$ must be \emph{additively separable}.

An example of the solution to (\ref{eqn_2dsoln}) is shown in Figure \ref{fig_pulsating 2D wave}. The initial condition for the density is specified as $\rho(\mathbf{x},0) = 1$ and the amplitude and frequency are set to unity, $B=1$ and $\omega=1$.  FDS is run with three scalar transport schemes: central differencing, Superbee, and the CHARM flux limiter. The solution at $(x,y) = (3\pi/2, 3\pi/2)$ for successively finer grid resolutions is plotted as a time series on the left and may be compared with the analytical solution (black line). On the right, we confirm second-order convergence for the FDS implementation.  Central differencing and the CHARM limiter outperform Superbee for this problem because the solution is relatively smooth.

\begin{figure}[ht]
    \begin{tabular}{rl}
      \includegraphics[width=3.2in]{SCRIPT_FIGURES/pulsating_time_series.pdf} &
      \includegraphics[width=3.2in]{SCRIPT_FIGURES/pulsating_convergence.pdf}
   \end{tabular}
         \caption[Pulsating wave convergence]{(Left) Time series of $\rho$ at the position $(x,y) = (3\pi/2, 3\pi/2)$ for several grid resolutions using the Superbee limiter. (Right) Convergence plot for central differencing, Superbee, and CHARM.  All schemes are second-order accurate.}
   \label{fig_pulsating 2D wave}
\end{figure}

\subsection{Stationary compression wave in 1D}
\label{stationary_1d}

Another problem which can be solved analytically is that of a stationary compression wave.  In this section we consider a stationary compression wave combined with a constant and uniform advection velocity in 1D.  The velocity is specified to be
\begin{equation}
\label{eqn_statu1d}
u(x) = c + \sin(x) \,\mbox{,}
\end{equation}
where $|c|>1$ is a constant.  The 1D continuity equation becomes
\begin{equation}
\label{eqn_stat1dcont}
\frac{\partial q}{\partial t} + [c + \sin(x)] \frac{\partial q}{\partial x} + \cos(x) = 0 \,\mbox{.}
\end{equation}
A solution to (\ref{eqn_stat1dcont}) is
\begin{eqnarray}
\label{eqn_stat1dsoln}
q(x,t) &=& q(x_0[x,t],0) \nonumber \vspace{0.3cm}\\
&+& \ln\left\{ -c^2 - \cos\big(bt + 2\arctan[\gamma(x,t)] \big) + b\sin\big(bt + 2\arctan[\gamma(x,t)] \big) \right\} \nonumber \vspace{0.3cm}\\
&-& \ln\left\{ -c^2 - \cos\big( 2\arctan[\gamma(x,t)] \big) + b\sin\big( 2\arctan[\gamma(x,t)] \big) \right\} \,\mbox{,}
\end{eqnarray}
where
\begin{equation}
\label{eqn_b}
b \equiv \sqrt{-1 + c^2} > 0 \,\mbox{,}
\end{equation}
\begin{equation}
\label{eqn_gamma}
\gamma(x,t) = \frac{ 1 + c\tan\left( \frac{x_0[x,t]}{2} \right) }{b} \,\mbox{,}
\end{equation}
and
\begin{equation}
\label{eqn_stat1dx0}
x_0(x,t) = 2\arctan\left( \frac{b}{c} \tan \left[ \arctan\left\{ \frac{1+c\tan[x/2]}{b} \right\} - \frac{bt}{2} \right] - \frac{1}{c} \right) \,\mbox{.}
\end{equation}

\subsection{Stationary compression wave in 2D}
\label{stationary_2d}

As with the pulsating flow, there is a simple extension of the 1D stationary wave solution to 2D.  In this section we consider the velocity field with components
\begin{eqnarray}
u(x) &=& c_1 + \sin(x) \,\mbox{,} \\
v(y) &=& c_2 + \sin(y) \,\mbox{.}
\end{eqnarray}
The continuity equation can be written as
\begin{equation}
\label{eqn_stat2d_cont}
\frac{\partial q}{\partial t} + [c_1 + \sin(x)] \frac{\partial q}{\partial x} + [c_2 + \sin(y)] \frac{\partial q}{\partial y} + \cos(x) + \cos(y) = 0 \,\mbox{.}
\end{equation}
A solution to (\ref{eqn_stat2d_cont}) is
\begin{eqnarray}
\label{eqn_stat2d_soln}
q(x,y,t) &=& q_0(x,y,t) \nonumber\\
&+& \mathcal{I}_1(x,t) - \mathcal{I}_1^0(x,t) \nonumber\\
&+& \mathcal{I}_2(y,t) - \mathcal{I}_2^0(y,t) \,\mbox{,}
\end{eqnarray}
where
\begin{eqnarray}
\label{eqn_Ii}
\mathcal{I}_i(z,t) &=& \ln\left\{ -c_i^2 - \cos\big(b_i t + 2\arctan[\gamma_i(z,t)] \big) + b_i \sin\big(b_i t + 2\arctan[\gamma_i(z,t)] \big) \right\}\,\mbox{,} \quad\quad  \vspace{0.3cm}\\
\label{eqn_Ii0}
\mathcal{I}_i^0(z,t) &=& \ln\left\{ -c_i^2 - \cos\big(2\arctan[\gamma_i(z,t)] \big) + b_i \sin\big(2\arctan[\gamma_i(z,t)] \big) \right\} \,\mbox{,}
\end{eqnarray}
and
\begin{equation}
b_i \equiv \sqrt{-1 + c_i^2} >0 \,\mbox{,}
\end{equation}
\begin{equation}
\gamma_i(z,t) = \frac{ 1 + c_i \tan\left( \frac{z_0[z,t]}{2} \right) }{b_i} \,\mbox{,}
\end{equation}
\begin{equation}
z_0(z,t) = 2\arctan\left( \frac{b_i}{c_i} \tan \left[ \arctan\left\{ \frac{1+c_i\tan[z/2]}{b_i} \right\} - \frac{b_it}{2} \right] - \frac{1}{c_i} \right) \,\mbox{.}
\end{equation}
Note that $z_0 \Rightarrow x_0$ for $i=1$ and $z_0 \Rightarrow y_0$ for $i=2$.  To be clear, no summation is implied over repeated indices. Also, note that the same restrictions apply to the initial condition as did in Section \ref{soln_2d}. Namely, that $\frac{\partial q_0}{\partial x}$ is independent of $y$ and $\frac{\partial q_0}{\partial y}$ is independent of $x$.

An example of the solution to (\ref{eqn_stat2d_soln}) is shown in Figure \ref{fig_compression_wave}.  In this case we set $c_1 = 2$ and $c_2 = 3$ to create an asymmetry in the flow.  The periodicity in time depends on the choices of $c_1$ and $c_2$; it is possible that no periodicity exists. We have not found a case that generates a singularity. The analytical time series of the density at the position $(x,y) = (3\pi/2, 3\pi/2)$ is shown as the solid black line. FDS is run with the CHARM flux limiter scheme (as this is a DNS flow field).  The solution at successively finer grid resolutions is plotted and compared with the analytical solution, demonstrating convergence of the scheme.  On the right side of the figure we demonstrate second-order convergence of the central, Superbee, and CHARM limiter schemes in FDS.

\begin{figure}[t]
   \begin{tabular}{rl}
      \includegraphics[width=3.2in]{SCRIPT_FIGURES/compression_wave_time_series.pdf} &
      \includegraphics[width=3.2in]{SCRIPT_FIGURES/compression_wave_convergence.pdf}
   \end{tabular}
   \caption[Stationary compression wave convergence]{(Left) Time series of $\rho$ at the position $(x,y) = (3\pi/2, 3\pi/2)$ for several grid resolutions using the CHARM flux limiter. (Right) Convergence plot for three different scalar transport schemes in FDS: central, Superbee, and CHARM.  All schemes are second-order accurate.  In addition, notice that Superbee gives the lowest error at the coarsest resolution while CHARM gives the lowest error at higher resolution.  This is one reason why Superbee is recommended for LES and CHARM is the default for DNS.}
   \label{fig_compression_wave}
\end{figure}

\clearpage

\section{Scalar Transport (move\_slug)}

In this section we demonstrate the qualitative behavior of the Superbee flux limiter scheme for transport of a square wave.
The diffusivity is set to zero and the advecting velocity is constant and uniform $\mathbf{u} = [1.0\,\,\,1.0]$.
The domain is the unit square with a passive scalar marker initialized to zero everywhere, except for two `slugs' of mass.
The first slug is set to unity over the region $x \times z = [0.125,\,0.375] \times [0.125,\,0.375]$.
The second slug is set to 1/2 over the region $x \times z = [0.500,\,0.750] \times [0.500,\,0.750]$.
With the scalar bounds set to [0,1], these slugs demonstrate both the boundedness and TVD (total variation diminishing) behavior of the transport scheme.

This case also tests two different types of boundary conditions applied in FDS.  First, the domain is periodic and the simulation runs for one flow through time.
The scalar slugs therefore ideally arrive back to their original locations with as little diffusion as possible.
Also, the domain is broken into four equally sized meshes, each with $40 \times 40$ uniform cells.
To increase temporal accuracy and focus on the potential spacial error, we run the case with a CFL of 0.25.  In FDS, we refer to the mesh interface as an `interpolated boundary'.

The results of the test are shown visually in Figure \ref{fig_move_slug}.  The upper-left image shows the initial condition.
The black lines indicate the mesh interfaces.  To the right of the initial condition we show the first slug crossing the mesh interfaces without incurring spurious noise.
The lower left image shows the final result for the Superbee limiter.  By comparison with a first-order scheme (lower right),
this test case confirms that relatively low levels of diffusion are incurred at both periodic and interpolated boundaries in FDS.

\begin{figure}[t]
   \begin{tabular}{rl}
      \includegraphics[width=3in]{SCRIPT_FIGURES/move_slug_FL2_t0.png} &
      \includegraphics[width=3in]{SCRIPT_FIGURES/move_slug_FL2_tm.png} \\
      \includegraphics[width=3in]{SCRIPT_FIGURES/move_slug_FL2_tf.png} &
      \includegraphics[width=3in]{SCRIPT_FIGURES/move_slug_FL1_tf.png} \\
   \end{tabular}
   \caption[Multi-mesh square wave transport]{(Upper left) Initial condition. (Upper right) Superbee solution after 0.175 seconds showing the scalar slug cleanly passing through the mesh interface. (Lower left) Final result for Superbee after one flow through time.  (Lower right) Result for first-order upwinding after one flow through time, illustrating the relatively low dissipation of the Superbee scheme.  Note that, though the first-order scheme is available as an option in FDS, it is presented here for comparison purposes only.  In practice, the higher order Superbee scheme is preferred for LES (FDS default).}
   \label{fig_move_slug}
\end{figure}


\clearpage

\section{Mass Conservation}

This section describes tests of global mass conservation.

\subsection{Flow of a Gas through a Simple Duct (\texorpdfstring{{\bf simple\_duct}}{simple\_duct})}

In this example, a closed chamber with a simple recirculating duct is used to demonstrate that a gas like carbon dioxide can be transported
through multiple meshes and its mass is conserved. An obstruction is created that leaks 0.5~kg of CO$_2$ over a time span of 10~s.

\begin{figure}[h]
\centering
\includegraphics[width=3in]{SCRIPT_FIGURES/simple_duct_mass}
\caption[The \bf{simple\_duct} test case.]{The mass of CO$_2$ contained in a simple room connected with a recirculating duct.}
\label{simple_duct}
\end{figure}


\clearpage

\subsection{Specified Mass Flux (\texorpdfstring{{\bf low\_flux\_hot\_gas\_filling}}{low\_flux\_hot\_gas\_filling})}

The specification of the fuel mass flux is probably the most commonly used boundary condition for specifying a fire.  When the user specifies the {\ct HRRPUA} (heat release rate per unit area), FDS divides this input by the heat of combustion for the specified fuel (propane by default) and uses this values as the specified mass flux $\dot{m}_{\alpha}^{\prime\prime}$ at the {\ct VENT}.  This seems simple enough.  But the problem is complicated by the fact that the total species flux is the sum of the advective and diffusive fluxes,
\begin{equation}
\label{eqn_total_flux}
\dot{m}_{\alpha}^{\prime\prime} = \rho Y_{\alpha} u_n - \rho D_\alpha \frac{\partial Y_\alpha}{\partial n}
\end{equation}
where $u_n$ is the face normal mass-average velocity and $\partial/\partial n$ is the gradient normal to the face.  The velocity is determined from the total mass flux and the density at the face,
\begin{equation}
\label{eqn_un}
u_n = \frac{\sum_\alpha \dot{m}_{\alpha}^{\prime\prime}}{\rho(\mathbf{Y},T)}
\end{equation}
The density is computed using old values of the face mass fractions and the face temperature which may be specified or computed depending on choices made by the user.  The new face mass fraction is then set to satisfy (\ref{eqn_total_flux}).  The test case below is designed to exercise contributions from both the advective and diffusive terms in this boundary condition.

In the test case, we inject propane into a cube with 1 m$^2$ vents on all six faces.  We specify the {\ct MASS\_FLUX} of propane to be 0.0001 kg/(m$^2$ s) and the temperature of the face of the {\ct VENT} ({\ct TMP\_FRONT}) is specified to be 500 $^\circ$C.  The box is initially filled with air at standard conditions.  We {\ct DUMP} a {\ct MASS\_FILE} and compare the accumulation of propane with the specified rate.  The results are shown in Figure \ref{fig_low_flux_hot_gas_filling}.

\begin{figure}[h]
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{FIGURES/low_flux_hot_gas_filling_domain} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/low_flux_hot_gas_filling}
\end{tabular*}
\caption[Low flux of hot gas into a closed domain]{Test of specified mass flux boundary condition for low mass flux and specified temperature on the face of the {\ct VENT}. (Left) Image of the domain showing contours of propane mass fraction. (Right) Comparison of the accumulated mass of propane with the FDS values reported in the {\ct \_mass} file.}
\label{fig_low_flux_hot_gas_filling}
\end{figure}


\clearpage

\section{Energy Conservation}

FDS does not explicitly solve the energy conservation equation. Instead, mass transport equations are solved for the density and the $n-1$ independent gas species. Source terms from the energy equation are incorporated in the velocity  divergence, $\nabla \cdot \bu$, which is factored out of the sensible enthalpy transport equation, i.e.,
\be
\label{eqn_new_div}
\nabla\cdot\mathbf{u} = \frac{1}{\rho h_s} \left[ \frac{\mbox{D}}{\mbox{D} t}(\bar{p}-\rho h_s) + \dot{q}^{\prime\prime\prime} + \nabla\cdot(k \nabla T) - \nabla\cdot\sum_\alpha h_{s,\alpha} \mathbf{J}_\alpha - \nabla\cdot\dot{\mathbf{q}}_r^{\prime\prime} + \dot{q}_b^{\prime\prime\prime} \right] \,\mbox{.}
\ee
Here $\rho$ is the mass density, $h_s$ is the sensible enthalpy, $\bar{p}$ is the thermodynamic pressure, $\dot{q}^{\prime\prime\prime}$ is the chemical heat release, $k$ is thermal conductivity, $\mathbf{J}_\alpha$ is the diffusion flux vector, $\dot{\mathbf{q}}_r^{\prime\prime}$ is the radiant heat flux vector, and $\dot{q}_b^{\prime\prime\prime}$ is the bulk heat source due to convective heat transfer to Lagrangian particles and the heat associated with mass sources. The divergence is a fairly complicated expression, and it is important that it is computed properly to ensure global energy conservation. The examples in this section check that mass and energy are conserved for relatively simple configurations.

\subsection{The Heat from a Fire (\texorpdfstring{{\bf energy\_budget}}{energy\_budget})}

For the purpose of verifying that the basic FDS algorithm is energy conserving, it is useful to think of a single compartment as a control volume into which energy is generated by a fire and out of which energy either flows via openings or is conducted through the walls. If the fire's heat release rate (HRR) is steady, eventually the system will reach a quasi-steady state (in an LES calculation, there is never a true ``steady state''). Two simple cases, called {\bf energy\_budget\_adiabatic\_walls} and {\bf energy\_budget\_cold\_walls}, illustrate that in the quasi-steady state, the energy generated by the fire is conserved. For the case with adiabatic walls, a 1200~kW fire is simulated within a compartment that is 10~m by 10~m by 5~m tall. There is a single door and a single horizontal vent in the ceiling. The walls are assumed to be adiabatic; that is, there is no net heat flux through them. Another way to look at it is that the walls are perfect insulators. To simplify the case even further, the radiation transport algorithm is turned off. It is expected that in this case 1200~kW ought to flow out of the compartment either via the
door or ceiling vent. The plot in Fig.~\ref{energy_budget_adiabatic_walls} shows both the HRR and enthalpy flow out of the compartment converging to 1200~kW. During the warm up phase, the enthalpy flow is less than the HRR because energy is consumed heating up the air within the room.

Next, the same compartment with the same fire is now assumed to have cold (20~$^\circ$C) walls, and the radiation is switched back on. After a few minutes of simulation, the net enthalpy outflow is approximately 470~kW and the heat losses to the wall (both radiative and convective) are approximately 730~kW. The plot is shown in Fig.~\ref{energy_budget_cold_walls}.

\begin{figure}[ht]
\centering
\includegraphics[width=.9\textwidth]{SCRIPT_FIGURES/energy_budget_adiabatic_walls}
\caption[Energy Budget (adiabatic walls).]{The energy budget for a simple compartment fire with adiabatic walls.}
\label{energy_budget_adiabatic_walls}
\end{figure}

\begin{figure}[ht]
\centering
\includegraphics[width=.9\textwidth]{SCRIPT_FIGURES/energy_budget_cold_walls}
\caption[Energy Budget (cold walls).]{The energy budget for a simple compartment fire with cold walls.}
\label{energy_budget_cold_walls}
\end{figure}


\subsection{Gas Injection via an Isentropic Process (\texorpdfstring{{\bf isentropic}}{isentropic})}

This example checks that if nitrogen is added to a sealed compartment with adiabatic ({\em i.e.} no heat loss) walls, that the
density, pressure and temperature ought to rise according to the ideal gas law for an isentropic process:
\be \frac{p_2}{p_1} = \left( \frac{\rho_2}{\rho_1} \right)^\gamma = \left( \frac{T_2}{T_1} \right)^{\frac{\gamma}{\gamma-1}}  \ee
The subscripts 2 and 1 refer to the final and initial state, respectively. Nitrogen is a diatomic gas for which $\gamma=1.4$. As an additional
check, the nitrogen is injected at two different rates such that in case A the injection occurs in 10~s and in case B the injection occurs in
50~s. The nitrogen is introduced into the domain via small spheres that do not generate or absorb heat. They do not occupy volume either. They just
inject the nitrogen at a specified rate into the particular grid cell that each occupies.

\begin{figure}[ht]
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/isentropic_density} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/isentropic_pressure} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/isentropic_temperature} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/isentropic_enthalpy}
\end{tabular*}
\caption[The isentropic case.]{Density, pressure, temperature, and enthalpy rise due to the injection of nitrogen into a sealed compartment.}
\label{isentropic}
\end{figure}


\subsection{Gas Injection via a Non-Isentropic Process (\texorpdfstring{{\bf isentropic2}}{isentropic2})}

This example checks that if nitrogen is added via an external vent to a sealed compartment with adiabatic ({\em i.e.} no heat loss) walls, that the
density, pressure and temperature ought to rise to the same values regardless of the time of injection.
In the two cases, 0.2~kg of N$_2$ are added to a compartment that is 1~m$^3$ in volume. In the first case, the injection occurs in 10~s, in the
second case in 50~s. The temperature of the gas in both cases is 500~$^\circ$C. It is expected that the pressure, $p$, should rise at the rate:
\be \frac{dp}{dt} = \frac{\gamma \, p \, u \, A}{V} \ee
where $u$ is the injection velocity and $A$ is the area of the vent. The vent area is 0.04~m$^2$. The density of the incoming N$_2$ is found from the
Equation of State:
\be \rho = \frac{ \overline{W} \, p }{ {\cal R} T} \ee
The injection velocity is the mass flux divided by the density, $u=\dot{m}''/\rho$, in which case, the pressure rise can be written
\be \frac{dp}{dt} = \frac{\gamma \, \dot{m}'' \, {\cal R} T \, A}{\overline{W} \, V} \ee
Note that the pressure rise is constant. In both the fast and slow injection cases, the pressure is expected to rise 64282~Pa above ambient. The density
and temperature rise are also linear. The density increases from 1.164~kg/m$^3$ to 1.364~kg/m$^3$. The temperature increases from 20~$^\circ$C to 135.7~$^\circ$C.
The change in the internal energy of the system, based on the mass and temperature of the added N$_2$, is:
\be \Delta E = (0.2 \; \hbox{kg}) \times (1.039 \; \hbox{kJ/kg/K}) \times (773.15 \; \hbox{K} ) = 160.7 \; \hbox{kJ} \ee
Adding in the work due to the pressure yields the change in total enthalpy:
\be \Delta H = \Delta E + V \, \Delta P = 160.7 \; \hbox{kJ} + (1 \; \hbox{m}^3) \times ( \; 64.3 \; \hbox{kJ/m}^3) = 225 \; \hbox{kJ} \ee


\begin{figure}[ht]
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/isentropic2_density} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/isentropic2_pressure} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/isentropic2_temperature} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/isentropic2_enthalpy}
\end{tabular*}
\caption[The isentropic2 case.]{Density, pressure, temperature, and enthalpy rise due to the injection of nitrogen into a sealed compartment.}
\label{isentropic2}
\end{figure}

\clearpage


\subsection{Mixing Gases (\texorpdfstring{{\bf energy\_budget\_dns}}{energy\_budget\_dns})}

In this example, two fictitious gases are forced through tiny ducts (1~mm by 1~mm) that meet at a T-joint. The cross sectional areas of all the ducts are the same. Gas~1 has an initial temperature of 606.3~$^\circ$C and a constant specific heat of 1~kJ/kg/K. Gas~2 has an initial temperature of 20~$^\circ$C and a constant specific heat of 10~kJ/kg/K. Both gases have a molecular weight of 29~g/mol and a mass flow of $1 \times 10^{-8}$~kg/s. Typically gases of the same molecular weight have comparable, but not necessarily the same, specific heats. This is an extreme case. In steady state, it is expected that the convection and diffusion of enthalpy at the boundaries will be equal:
\be \int h_s \, \rho \bu \cdot d\bS = \sum_\alpha \int h_{s,\alpha} \, \rho D_\alpha \nabla Z_\alpha \cdot d\bS \ee
The plot at left in Fig.~\ref{energy_budget_dns} shows the convective and diffusive enthalpy fluxes at steady state. The quantities are of opposite sign because both quantities are evaluated as source terms in the energy budget.

Because of the large difference in specific heats, the average velocity of the gas mixture flowing out, $U_3$, is not simply the sum of the velocities at the two inlets, $U_1+U_2$. In fact, in order to have the proper enthalpy flow at the outlet, the volume integral of the divergence should be:
\be \int \nabla \cdot \bu \; dV \equiv -A \, (U_1 + U_2 - U_3) = -A \, \frac{ (U_1-U_2) \, (c_{p,2}-c_{p,1}) }{ c_{p,1}+c_{p,2} } = -1.357 \times 10^{-8} \; \hbox{m}^3/\hbox{s} \label{div2} \ee
The plot at right in Fig.~\ref{energy_budget_dns} shows the resulting and integrated divergence or net volume flow.

\begin{figure}[ht]
\includegraphics[width=3.2in]{SCRIPT_FIGURES/energy_budget_dns_heat}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/energy_budget_dns_div}
\caption[Energy conservation for a DNS case.]{(Left) Equality of convective and diffusive enthalpy flux at steady state. (Right) The integrated divergence or net volume flow.}
\label{energy_budget_dns}
\end{figure}

\clearpage


\subsection{Mixing with Variable Specific Heats (\texorpdfstring{{\bf energy\_budget\_tmix}}{energy\_budget\_tmix})}

This case tests the ability of FDS to properly account for temperature dependent specific heats.  A coarse 2D channel mixing case is presented where hot gas at 900 $^\circ$C with a constant specific heat of $c_p=1$ kJ/(kg K) enters from the bottom left vent with a flux of 2 kg/(m$^2$ s) and cold gas at 20 $^\circ$C with a constant specific heat of $c_p=10$ kJ/(kg K) enters from a top left vent with the same mass flux.  The gases mix in a center channel and exit the domain flowing to the right.

The enthalpy of the mixture at the outlet is $2 \times 1 \times (900+273.15) + 2 \times 10 \times (20+273.15) = 8209.3$ kJ/(m$^2$ s).  The mixture heat capacity at the outlet is 5.5 kJ/(kg K) and the flux is 4 kg/(m2 s).  Therefore the outlet temperature is $8209.3/4/5.5 - 273.15 = 100$ $^\circ$C.
\begin{figure}[ht]
\centering
\includegraphics[width=3.2in]{SCRIPT_FIGURES/energy_budget_tmix.pdf}
\caption{\label{fig_outlet_temperature} Outlet temperature for energy\_budget\_tmix case.  Black circles represent the correct result of 100 $^\circ$C.}
\end{figure}

\clearpage


\section{Checking for Coding Errors (\texorpdfstring{{\bf symmetry\_test}}{symmetry\_test})}

This example is a very simple test to determine if there are coding errors in the basic flow solver. A closed box, 1~m on a side, has 6 injection vents, one centered on each face.
Air is pumped into the box at a rate of 0.5~m/s. Anything that might lead to an asymmetry in the flow field is turned off, for example, gravity, atmospheric stratification,
natural convection, and random noise. The resulting flow field is shown at the left in Fig.~\ref{symmetry_test}. On the right are plots of the three components of velocity
at equidistant corners of the enclosure. Ideally, there should be two equal and opposite time histories of the three components. Even the slightest error in coding will throw
this off almost immediately.


\begin{figure}[ht]
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/symmetry_test.png} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/symmetry_test.pdf}
\end{tabular*}
\caption[The {\bf symmetry\_test} case.]{Flow field (left) and velocity component plot (right) for the symmetry\_test case.}
\label{symmetry_test}
\end{figure}



\chapter{Thermal Radiation}

The Radiative Transport Equation (RTE) for an absorbing/emitting
and scattering medium is
\be \bs \cdot \nabla I_{\la}(\bx,\bs) =
 -\Big[ \kappa(\bx,\la) + \sigma_s(\bx,\la) \Big] \;
I_\la(\bx,\bs) +B(\bx,\la) + \frac{\sigma_s(\bx,\la)}{4\pi}
\int_{4\pi}\Phi(\bs,\bs') \; I_{\la}(\bx,\bs') \; d\bs'
\label{RTEbasic} \ee
where $I_{\la}(\bx,\bs)$ is the radiation intensity at wavelength
$\la$, $\bs$ is the direction vector of the intensity,
$\kappa(\bx,\la)$ and $\sigma_s(\bx,\la)$ are the local absorption
and scattering coefficients,
respectively, and $B(\bx,\la)$ is the emission source term.
The integral on the
right hand side describes the in-scattering from other directions.
In the case of a non-scattering gas the RTE becomes
\be \bs \cdot \nabla I_{\la}(\bx,\bs) = \kappa(\bx,\la) \; \Big[ I_b(\bx)
- I_\la(\bx,\bs) \Big] \label{RTE} \ee
where $I_b(\bx)$ is the source term given by the Planck function (see below).

In practical simulations the spectral ($\la$) dependence cannot be solved
accurately. Instead, the radiation spectrum is divided into
a relatively small number of bands and a separate RTE is derived for
each band. The band specific RTE is
\be   \bs \cdot \nabla I_n(\bx,\bs) = \kappa_n(\bx) \;
        \left[ I_{b,n}(\bx) - I_n(\bx,\bs) \right],\;\; n = 1...N
\label{bandRTE} \ee
where $I_n$ is the intensity integrated over the band $n$, and $\kappa_n$
is the appropriate mean absorption coefficient inside the band. The
source term can be written as a fraction of the blackbody radiation
\be I_{b,n} = F_n(\la_{\rm min},\la_{\rm max}) \; \sigma \; T^4/\pi \ee
where $\sigma$ is the Stefan-Boltzmann constant.
The calculation of factors $F_n$ is explained in Ref.~\cite{Siegel:1}.
When the intensities corresponding to the bands are known, the total
intensity is calculated by summing over all the bands
\be I(\bx,\bs) = \sum_{n=1}^N I_n(\bx,\bs) \ee

There are numerous examples in the heat transfer literature of exact solutions, for simple configurations of hot and cold objects, of the radiation
transport equation.

\clearpage

\section{Radiation from parallel plate in different co-ordinate systems \\
(\texorpdfstring{{\bf plate\_view\_factor}}{plate\_view\_factor}) }
\label{plate_view_factor}


This verification case tests the computation of radiative heat flux from hot surface to a differential, parallel surface at 1 m distance
in different co-ordinate systems. The radiating surface is at 1000~$^\circ$C temperature and has emissivity of 1.0.  The exact values are
calculated using the analycal expressions for the view factors.
\begin{center}
\begin{tabular}{|l|l|c|}
\hline Co-ordinates & Radiation source & Heat flux (kW/m$^2$)  \\ \hline \hline
2D cartesian   & Infinite plate of width 2 m   & 105.3 \\
3D cartesian   & Square plate of width 2 m     & 81.8 \\
2D cylindrical & Circular disk of diameter 2 m & 74.1 \\ \hline
\end{tabular}
\end{center}

A comparison of exact values and FDS predictions at three diffferent angular resolutions is shown below.
\begin{center}
\includegraphics[width=4.0in]{SCRIPT_FIGURES/plate_view_factor.pdf}
\end{center}



\clearpage


\section{Radiation inside a box (\texorpdfstring{{\bf radiation\_in\_a\_box}}{radiation\_in\_a\_box}) }
\label{radiation_in_a_box}

This verification case tests the computation of three-dimensional configuration factor $\Phi$ inside a cube box with one hot wall and five cold (0~K)
walls. An overview of the test geometry is shown here:
\begin{center}
\includegraphics[width=4.0in]{FIGURES/box.pdf}
\end{center}
The configuration factors are calculated at the diagonal of the cold wall opposite to the hot wall. The exact values of the configuration factor from
plane element $dA$ to parallel rectangle $H$ are calculated using the analytical solution~\cite{Siegel:1}

\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline (y,z) & $\Phi_{HdA}$ & (y,z) & $\Phi_{HdA}$ \\ \hline \hline
0.025   &0.1457 & 0.275 &0.2135 \\
0.075   &0.1603 & 0.325 &0.2233 \\
0.125   &0.1748 & 0.375 &0.2311 \\
0.175   &0.1888 & 0.425 &0.2364 \\
0.225   &0.2018 & 0.475 &0.2391 \\ \hline
\end{tabular}
\end{center}

\noindent Different variations of the case include the mesh resolution (20$^3$ and 100$^3$ cells) and the number of radiation angles (50, 100, 300,
1000, 2000). The exact and FDS results are shown here:

\noindent
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/radiation_box_20} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/radiation_box_100}
\end{tabular*}





\clearpage

\section{Radiation from a plane layer (\texorpdfstring{{\bf radiation\_plane\_layer}}{radiation\_plane\_layer})}
\label{radiation_plane_layer}

This case tests the computation of three-dimensional radiation from a homogenous, infinitely wide layer of hot gases.  The temperature of
the layer is 1273.15~K and the absorption coefficient, $\kappa$, is varied. The thickness of the layer is fixed at 1~m, and the optical depth is $\tau = (1 \, \kappa)$~m$^{-1}$.
Wall temperatures are set to 0~K. The results are compared against the exact solution $S(\tau)$ presented in~\cite{Zeldovich:1}
\be S(\tau) = S_b\left[1-2E_3(\tau)\right] \ee
where $S_b = \sigma T^4$ is the black-body heat flux from the radiating plane and $E_3(\tau)$ is the exponential
integral function (order 3) of the optical depth $\tau$.

The FDS results are computed at two mesh resolutions in the $x$-direction (I=20 and I=150). For I=20, both one-band and six-band versions are
included to test the correct integration of heat fluxes over multiple bands. For I=20, 2-D versions are also computed (J=1). The limiting case, $\tau=\infty$,
using a solid wall of temperature 1273.15~K, is computed to test the wall heat flux computation. The exact values and FDS predictions of
the wall heat fluxes are given in the table below.

\input{SCRIPT_FIGURES/radiation_plane_layer.tex}


\clearpage
\section{Wall Internal Radiation (\texorpdfstring{{\bf wall\_internal\_radiation}}{wall\_internal\_radiation}) }
\label{wall_internal_radiation}


In-depth absorption of thermal radiation in a solid is computed using a two-flux model.  In this example, the accuracy of the two-flux model
is tested in the computation of the emissive flux from a homogenous layer of material (thickness $L=$~0.1~m) at 1273.15~K temperature,
surrounded by an ambient temperature of 10~K. The absorption coefficient $\kappa$ is varied to cover a range [0.01, 10] of optical depth
$\tau = \kappa L$.

The exact solutions for radiative flux are the analytical solutions of plane layer emission~\cite{Zeldovich:1}
\be S(\tau) = S_b\left[1-2E_3(\tau)\right] \ee
where $S_b = \sigma T^4$ is the black-body heat flux from the radiating plane and $E_3(\tau)$ is the exponential
integral function (order 3) of optical depth, $\tau$. The exact solutions and FDS results are shown in the table below.

\input{SCRIPT_FIGURES/wall_internal_radiation.tex}



\clearpage

\section{Radiation Emitted by Hot Spheres (\texorpdfstring{{\bf hot\_spheres}}{hot\_spheres}) }
\label{hot_spheres}

This case tests the calculation of the radiation heat flux from a collection of hot objects. Within two
completely open volumes that are 1~m on a side, hot spheres with a diameter of 1~cm and temperature of 500~$^\circ$C are
situated within a smaller volume that is 0.5~m on a side. One of the open volumes contains 10 spheres, the other contains
50,000. The simulation lasts for
10~s. In the first volume, the heat loss is just the sum
of the areas of the spheres multiplied by $\sigma T^4$ (emissivity is specified as unity in this case). See
the upper left plot in Fig.~\ref{hot_spheres_plot}. In the second
volume, the region is densely packed and it is expected that the collection of spheres will radiate like a solid cube  that is
0.5~m on a side and whose temperature is 500~$^\circ$C. This is just under 30~kW, as
shown in the upper right of Fig.~\ref{hot_spheres_plot}. The plot in the lower left of Fig.~\ref{hot_spheres_plot}
shows the incident heat flux to a gauge positioned at the center of the densely packed volume.
It is expected that this gauge would register a heat flux of
$\sigma T^4=20.26$~kW/m$^2$. Finally, the plot in the lower right of Fig.~\ref{hot_spheres_plot} indicates the
integrated intensity, $4 \sigma T^4=81.04$~kW/m$^2$.

\begin{figure}[h]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/hot_spheres_rad_loss_1} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/hot_spheres_rad_loss_2} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/hot_spheres_heat_flux}  &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/hot_spheres_intensity}
\end{tabular*}
\caption[Radiation from hot spheres]{The total heat losses, radiative heat flux, and integrated intensity of a collection
of loosely and densely packed radiating spheres.}
\label{hot_spheres_plot}
\end{figure}

\clearpage

\section{Radiation Absorbed by Particles (\texorpdfstring{{\bf droplet\_absorption}}{droplet\_absorption}) }
\label{droplet_absorption}

This case tests the conservation of energy that is absorbed by liquid droplets. We want to make sure that the
absorbed thermal radiation is accurately converted into internal energy of the droplets. The average droplet temperature $\overline{T_d}$ is
increased by the radiation energy absorbed by all the droplets, $\dot{Q}_r$, according to the following equation:
\be
m \, c_p \frac{d \overline{T_d}}{dt} = \dot{Q}_r
\ee
where $m$ and $c_p$ are the total mass and specific heat of the droplets, respectively. The convective heat transfer between the
gas and droplets is small because the gas phase Prandtl number has been set to an artificially high value.
If the radiative intensity remains constant during the time step, the average droplet temperature over a time period, $\Delta t$, should be:
\be
\overline{T_d} = T_0 + \frac{\Delta t \, \dot{Q}_r }{m \, c_p}
\ee
By setting $T_0=0$~$^\circ$C, $\Delta t =0.01$~s, $m =0.01$~kg, and $c_p =1.0$~kJ/kg, the final value of $\overline{T_d}$ should equal
$\dot{Q}_r$. Figure~\ref{droplet_absorption_figures} shows comparisons of the predicted average droplet temperature and the expected value in cartesian and cylindrical
coordinate systems.

\begin{figure}[h]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/droplet_absorption_cart} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/droplet_absorption_cyl}
\end{tabular*}
\caption[Radiation absorption by liquid droplets]{Transfer of absorbed thermal radiation energy into increased average droplet temperature.}
\label{droplet_absorption_figures}
\end{figure}

%Similar test for droplets with surface in different geometries is tested. All the previously used values are the same, except the mass ($m_{cartesian} = 6.26\cdot 10^{-4}$~kg, $m_{cylindrical} = 1.96\cdot 10^{-3}$~kg, $m_{spherical} = 6.54\cdot 10^{-4}$~kg). It is also necessary to define a high thermal conductivity $k = 1\cdot 10^{9}$~W/m/K for the surface. Figure~\ref{droplet_absorption_surface_figures} shows comparisons of the predicted average droplet temperature and the expected value in cartesian coordinate system. The droplets have surface either in cartesian, cylindrical or spherical geometries. Splitting the radiation angles has been tested in x-, y- and z- directions (except for cartesian particles only in z-direction).
%
%\begin{figure}[h]
%\noindent
%\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
%\includegraphics[width=3.2in]{SCRIPT_FIGURES/particle_absorption_cart_surf_cart} &
%\includegraphics[width=3.2in]{SCRIPT_FIGURES/particle_absorption_cart_surf_cyl}\\
%\includegraphics[width=3.2in]{SCRIPT_FIGURES/particle_absorption_cart_surf_sph}
%\end{tabular*}
%\caption[Radiation absorbed by surface particles]{Transfer of absorbed thermal radiation energy into increased average droplet temperature with surface droplets.}
%\label{droplet_absorption_surface_figures}
%\end{figure}

\clearpage

\section{Radiation Attenuation by Particles (\texorpdfstring{{\bf part\_attenuation}}{part\_attenuation}) }
\label{part_attenuation}

This test case is a qualitative assessment of the attenuation of thermal radiation by four different types of particles (droplets).
In each case, the radiation is computed inside a one meter cube with one hot and five cold walls.
The radiative heat flux is monitored on the wall that is opposite to the hot wall. Five different cases are computed:
\begin{description}
\item[Reference] case with no particles.
\item[Transparent] particles with refractive index $\hbox{m} = 1.0+0\,i$.
\item[Water] droplets.
\item[Fuel] (heptane) droplets.
\item[(Relatively) Opaque] particles with refractive index $\hbox{m} = 1.6+0.1 \,i$.
\end{description}
In each case, 10~g of non-evaporating, monodisperse, 100~$\mu$m particles with 1000~kg/m$^3$ density are placed inside the cube.  The resulting heat
fluxes are plotted in the figure below. The transparent particles do not attenuate the radiation, and the relatively opaque particles
give the highest attenuation. The heat fluxes through water and fuel droplets fall between the two extremes.
\begin{figure}[h]
\begin{center}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/part_attenuation}
\end{center}
\caption[Radiation attenuation by Lagrangian particles.]{Attenuation of thermal radiation by four different classes of Lagrangian particles.}
\label{part_attenuation_figure}
\end{figure}


\clearpage

\section{Transient Thermocouple Response (\texorpdfstring{{\bf TC\_heating}}{TC\_heating}) }
\label{TC_heating}

A thermocouple is placed in the center of a 1~m cube with walls set to 600~$^\circ$C and gas temperature set to 20~$^\circ$C.
The heat transfer coefficient is set to zero to eliminate convective heating. The gas temperature remains at 20~$^{\circ}$C because there is no convective heat transfer from the walls.
The thermocouple heats up according to the equation:
\be
\label{eq: rad}
  \rho_{\hbox{\tiny TC}} \, c_{\hbox{\tiny TC}} \, V_{\hbox{\tiny TC}} \frac{dT_{\hbox{\tiny TC}}}{dt}=\epsilon_{\hbox{\tiny TC}} \, \sigma \, A_{\hbox{\tiny TC}}
  \left(T_s^{4}-T_{\hbox{\tiny TC}}^4 \right)
\ee
whose analytical solution is:
\be
\label{eq: rad_sol}
t=\left.\frac{\ln(x+1) - \ln(1-x) + 2 \tan^{-1}(x)}{4 \, \beta \, T_s^3}\right|_{T_{\hbox{\tiny TC}}(0)}^{T_{\hbox{\tiny TC}}(t)}
\quad ; \quad \beta=\frac{\epsilon_{\hbox{\tiny TC}} \, \sigma A_{\hbox{\tiny TC}}}{\rho_{\hbox{\tiny TC}} \, c_{\hbox{\tiny TC}} \, V_{\hbox{\tiny TC}}} \quad ; \quad
  x=\frac{T_{\hbox{\tiny TC}}}{T_s}
\ee
Figure~\ref{TC_heating_plot} displays the thermocouple response compared to the analytical solution.
\noindent
\begin{figure}[h]
\begin{center}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/TC_heating}
\end{center}
\caption[Transient thermocouple heating.]{Increasing temperature of a thermocouple surrounded by walls at 600~$^\circ$C.}
\label{TC_heating_plot}
\end{figure}




\clearpage

\section{Radiation and Thermocouples (\texorpdfstring{{\bf TC\_view\_factor}}{TC\_view\_factor}) }
\label{TC_view_factor}

This case tests the radiation solver using the simple thermocouple model in FDS.
Suppose that a small, thermally-thin metal bead is at the center of a 1~m cube. The left half of the cube boundary surface is
at 20~$^\circ$C, the right half at 500~$^\circ$C. Assume that there is no convective heat transfer to the bead; only radiation. Assume everything has an emissivity of 1. The
bead temperature ought to rise to a steady value of
\be
   T_{\hbox{\tiny TC}} = \left( \frac{T_1^4 + T_2^4}{2} \right)^\frac{1}{4} -273.15 = \left( \frac{293.15^4 + 773.15^4}{2} \right)^\frac{1}{4} -273.15 = 380.3 \quad ^\circ \hbox{C}
   \label{ideal_TC}
\ee
The thermocouple model in FDS uses the integrated intensity divided by 4, $U/4$, as the average heat flux to the bead surface. In the absence of convection, the steady value of the bead temperature ought to be
\be
   T_{\hbox{\tiny TC}} = \left( \frac{U}{4 \, \sigma} \right)^\frac{1}{4} - 273.15
\ee
This is essentially what is plotted in Fig.~\ref{TC_view_factor_plot}, compared to the ideal value as computed in Eq.~(\ref{ideal_TC}).
\noindent
\begin{figure}[h]
\begin{center}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/TC_view_factor}
\end{center}
\caption[Radiation/Thermocouple test case.]{Temperature of a thermocouple equidistant from walls at temperatures of 20~$^\circ$C and 500~$^\circ$C.}
\label{TC_view_factor_plot}
\end{figure}

\clearpage

\section{Radiation Shield (\texorpdfstring{{\bf radiation\_shield}}{radiation\_shield}) }
\label{radiation_shield}

A lead radiation shield with a thickness of 0.1~mm is placed between two infinitely wide parallel plates at 500~$^\circ$C and 20~$^\circ$C.
The computational domain has dimensions of 10~m by 0.1~m by 1~m. The sides of the domain are assumed to be symmetry planes.
The emissivity, $\varepsilon_{3}$, of the lead shield is 0.48 on both sides.  At 400~s, the shield is removed.
Assuming that there is no convective heat transfer and that the emissivity of the hot and cold plates is 1,
the steady state heat flux to the cold plate should be~\cite{Incropera:1}:
\be
   \dq_{12}'' = \frac{\sigma(T_{1}^{4}-T_{2}^{4})}{\frac{1}{\varepsilon_1}+\frac{1}{\varepsilon_2}+2 \left(\frac{1-\varepsilon_3}{\varepsilon_3} \right)} = 4.76 \; \hbox{kW/m}^2
\ee
where $T_{1}$ and $T_{2}$ are the hot and cold plate temperatures, respectively, and $\varepsilon_1$, $\varepsilon_2$, and $\varepsilon_3$ are the
emissivity values for the hot plate, cold plate, and lead shield, respectively. When the shield is removed at 400~s, the heat flux should increase to 19.8~kW/m$^2$.
The predicted heat flux is given in Fig.~\ref{radiation_shield_plot}.
\noindent
\begin{figure}[h]
\includegraphics[width=3.2in]{SCRIPT_FIGURES/radiation_shield_flux}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/radiation_shield_temp}
\caption[Radiation Shield Test Case]{(Left) Heat flux to a cold plate separated from a hot plate by a heat shield. At 400~s, the shield is removed. (Right)
Temperature of a the heat shield.}
\label{radiation_shield_plot}
\end{figure}

Because the heat flux from the hot plate to the shield is equal to the heat flux from the hot plate to the cold plate,
the shield temperature can be found from the following formula~\cite{Incropera:1}:
\be
   \dq_{12}'' = \dq_{13}'' = \frac{\sigma(T_{1}^{4}-T_{3}^{4})}{\frac{1}{\varepsilon_1}+\frac{1}{\varepsilon_3}-1} \quad ; \quad T_3=380.4 \; ^\circ\hbox{C}
\ee
The predicted shield temperature is plotted in Fig.~\ref{radiation_shield_plot}.




\chapter{Species and Combustion}

This chapter contains examples that test the computations related to species concentrations, gas properties and combustion.



\section{Product Yields (Methane\_flame)}

A simple methane flame with 10~\% CO yield is burned inside a closed cavity for 5~s.
The total mass of CO$_2$, H$_2$O and CO is recorded.
The simulation is performed using the three alternative ways
to define the combustion reaction: {\em simple chemistry}, {\em primitive species}, and {\em lumped species}. The
same amount of each product species should be produced in each case. The following figure compares the
mass of the three combustion products. The figure compares the simple chemistry versus the primitive species and versus the lumped species.
\begin{figure}[ht]
\begin{center}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/Methane_flame_reac_comp}
\caption[Yield of combustion products using three alternative definitions of the same reaction.]{The combustion product masses using three alternative definitions of the reaction:  Simple chemistry vs. primitive species vs. lumped species. }
\label{fig_methane_flame_yields}
\end{center}
\end{figure}

\clearpage

\section{Reaction Rates (ReactionRate\_)}

This section describes a series of test cases designed to check the reaction rate mechanism for eddy dissipation, finite-rate, and mixed-mode reaction schemes.

\subsection{Eddy Dissipation Model (EDM) Reactions (ReactionRate\_EDM\_)}

The eddy dissipation (mixed is burned) reaction model with local extinction is the default reaction mechanism in FDS. The reaction rate is determined by assuming that the consumption rate of fuel for each reaction is determined from the local fuel, oxidizer, and product mass fractions and the turbulent mixing time by the following equation \cite{Poinsot:TNC}:

\begin{equation}\label{eq:EDM}
\dot{m}^{\prime\prime\prime}_{fuel,i} = \frac{C_{EDM}}{\tau_{mix}} \, \min \left( Y_F,\frac{Y_\OTWO}{s},\beta_{EDM}\frac{Y_P}{(1+s)} \right)
\end{equation}
where $C_{EDM}$ is a model constant related to the turbulent subgrid model, $\beta_{EDM}$ is a model constant related to combustion, and $s$ is the mass stoichiometric coefficient. This model can be considered a deficient model as the consumption rate is found by the limiting species. To determine species evolution for the reaction, a system of ordinary differential equations is solved for each participating species ($\alpha$):
\begin{equation}\label{eq:spec_ode}
\frac{dY_{\alpha}}{dt}= \frac{\nu_{\alpha} \, W_{\alpha}}{W_F} \, \dot{m}^{\prime\prime\prime}_{F}
\end{equation}
To test this implementation, consider both a one-step methane and a one-step propane reaction:
\begin{eqnarray}\label{eq:1step_reacs}
\mathrm{CH_4 + 2\, O_2 \rightarrow  CO_2 + 2\, H_2O} \\
\mathrm{C_3H_8 + 5\, O_2 \rightarrow  3\, CO_2 + 4\, H_2O}
\end{eqnarray}
In both cases the reactants are premixed and react in a constant volume, adiabatic enclosure under stoichiometric conditions with a fixed mixing time, $\tau_{mix}=0.125$~s (Figure \ref{fig:EDM_1Step}). Using Equations \ref{eq:EDM} and \ref{eq:spec_ode}, species evolutions from FDS simulations are compared to expected values.

\begin{figure}[ht]
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_EDM_Flim_1Step_CH4_Spec} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_EDM_Flim_1Step_C3H8_Spec}
\end{tabular*}
\caption[Species Evolution in Mixing Controlled Reaction]{Time evolution of species mass fraction for a one-step EDM reaction with a fixed mixing time of $\tau_{mix}=0.125$~s. (Left) Methane reaction (Right) Propane reaction}
\label{fig:EDM_1Step}
\end{figure}
We also want to compare FDS predictions for temperature and pressure. For this reacting system, the internal energy remains constant, so temperature can be found from:
\begin{equation}\label{eq:del_u}
\overline{u}_{P,\alpha} - \overline{u}_{R,\alpha} = 0
\end{equation}
where $P$ is products, $R$ is reactants, and $\overline{u}_{\alpha}=\overline{h}_{\alpha}-\overline{R}T$. In this case, $\overline{h}_{\alpha}$ is defined as the sum of the enthalpy of formation ($\overline{h}_{f}^{\circ}$) and sensible enthalpy ($\Delta \overline{h}$) for each of the $\alpha$ species. Assuming the products behave like an ideal gas, the final pressure can be found using the equation of state for an ideal gas:
\begin{equation}\label{eq:ideal_gas}
PV = n\overline{R}T
\end{equation}

\begin{figure}[ht]
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_EDM_Flim_1Step_CH4_Temp} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_EDM_Flim_1Step_CH4_Pres}
\end{tabular*}
\caption[Temperature Evolution in Mixing Controlled Reaction]{Temperature (left) and pressure (right) evolution for a one-step methane EDM reaction with a fixed mixing time of $\tau_{mix}=0.125$~s.}
\label{fig:EDM_Methane_TempPres}
\end{figure}

\begin{figure}[ht]
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_EDM_Flim_1Step_C3H8_Temp} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_EDM_Flim_1Step_C3H8_Pres}
\end{tabular*}
\caption[Temperature Evolution in Mixing Controlled Reaction]{Temperature (left) and pressure (right) evolution for a one-step propane EDM reaction with a fixed mixing time of $\tau_{mix}=0.125$~s.}
\label{fig:EDM_Propane_TempPres}
\end{figure}
A non-premixed, fuel-rich case is also analyzed for the one-step methane reaction. Figures \ref{fig:EDM_methan_nonpremix_spec} and \ref{fig:EDM_methan_nonpremix_TempPres} show the species concentrations, temperature, and pressure from FDS and the expected values. The figures show that the only difference is that the final state is not reached until approximately 35 seconds compared to 1 second for the premixed cases.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_EDM_1Step_Nonpremix_Spec}
\caption[Species Evolution in Mixing Controlled Reaction]{Time evolution of species mass fraction for a non-premixed one-step methane EDM reaction with a fixed mixing time of $\tau_{mix}=0.001$~s. }
\label{fig:EDM_methan_nonpremix_spec}
\end{center}
\end{figure}

\begin{figure}[ht]
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_EDM_1Step_Nonpremix_Temp} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_EDM_1Step_Nonpremix_Pres}
\end{tabular*}
\caption[Temperature Evolution in Mixing Controlled Reaction]{Temperature (left) and pressure (right) evolution for a non-premixed one-step methane EDM reaction with a fixed mixing time of $\tau_{mix}=0.001$~s.}
\label{fig:EDM_methan_nonpremix_TempPres}
\end{figure}

Additionally, the EDM reaction implementation is tested to check species evolution for a two-step methane reaction:

\begin{eqnarray}\label{eq:2step_methane}
\mathrm{CH_4 + 1.5 \, O_2 \rightarrow  CO + 2 \, H_2O} \\
\nonumber \mathrm{CO + 0.5 \, O_2 \rightarrow CO_2}
\end{eqnarray}
for both fuel-limited and oxygen-limited conditions with a fixed mixing time, $\tau_{mix}=0.1$~s (Figure \ref{fig:EDM_2Step}).

\begin{figure}[ht]
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_EDM_Flim_2Step} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_EDM_O2lim_2Step}
\end{tabular*}
\caption[Species Evolution in EDM Reaction]{Time evolution of species mass fraction for a two-step EDM reaction with a fixed mixing time of $\tau_{mix}=0.1$~s. (Left) Fuel-limited reaction. (Right) Oxygen-limited reaction.}
\label{fig:EDM_2Step}
\end{figure}

\subsection{Finite Rate Reactions (ReactionRate\_Arrhenius\_)}

The solution process for species evolution in finite rate reactions is similar to mixing-controlled reactions in that species evolution is found by solving a system of ordinary differential equations similar to (\ref{eq:spec_ode}). The main difference between the mechanisms is that instead of the reaction rate being determined by the turbulent mixing time, the reaction rate in finite rate reactions is found using an Arrhenius reaction equation:
\begin{equation}\label{eq:FR_Arr}
{k}_{i}=-AT^{n_{\alpha}}\exp(-E/RT)
\end{equation}
where $A$ is the pre-exponential, $E$ is the activation energy, and $n_{\alpha}$ determines the temperature dependence of the reaction. $A$, $E$, and $n_{\alpha}$ are user defined inputs based on a specificly defined reaction. The species mass flux for each reaction is defined by:
\begin{equation}\label{eq:FR_mdot}
\dot{m}^{\prime\prime\prime}_{\alpha,i}=k_{i}\,\displaystyle\prod Y_{\alpha}^{a_{\alpha,i}}
\end{equation}
where $a_{\alpha,i}$ is a vector of species exponents defined by the user. To determine the species evolution for the reaction, a system of ordinary equations is solved for each of the participating species:
\begin{equation}\label{eq:FR_spec}
\frac{dY_{\alpha}}{dt}=\displaystyle\sum_{i=1}^{NR} \dot{m}^{\prime\prime\prime}_{\alpha,i}
\end{equation}
where $\alpha$ represents each species and $\mathrm{NR}$ is the number of reactions. The values of $a_{\alpha}$ in Equation (\ref{eq:FR_mdot}) are specific to each reaction and for non-zero values, Equation (\ref{eq:FR_spec}) becomes  a system of non-linear differential equations. We consider both linear and non-linear cases with one and two-step reaction mechanisms. First we examine two one-step cases; a zero-order and second-order reaction. Equation (\ref{eq:1step_CO}) shows a one-step, zero-order test case of carbon monoxide oxidation:
\begin{equation}\label{eq:1step_CO}
\mathrm{CO+0.5 \, O_2 \rightarrow  CO_2}
\end{equation}
The reaction rate input parameters are shown in the table below. $E$, $a_{\alpha}$, and $n_{\alpha}$ are set to zero, and $A$ is set such that ${k}_{i} = 1$. The resulting reaction rates simplify to a function of molecular weight and stoichiometric coefficients. Species evolutions results from the CO reaction in Equation (\ref{eq:1step_CO}) are shown in Figure \ref{fig:Arrhenius_0Order_1step}.

\begin{center}
\begin{tabular}{|l|l|l|l|l|l|l|l|l|}
\hline Reaction & $\nu_{\alpha}$ & E (kJ/kmol) & A (cm$^3$/mole/s) & $a_{\alpha}$ & $n_{\alpha}$  \\ \hline \hline
\ref{eq:1step_CO} & [-1 -0.5 1] & 0 & 4.244e-6 & [0 0 0] & [0 0 0] \\ \hline
\end{tabular}
\vskip8pt
$\alpha$ is defined as [$\mathrm{CO}$ $\mathrm{O_2}$ $\mathrm{CO_2}$].
\end{center}

\begin{figure}[ht]
\begin{center}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_Arrhenius_0Order_1Step}
\end{center}
\caption[Species Evolution in Finite Rate Reaction]{Time evolution of species mass fraction for a one-step zero-order Arrhenius finite rate reaction.}
\label{fig:Arrhenius_0Order_1step}
\end{figure}
The second test case is a one-step, second-order propane reaction:

\begin{equation}\label{eq:1step_propane}
\mathrm{C_3H_8 + 5 \, O_2 \rightarrow  3 \, CO_2 + 4 \, H_2O}
\end{equation}
The table below shows the reaction rate input parameters. In this case, $a_{\alpha}=[1,1,0,0]$  for propane, oxygen, carbon monoxide, and water vapor respectively. This makes the reaction second-order as $\mathcal{O}=\sum a_{\alpha}$. Species evolutions for the one-step second-order reaction are shown in Figure \ref{fig:Arrhenius_2Order_1step}.

\begin{center}
\begin{tabular}{|l|l|l|l|l|l|l|l|l|}
\hline Reaction & $\nu_{\alpha}$ & E (kJ/kmol) & A (cm$^3$/mole/s) & $a_{\alpha}$ & $n_{\alpha}$  \\ \hline \hline
\ref{eq:1step_propane} & [-1 -5 3 4] & 0 & 4e5 & [1 1 0 0] & [0 0 0 0] \\ \hline
\end{tabular}
\vskip8pt
$\alpha$ is defined as [$\mathrm{C_3H_8}$ $\mathrm{O_2}$ $\mathrm{CO_2}$ $\mathrm{H_2O}$].
\end{center}

\begin{figure}[ht]
\begin{center}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_Arrhenius_2Order_1Step}
\end{center}
\caption[Species Evolution in Finite Rate Reaction]{Time evolution of species mass fraction for a one-step second-order Arrhenius finite rate reaction.}
\label{fig:Arrhenius_2Order_1step}
\end{figure}
Multi-step Arrhenius finite rate reactions are also examined. First, we consider a two-step forward propane reaction:
\begin{eqnarray}\label{eq:2step_propane}
\mathrm{C_3H_8+3.5 \, O_2 \rightarrow  3 \, CO + 4 \, H_2O} \\
\nonumber \mathrm{CO+0.5 \, O_2 \rightarrow CO_2}
\end{eqnarray}
with the following reaction input parameters:

\begin{center}
\begin{tabular}{|l|l|l|l|l|l|l|l|l|}
\hline Reaction & $\nu_{\alpha}$ & E (kJ/kmol) & A (cm$^3$/mole/s) & $a_{\alpha}$ & $n_{\alpha}$  \\ \hline \hline
\ref{eq:2step_propane} a & [-1 -3.5 3 4 0] & 0 & 5e2 & [0.1 1.65 0 0 0] & [0 0 0 0 0] \\ \hline
\ref{eq:2step_propane} b & [0 -0.5 -1 0 1] & 0 & 8e3 & [0 0.25 1 0.5 0] & [0 0 0 0 0] \\ \hline
\end{tabular}
\vskip8pt
$\alpha$ is defined as [$\mathrm{C_3H_8}$ $\mathrm{O_2}$ $\mathrm{CO}$ $\mathrm{H_2O}$ $\mathrm{CO_2}$].
\end{center}
The species evolutions for the two-step 1.75 order reaction mechanism are shown in the left plot in Figure \ref{fig:Arrhenius_175Order_23step}. We also consider a two-step reversible propane reaction:
\begin{eqnarray}\label{eq:2step_propane_rev}
\mathrm{C_3H_8+3.5 \, O_2 \rightarrow  3 \, CO+4 \, H_2O} \\
\nonumber \mathrm{CO + 0.5 \, O_2 \leftrightarrow CO_2}
\end{eqnarray}
with the following reaction input parameters:

\begin{center}
\begin{tabular}{|l|l|l|l|l|l|l|l|l|}
\hline Reaction & $\nu_{\alpha}$ & E (kJ/kmol) & A (cm$^3$/mole/s) & $a_{\alpha}$ & $n_{\alpha}$  \\ \hline \hline
\ref{eq:2step_propane_rev} a & [-1 -3.5 3 4 0] & 0 & 5e2  & [0.1 1.65 0 0 0] & [0 0 0 0 0] \\ \hline
\ref{eq:2step_propane_rev} b & [0 -0.5 -1 0 1] & 0 & 8e3  & [0 0.25 1 0.5 0] & [0 0 0 0 0] \\ \hline
\ref{eq:2step_propane_rev} c & [0 0.5 1 0 -1]  & 0 & 4e-4 & [0 0 0 0 0 1]    & [0 0 0 0 0] \\ \hline
\end{tabular}
\vskip8pt
$\alpha$ is defined as [$\mathrm{C_3H_8}$ $\mathrm{O_2}$ $\mathrm{CO}$ $\mathrm{H_2O}$ $\mathrm{CO_2}$].
\end{center}
Equation (\ref{eq:2step_propane_rev}) includes the decomposition of $\mathrm{CO_2}$ into $\mathrm{CO}$ and $\mathrm{O_2}$ which the forward only two-step mechanism, Equation (\ref{eq:2step_propane}), does not. This reverse reaction mechanism is represented by three separate reactions on the {\ct REAC} line in an FDS input file as indicated by rows $\mathrm{a}$, $\mathrm{b}$ and $\mathrm{c}$ in the preceding table. Species evolutions for the 2 step reverse reaction are shown in the right plot in Figure \ref{fig:Arrhenius_175Order_23step}. In the forward CO step, (row $\mathrm{b}$ in the two prior tables), we see that water vapor contributes to the reaction rate based on its local concentration despite not being a participant in the reaction.
\vskip8pt
Note: the values of $E$ and $A$ used in these examples are necessarily representative of the chemical reactions presented. When using finite rate chemistry consult experimental data or literature for appropriate reaction parameters.

\begin{figure}[ht]
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_Arrhenius_1p75Order_2Step} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_Arrhenius_1p75Order_2StepR}
\end{tabular*}
\caption[Species Evolution in Finite Rate Reaction]{Time evolution of species mass fraction for multi-step Arrhenius finite rate propane reactions. (Left) Two-step reaction. (Right) Two-step reaction with reversible CO reaction.}
\label{fig:Arrhenius_175Order_23step}
\end{figure}
\vskip8pt
To couple verification of species mass fraction, compartment temperature, and compartment pressure an equilibrium example problem was setup. In this case, we examine a sealed box filled with a stoichiometric mixture of fuel, oxygen, and nitrogen. The two-step reversible reaction mechanism, Equation (\ref{eq:2step_propane_rev}), is used to drive the FDS simulation. The initial temperature is set to 350 $^\circ$C to ensure the reaction occurs in timely manner. The reaction rate parameters in the table below are based off values in literature from Westbrook and Dryer \cite{Westbrook:1}. The heat of combustion for reaction \ref{eq:2step_propane_rev} a and \ref{eq:2step_propane_rev} b were found using data from the NIST JANAF tables \cite{NIST_JANAF}. The heat of combustion for the reversible reaction, \ref{eq:2step_propane_rev} c, was calculated by FDS by setting REVERSIBLE=.TRUE. on the {\ct REAC} line and identifying the appropriate forward reaction ID.
\begin{center}
\begin{tabular}{|l|l|l|l|l|l|l|l|l|}
\hline Reaction & $\nu_{\alpha}$ & E (kJ/kmol) & A (cm$^3$/mole/s) & $a_{\alpha}$ & $n_{\alpha}$  \\ \hline \hline
\ref{eq:2step_propane_rev} a & [-1 -3.5 3 4 0] & 125520 & 1.5e12 & [0.1 1.65 0 0 0] & [0 0 0 0 0] \\ \hline
\ref{eq:2step_propane_rev} b & [0 -0.5 -1 0 1] & 167360 & 3.4e13 & [0 0.25 1 0.5 0] & [0 0 0 0 0] \\ \hline
\ref{eq:2step_propane_rev} c & [0 0.5 1 0 -1]  & 167360 & 8e8    & [0 0 0 0 0 1]    & [0 0 0 0 0] \\ \hline
\end{tabular}
\vskip8pt
$\alpha$ is defined as [$\mathrm{C_3H_8}$ $\mathrm{O_2}$ $\mathrm{CO}$ $\mathrm{H_2O}$ $\mathrm{CO_2}$].
\end{center}
Equilibrium values were determined using the NASA code Chemical Equilibrium with Applications (CEA) \cite{Gordon:1994}. A constant volume, constant internal energy equilibrium calculation was performed where the equilibrium values were found by minimizing Helmholtz Energy. The equilibrium species were limited to $\mathrm{C_3H_8}$, $\mathrm{O_2}$, $\mathrm{CO}$, $\mathrm{H_2O}$, and $\mathrm{CO_2}$; the same species tracked by FDS.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_Equilibrium_Species}
\end{center}
\caption[Species Evolution in Finite Rate Reaction]{Time evolution of species mass fraction for a two-step Arrhenius finite rate reaction compared to equilibrium values.}
\label{fig:Arrhenius_2Order_1stepb}
\end{figure}

\begin{figure}[ht]
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_Equilibrium_Temperature} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/ReactionRate_Equilibrium_Pressure}
\end{tabular*}
\caption[Temperature and Pressure equilibrium comparison]{Time evolution of temperature (left) and pressure (right) for two-step Arrhenius finite rate propane reactions compared to equilibrium values.}
\label{fig:Arrhenius_175Order_23stepb}
\end{figure}
\subsection{Mixed mode reactions (ReactionRate\_Mixed\_)}




\clearpage

\section{Fractional Effective Dose (FED) and Fractional Irritant Concentration (FIC) (\texorpdfstring{{\bf FED\_FIC}}{FED\_FIC}) }
\label{FED_FIC}

The Fractional Effective Dose index (FED), developed by Purser~\cite{SFPE:Purser}, is a commonly used measure of human incapacitation
due to the combustion gases. The FED value is calculated as
\be
\mathrm{FED}_\mathrm{tot} = (\mathrm{FED}_\mathrm{CO} + \mathrm{FED}_\mathrm{CN} + \mathrm{FED}_\mathrm{NO_x} + \mathrm{FLD}_\mathrm{irr}) \times \mathrm{HV}_\mathrm{CO_2} + \mathrm{FED}_\mathrm{O_2}
\ee
The fraction of an incapacitating dose of CO is calculated as
\be
\mathrm{FED}_\mathrm{CO} = \int_0^t 2.764 \times 10^{-5} \, (C_\mathrm{CO}(t))^{1.036} \, dt
\ee
where $t$ is time in minutes and $C_\mathrm{CO}$ is the CO concentration (ppm). The fraction of an incapacitating dose of CN is calculated as
\be
\mathrm{FED}_\mathrm{CN} = \int_0^t \left( \frac{\exp\left( \frac{C_\mathrm{CN}(t)}{43} \right)}{220} - 0.0045 \right) \, dt
\ee
where $t$ is time in minutes and $C_\mathrm{CN}$ is the concentration (ppm) of HCN corrected for the protective effect of NO$_\mathrm{2}$. $C_\mathrm{CN}$ is calculated as
\be
C_\mathrm{CN} = C_\mathrm{HCN} - C_\mathrm{NO_2}
\ee
The fraction of an incapacitating dose of NO$_x$ is calculated as
\be
\mathrm{FED}_\mathrm{NO_x} = \int_0^t \frac{C_\mathrm{NO_x}(t)}{1500} \, dt
\ee
where $t$ is time in minutes and $C_\mathrm{NO_x}$ is the sum of NO and NO$_\mathrm{2}$ concentrations (ppm).
The Fractional Lethal Dose (FLD) of irritants is calculated as
\be
\mathrm{FLD}_\mathrm{irr} = \int_0^t \left(
    \frac{C_\mathrm{HCl}(t)}    {F_\mathrm{FLD,HCl}} +
    \frac{C_\mathrm{HBr}(t)}    {F_\mathrm{FLD,HBr}} +
    \frac{C_\mathrm{HF}(t)}     {F_\mathrm{FLD,HF}} +
    \frac{C_\mathrm{SO_2}(t)}   {F_\mathrm{FLD,SO_2}} +
    \frac{C_\mathrm{NO_2}(t)}   {F_\mathrm{FLD,NO_2}} +
    \frac{C_\mathrm{C_3H_4O}(t)}{F_\mathrm{FLD,C_3H_4O}} +
    \frac{C_\mathrm{CH_2O}(t)}  {F_\mathrm{FLD,CH_2O}}
    \right) \, dt
\ee
where $t$ is time in minutes, the nominators are the instantaneous concentrations (ppm) of each irritant and
the denominators the exposure doses of respective irritants predicted to be lethal to half the population.
The lethal exposure doses~\cite{SFPE:Purser} are given in the table below.
\begin{center}
\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline & HCl & HBr & HF & $\mathrm{SO_2}$ & $\mathrm{NO_2}$ & $\mathrm{C_3H_4O}$ & $\mathrm{CH_2O}$  \\ \hline \hline
F${}_\mathrm{FLD}$ (ppm $\times$ min) & 114000 & 114000 & 87000 & 12000 & 1900 & 4500 & 22500 \\
F${}_\mathrm{FIC}$ (ppm) & 900 & 900 & 900 & 120 & 350 & 20 & 30 \\ \hline
\end{tabular}
\end{center}
The fraction of an incapacitating dose of low O${}_2$ hypoxia is calculated as
\be
\mathrm{FED}_\mathrm{O_2} =  \int_0^t \frac{dt}{60 \exp \left [ 8.13 - 0.54 \, (20.9 - C_\mathrm{O_2}(t)) \right ] }
\ee
where $t$ is time in minutes and $C_\mathrm{O_2}$ is the O${}_2$ concentration (volume per cent).
The hyperventilation factor induced by carbon dioxide is calculated as
\be
\mathrm{HV}_\mathrm{CO_2} = \frac{ \exp( 0.1930 \, C_\mathrm{CO_2}(t) +  2.0004 ) }{7.1} \label{co2hyp}
\ee
where $t$ is time in minutes and $C_\mathrm{CO_2}$ is the CO${}_2$ concentration (percent).

The Fractional Irritant Concentration (FIC), also developed by Purser~\cite{SFPE:Purser}, represents the toxic effect which
depends upon the immediate concentrations of irritants. The overall irritant concentration FIC is calculated as
\be
\mathrm{FIC}_\mathrm{irr} =
    \frac{C_\mathrm{HCl}(t)}    {F_\mathrm{FIC,HCl}} +
    \frac{C_\mathrm{HBr}(t)}    {F_\mathrm{FIC,HBr}} +
    \frac{C_\mathrm{HF}(t)}     {F_\mathrm{FIC,HF}} +
    \frac{C_\mathrm{SO_2}(t)}   {F_\mathrm{FIC,SO_2}} +
    \frac{C_\mathrm{NO_2}(t)}   {F_\mathrm{FIC,NO_2}} +
    \frac{C_\mathrm{C_3H_4O}(t)}{F_\mathrm{FIC,C_3H_4O}} +
    \frac{C_\mathrm{CH_2O}(t)}  {F_\mathrm{FIC,CH_2O}}
\ee
where the nominators are the instantaneous concentrations of each irritant and the denominators the concentrations of respective irritants
expected to cause incapacitation in half the population. The incapacitating concentrations~\cite{SFPE:Purser} are given in the table above.

The FED and FIC values were computed from specified constant gas concentrations for four cases using an external script.
The gas concentrations are listed in the table below. The concentrations are in ppm.
\begin{center}
\begin{tabular}{|l|l|l|l|l|}
\hline Case ID & O2, CO2, CO & Asphyxiants & Irritants & All Gases \\ \hline \hline
$\mathrm{O_2}$ & 97727 & 90218 & 209000 & 103055 \\ \hline
$\mathrm{CO_2}$ & 343066 & 19189 & 0 & 7463 \\ \hline
$\mathrm{CO}$ & 3242 & 2456 & 0 & 1660 \\ \hline
$\mathrm{NO}$ & 0 & 134.9 & 0 & 89.34 \\ \hline
$\mathrm{NO_2}$ & 0 & 0 & 1.139 & 0.569 \\ \hline
$\mathrm{HCN}$ & 0 & 265.3 & 0 & 204.0 \\ \hline
$\mathrm{HCl}$ & 0 & 0 & 68.33 & 34.17 \\ \hline
$\mathrm{HBr}$ & 0 & 0 & 68.33 & 34.17 \\ \hline
$\mathrm{HF}$ & 0 & 0 & 52.15 & 26.07 \\ \hline
$\mathrm{SO_2}$ & 0 & 0 & 7.193 & 3.596 \\ \hline
$\mathrm{C_3H_4O}$ & 0 & 0 & 2.697 & 1.349 \\ \hline
$\mathrm{CH_2O}$ & 0 & 0 & 13.49 & 6.743  \\ \hline
\end{tabular}
\end{center}

Two versions of the simulations are performed. In the first simulation, the species were defined as individual tracked species.
The FDS predictions and the expected FED and FIC values are compared in the figures below. In the second simulation, each specie was defined as
a lumped specie, being part of the mixture using {\ct SMIX}. Four different mixtures were defined. The results for this test are shown in
Figure~\ref{FED_FIC_SMIX_plot}.

\begin{figure}[ht]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.in]{SCRIPT_FIGURES/FED_O2_CO2_CO} &
\includegraphics[width=3.in]{SCRIPT_FIGURES/FED_Asphyxiants} \\
\includegraphics[width=3.in]{SCRIPT_FIGURES/FED_Irritants} &
\includegraphics[width=3.in]{SCRIPT_FIGURES/FED_All_Gases} \\
\includegraphics[width=3.in]{SCRIPT_FIGURES/FIC_O2_CO2_CO} &
\includegraphics[width=3.in]{SCRIPT_FIGURES/FIC_Asphyxiants} \\
\includegraphics[width=3.in]{SCRIPT_FIGURES/FIC_Irritants} &
\includegraphics[width=3.in]{SCRIPT_FIGURES/FIC_All_Gases}
\end{tabular*}
\caption[The FED and FIC values in {\bf FED\_FIC} test cases.]{Comparison of FED and FIC predictions with expected values.}
\label{FED_FIC_plot}
\end{figure}

\begin{figure}[ht]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.in]{SCRIPT_FIGURES/FED_SMIX_O2_CO2_CO} &
\includegraphics[width=3.in]{SCRIPT_FIGURES/FED_SMIX_Asphyxiants} \\
\includegraphics[width=3.in]{SCRIPT_FIGURES/FED_SMIX_Irritants} &
\includegraphics[width=3.in]{SCRIPT_FIGURES/FED_SMIX_All_Gases} \\
\includegraphics[width=3.in]{SCRIPT_FIGURES/FIC_SMIX_O2_CO2_CO} &
\includegraphics[width=3.in]{SCRIPT_FIGURES/FIC_SMIX_Asphyxiants} \\
\includegraphics[width=3.in]{SCRIPT_FIGURES/FIC_SMIX_Irritants} &
\includegraphics[width=3.in]{SCRIPT_FIGURES/FIC_SMIX_All_Gases}
\end{tabular*}
\caption[The FED and FIC values in {\bf FED\_FIC\_SMIX} test cases.]{Comparison of FED and FIC predictions with expected values using {\ct SMIX}.}
\label{FED_FIC_SMIX_plot}
\end{figure}

\clearpage

\newpage

\section{Aerosol Deposition (Propane\_flame\_deposition)}

The calculations described in this section check the conservation of mass for the aerosol deposition algorithms. The example involves a reaction that invokes an aerosol deposition model in FDS (e.g., soot deposition). For this example, the fuel will be propane with a peak heat release rate of 100~kW and a 5~\% soot yield. For a 100~kW propane fire ({\ct HEAT\_OF\_COMBUSTION} of 44,715~kJ/kg), the associated burning rate is 2.236~g/s. A {\ct RAMP} is used to specify a burning rate from a propane burner that ramps up linearly to 2.236~g/s from 0~s to 1~s, remains steady at 2.236~g/s from 1~s to 4~s, then linearly decreases to 0~g/s from 4~s to 5~s. The total fuel mass released is 8.944~g of propane. Therefore, the resulting soot mass should be equal to 0.447~g, or 5~\% of the total amount of fuel. For a case with no aerosol deposition, we would expect the gas phase soot mass to be equal to 0.447~g. For a case with aerosol deposition, we would expect some fraction of the soot to exist in the gas phase and the remainder of the soot in the condensed phase (deposited to the wall). The sum of the soot mass in the gas phase and condensed phase should be equal to 0.447~g.

Figure~\ref{fig:deposition_mass} shows the time evolution of the gas phase soot mass, condensed phase soot mass, and total soot mass (sum of the gas phase soot mass and condensed phase soot mass) for five cases. The five cases are (1) all aerosol deposition mechanisms active, (2) no aerosol deposition mechanisms active, (3) gravitational deposition only, (4) thermophoretic deposition only, and (5) turbulent deposition only.

\begin{figure}[ht]
\begin{center}
\begin{tabular}{c}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/Propane_flame_deposition_gas} 
\includegraphics[width=3.2in]{SCRIPT_FIGURES/Propane_flame_deposition_wall} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/Propane_flame_deposition_total}
\end{tabular}
\end{center}
\caption[Soot mass conservation for Propane\_flame\_deposition case]{Time evolution of soot mass components for deposition cases. (Left) Mass of soot in gas phase. (Right) Mass of soot deposited on condensed phase walls. (Bottom) Total mass of soot in gas phase and condensed phase.}
\label{fig:deposition_mass}
\end{figure}


\chapter{Heat Conduction}

This chapter contains examples that test the one-dimensional heat conduction solver in FDS.
A one-dimensional heat conduction equation for the solid phase
temperature $T_s(x,t)$ is applied in the direction $x$ pointing into
the solid (the point $x = 0$ represents the surface)
\be
  \rho_s c_s \; \dod{T_s}{t} = \dod{}{x} k_s \dod{T_s}{x} + \dq_s'''
  \label{1dheat}
\ee
In cylindrical and spherical coordinates, the heat conduction equation is written
\be
  \rho_s c_s \; \dod{T_s}{t} = \frac{1}{r} \, \dod{}{r}
  \left(rk_s \dod{T_s}{r} \right)+\dq_s'''
  \label{1dheatcyl} \quad ; \quad
  \rho_s c_s \; \dod{T_s}{t} = \frac{1}{r^2} \, \dod{}{r}
  \left(r^2k_s \dod{T_s}{r} \right)+\dq_s'''
\ee
FDS offers the user these options, with the assumption that the
obstruction is not actually recti-linear, but rather cylindrical or
spherical in shape. This option is useful in describing the behavior
of small, complicated ``targets'' like cables or heat detection
devices.



\clearpage

\section{Simple Heat Conduction Through a Solid Slab (\texorpdfstring{{\bf heat\_conduction}}{heat\_conduction})}

Analytical solutions of transient, one-dimensional heat conduction through a slab can be found in Refs.~\cite{Drysdale:1} and \cite{Carslaw:1}. Four
cases are examined here. In each, a slab of thickness $L=0.1$~m is exposed on one face to an air temperature of $T_g=120$~$^\circ$C. The other face
is insulated (adiabatic). The convective heat transfer from the gas to the slab is $\dq_c'' = h \, (T_g - T_s)$, where $h$ is constant, and $T_s$ is
the slab face temperature. No thermal radiation is included.
\begin{center}
\begin{tabular}{|c|c|c|c|c|c|}
\hline
Case  &  $k$      & $\rho$       &  $c$          &   $h$         &  Bi     \\
      & (W/m/K)   & (kg/m$^3$)   &  (kJ/kg/K)    &  (W/m$^2$/K)  &  $hL/k$ \\ \hline \hline
A     &   0.1     & 100          &  1            &  100          &  100    \\ \hline
B     &   0.1     & 100          &  1            &  10           &  10     \\ \hline
C     &   1.0     & 1000         &  1            &  10           &  1      \\ \hline
D     &  10.0     & 10000        &  1            &  10           & 0.1     \\ \hline
\end{tabular}
\end{center}

\begin{figure}[ht]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/heat_conduction_a} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/heat_conduction_b} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/heat_conduction_c} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/heat_conduction_d}
\end{tabular*}
\caption[The {\bf heat\_conduction} test cases.]{Comparison of heat conduction calculations with analytical solutions.}
\label{heat_conduction}
\end{figure}


\clearpage

\section{Temperature-Dependent Thermal Properties (\texorpdfstring{{\bf heat\_conduction\_kc}}{heat\_conduction\_kc})}

This example demonstrates the 1-D heat conduction in cartesian, cylindrical and spherical geometries with temperature-dependent thermal properties.
The cartesian solution was computed using HEATING (version~7.3), a multi-dimensional, finite-difference, general purpose heat transfer
model~\cite{Childs}. The cylindrical and spherical solutions were computed using a commercial finite-element solver, ABAQUS.

The sample of homogenous material is initially at 0~$^\circ$C and at $t>0$ exposed to a gas at 700~$^\circ$C. A fixed heat transfer coefficient of
10~W/m$^2$/K is assumed. The density of the material is 10000~kg/m$^3$. The conductivity and specific heat are functions of temperature with the
following values: $k(0)=0.10$~W/m/K, $k(200)=0.20$~W/m/K, $c(0)=1.0$~kJ/kg/K, $c(100)=1.2$~kJ/kg/K, $c(200)=1.0$~kJ/kg/K. The thickness (radius) of
the sample is 0.01~m. In the cartesian case, the back surface of the material is exposed to a gas at 0~$^\circ$C. In the figure below, the light colored solid
lines are FDS results and the dark lines are the HEATING results. An example input with cylindrical geometry looks like:

\scriptsize
\begin{verbatim}
&MATL ID='MAT_1'
      EMISSIVITY = 0.0
      CONDUCTIVITY_RAMP='K_RAMP'
      SPECIFIC_HEAT_RAMP = 'C_RAMP'
      DENSITY=10000. /

&RAMP ID = 'K_RAMP' T=0,   F= 0.10 /
&RAMP ID = 'K_RAMP' T=100, F= 0.15 /
&RAMP ID = 'K_RAMP' T=200, F= 0.20 /
&RAMP ID = 'C_RAMP' T=0,   F= 1.00 /
&RAMP ID = 'C_RAMP' T=100, F= 1.20 /
&RAMP ID = 'C_RAMP' T=200, F= 1.00 /

&SURF ID='SLAB'
      STRETCH_FACTOR = 1.0
      GEOMETRY = 'CYLINDRICAL'
      MATL_ID='MAT_1'
      THICKNESS=0.01 /
\end{verbatim} \normalsize

\begin{figure}[ht]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/heat_conduction_kc_surf} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/heat_conduction_kc_back}
\end{tabular*}
\caption[The {\bf heat\_conduction\_kc} test case.]{Comparison of heat conduction calculations with a finite-element model.}
\label{heat_conduction_kc}
\end{figure}


\clearpage

\section{Simple Thermocouple Model (\texorpdfstring{{\bf thermocouples}}{thermocouples})}

This example tests the simple thermocouple model in FDS. It consists of a box whose walls and gas temperatures are fixed at 500~$^\circ$C. Inside the box are three
thermocouples with bead diameters of 1, 2, and 3~mm. Also included in the box are three ``targets'' -- small solid objects whose surfaces are assumed to be composed of
small spheres of the same diameter as the thermocouples. Figure~\ref{thermocouples} compares the temperature rise of the objects. The thermocouple model is not compared
with an analytical solutions. This is
simply a comparison of the thermally-thin thermocouple calculation with the thermally-thick ``target'' calculation. Small differences in temperature are due to slightly different
flow conditions in different regions of the box, and numerical error due to node spacing and time step size.

\begin{figure}[ht]
\noindent
\begin{center}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/thermocouples}
\end{center}
\caption[The {\bf thermocouples} test case.]{Comparison of thermally-thin and thick heat conduction into a small sphere.}
\label{thermocouples}
\end{figure}




\chapter{Pyrolysis}

This chapter tests the routines in FDS that calculate the thermal decomposition of materials. Solid
surfaces can consist of multiple layers, and each layer can consist of multiple material components.
Each material component may undergo several competing reactions, and
each of these reactions may produce some other solid component
(residue), gaseous fuel, and/or water vapor.


\section{Mass conservation of pyrolyzed mass (\texorpdfstring{{\bf surf\_mass\_conservation}}{surf\_mass\_concervation})}

The calculations described in this section check the conservation of
mass produced by the pyrolysis algorithm. Parameters describing the geometric configuration of the solid are input via a {\ct SURF} line,  and
the reacting materials are described on respective {\ct MATL} lines. In the tests, four independent modeling options are varied:
\begin{enumerate}
\item The {\ct SURF} line can be associated with either a solid surface as designated by a {\ct VENT} line, or by solid particles as
described by a {\ct PART} line.
\item The {\ct SURF} geometry can be either {\ct CARTESIAN}, {\ct CYLINDRICAL}, or {\ct SPHERICAL}.
\item The {\ct MATL} can be either charring (non-zero {\ct NU\_RESIDUE}) or non-charring.
\item The pyrolysis product can be either the fuel gas defined by the
mixture fraction model, or an additional gas species, defined by a {\ct SPEC} line.
\end{enumerate}
In all cases, the wall thickness (or radius for cylindrical and spherical geometries) is 0.01~m. The material density is 360~kg/m$^3$ and the yield of gaseous
products for the charring cases is 0.5, {\em i.e.} half of the original mass. For cartesian surfaces, the mass loss per unit area is
1.8~kg/m$^2$ for charring, and 3.6~kg/m$^2$ for non-charring materials.
For cylindrical surfaces, the volume per unit surface area is $r/2$, and thus the mass loss per unit area
is $360(1-0.5) \times r/2$=0.9~kg/m$^2$ for charring, and 1.8~kg/m$^2$ for non-charring materials.
For spherical surfaces, the volume per unit surface area is $r/3$, and thus the mass loss per unit area is
$360(1-0.5) \times r/3$=0.6~kg/m$^2$ for charring, and 1.2~kg/m$^2$ for non-charring materials.
On the figures found on the following pages, the computed results are labeled as follows:
\begin{description}
\item[Expected] indicates the total mass that has pyrolyzed by the end of the simulation.
\item[Gaseous] indicates the instantaneous concentration of pyrolyzed mass integrated over the volume of the
computational domain. It should gradually increase from zero to the ``Expected'' value.
\item[Solid] indicates the instantaneous value of the solid surface density integrated over the entire surface area.
For charring materials it should decrease from its initial value (twice the final value) to the final ``Expected'' value. For non-charring materials, it should
decrease from the ``Expected'' value to zero.
\item[Fuel Gas] is the total burning rate integrated over time. It should increase from zero to the ``Expected'' value.
\end{description}


\subsection{Pyrolysis at a Solid Surface}

The analytical mass losses are calculated by multiplying the mass per unit area by the {\ct VENT} area,
which in all cases is 1~m$^2$.
The expected and computed results for charring material are compared in Fig.~\ref{surf_mass_vent_char}.
The expected and computed results for non-charring material are compared in Fig.~\ref{surf_mass_vent_nonchar}.
\begin{figure}[ht!]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_vent_char_cart_fuel} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_vent_char_cart_gas} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_vent_char_cyl_fuel} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_vent_char_cyl_gas} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_vent_char_spher_fuel} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_vent_char_spher_gas}
\end{tabular*}
\caption[The {\ct surf\_mass\_vent\_char} test cases.]{Comparison of analytical and predicted mass change for charring surfaces that are introduced as {\ct VENT}s.}
\label{surf_mass_vent_char}
\end{figure}

\begin{figure}[ht!]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_vent_nonchar_cart_fuel} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_vent_nonchar_cart_gas} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_vent_nonchar_cyl_fuel} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_vent_nonchar_cyl_gas} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_vent_nonchar_spher_fuel} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_vent_nonchar_spher_gas}
\end{tabular*}
\caption[The {\ct surf\_mass\_vent\_nonchar} test cases.]{Comparison of analytical and predicted mass change for non-charring surfaces that are introduced as {\ct VENT}s.}
\label{surf_mass_vent_nonchar}
\end{figure}

\clearpage

\subsection{Pyrolysis of Discrete Particles}

For lagrangian particles, the expected values of the mass are obtained by multiplying the material density by the particle volume by the residue fraction.
For cartesian surfaces, the particle area is two times the product of the parameters {\ct LENGTH} and {\ct WIDTH} on the {\ct SURF} line, both of
which are given a value 0.05~m. As a result, the expected masses for particles with cartesian surfaces are
$360 (1-0.5) \times 2\delta L W=0.009$~kg for charring, and 0.018~kg for non-charring materials. Note that the half-thickness, $\delta=0.01$~m, is
specified on the {\ct SURF} line as {\ct THICKNESS}.
For cylindrical particles, the {\ct LENGTH} is 0.1~m, and the radius, $r$
(specified via {\ct THICKNESS}), is 0.01~m. The expected masses are thus
$360(1-0.5) \times \pi r^2 L=0.00565$~kg for charring, and 0.0113~kg for non-charring materials.
For spherical particles, the expected mass is $360(1-0.5) \times 4\pi r^3/3=7.54\times 10^{-4}$~kg for charring, and $1.51\times 10^{-3}$~kg for
non-charring materials.

The analytical and computed results for charring material are compared in~\ref{surf_mass_part_char}.
The analytical and computed results for non-charring material are compared in~\ref{surf_mass_part_nonchar}.
\begin{figure}[ht]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_char_cart_fuel} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_char_cart_gas} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_char_cyl_fuel} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_char_cyl_gas} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_char_spher_fuel} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_char_spher_gas}
\end{tabular*}
\caption[The {\ct surf\_mass\_part\_char} test cases.]{Comparison of analytical and predicted mass change for charring particle surfaces.}
\label{surf_mass_part_char}
\end{figure}

\begin{figure}[ht]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_nonchar_cart_fuel} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_nonchar_cart_gas} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_nonchar_cyl_fuel} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_nonchar_cyl_gas} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_nonchar_spher_fuel} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_nonchar_spher_gas}
\end{tabular*}
\caption[The {\ct surf\_mass\_part\_nonchar} test cases.]{Comparison of analytical and predicted mass change for non-charring particle surfaces.}
\label{surf_mass_part_nonchar}
\end{figure}

\clearpage

A set of more advanced computations are performed to test mass conservation in cases involving multiple and split particles.
The case has three meshes, and each mesh has the same mass of charring cylindrical particles as the cases above.
Because the length of the cylindrical particles is four times 0.1~m, the cylinder diameter is only half of the value used above.
\begin{description}
\item[Mesh 1] has four 0.1 m long cylinders with 5 mm radius. The locations are randomly chosen from a plane defined by the {\ct INIT} statement.
\item[Mesh 2] has eight 0.05 m long cylinders, initialized using the {\ct INIT} and {\ct MULT} statements.
\item[Mesh 3] has eight 0.05 m long cylinders, initialized using the {\ct INIT} and {\ct MULT} statements. The cylinders are split in two sections using the
{\ct NUMBER\_RADIATIVE\_ANGLES} feature of the {\ct PART} class.
\end{description}
The analytical and computed results are compared in Fig.~\ref{surf_mass_part_char_advanced}.
The readability of the figure is improved by setting the external heat fluxes for Meshes 1, 2, and 3 to 50, 45 and 40 kW/m$^2$, respectively.
\begin{figure}[ht]
\begin{center}
\includegraphics[width=5.0in]{SCRIPT_FIGURES/surf_mass_part_char_cyl_gas_advanced}
\end{center}
\caption[The {\ct surf\_mass\_part\_char\_cyl\_gas\_advanced} test cases.]{Comparison of analytical and predicted mass change for a charring, cylindrical surface
associated with particles in three variations.}
\label{surf_mass_part_char_advanced}
\end{figure}

\clearpage
%The splitted particles are studied more systematically here. The particles with solid surfaces (surf mass part) with and without char yield, producing fuel, are splitted in two radiation angles (x, y and z directions). The mass conservation results are seen in Fig.~\ref{surf_mass_part_fuel_split} The ambient is air, so also the effects in total energy release are seen in Fig.~\ref{surf_mass_part_fuel_energy_split}.
%
%\begin{figure}[ht]
%\noindent
%\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
%\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_char_cart_fuel_split} &
%\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_nonchar_cart_fuel_split} \\
%\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_char_cyl_fuel_split} &
%\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_nonchar_cyl_fuel_split} \\
%\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_char_spher_fuel_split} &
%\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_nonchar_spher_fuel_split}
%\end{tabular*}
%\caption[The {\ct surf\_mass\_part\_fuel\_split} test cases.]{Comparison of analytical and predicted mass change for splitted particle surfaces.}
%\label{surf_mass_part_fuel_split}
%\end{figure}
%
%\begin{figure}[ht]
%\noindent
%\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
%\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_char_cart_fuel_energy_split} &
%\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_nonchar_cart_fuel_energy_split} \\
%\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_char_cyl_fuel_energy_split} &
%\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_nonchar_cyl_fuel_energy_split} \\
%\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_char_spher_fuel_energy_split} &
%\includegraphics[width=3.2in]{SCRIPT_FIGURES/surf_mass_part_nonchar_spher_fuel_energy_split}
%\end{tabular*}
%\caption[The {\ct surf\_mass\_part\_fuel\_split} test cases.]{Comparison of analytical and predicted total energy release for splitted particle surfaces.}
%\label{surf_mass_part_fuel_energy_split}
%\end{figure}


%\clearpage

\section{Development of surface emissivity (\texorpdfstring{{\bf emissivity}}{emissivity})}

For thermally thick materials, the surface emissivity is computed as a
mass-weighted sum of the individual values of the emissivity
in the first condensed phase grid cell. In this verification test, the
initial material, having emissivity of 1.0, is converted to another
material, having emissivity of 0.0, at a constant rate of 0.1~s$^{-1}$. As a
result, the surface emissivity should change linearly from 1.0 to 0.0 in 10~s.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=3.5in]{SCRIPT_FIGURES/emissivity}
\end{center}
\caption[The {\bf emissivity} test case.]{Testing the emissivity of solid materials.}
\label{emissivity}
\end{figure}


\clearpage

\section{Enthalpy of solid materials (\texorpdfstring{{\bf enthalpy}}{enthalpy})}

Consider a thin plate of conductive material that is exposed on one side to an elevated temperature heat source and exposed on the
other to an ambient temperature void. In the thermally-thin limit, the temperature of the slab is governed by the following equation
\be
   \frac{dT_s}{dt} = \frac{\dq_{\hbox{\tiny front}}'' + \dq_{\hbox{\tiny back}}''}{c_s \, \rho_s \, \delta}
\ee
In this example, the initial exposure to the front side of the slab is
3~kW/m$^2$. The original material (call it A) undergoes a reaction to form material B.  The reaction rate is constant, 0.2~s$^{-1}$, which in this
case means that material A disappears in exactly 5~s. This is achieved by setting $n_s$ and $E$ to 0 and $A$ to 0.2 in the reaction rate term:
\be
    r = \left( \frac{\rho_{s,A}}{\rho_{s0}}\right)^{n_{s}}
    A \; \exp \left(-\frac{E}{RT_s}\right)
\ee
The density and conductivity of both materials are
30~kg/m$^3$ and 10~W/m/K, respectively. The emissivity of front and back is 1.  The specific heat of material A changes from
1.0~kJ/kg/K to 0.1~kJ/kg/K above 80~$^\circ$C, while the specific heat of material B is constant at 1.0~kJ/kg/K. The slab is 1~mm thick.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=3.5in]{SCRIPT_FIGURES/enthalpy}
\end{center}
\caption[The {\bf enthalpy} test case.]{Testing the enthalpy of solid materials.}
\label{enthalpy}
\end{figure}

\noindent
Note that the ``analytical'' solution is actually a simple numerical integration of the equations above with a small time step to ensure accuracy.
This example tests a number of features, including the reaction rate, mass weighted specific heats, and radiation boundary conditions. Note that the
convective heat transfer has been turned off, and the correct steady-state temperature is calculated by FDS.

\clearpage


\section{Simple phase change reaction (\texorpdfstring{{\bf pcm\_slab}}{pcm\_slab})}

A semi-infinite layer of liquid in the semi-infinite region, $x>0$,
is cooled by setting the surface, $x=0$, to a constant temperature, $T_0$,
below the freezing temperature, $T_f$. Initially, the liquid is at temperature $T_i > T_f$. The position of the boundary between frozen and liquid layers
is denoted by $x_f$. The heat conduction equations for the two regions are
\begin{eqnarray}
\dod{T_s}{t} & = & \alpha_s \dsods{T_s}{x} \quad \quad (0 < x < x_f) \\ [0.2in]
\dod{T_s}{t} & = & \alpha_l \dsods{T_s}{x} \quad \quad (x > x_f)
\end{eqnarray}
with boundary conditions
\begin{eqnarray}
T_s(x,0)   &= & T_i \nonumber \\
T_s(0,t)   &= & T_0 \nonumber \\
T_s(x_f,t) &= & T_f \nonumber
\end{eqnarray}
The analytical solutions for the phase interface location and temperature are \cite{Carslaw:1}
\be
x_f(t) = 2 \lambda \sqrt{\alpha_l t}
\ee
\begin{eqnarray}
\frac{T_s(x,t)-T_0}{T_f - T_0} &=& \frac{\erf(x/2\sqrt{\alpha t})} {\erf (x_f/2\sqrt{\alpha t})} \quad \quad (0 < x < x_f) \\ [0.2in]
\frac{T_i-T_s(x,t)}{T_i - T_f} &=& \frac{\erfc(x/2\sqrt{\alpha t})}{\erfc(x_f/2\sqrt{\alpha t})} \quad \quad (x > x_f)
\end{eqnarray}
where $\lambda = x_f /2\sqrt{\alpha t}$ is obtained as a root of the (complicated)
transcendental equation, given in \cite{Carslaw:1}.

In the test case, the thickness of the liquid layer cannot be infinite. For practical purposes, a 50 cm thick layer was found to be sufficient.
The fixed-temperature boundary condition, which is formally not available for the condensed-phase heat transfer solver in FDS,
is implemented by assuming that the gas temperature is $T_0$ with a very high heat convection coefficient.
For material properties, we choose $\rho_s = \rho_l =1000$~kg/m$^3$,
$k_s = k_l = 2$~W/m/K, $c_s = c_l = 2$~kJ/kg/K, $H_{r,\alpha\beta}=300$~kJ/kg, $T_f = 0$~$^\circ$C, $T_i = +15$~$^\circ$C,
and $T_0 = -15$~$^\circ$C, which leads to a {\em Stefan number}
\be
\hbox{St}=\frac{c_s\left(T_i - T_0\right)}{H_{r,\alpha\beta}} = 0.1
\ee
and $\lambda = 0.189$.

Analytical and simulated results are compared in Fig.~\ref{pcm_slab}. The plot on the left shows the position of the phase boundary.
From the FDS results, two estimates of $x_f$ are determined because in the numerical solution, the boundary of the two phases is not perfectly sharp.
``FDS min'' is the largest value of $x$ for which $\rho_s > 990$~kg/m$^3$ and ``FDS max'' is the largest $x$ for which $\rho_s > 0$~kg/m$^3$. The plot on the right
shows temperatures at three depths from the surface: 1~cm, 5~cm, and 10~cm.
\begin{figure}[ht!]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/pcm_slab_xf} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/pcm_slab_T}
\end{tabular*}
\caption[The {\bf pcm\_slab} test cases.]{Comparison of analytical and simulated results for the two-region Neumann problem with phase change.}
\label{pcm_slab}
\end{figure}


\clearpage


\section{A Simple Two-Step Pyrolysis Example (\texorpdfstring{{\bf two\_step\_solid\_reaction}}{two\_step\_solid\_reaction})}

Before considering actual experimental measurements, it is necessary to check the accuracy of the ordinary differential
equation solver within FDS.
Consider  the simplified set  of ordinary  differential equations  describing the mass
fraction of  three  components of  a  solid material  undergoing thermal
degradation:
\begin{eqnarray}
    \frac{dY_a}{dt} &=&  -K_{ab} Y_a \nonumber  \\
    \frac{dY_b}{dt} &=&   K_{ab} Y_a  -  K_{bc}  Y_b  \\
    \frac{dY_c}{dt} &=&   K_{bc} Y_a
    \nonumber
\end{eqnarray}
where  the  mass  fraction  of  component  $a$  is  1  initially.  The
analytical solution is:
\begin{eqnarray}
    Y_a(t)    &=&    \exp(-K_{ab}t)    \nonumber   \\
    Y_b(t)    &=&    \frac{K_{ab}}{K_{bc}-K_{ab}} \exp(-K_{ab} t)  - \exp(-K_{bc} t) \\
    Y_c(t)    &=&    \left[   K_{ab}    (1-\exp(-K_{bc} t) )    +  K_{bc}*(\exp(-K_{ab} t) -1) \right] / (K_{ab}-K_{bc})
\end{eqnarray}
The analytical and  numerical solution for the parameters $K_{ab} = 0.389$ and $K_{bc} = 0.262$ are shown here:

\begin{figure}[ht]
\begin{center}
\includegraphics[width=3.5in]{SCRIPT_FIGURES/two_step_solid_reaction}
\end{center}
\caption[The {\bf two\_step\_solid\_reaction} test case.]{Comparison of a two-step solid pyrolysis calculation with an analytical solution.}
\label{two_step_solid_reaction}
\end{figure}




\clearpage

\section{Interpreting Bench-Scale Measurements}
\label{solid_kinetics}

This section describes a method of deriving and applying the values of the kinetic parameters for the thermal
decomposition of a solid, following the methodology described by Lyon~\cite{Lyon:FM2000}.


\subsection{General Theory}

Consider a small sample of solid material that is heated at a relatively slow, constant rate. An example of this process is
thermal gravimetric analysis (TGA). Assume that the solid consists of $N$ material components, with each component mass fraction denoted by
$Y_i(t)$. As the solid is heated, each component undergoes a reaction to form undetermined gases or a single solid residue whose
mass fraction is denoted $Y_r(t)$ and whose yield is denoted by $\nu_r$. The governing equations for the component mass fractions is then:
\begin{eqnarray}
   \frac{dY_i}{dt} &=& -A_i \, Y_i \, \exp \left( -\frac{E_i}{RT} \right)    \quad ; \quad Y_i(0) = Y_{0,i} \quad ; \quad i=1,N  \label{dYdt} \\
   \frac{dY_r}{dt} &=& -\nu_r  \sum_i \frac{dY_i}{dt}                        \quad ; \quad Y_r(0) = 0  \label{dYrdt}
\end{eqnarray}
In the TGA apparatus, the temperature of the sample is increased linearly in time, $dT/dt=\beta$. Because TGA results are usually expressed as a function of
temperature rather than time, it is convenient to rewrite Eq.~(\ref{dYdt}) as:
\be
   \frac{dY_i}{dT} = -\frac{A_i}{\beta} \, Y_i \, \exp \left( -\frac{E_i}{RT} \right)    \quad ; \quad Y(T=T_0) = Y_{0,i}  \label{dYdT}
\ee
The decomposition rate, $-dY_i/dt$, peaks at a temperature denoted by $T_{p,i}$ with a value denoted by $r_{p,i}$.
At this temperature, the second derivative of $Y_i$ is zero:
\be
   \frac{d^2 Y_i}{dT^2} = -\frac{A_i}{\beta} \, \frac{dY_i}{dT} \, \exp \left( -\frac{E_i}{RT_{p,i}} \right) -
   \frac{A_i}{\beta} \, Y_i \, \exp \left( -\frac{E_i}{RT_{p,i}} \right) \, \frac{E_i}{R T_{p,i}^2}
   = -\frac{dY_i}{dT} \left[ \frac{A_i}{\beta} \, \exp \left( -\frac{E_i}{RT_{p,i}} \right) - \frac{E_i}{R T_{p,i}^2} \right] = 0  \label{d2YdT2}
\ee
Next, Eq.~(\ref{dYdT}) can be integrated from $Y_{0,i}$ to $Y_{p,i}$ (the value of $Y_i$ at the peak), and $T_0$ to $T_{p,i}$:
\be
   \int_{Y_{0,i}}^{Y_{p,i}} \left( \frac{dY_i'}{Y_i'} \right) = - \frac{A_i}{\beta} \int_{T_0}^{T_{p,i}} \exp \left( -\frac{E_i}{RT'} \right) \; dT'
   \approx - \frac{A_i R T_{p,i}^2}{ \beta \, (E_i+2 R T_{p,i}) } \; \exp \left( -\frac{E_i}{RT_{p,i}} \right)
\ee
Using Eq.~(\ref{d2YdT2}) to eliminate $A_i$ yields:
\be
   \ln \left( \frac{Y_{p,i}}{Y_{0,i}} \right) = - \frac{E_i}{E_i+2 R T_{p,i}} \approx -1  \quad \quad (E_i \gg 2 R T_{p,i})
\ee
or more simply, $Y_{p,i} \approx Y_{0,i}/e$. Now, the activation energy can be evaluated using Eqs.~(\ref{dYdt}) and (\ref{d2YdT2}):
\be
   E_i = RT_{p,i}^2 \, \frac{A_i}{\beta} \, \exp \left( -\frac{E_i}{RT_{p,i}} \right) = \frac{RT_{p,i}^2}{\beta} \frac{r_{p,i}}{Y_{p,i}}
   \approx \frac{RT_{p,i}^2}{\beta} \frac{e \, r_{p,i}}{Y_{0,i}}  \label{E_formula}
\ee
Then $A_i$ can be evaluated directly from Eq.~(\ref{dYdt}):
\be
   A_i = \frac{r_{p,i}}{Y_{p,i}} \, \exp \left( \frac{E_i}{RT_{p,i}} \right) \approx \frac{e \, r_{p,i}}{Y_{0,i}} \, \exp \left( \frac{E_i}{RT_{p,i}} \right) \label{A_formula}
\ee
Note that the formulae for $A_i$ and $E_i$ can be evaluated with parameters that are obtained directly by
inspection of the plot of mass loss rate versus temperature.
For each peak, the values of $T_{p,i}$ and $r_{p,i}$ are obvious.
The values of $Y_{0,i}$ can be estimated based on the relative area underneath each peak. The values of $Y_{0,i}$ should sum to 1.



\subsection{Using Micro-Calorimetry Data (\texorpdfstring{{\bf cable\_11\_mcc}}{cable\_11\_mcc})}
\label{cable_11_mcc}

This section describes a method for interpreting micro-combustion calorimeter (MCC) measurements.
The pyrolysis combustion flow calorimeter (PCFC), developed
by Lyon and Walters~\cite{Lyon:JAAP2004} at the U.S. Federal Aviation Administration (FAA), is a device
used to measure the heat generated from the combustion of small (4~mg to 6~mg) material samples by oxygen depletion calorimetry.
Samples are pyrolyzed at a specified heating rate in an anerobic atmosphere (typically N$_2$) and the resulting gases are mixed with
excess oxygen and combusted in a separate chamber. The heat release rate from the specimen is obtained from measurements of the
concentration of oxygen in the effluent exiting the combustor as a function of time. The methodology is the basis for
the standard test ASTM~D~7309~\cite{ASTM:D7309}.

The results of PCFC measurements for several multi-conductor control cables are shown in Fig.~\ref{mcc_plots}.
For each cable, the insulation and jacket material were tested separately, and at least three replicates were performed for each
(only one replicate is shown for each sample). The samples, weighing approximately 5~mg, were cut from the cable jackets and conductor
insulation material of each of the cables. These samples were pyrolyzed in the PCFC at a rate of 1~K/s
from 100~$^\circ$C to 600~$^\circ$C in a nitrogen atmosphere and the effluent combusted at 900~$^\circ$C in a mixture consisting of 20~\% O$_2$
and 80~\% N$_2$. The resulting curve shows the heat release rate of the sample as it was heated, normalized by the mass of the original sample.
There are usually one, two or three noticeable peaks in the curve, corresponding to temperatures where a significant decomposition reaction occurs.
Each peak can be characterized by the maximum value of the heat release rate~($\dot{q}_{p,i}$), the temperature ($T_{p,i}$), and the relative fraction of the original sample mass that undergoes this particular reaction ($Y_{0,i}$). The area under the curve
\be \int_0^\infty \dot{q}(T) \, dT = \beta \, \Delta H' \ee
is the sample heating rate ($\beta$) times the energy released per unit mass of the original sample ($\Delta H'$). This latter quantity is
related to the more conventional heat of combustion via the relation
\be \Delta H = \frac{\Delta H'}{1-\nu_r} \ee
where $\nu_r$ is the fraction of the original mass that remains as residue. Sometimes this is referred to as the ``char yield.'' Note that it is
assumed to be the same for all reactions.

The MCC measurement is similar to TGA in that it is possible to derive the kinetic parameters, $A_i$ and $E_i$, for the various reactions from
the heat release rate curve. As an example of how to work with MCC data, consider the two plots shown in Fig.~\ref{mcc_plots}. The solid curves in the figures
display the results of micro-calorimetry measurements for the insulation and jacket material of a multi-conductor control
cable (the number 11 has no particular meaning other than to distinguish it from other cables being studied).
\begin{figure}[ht]
\includegraphics[width=3.2in]{SCRIPT_FIGURES/cable_11_insulation_mcc}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/cable_11_jacket_mcc}
\caption[Results of a micro-calorimetry analysis of cable materials.]{Results of a micro-calorimetry analysis of a sample of cable insulation (left) and jacket material (right).}
\label{mcc_plots}
\end{figure}
The insulation material exhibits two fairly well-defined peaks, whereas the jacket material exhibits three. Thus, the insulation
material is modeled using two solid components, each undergoing a single-step reaction that produces fuel gas and a solid residue. The jacket
material is modeled using three solid components. The residue yield for the insulation material is
6~\%; for the jacket 49~\%, obtained simply by weighing the sample before and after the micro-calorimetry measurement. It is
not known which reaction produces what fraction of the residue. Rather, it is assumed that each reaction yields the same
residue in the same relative amount.
The dashed curves in Fig.~\ref{mcc_plots} are the results of FDS simulations of the MCC measurements. To mimic the
sample heating, a very thin sheet comprised of a mixture of the solid components with an insulated backing is heated at the
rate specified in the experiment (1~K/s or 60~K/min, the units needed in FDS).
For each reaction,
the kinetic parameters are calculated using the formulae (\ref{E_formula}) and (\ref{A_formula}). The values of
$T_{p,i}$ are obtained directly from the figures. The value of $r_{p,i}/Y_{0,i}$ for the $i$th reaction can be found from:
\be
   r_{p,i} = \beta \, \frac{\dot{q}_{p,i}}{ \Delta H'}   \quad ; \quad
   \Delta H'=\int_0^\infty \dot{q}(T) \, dT   \label{r_formula}
\ee
where $\dot{q}_{p,i}$ is the value of the $i$th heat release rate peak. The values, $Y_{0,i}$, can be estimated from the
relative area under the curve. Their sum ought to be 1.
It is important to check the units of all of these quantities because the
results of these experiments are often presented in different ways depending on the particular application. A mistake
in units can result in values of $A_i$ and/or $E_i$ that will invariably cause spurious results.

The dashed curves in Fig.~\ref{mcc_plots} are the results of numerically integrating Eq.~(\ref{dYdt}) within FDS for each
material component. A typical input line for FDS that describes a single material component undergoing a single
reaction is given by:

\footnotesize
\begin{verbatim}
&MATL ID                    = 'Cable 11 Jacket Component A'
      EMISSIVITY            = ...
      DENSITY               = ...
      CONDUCTIVITY          = ...
      SPECIFIC_HEAT         = ...
      N_REACTIONS           = 1
      REFERENCE_TEMPERATURE = 300.
      REFERENCE_RATE        = 0.0064
      HEATING_RATE          = 60.
      NU_RESIDUE            = 0.49
      RESIDUE               = 'char'
      NU_FUEL               = 0.51
      HEAT_OF_REACTION      = ... /
\end{verbatim} \normalsize

\noindent Only the relevant parameters are shown. The other parameters are not relevant in this
exercise. Note that {\ct REFERENCE\_TEMPERATURE} is $T_{p,i}$, but in units of $^\circ$C. {\ct REFERENCE\_RATE} is actually
$r_{p,i}/Y_{0,i}$, in units of s$^{-1}$. {\ct HEATING\_RATE} is $\beta$ in units of K/min.
{\ct NU\_RESIDUE} is $\nu_r$ and {\ct NU\_FUEL} is ($1-\nu_r$).
Table~\ref{cable_parameters} lists all of the kinetic parameters for the cable insulation and jacket
materials. The peak temperatures are easy to estimate, and the values of $r_{p,i}/Y_{0,i}$ can be fine-tuned to closely match
the data. Note that it is possible to compute values of $A_i$ and $E_i$ and input them directly into FDS, rather
than inputting those listed in the table. However, the values of $A_i$ and $E_i$ are fairly large numbers and have little
meaning in their own.


\begin{table}[ht]
\begin{center}
\caption{Parameters used to derive the kinetic constants for cable materials. The heating rate for both is
60~$^\circ$C/min.}
\label{cable_parameters}
\begin{tabular}{|l||c|c||c|c|c|}
\hline
Parameter                       & \multicolumn{2}{|c|}{Insulation, $\nu_r$=0.06 }  &  \multicolumn{3}{|c|}{Jacket, $\nu_r$=0.49} \\ \cline{2-6}
                                & 1             & 2                 &  1        & 2         & 3              \\ \hline \hline
$T_{p,i}$ ($^\circ$C)           & 355           & 485               &  300      & 345       & 450            \\ \hline
$r_{p,i}/Y_{0,i}$ (s$^{-1}$)    & 0.0384        & 0.2426            &  0.0064   & 0.3500    & 0.0156         \\ \hline
\end{tabular}
\end{center}
\end{table}


\subsection{Using TGA Data (\texorpdfstring{{\bf birch\_tga}}{birch\_tga})}
\label{birch_tga}

This is an example of a comparison of a candidate solid phase model with TGA (Thermo-gravimetric Analysis) data. The sample cases
called {\bf birch\_tga\_1step\_2} and {\bf birch\_tga\_1step\_20} simulate two standard TGA experiments in which small samples of birch wood are heated up slowly at constant
rates of 2~$^\circ$C/min and 20~$^\circ$C/min, respectively. The model of the wood only involves one reaction that converts virgin wood to char and fuel gases. There is
also a reaction in the simulation that does nothing more than evaporate the small amount of moisture in the wood. This evaporation is evident in
Fig.~\ref{fig_birch_tga} near the temperature of 100~$^\circ$C.

\begin{figure}[ht]
   \begin{center}
      \includegraphics[width=3.5in]{SCRIPT_FIGURES/birch_tga}
      \caption[An example of TGA data.]{\label{fig_birch_tga}
    Comparison of a solid phase model of birch wood with TGA data.}
   \end{center}
   \end{figure}





\chapter{Lagrangian Particles}

This chapter contains verification cases that test all aspects of particles, droplets, sprays, and so on. Note that in FDS, lagrangian particles are used for a variety of purposes, not just water droplets.

\section{Fluid-Particle Momentum Transfer (fluid\_part\_mom\_x, \_y, \_z)}

The {\bf fluid\_part\_mom} cases test accuracy, stability, and momentum conservation for the general case of momentum transfer between fluid and particles via drag.  Examples include, sprinkler and mist nozzles and ember transport.  For sprinkler nozzle applications, it is impossible to resolve the details of the nozzle and the fluid flow and particle transport near the nozzle presents challenges to accuracy and stability of integrating the particle drag laws, which are a coupled set of ordinary differential equations for each component of momentum for each particle and the fluid.  Details of the FDS scheme are given in the Tech Guide.  In short, we find an analytical solution for the case of binary fluid-particle interaction and apply this solution to the case of multiple particles by enforcing total momentum conservation within a fluid cell.  The resulting scheme is guaranteed to be stable because the fluid velocity cannot overshoot the cell equilibrium velocity (total momentum of fluid and particles divided by the total mass).

We set up three separate tests, one for each coordinate direction.  These are labeled \_x, \_y, and \_z in the verification directory.  We consider a duct 1 m $\times$ 1 m in the vertical and spanwise directions and 10 m in the streamwise direction.  The boundary conditions are periodic in the streamwise direction and free slip walls along the inside of the duct. The fluid grid is 40 $\times$ 4 $\times$ 4 for the x case; the y and z cases use analogous grids.  The fluid velocity is initialized to be 10 m/s in the streamwise direction.  A monodisperse distribution of 1000 particles is initialized with zero velocity and random positions in the first cubic meter of the duct.  Gravity is set to zero.

As the case proceeds momentum is exchanged between the fluid and the particles.  The momenta relax toward equilibrium.  The results for all three tests are shown in Figure \ref{fig_fluid_part_mom}.  On the left, the green symbols represent the total momentum of the system, which, as can be seen, is conserved.  The fluid (blue) and the particle (red) momenta are closely following the analytical solution (solid lines) which is the basis of the scheme.  The plot on the right shows the fluid (blue) and particle (red) velocities compared to the system equilibrium velocity (greeen dashed line).  By construction of the method, both the fluid and the particle velocities are approaching the equilibrium velocity at long times.

\begin{figure}[h]
\begin{center}
\includegraphics[width=.9\textwidth]{SCRIPT_FIGURES/fluid_part_momentum}\\
\includegraphics[width=.9\textwidth]{SCRIPT_FIGURES/fluid_part_velocity}
\caption[Test of fluid-particle momentum transfer for nonstationary particles.]{Outputs of the {\bf fluid\_part\_mom} cases.  (Top) The fluid momentum (blue), the particle momentum (red), and the total momentum (green) are plotted for each coordinate direction, $x$ (circles), $y$ (inverted triangles), and $z$ (plus symbols).  The analytical solutions for the fluid and particle equations are shown by the solid blue and red lines, respectively. The total momentum should be constant, as indicated by the green symbols. (Bottom) The fluid (blue) and particle (red) velocities are plotted for each direction.  Also, the equilibrium velocity (total momentum [fluid plus particles] divided by the total mass) is shown as a dashed green line.  Stability of the momentum exchange is guaranteed because, by construction, the fluid velocity cannot overshoot the equilibrium velocity; the fluid velocity relaxes toward it.}
\label{fig_fluid_part_mom}
\end{center}
\end{figure}

\clearpage

\newpage

\section{Stationary Particles (\texorpdfstring{{\bf particle\_drag}}{particle\_drag})}
\label{particle_drag}

The particle drag test cases consider a 1~m by 1~m by 1~m
channel with periodic boundary conditions on the $x$-faces and {\ct FREE\_SLIP}
walls on $y$- and $z$-faces. Static droplets are placed in the center
of the channel, one particle per computational cell, so that they form a surface
perpendicular to the flow direction. Gravity is set to zero. Due to the symmetry of the problem the flow is one
dimensional. Assuming that the droplets are of uniform diameter  and
the drag coefficient and gas density are constant, the velocity in
the channel decays according to
\be u=\frac{u_{0}}{1 + B \, u_{0} \, t}  \quad ; \quad B=\frac{1}{2}\frac{\sum \, C_{D} \, \pi \, r_{d}^{2}}{V} \ee
In the above, $V$ is the volume of the channel, $r_{d}$ is the droplet radius, $C_{D}$
is the droplet drag coefficient, and $u$ is the gas velocity in the $x$-direction. The summation is
over all $N$ particles.
The common parameters used in all the simulations are
\[
    C_D=10, \quad r_d=0.005\mbox{ m}
\]
The initial velocity, $u_0$, for each case is listed in Table~\ref{particle_drag_parameters}.
Comparisons of computed and analytical results are shown in Figure~\ref{particle_drag_plots}.
\begin{table}[ht]
\begin{center}
\caption{Parameters used in the {\bf particle\_drag} cases}
\label{particle_drag_parameters}
\begin{tabular}{|c|c|c|}
\hline
Case & $u_{0}$ & $N$\tabularnewline
\hline
\hline
A & 10 & 16 \tabularnewline
\hline
B & 50 & 16\tabularnewline
\hline
C & 100 & 16\tabularnewline
\hline
D & 50  & 1600\tabularnewline
\hline
E & 100 & 1600\tabularnewline
\hline
F & 150 & 1600 \tabularnewline
\hline
\end{tabular}
\end{center}
\end{table}

\begin{figure}[ht]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/particle_drag_A} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/particle_drag_D} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/particle_drag_B} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/particle_drag_E} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/particle_drag_C} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/particle_drag_F}
\end{tabular*}
\caption[Sample cases {\bf particle\_drag}.]{Outputs of the {\bf particle\_drag} test cases compared with analytical solutions.}
\label{particle_drag_plots}
\end{figure}

\clearpage

\newpage

\section{Pressure Drop through Stationary Particles (drag\_dt)}

The pressure drop test cases consider a 1 m wide by 1 m tall by 2 m long channel with a 2 m/s fixed velocity boundary condition on one end, an {\ct OPEN} boundary condition on the other end, and {\ct FREE\_SLIP} on the y- and z-faces.  Three channels are stacked vertically (each with its own {\ct MESH}, and a plane of particles is placed across each channel at 1 m.  The particles are 0.01 m in diameter and 10 particles are placed per cell.  A {\ct USER\_DRAG\_COEFFICIENT} of 5, 10, and 20 is set for the particles in the channels.  According to
\be \Delta P=\frac{1}{2} \rho \frac{\sum \, C_{D} \, \pi \, r_{d}^{2}} {A} \ee
where A$_{cx}$ is the 1 m$^2$ cross-sectional area, the pressure drops in each sub channel is 3.77, 7.54, and 15.1 Pa.  Comparisons of computed and analytical results are shown in Figure~\ref{particle_drag_plots}. It is seen that the pressure drop converges to the analytic solution as the timestep decreases. 

\begin{figure}[ht]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/pressure_drop_p1} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/pressure_drop_p01} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/pressure_drop_p001} &
\\
\end{tabular*}
\caption[Sample cases {\bf drag\_dtp1, 01, and 001}.]{Outputs of the {\bf drag\_dt} test cases compared with analytical solutions.}
\label{pressure_drop_plots}
\end{figure}

\clearpage

\newpage

\section{Mesh Screens (screen\_drag)}

These two test cases consider a 1 m wide by 1 m tall by 2 m long channel with either a 2 m/s or a 20 m/s fixed velocity boundary condition fixed velocity boundary condition on one end, an {\ct OPEN} boundary condition on the other end, and {\ct FREE\_SLIP} on the y- and z-faces.  Three channels are stacked vertically (each with its own {\ct MESH}, and a plane of particles is placed across each channel at 1 m.  The plane of particles are defined as a screen with a wire diameter of 0.0003 m.  A {\ct FREE\_AREA\_FRACTION} of 0.1, 0.4, and 0.8 is set for the particles in the channels.  According to the screen drag formula 
\be  \Delta \hbox{P} \;= \; \left( \frac{\mu}{\hbox{K}} u \; + \; \rho \frac{\hbox{Y}}{\sqrt{\hbox{K}}} u^2 \right) \Delta x_{screen} \ee
where K and Y are empirical constants defined in the User's Guide, the pressure drops for the 2 m/s inlet should be 126 Pa, 14 Pa, and 5.3 Pa, and for the 20 m/s inlet should be 1260 Pa, 168 Pa, and 124 Pa.   Comparisons of computed and analytical results are shown in Figure~\ref{screen_drag_plots}.


\begin{figure}[ht]
\includegraphics[width=3.2in]{SCRIPT_FIGURES/screen_drag_1} 
\includegraphics[width=3.2in]{SCRIPT_FIGURES/screen_drag_2} 
\caption[Sample cases {\bf screen\_drag\_1} and {\bf screen\_drag\_2}.]{Outputs of the {\bf screen\_drag} test cases compared with analytical solutions.}
\label{screen_drag_plots}
\end{figure}

\section{Particles in 1D (terminal\_velocity)}

\subsubsection{Ben Trettel, NIST SURF student}

If a single droplet having a constant drag coefficient falls through a stationary fluid, its velocity and trajectory can be found analytically.
This is the ``terminal velocity'' case. The particle starts from rest and falls under the influence of gravity and drag in 1D.
FDS runs until a steady-state solution is reached. The equation governing this motion is
\[
    \dot{u} = K u^2 - g \quad ; \quad K \equiv \frac{\rho_a C_d A}{2 m}
\]
$\rho_a$ is the ambient air density, $C_d$ is the drag coefficient of the droplet, $A$ is the cross-sectional area of the droplet, and $m$ is the mass of the droplet.
Defining $\rho_d$ as the density of the droplet and $D_d$ as the diameter of the droplet and solving this ODE with zero ICs,
the solution below and equivalent definition of $K$ for a droplet is found.
% D = 10 mm
% Cd = 1.0
% g = -9.8 m/s^2
\be
    u = \frac{d x}{d t} = - \sqrt{\frac{g}{K}} \text{tanh}\left(\sqrt{g K} t\right) \quad ; \quad
    x = - \frac{\text{ln}\left[\text{cosh}\left(\sqrt{g K} t \right)\right]}{K} \quad ; \quad
    K \equiv \frac{3 \rho_a C_d}{4 \rho_d D_d}
\ee
The terminal velocity case is run over several time steps. The precise configuration of the scenario is detailed in the table below.
The $L_\infty$ error of the terminal velocity and position are computed and plotted for each time step.
\begin{center}
\begin{tabular}{|r|c|l|}
\hline
Drag coefficient of droplet & $C_d$ & 1 \\
Diameter of droplet & $D_d$ & 10~mm \\
Gravitational acceleration & $g$ & 9.8~m/s$^2$ \\
Droplet fluid density & $\rho_d$ & 1000~kg/m$^3$ \\
\hline
\end{tabular}
\end{center}
FDS demonstrated second-order convergence in the terminal velocity case for both the velocities and the positions. See Fig.~\ref{fig_terminal_velocity_convergence}.

\begin{figure}[h]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/terminal_velocity_convergence} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/position_convergence}
\end{tabular*}
\caption[Convergence analysis of terminal velocity test case.]{(Left) FDS convergence for the particle velocity in the terminal velocity case. (Right) FDS convergence for the particle position in the terminal velocity case.}
\label{fig_terminal_velocity_convergence}
\end{figure}

%
%\section{Accuracy of Fluid-Particle Momentum Transfer}
%In Appendix G of the Technical Reference Guide the numerical scheme FDS uses to compute these trajectories is detailed. The equation for particle velocities is
%\begin{equation}
%   \mathbf{u}_p^{n+1} = \frac{\mathbf{u}_p^n}{1 + \beta_p \Delta t} + \frac{(\mathbf{u}_p^n + \alpha_p \mathbf{U}_p^n)\beta_p \Delta t}{(1 + \beta_p \Delta t)(1 + \alpha_p)} + \mathbf{g} \Delta t - \frac{\alpha_p \beta_p (\Delta t)^2}{2 (1 + \alpha_p)} \left[\mathbf{u}_r^n \left(\frac{\mathbf{u}_r^n \cdot \mathbf{g}}{|\mathbf{u}_r^n|^2}\right) + \mathbf{g}\right] \,.
%\end{equation}
%And the equation for particle positions is
%\begin{equation}
%   \mathbf{x}_p^{n+1} = \mathbf{x}_p^n + \left(\frac{\mathbf{u}_p^n + \alpha_p \mathbf{U}_p^n}{1 + \alpha_p}\right) \Delta t + \frac{\alpha_p (\mathbf{u}_p^n - \mathbf{U}_p^n)}{\beta_p (1 + \alpha_p)} \text{ln}(\beta_p \Delta t + 1) + \frac{\mathbf{g} (\Delta t)^2}{2} - \frac{\alpha_p \beta_p (\Delta t)^3}{6 (1 + \alpha_p)} \left[\mathbf{u}_p^n \left(\frac{\mathbf{u}_p^n \cdot \mathbf{g}}{|\mathbf{u}_p^n|^2}\right) + \mathbf{g}\right] \,.
%\end{equation}
%The particle velocities are second-order accurate in time. In other words, they are accurate to an order-of-magnitude of $\Delta t^2$. The error committed each time step as shown in Appendix G is
%\begin{equation}
%   \epsilon = \mathcal{O}(\Delta t^3) \,.
%\end{equation}
%This error is accumulated over many time steps. The allows us to define the total error $E \equiv n \epsilon$ where $n = T/\Delta T$ is the number of time steps and $T$ is the final time iterated out to. The total error can be found to be
%\begin{equation}
%   E = n \epsilon = \frac{T}{\Delta t} \mathcal{O}(\Delta t^3) = \mathcal{O}(\Delta t^2) \,.
%\end{equation}
%The particle velocities should be second-order accurate, as has been shown in FDS.
%
%
%The accuracy of the particle positions, $\mathbf{x}$ is less obvious and finding their accuracy requires knowledge of the accuracy of $\mathbf{u}$. The natural log term of the position equation reduces the order of accuracy. Note that
%\begin{equation}
%   \frac{\alpha_p (\mathbf{u}_p^n - \mathbf{U}_p^n)}{\beta_p (1 + \alpha_p)} \text{ln}(\beta_p \Delta t + 1) = \frac{\alpha_p (\mathbf{u}_p^n - \mathbf{U}_p^n)}{1 + \alpha_p} \left(\Delta t - \frac{\beta_p \Delta t^2}{2} + \cdots \right) \quad \text{ for } \beta_p t < 1 \,.
%\end{equation}
%Also note that $\mathbf{u}_p^n = \mathbf{u}_{p,\text{exact}}^n + \mathcal{O}(\Delta t^2)$ in general. This error propagates through the natural log term. If only the relevant parts of the term are extracted we can see that
%\begin{equation}
%   \frac{\mathbf{u}_p^n}{\beta_p} \text{ln}(\beta_p \Delta t + 1) = (\mathbf{u}_{p,\text{exact}}^n + \mathcal{O}(\Delta t^2)) \left(\Delta t - \frac{\beta_p \Delta t^2}{2} + \cdots \right) = \frac{\mathbf{u}_{p,\text{exact}}^n \text{ln}(\beta_p \Delta t + 1)}{\beta_p} + \mathcal{O}(\Delta t^3) \,.
%\end{equation}
%This third-order error per time step becomes an accumulated second-order error, and consequently the position scheme is only second-order accurate as has been shown numerically.
%
%
%Due to this error, the $\Delta t^3$ term of the position equation is dropped because it offers no improvements in accuracy but requires more computation.

\clearpage

\newpage

\section{2D Flat Fire Trajectory (flat\_fire)}

\subsubsection{Ben Trettel, NIST SURF student}

There are no known solutions of the drag equations in multiple dimensions. However, ballisticians have developed an approximate solution useful for computing trajectories of projectiles when guns are shot within a certain range of angles. This solution makes use of the ``flat fire'' assumption. In short, if a particle is launched with its velocity in only the horizontal direction and its vertical velocity is never very significant compared to the horizonal velocity, then throughout the entire trajectory the horizontal velocity component, $u$, is a good approximation for the velocity magnitude, $|\mathbf{u}|$.

%In 2D, this approximation decouples the $x$ equation of motion from the $y$ equation of motion and reduces the $y$ equation of motion to a linear ODE.
%\begin{align*}
%   \ddot{x} = -K \dot{x} \sqrt{\dot{x}^2 + \dot{y}^2} \quad &; \quad \ddot{y} = -K \dot{y} \sqrt{\dot{x}^2 + \dot{y^2}} - g \\
%   &\Downarrow \\
%   \ddot{x} = -K \dot{x}^2 \quad &; \quad \ddot{y} = -K \dot{y} \dot{x} - g
%\end{align*}
To ensure that the flat fire assumption is valid, the following ICs are used: $x(0) = 0$, $\dot{x}(0) = u(0) = V_0$, $z(0) = h$, $\dot{z}(0) = w(0) = 0$. The exact solution to this system is below.
\be
    x = \frac{\text{log}(V_0 K t + 1)}{K} \quad ; \quad
    z = h + \frac{g \text{log}(V_0 K t + 1)}{2 (V_0 K)^2} - \frac{g t^2}{4} - \frac{g t}{2 V_0 K} \quad ; \quad
    K \equiv \frac{3 \rho_a C_d}{4 \rho_d D_d}
\ee
\be
    u = \frac{\mbox{d} x}{\mbox{d} t} = \frac{V_0}{V_0 K t + 1} \quad ; \quad w = \frac{\mbox{d} z}{\mbox{d} t} = \frac{g}{2 V_0 K (V_0 K t + 1)} - \frac{g t}{2} - \frac{g}{2 V_0 K}
\ee
The following case was run in FDS and compared against the approximate solution:
\begin{center}
\begin{tabular}{|r|c|l|}
\hline
Drag coefficient of droplet & $C_d$ & 0.2 \\
Diameter of droplet & $D_d$ & 5~mm \\
Gravitational acceleration & $g$ & 9.8~m/s$^2$ \\
Droplet fluid density & $\rho_d$ & 1000~kg/m$^3$ \\
Starting $x$-velocity & $V_0$ & 400~m/s \\
\hline
\end{tabular}
\end{center}
As can be seen in Figure \ref{flat_fire_plots}, FDS agrees well with this approximate solution. The flat fire solution should have slightly faster vertical velocities, $w$, at extended times because the speed of the particle is approximated with $u$, which is lower than the true speed at extended times. This ensures the drag force is lower than it should be, and consequently $w$ is too fast. In the lower left plot in Figure \ref{flat_fire_plots} the $w$-velocity from FDS is slightly slower than the flat fire solution.
\begin{figure}[p]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/flat_fire_trajectory} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/flat_fire_x} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/flat_fire_z} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/flat_fire_u} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/flat_fire_w} &
\end{tabular*}
\caption{Output of the test case called {\bf flat\_fire}.}
\label{flat_fire_plots}
\end{figure}

\clearpage

\newpage

\section{Water Droplet Evaporation (\texorpdfstring{{\textbf{water\_evaporation}}}{water\_evaporation}) }
\label{water_evaporation}

The cases called {\bf water\_evaporation\_x} test the water evaporation routine in FDS. The geometry consists either of
a sealed box or a tunnel with a cross flow. The walls are assumed adiabatic, meaning that there are no leaks or heat losses.
For the box cases, the air within the box is stirred to maintain uniform conditions.
In each case, the numerical solutions are compared to analytical solutions.

For Cases 1-3 where the water droplets are confined to a sealed box, the change in the enthalpy of the droplets should equal the change in the enthalpy of the gas minus the work
performed due to pressure. It is the internal energy of the system that is conserved. The internal energy can be expressed in terms of the
enthalpy, pressure and density:
\begin{equation} e = h - \frac{p}{\rho} \end{equation}
In differential form:
\begin{equation} de = dh - \frac{1}{\rho} \; dp - p \; d \left(\frac{1}{\rho}
\right) = dh - v \; dp - p \; dv \end{equation}
Multiplying by mass and noting that the volume, $V$, is constant yields:
\begin{equation} dE = dH - V \; dp \end{equation}
The enthalpy
decrease of the liquid water droplets is equal to the enthalpy gain of the gas (both expressed in kJ) minus the
pressure increase times the volume in
units of kPa and m$^3$, respectively.

\subsection{Case 1}

In the first case, the dimensions of the box are 1~m on a side, the initial
air temperature is 200~$^\circ$C, the median volumetric diameter of the droplets is 200~$\mu$m, the water temperature is 20~$^\circ$C, and the total
mass of water droplets is 0.01~kg. The initial mass fraction of water vapor is 0.
It is expected that the droplets will all evaporate within about 10~s.
Figure~\ref{water_evaporation_1_plots} displays
the average enthalpy, humidity, density, temperature, pressure, and mass of water vapor within the box.
The solid horizontal lines denote the expected steady state values.

\begin{figure}[p]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_1_enthalpy} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_1_humidity} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_1_density} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_1_temperature} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_1_pressure} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_1_water_mass}
\end{tabular*}
\caption[Sample case {\bf water\_evaporation\_1}.]{Output of the test case called {\bf water\_evaporation\_1}.}
\label{water_evaporation_1_plots}
\end{figure}

\subsection{Case 2}

In the second case, the dimensions of the box are 40~cm on a side, and the initial
air temperature is 500~$^\circ$C. There is only one fictitiously large water droplet in the box whose diameter is 10~cm and whose temperature is 20~$^\circ$C.
The initial mass fraction of water vapor is 0. It is expected that the water will evaporate until the air in the box is saturated. The analytical solution for the stationary state is derived
from the first law of thermodynamics and the Clausius-Clapeyron equation by assuming that the liquid water temperature is equal to air temperature at the steady state.

\begin{figure}[p]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_2_enthalpy} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_2_humidity} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_2_density} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_2_temperature} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_2_pressure} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_2_W_density}
\end{tabular*}
\caption[Sample case {\bf water\_evaporation\_2}.]{Output of the test case called {\bf water\_evaporation\_2}.}
\label{water_evaporation_2_plots}
\end{figure}

\subsection{Case 3}

In the third case, the dimensions of the box are 1~m on a side, the initial
air temperature is 500~$^\circ$C, the  initial diameter of all the droplets is 200~$\mu$m, the water temperature is 20~$^\circ$C,
and the total mass of water droplets is 0.1~kg. The initial mass fraction of water vapor is 0. It is expected to reach the saturation state.
As in the second case, the analytical solution for the stationary state derives from the first principle of thermodynamics and the Clausius-Clapeyron equation
by assuming that the liquid water temperature is equal to air temperature at the stationary state.

\begin{figure}[p]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_3_enthalpy} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_3_humidity}\\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_3_density} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_3_temperature}\\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_3_pressure}&
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_3_W_density}
\end{tabular*}
\caption[Sample case {\bf water\_evaporation\_3}.]{Output of the test case called {\bf water\_evaporation\_3}.}
\label{water_evaporation_3_plots}
\end{figure}

\clearpage

\subsection{Case 4}

In the fourth case, air at 500~$^\circ$C is forced through a 3~m long, 1~m wide, 1~m tall tunnel at 1~m/s. Water droplets with a median volumetric diameter of 20~$\mu$m are
introduced in the middle of the tunnel at a rate of 0.05~kg/s, starting at 10~s. The water temperature is 20~$^\circ$C.
The mass fraction of water vapor in the hot air flowing into the tunnel is 0.
The water evaporates at approximately the same rate at which it is introduced.
Figure~\ref{water_evaporation_4_plots}, left, displays the time history of the enthalpy flow out of the tunnel. The enthalpy flow rate of the dry hot air is 228~kW above its ambient value, and this
value drops to approximately 100~kW after about 20~s. The evaporation of the water droplets is extracting energy from the hot gas at a rate of
\be \left( 4.184 \; \hbox{kJ/kg/K} \times 80 \; \hbox{K} + 2260 \; \hbox{kJ/kg} \right) \times 0.05 \; \hbox{kg/s} = 130 \; \hbox{kW} \ee

\subsection{Case 5}

This test involves a single evaporating water droplet in relatively dry air. The comparison is made with an actual measurement~\cite{Ranz} where a 1~mm water droplet
shrinks to approximately 0.3~mm in approximately 10~min (see Fig.~\ref{water_evaporation_4_plots}, right).
As opposed to the other cases above, this case tests the predicted rate of evaporation, not the final steady state.

\begin{figure}[h!]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_4_enthalpy} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/water_evaporation_5_diameter}
\end{tabular*}
\caption[Sample cases {\bf water\_evaporation\_4} and {\bf water\_evaporation\_5}.]{Output of {\bf water\_evaporation} cases 4 and 5.}
\label{water_evaporation_4_plots}
\end{figure}

\section{Flow Rate and Pipe Networks (\texorpdfstring{{\textbf{flow\_rate\_2}}}{flow\_rate\_2}) }
\label{flow_rate_2}

In this test case 4 sprinklers are placed in a box.  Three of the sprinklers are on one pipe network ({\ct PIPE\_INDEX = 1}) and the fourh sprinkler is on a second pipe network ({\ct PIPE\_INDEX = 2}).  The sprinklers are defined with a pressure ramp such that all the sprinklers within a pipe network will flow a total of 10 l/min for any number of open heads.  The sprinklers are set to open every 15 s and to close at 60 s.  The first three sprinklers are one the first pipe and the fourth sprinkler is on the second pipe.  At 45 s, there will have been three sprinklers flowing 10 l /min total for an accumulated flow of 7.5 kg.  At 60 s, there will have been the additional of the fourth sprinkler flowing 10 l/min plus the 10 l/min from the other three sprinklers for a total accumulated mass of 12.5 kg.

\begin{figure}[ht]
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/flow_rate_2_open_nozzles} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/flow_rate_2_water_mass}
\end{tabular*}
\caption[Output of the flow rate test case.]{Output of the {\bf flow\_rate\_2} test case.}
\label{flow_rate_2_figure}
\end{figure}

\section{Turbulent Dispersion (\texorpdfstring{{\textbf{random\_walk}}}{random\_walk}) }
\label{turbulent_dispersion}

Two cases are set up to test the turbulent dispersion of tracer particles.  Tracer particles are injected into a channel with a steady laminar flow with mean velocity 1 m/s.  In the first case (random\_walk\_1) the diffusivity is set to $D=0.0834$ m$^2$/s (this value results from setting the dynamic viscosity to $\mu = 0.1$ kg/m/s with an ambient density of $\rho=1.199$ kg/m$^3$ and a Schmidt number of unity).  In the second case (random\_walk\_2) the diffusivity is set to $D=0.00834$ m$^2$/s.  The results are compared with Einstein's classic result for Brownian motion \cite{Gardiner:2004}:
\begin{equation}
\label{eqn_number_density}
f(z,t) = \frac{n}{4\pi D} \frac{e^{-z^2/4Dt}}{\sqrt{t}}
\end{equation}
where $f(z,t)$ is the particle number density at lateral distance $z$ from the source at time $t$, $n$ is the total number of particles in the system.  A PDPA is set up to measure the number concentration at the outlet of the channel as a function of height, $z$.  The outlet is 15 m downstream of the point source of tracer particles.  With a mean velocity of 1 m/s, the time is taken as $t = 15$ s.  The FDS results are compared with Eq.~(\ref{eqn_number_density}) in Fig.~\ref{random_walk}.

\begin{figure}[ht]
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/random_walk_1} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/random_walk_2}
\end{tabular*}
\caption[Turbulent dispersion of tracer particles.]{Turbulent dispersion of tracer particles {\bf random\_walk} test cases.}
\label{random_walk}
\end{figure}


\clearpage

\newpage


\chapter{Heating, Ventilating, and Air Conditioning (HVAC)}

\section{Duct Flow Losses (HVAC\_flow\_loss)}

Steady-state flow in a duct is given by
\be \frac{K \rho \, u^2}{2} = \Delta p \label {HVAC_steady_state}\ee
where K is the loss coefficient for the duct and $\Delta P$ is the pressure drop across the duct.  A simple duct network is created from three 0.1~m$^2$ ducts connected with a tee.  One of the ducts is assigned a constant flow rate of 0.3~m$^3$/s.  The other two ducts are given loss coefficients of 4 and 16 and are given inlets at the same elevation.  Based on the above equation, it can be seen that since the ducts have the same conditions at their nodes (both connected to the same tee and both connected to ambient at the same elevation), that once steady state is reached that the velocities in the three ducts should be 3~m/s, 2~m/s, and 1~m/s.

\begin{figure}[ht]
   \begin{center}
      \includegraphics[height=3.00in]{SCRIPT_FIGURES/HVAC_flow_loss.pdf}
     \caption{\label{fig_HVAC_loss} Duct velocities with varied duct flow loss.}
   \end{center}
\end{figure}

\clearpage

\section{Node Flow Losses (HVAC\_tee\_loss\_1 and HVAC\_tee\_loss\_2)}

Node flow losses are implemented by partitioning the node loss to upstream and downstream ducts connected to a node as a function of the combination of flow directions present.  These two cases replicate the duct flow loss geometry and HVAC system ((HVAC\_flow\_loss.fds)) . However, instead of losses assigned to the ducts, the losses are assigned to the duct nodes.  In the first test case, HVAC\_tee\_loss\_1.fds, flow is into the main leg of the tee and out the two secondary legs.  The secondary branches of the tee are given losses of 15 and 3 and the nodes discharing to the FDS domain are assigned losses of 1.  This gives total losses of 16 and 4, the same as in the duct loss example.  In the second case, HVAC\_tee\_loss\_2.fds, flow is out the main leg of the tee and in the two secondary legs of the tee.  Duct directions are reversed so the sign on velocity remains the same as in the first case.  The same flow losses are assigned.  It is expected that the duct velocities in both cases should be 3~m/s, 2~m/s, and 1~m/s.

\begin{figure}[ht]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/HVAC_tee_loss_1} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/HVAC_tee_loss_2} }
   \end{tabular*}
   \caption[Duct velocities with varied node loss.]{Duct velocities with varied node loss. HVAC\_tee\_loss\_1 (left) and (HVAC\_tee\_loss\_2 (right)}
   \label{fig_HVAC_node}
\end{figure}

\clearpage


\section{HVAC Mass Conservation (HVAC\_mass\_conservation)}

A 1~m by 1~m by 1~m compartment is initialized with the lower half of the compartment being filled with a species called {\ct SPEC1} having the same molecular weight as air, see Figure~\ref{fig_HVAC_mass}.   An HVAC system of two ducts is created with one duct taking suction from the lower half (red vent) and discharging into the upper half (blue vent), and the second duct taking suction from the upper half (green vent) and discharging into the lower half (yellow vent).  The two ducts are assigned the same volume flow rate.  It is expected that the total mass in the compartment will be conserved, that the mass of the second species will be conserved (at 50 \% of the total mass), and that at the start of the computation a slice file of species will show pure ambient being discharged in the lower half and pure {\ct SPEC1} being discharged in the upper half.

\begin{figure}[ht]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/HVAC_mass_conservation} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/HVAC_mass_conservation.pdf} }
   \end{tabular*}
   \caption{SPEC1 mass fraction at 1 s (left) and SPEC1 and total mass (right)}
   \label{fig_HVAC_mass}
\end{figure}

\clearpage

\section{HVAC Energy Conservation and Pressure (HVAC\_energy\_pressure)}

A 1~m by 1~m by 1~m box is divided into two equal compartments by a vertical wall, see Figure~\ref{fig_HVAC_e_p}.
The ambient species is defined with a molecular weight of 28 g/mol, a specific heat of 1 kJ/kg/K and a specific enthalpy of 298.15 kJ/kg at the reference temperature of 298.15~K.
The left side of the compartment is initialized to twice the ambient temperature.  A simple HVAC system of ducts is created.
The first duct takes suction from the lower left half and discharges into the lower right half and is given an area of 0.1 m$^2$ and fixed volume flow rate 0.1 m$^3$/s.
The second duct is placed in the upper half of the compartment and is assigned a flow loss of 1 and an area of 0.01 m$^2$.  It is expected that the top and bottom duct velocities will be 10 m/s and 1 m/s respectively, the total energy will be conserved, that at the start of the computation hot gas will be seen entering the lower right and cold gas entering the upper left, and that at the end of the computation the pressure difference between the two sides will be 43.6 Pa based on Eq.~\ref{HVAC_steady_state}

\begin{figure}[ht]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{SCRIPT_FIGURES/HVAC_energy_pressure} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/HVAC_e_p_velocity.pdf} \\
\includegraphics[width=3.2in]{SCRIPT_FIGURES/HVAC_e_p_enthalpy.pdf} &
\includegraphics[width=3.2in]{SCRIPT_FIGURES/HVAC_e_p_pressure.pdf}
\end{tabular*}
\caption[Results of {\ct HVAC\_energy\_pressure} test case.]{Clockwise from top left: Temperature at 1 s, duct velocities, total enthalpy in the domain, and duct node pressures for the top duct}
\label{fig_HVAC_e_p}
\end{figure}



\clearpage

\section{Single Zone Leakage: {\bf leak\_test}}

In the following examples, both leaks and fans are demonstrated. A two compartments (each 3.6~m by 2.4~m by 2.4~m) are connected by a small fan and a leak at the floor.

The volume flow rate of the fan is given by the ``fan curve'' \be \dot{V}_{\hbox{\footnotesize fan}} = A_{\hbox{\footnotesize duct}}
U_{\hbox{\footnotesize max}} \;
   \hbox{sign} (\Delta p_{\hbox{\footnotesize max}}-\Delta p)
   \sqrt{ \frac{ |\Delta p - \Delta p_{\hbox{\footnotesize max}}|}{\Delta p_{\hbox{\footnotesize max}} } }  \ee
where $\Delta p$ is the difference in pressure and $A_{\hbox{\scriptsize duct}}=0.1$~m$^2$, $U_{\hbox{\scriptsize max}}=0.6$~m/s, and $\Delta
p_{\hbox{\scriptsize max}}=300$~Pa. The volume flow due to the leak is given by: \be \dot{V}_{\hbox{\scriptsize leak}} = A_{\hbox{\scriptsize leak}}
\sqrt{ \frac{ 2 \Delta p}{ \rho} } \ee where $A_{\hbox{\scriptsize leak}}=0.0001$~m$^2$ and $\rho$ is the density at the leakage vent on the discharge side of the fan.  Assuming that the pressure difference is evenly split between the two compartments, equating the fan and leak volume flow rates, and solving for $\Delta_p$, $\Delta_p$ is 190.7~Pa. The results are shown in Fig.~\ref{leak_test}.  Since the leakage flow cannot begin until there is a pressure rise on the discharge side of the compartment, it is expected that the true split in the pressure will be biased slightly high on the fan discharge side.  The total pressure difference, however, should match.

\begin{figure}[ht]
   \begin{center}
      \includegraphics[height=3.00in]{SCRIPT_FIGURES/leak_test.pdf}
     \caption{\label{leak_test} Pressure rise in sealed compartment with leakage.}
   \end{center}
\end{figure}


\section{Multiple zone leakage (leak\_test\_2)}

This sample case starts with the same input as leak\_test.  A second leakage vent is added to the floor of the discharge side of the fan.  This vent leaks to the ambient.  When the simulation starts the fan will begin to remove air from the suction side and discharge it to the other compartment.  As the pressure rises, the leakage flows will slowly increase until the leakage flow is equal to the flow from the fan.
Since some air from the interior compartment is being discharged to the ambient, the average pressure of the two compartments will
decrease until the pressure of the interior compartment is equal to that of the ambient.  At this point in time, no more leakage flow will occur to the
ambient and the fan flow will equal intra-compartment leakage flow.  Given the leakage area and the fan curve, this will occur when the pressure difference between the
two compartments is the same as the pressure difference from leak\_test (190.7~Pa.) only now the discharge side should be at 0~Pa.

\begin{figure}[ht]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/leak_test_2_vector} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{SCRIPT_FIGURES/leak_test_2.pdf} }
   \end{tabular*}
   \caption[Results of {\ct leak\_test\_2} test case.]{Vector plot of pressure at 10 s with geometry clipped to show compartment interiors (left) and line plot of zone pressures (right)}
   \label{fig_HVAC_leak_fan}
\end{figure}



\clearpage

\section{ASHRAE Sample Problem 7 (ashrae\_7\_fixed\_flow, ashrae\_7\_quadratic, and ashrae\_7\_table)}

ASRHAE sample problem 7~\cite{ASHRAE} is a simple HVAC system that represents a metal working exhaust system for a machine shop where particulates from three pieces of equipment are removed by a dust collector.  The network, shown in Figure~\ref{ASHRAE7} consists of three inlets, two tees, the dust collector, and a fan.  The lengths, diameters, and friction losses for all the components were defined as well as the fan flow rate.  Pressure drops and flow rates in the remaining components can be computed by hand.  Also shown in Figure~\ref{ASHRAE7} are the predict pressure drops using a fixed flow fan, a fan with a quadratic fan curve ({\ct MAX\_FLOW=2.4094, MAX\_PRESSURE=3000.}) that includes the fixed flow state (i.e. the flow rate of 1.45 m$^3$/s and pressure drop of 1913.5 Pa from the fixed flow simulation sits on the quadratic curve), and a fan using a {\ct RAMP} to define the same quadratic fan curve at 500 Pa intervals.  The hand calculations assume a constant density, whereas, the FDS computation will have slightly non uniform density in HVAC network due to presure drops and the equation of state.  It is expected that there will be small differences that will be more noticeable at higher pressure changes.  Additionally since inputting a fan curve as a table results in a piecewise linear approximation, it is expected that the user defined fan curve results will vary slightly from the quadratic and fixed flow results.


\begin{figure}[ht]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{FIGURES/HVAC/ashrae_7.pdf} &
\end{tabular*}
\input{SCRIPT_FIGURES/ashrae_7.tex}
\caption[Results of {\ct ashrae\_7} test case.]{Clockwise from top left: Schematic of ASHRAE sample problem 7, pressure drops for a fixed flow fan curve, pressure drops for a quadratic fan curve, pressure drops for a table defined fan curve}
\label{ASHRAE7}
\end{figure}

\newpage

\chapter{Unstructured Geometry}

\section{Fluid-Structure Interaction}

\section{Cut-cell Algorithm}

A cut-cell algorithm is developed for calculating the intersection area between a triangle and a bounding box (e.g., Cartesian grid cell). It is difficult to directly calculate the intersection area, because the intersection shape is generally an irregular polygon. The area calculation can be divided into three steps. The first step is to obtain the points that the triangle-determined plane intersects with the bounding box edges. These points are sorted to give an intermediate polygon. Please note this intermediate polygon is in the same plane as the blue-edge triangle. The second step is to determine all vertices of the final intersection polygon, by checking whether the triangle edges are intersecting with the edges of the intermediate polygon. Lastly, the area can be easily calculated for the final polygon, which is always convex in this study.

\input{SCRIPT_FIGURES/cutcell_area.tex}

 Twelve testing examples in which different triangles intersect with a bounding box are summarized in the table below.  NXP is the vertices of the intersection polygon, whose area is calculated as shown. Examples (1) through (4) and (6) through (8) have a regular triangle intersection. Examples (5) and (9) have a point and line intersection, both with zero area. Examples (10), (11), and (12) are more complicated cases. The intersection polygon has six (6), seven (7), and nine (9) vertices, respectively.
\newpage

\bibliography{../Bibliography/FDS_refs,../Bibliography/FDS_general,../Bibliography/FDS_mathcomp}

\end{document}
