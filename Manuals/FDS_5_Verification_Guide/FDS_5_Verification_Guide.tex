\documentclass[11pt]{book}
\usepackage{mathptm,times}
\usepackage[pdftex]{graphicx}
%\usepackage{hyperref}

\usepackage{pdfsync}
\usepackage[pdftex,
        colorlinks=true,
        urlcolor=linkblue,     % \href{...}{...} external (URL)
        citecolor=linkred,     % citation number colors
        linkcolor=linknavy,    % \ref{...} and \pageref{...}
        pdftitle={Fire Dynamics Simulator (Version 5) User's Guide},
        pdfauthor={Randall McDermott, Kevin McGrattan, Simo Hostikka, Jason Floyd},
        pdfsubject={User Guide},
        pdfkeywords={FDS, Fire Model, NIST, BFRL},
        pdfproducer={pdflatex},
        pagebackref,
        pdfpagemode=UseNone,
        bookmarksopen=true,
        plainpages=false]{hyperref}
\usepackage{color}
\definecolor{linknavy}{rgb}{0,0,0.50196}
\definecolor{linkred}{rgb}{1,0,0}
\definecolor{linkblue}{rgb}{0,0,1}
\usepackage{caption}
\usepackage{graphpap}
\usepackage{rotating}
\usepackage{epsfig,psfrag}
\usepackage{geometry}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage{lscape}
\usepackage{amssymb}
\usepackage{makeidx} % Create index at end of document
\usepackage[nottoc,notlof,notlot]{tocbibind} % Put the bibliography and index in the ToC
\usepackage{float}
\usepackage{lastpage} % Automatic last page number reference.
\usepackage[T1]{fontenc}
\usepackage{upquote}
%\usepackage{array,eqnarray}
\newcommand{\nopart}{\expandafter\def\csname Parent-1\endcsname{}} % To fix table of contents in pdf.
\newcommand{\ct}{\tt\small}


\setlength{\textwidth}{6.5in}
\setlength{\textheight}{9.0in}
\setlength{\topmargin}{0.in}
\setlength{\headheight}{0.in}
\setlength{\headsep}{0.in}
\setlength{\parindent}{0.25in}
\setlength{\oddsidemargin}{0.0in}
\setlength{\evensidemargin}{0.0in}





\begin{document}

\bibliographystyle{unsrt}

\newcommand{\dod}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\DoD}[2]{\frac{D #1}{D #2}}
\newcommand{\dsods}[2]{\frac{\partial^2 #1}{\partial #2^2}}
\newcommand{\dx}{\delta x}
\newcommand{\dy}{\delta y}
\newcommand{\dz}{\delta z}
\newcommand{\x}{x}
\newcommand{\y}{y}
\newcommand{\z}{z}
\newcommand{\dt}{\delta t}
\newcommand{\dn}{\delta n}
\newcommand{\cH}{{\cal H}}
\newcommand{\hu}{u}
\newcommand{\hv}{v}
\newcommand{\hw}{w}
\newcommand{\la}{\lambda}
%\newcommand{\bO}{\mbox{\boldmath $\Omega$}}
\newcommand{\bO}{{\Omega}}
\newcommand{\bo}{{\bf \omega}}
%\newcommand{\btau}{\mbox{\boldmath $\tau$}}
\newcommand{\btau}{{\bf \tau}}
\newcommand{\bdelta}{{\bf \delta}}
\newcommand{\sumym}{\sum (Y_i/W_i)}
\newcommand{\oW}{\overline{W}}
\newcommand{\om}{\omega}
\newcommand{\omx}{\omega_x}
\newcommand{\omy}{\omega_y}
\newcommand{\omz}{\omega_z}
\newcommand{\erf}{\hbox{erf}}
\newcommand{\bF}{{\bf F}}
\newcommand{\bof}{{\bf f}}
\newcommand{\bq}{{\bf q}}
\newcommand{\br}{{\bf r}}
\newcommand{\bu}{{\bf u}}
\newcommand{\bx}{{\bf x}}
\newcommand{\bk}{{\bf k}}
\newcommand{\bv}{{\bf v}}
\newcommand{\bg}{{\bf g}}
\newcommand{\bn}{{\bf n}}
\newcommand{\bS}{{\bf S}}
\newcommand{\dS}{d{\bf S}}
\newcommand{\bs}{{\bf s}}
\newcommand{\bI}{{\bf I}}
\newcommand{\hp}{{\cal H}}
\newcommand{\trho}{\tilde{\rho}}
\newcommand{\dph}{{\delta\phi}}
\newcommand{\dth}{{\delta\theta}}
\newcommand{\tp}{\tilde{p}}
\newcommand{\dQ}{\dot{Q}}
\newcommand{\dq}{\dot{q}}
\newcommand{\dm}{\dot{m}}
\newcommand{\ha}{\frac{1}{2}}
\newcommand{\ft}{\frac{4}{3}}
\newcommand{\ot}{\frac{1}{3}}
\newcommand{\fofi}{\frac{4}{5}}
\newcommand{\of}{\frac{1}{4}}
\newcommand{\twth}{\frac{2}{3}}
\newcommand{\R}{{\cal R}}
\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand{\RE}{\hbox{Re}}
\newcommand{\LE}{\hbox{Le}}
\newcommand{\PR}{\hbox{Pr}}
\newcommand{\PE}{\hbox{Pe}}
\newcommand{\NU}{\hbox{Nu}}
\newcommand{\SC}{\hbox{Sc}}
\newcommand{\SH}{\hbox{Sh}}
\newcommand{\WE}{\hbox{We}}
\newcommand{\COTWO}{{\tiny \hbox{CO}_2}}
\newcommand{\OTWO}{{\tiny \hbox{O}_2}}
\newcommand{\CO}{{\tiny \hbox{CO}}}
\newcommand{\F}{{\tiny \hbox{F}}}

\pagestyle{empty}

\begin{minipage}[t][9in][s]{6.5in}

\huge
\flushright{NIST Special Publication 1018-5}

\vspace{1in}

\Huge
\flushright{Fire Dynamics Simulator (Version 5) \\
Technical Reference Guide \\ \LARGE Volume 2: Verification}

\vspace{.5in}

\large
\flushright{
Randall McDermott \\
Kevin McGrattan \\
Simo Hostikka \\
Jason Floyd}

\vfill

\flushright{\includegraphics[width=2.5in]{FIGURES/nistident_flright_vec}}

\end{minipage}

\newpage

\hspace{5in}

\newpage

\begin{minipage}[t][9in][s]{6.5in}

\huge
\flushright{NIST Special Publication 1018-5}

\vspace{1.in}

\Huge
\flushright{Fire Dynamics Simulator (Version 5) \\
Technical Reference Guide \\ \LARGE Volume 2: Verification }

\vspace{.5in}

\normalsize
\flushright{
Randall McDermott \\
Kevin McGrattan \\
{\em Fire Research Division} \\
{\em Building and Fire Research Laboratory}  \\
\hspace{1.in} \\
Simo Hostikka \\
{\em VTT Technical Research Centre of Finland}\\
{\em Espoo, Finland} \\
\hspace{1.in} \\
Jason Floyd \\
{\em Hughes Associates, Inc.}  \\
{\em Baltimore, Maryland}}

\vspace{.25in}

\flushright{\today \\
FDS Version 5.4 \\
$SVN Repository$~$Revision$}


\vfill

\flushright{\includegraphics[width=1in]{FIGURES/doc} }

\small
\flushright{U.S. Department of Commerce \\
{\em Gary Locke, Secretary} \\
\hspace{1in} \\
National Institute of Standards and Technology \\
{\em Patrick Gallagher, Acting Director} }

\end{minipage}




\newpage

\frontmatter

\pagestyle{plain}


\chapter{Preface}

This is Volume 2 of the FDS Technical Reference Guide. Volume 1 describes the mathematical model and
numerical method. Volume 3 documents past and present experimental validation work. Instructions for
using FDS are contained in a separate User's Guide~\cite{FDS_Users_Guide_5}.

The three volumes of the FDS Technical Reference Guide are based in part on the ``Standard Guide for
Evaluating the Predictive Capability of Deterministic Fire Models,'' ASTM~E~1355~\cite{ASTM:E1355}.
ASTM~E~1355 defines {\em model evaluation} as ``the process of quantifying
the accuracy of chosen results from a model when applied for a specific use.''
The model evaluation process consists of two main components: verification and validation.
{\em Verification} is a process to check the correctness of the solution of the
governing equations. Verification does not imply that the governing equations are
appropriate; only that the equations are being solved correctly.
{\em Validation} is a process to determine the appropriateness of the governing equations as a mathematical
model of the physical phenomena of interest. Typically, validation involves comparing
model results with experimental measurement. Differences that cannot be explained in terms of
numerical errors in the model or uncertainty in the measurements
are attributed to the assumptions and simplifications of the physical model.

Evaluation is critical to establishing both the acceptable uses
and limitations of a model. Throughout its development, FDS has undergone various forms of evaluation,
both at NIST and beyond. This volume provides a survey of verification work conducted to date to evaluate FDS.



\chapter{About the Authors}

\begin{description}
\item[Randall McDermott] joined the research staff of the Building and Fire Research Lab in 2008. He received a B.S.~degree from the University of Tulsa in Chemical Engineering in 1994 and a doctorate at the University of Utah in 2005. His research interests include subgrid-scale models and numerical methods for large-eddy simulation, adaptive mesh refinement, and Lagrangian particle methods.
\item[Kevin McGrattan] is a mathematician in the Building and Fire Research Laboratory (BFRL) of NIST. He received a bachelors of science degree from the School of Engineering and Applied Science of Columbia University in 1987 and a doctorate at the Courant Institute of New York University in 1991. He joined the NIST staff in 1992 and has since worked on the development of fire models, most notably the Fire Dynamics Simulator.
\item[Simo Hostikka] is a Senior Research Scientist at VTT Technical Research Centre of Finland. He received a master of science (technology) degree in 1997 and a doctorate in 2008 from the Department of Engineering Physics and Mathematics of the Helsinki University of Technology.  He is the principal developer of the radiation and solid phase sub-models within FDS.
\item[Jason Floyd] is a Senior Engineer at Hughes Associates, Inc., in Baltimore, Maryland. He received a bachelors of science and Ph.D. in the Nuclear Engineering Program of the University of Maryland. After graduating, he won a National Research Council Post-Doctoral Fellowship at the Building and Fire Research Laboratory of NIST, where he developed the combustion algorithm within FDS. He is currently funded by NIST under grant 70NANB8H8161 from the Fire Research Grants Program (15 USC 278f). He is the principal developer of the multi-parameter mixture fraction combustion model and control logic within FDS.
\end{description}



\chapter{Acknowledgments}

\label{acksection}

FDS is supported financially via internal funding at both NIST and
VTT, Finland. In addition, support is provided by other agencies of
the US Federal Government:
\begin{itemize}
\item The US Nuclear Regulatory Commission Office of Research has funded key
validation experiments, the preparation of the FDS manuals, and the
development of various sub-models that are of importance in the area
of nuclear power plant safety. Special thanks to Mark Salley and Jason
Dreisbach for their efforts and support.  The Office of Nuclear
Material Safety and Safeguards, another branch of the US NRC, has
supported modeling studies of tunnel fires under the direction of
Chris Bajwa and Allen Hansen.
\item The Micro-Gravity Combustion Program of the National Aeronautics and Space
Administration (NASA) has supported several projects that directly or indirectly benefited FDS development.
\item The US Forest Service has supported the development of sub-models in FDS designed to simulate the spread of
fire in the Wildland Urban Interface (WUI). Special thanks to Mark Finney and Tony Bova for their support.
\item The Minerals Management Service of the US Department of the Interior funded research at NIST aimed at
characterizing the burning behavior of oil spilled on the open sea or ice. Part of this research led to the development
of the ALOFT (A Large Outdoor Fire plume Trajectory) model, a forerunner of FDS. Special thanks to Joe Mullin for his
encouragement of the modeling efforts.
\end{itemize}
\noindent The following individuals and organizations played a role in the verification process of FDS.
\begin{itemize}
\item Thanks to Chris Lautenburger and Carlos Fernandez-Pello for their assistance with the ``two-reaction'' test case.
\item Matthias M\"{u}nch of the Freie Universit\"{a}t Berlin provided useful test cases for the basic flow solver.
\item Susanne Kilian of hhpberlin (Germany) helped to debug the improved pressure solver.
\item Clara Cruz, a student at the University of Puerto Rico and Summer Undergraduate Fellow at NIST, helped developed useful Matlab scripts to automate
the process of compiling this Guide.
\item Bryan Klein of NIST developed the source code version control system that is an essential part of the verification process.
\end{itemize}



\tableofcontents
%\listoffigures
%\listoftables

\mainmatter


\chapter{What is Verification?}

The terms {\em verification} and {\em validation} are often used interchangeably to mean the process of checking the
accuracy of a numerical model. For many, this entails comparing model predictions with experimental measurements. However,
there is now a fairly broad-based consensus that comparing model and experiment is largely what is considered {\em validation}. So what is
{\em verification}? ASTM~E~1355~\cite{ASTM:E1355}, ``Standard Guide for
Evaluating the Predictive Capability of Deterministic Fire Models,'' defines verification as
\begin{quote}
The process of determining that the implementation of a calculation method accurately
represents the developer's conceptual description of the calculation method and the solution to the calculation method.
\end{quote}
and it defines validation as
\begin{quote}
The process of determining the degree to which a calculation method is an accurate representation of the real world
from the perspective of the intended uses of the calculation method.
\end{quote}
Simply put, verification is a check of the math; validation is a check of the physics. If the model predictions closely match
the results of experiments, using whatever metric is appropriate, it is assumed by most that the model suitably describes, via
its mathematical equations, what is happening. It is also assumed that the solution of these equations must be correct. So why do
we need to perform model verification? Why not just skip to validation and be done with it? The reason is that rarely do model and
measurement agree so well in all applications that anyone would just accept its results unquestionably. Because there is
inevitably differences between model and experiment, we need to know if these differences are due to limitations or errors in
the numerical solution, or the physical sub-models, or both.

Whereas model validation consists mainly of comparing predictions with measurements, as documented for FDS in Volume 3 of the
Technical Reference Guide, model verification consists of a much broader range of activities, from checking the computer program
itself to comparing calculations to analytical (exact) solutions to considering the sensitivity of the dozens of numerical
parameters. The next chapter discusses these various activities, and the rest of the Guide is devoted mainly to comparisons of
various sub-model calculations with analytical solutions.








\chapter{Survey of Past Verification Work}

This chapter documents work of the past few decades at NIST, VTT and elsewhere to verify the algorithms within FDS.




\section{Analytical Tests}

\label{Analytical Tests}

Most complex combustion processes, including fire, are turbulent and time-dependent. There are no closed-form mathematical solutions for the
fully-turbulent, time-dependent Navier-Stokes equations. CFD provides an approximate solution for the non-linear partial differential equations by
replacing them with discretized algebraic equations that can be solved using a powerful computer. While there is no general analytical solution for
fully-turbulent flows, certain sub-models address phenomenon that do have analytical solutions, for example, one-dimensional heat conduction through
a solid. These analytical solutions can be used to test sub-models within a complex code such as FDS. The developers of FDS routinely use such
practices to verify the correctness of the coding of the model~\cite{Mell:1,McGrattan:4}. Such verification efforts are relatively simple and routine
and the results may not always be published nor included in the documentation. Examples of routine analytical testing include:
\begin{itemize}
\item The radiation solver has been verified with scenarios where
simple objects, like cubes or flat plates, are positioned in simple, sealed compartments. All convective motion is turned off, the object is given a
fixed surface temperature and emissivity of one (making it a black body radiator). The heat flux to the cold surrounding walls is recorded and
compared to analytical solutions.  These studies help determine the appropriate number of solid angles to be set as the default.
\item Solid objects are heated with a fixed heat flux, and the
interior and surface temperatures as a function of time are compared to analytical solutions of the one-dimensional heat transfer equation. These
studies help determine the number of nodes to use in the solid phase heat transfer model. Similar studies are performed to check the pyrolysis models
for thermoplastic and charring solids.
\item Early in its development, the hydrodynamic solver that evolved
to form the core of FDS was checked against analytical solutions of simplified fluid flow phenomena. These studies were conducted at the National
Bureau of Standards (NBS)\footnote{The National Institute of Standards and Technology (NIST) was formerly known as the National Bureau of Standards.}
by Rehm, Baum and co-workers~\cite{Rehm:SIAM83,Rehm:SIAM84,Baum:CST84,Rehm:ANM85}. The emphasis of this early work was to test the stability and
consistency of the basic hydrodynamic solver, especially the velocity-pressure coupling that is vitally important in low Mach number applications.
Many numerical algorithms developed up to that point in time were intended for use in high-speed flow applications, like aerospace. Many of the
techniques adopted by FDS were originally developed for meteorological models, and as such needed to be tested to assess whether they would be
appropriate to describe relatively low-speed flow within enclosures.
\item A fundamental decision made by Rehm and Baum early in the FDS
development was to use a direct (rather than iterative) solver for the pressure. In the low Mach number formulation of the Navier-Stokes equations,
an elliptic partial differential equation for the pressure emerges, often referred to as the Poisson equation. Most CFD methods use iterative
techniques to solve the governing conservation equations to avoid the necessity of directly solving the Poisson equation. The reason for this is that
the equation is time-consuming to solve numerically on anything but a rectilinear grid. Because FDS is designed specifically for rectilinear grids,
it can exploit fast, direct solvers of the Poisson equation, obtaining the pressure field with one pass through the solver to machine accuracy. FDS
employs double-precision (8 byte) arithmetic, meaning that the relative difference between the computed and the exact solution of the discretized
Poisson equation is on the order of $10^{-12}$. The fidelity of the numerical solution of the entire system of equations is tied to the
pressure/velocity coupling because often simulations can involve hundreds of thousands of time steps, with each time step consisting of two solutions
of the Poisson equation to preserve second-order accuracy. Without the use of the direct Poisson solver, build-up of numerical error over the course
of a simulation could produce spurious results. Indeed, an attempt to use single-precision (4 byte) arithmetic to conserve machine memory led to
spurious results simply because the error per time step built up to an intolerable level.
\end{itemize}



\section{Numerical Tests}

\label{Numerical Tests}


Numerical techniques used to solve the governing equations within a model can be a source of error in the predicted results.  The hydrodynamic model
within FDS is second-order accurate in space and time.  This means that the error terms associated with the approximation of the spatial partial
derivatives by finite differences is of the order of the square of the grid cell size, and likewise the error in the approximation of the temporal
derivatives is of the order of the square of the time step. As the numerical grid is refined, the ``discretization error'' decreases, and a more
faithful rendering of the flow field emerges.  The issue of grid sensitivity is extremely important to the proper use of the model and will be taken
up in the next chapter.

A common technique of testing flow solvers is to systematically refine the numerical grid until the computed solution does not change, at which point
the calculation is referred to as a Direct Numerical Solution (DNS) of the governing equations.  For most practical fire scenarios, DNS is not
possible on conventional computers. However, FDS does have the option of running in DNS mode, where the Navier-Stokes equations are solved without
the use of sub-grid scale turbulence models of any kind. Because the basic numerical method is the same for LES and DNS, DNS calculations are a very
effective way to test the basic solver, especially in cases where the solution is steady-state. Throughout its development, FDS has been used in DNS
mode for special applications.  For example, FDS (or its core algorithms) have been used at a grid resolution of roughly 1~mm to look at flames
spreading over paper in a microgravity environment~\cite{McGrattan:C&F1996,Kashiwagi:CS1996,Mell:CS98,Mell:CS00,Prasad:CS2002,Nakamura:C&F2002}, as
well as "g-jitter" effects aboard spacecraft~\cite{Mell:g-jitter}. Simulations have been compared to experiments performed aboard the US Space
Shuttle.  The flames are laminar and relatively simple in structure, and the comparisons are a qualitative assessment of the model solution. Similar
studies have been performed comparing DNS simulations of a simple burner flame to laboratory experiments~\cite{Mukhopadhyay:1}. Another study
compared FDS simulations of a counterflow diffusion flames to experimental measurements and the results of a one-dimensional multi-step kinetics
model~\cite{Hamins:NASA}.

Early work with the hydrodynamic solver compared two-dimensional simulations of gravity currents with salt-water experiments~\cite{McGrattan:1}. In
these tests, the numerical grid was systematically refined until almost perfect agreement with experiment was obtained. Such convergence would not be
possible if there were a fundamental flaw in the hydrodynamic solver.




\section{Sensitivity Analysis}

A sensitivity  analysis considers the  extent to which  uncertainty in model  inputs influences  model output.  Model parameters  can  be the
physical properties of solids  and gases, boundary conditions, initial conditions, {\em  etc.} The parameters  can also be  purely numerical, like
the size  of the numerical grid. FDS  typically requires the user to  provide several  dozen different  types of  input  parameters that describe the
geometry, materials,  combustion phenomena, {\em etc.} By design,  the user  is  not expected  to  provide numerical  parameters besides the grid
size,  although the optional numerical parameters are described in both the Technical Reference Guide and the User's Guide.

FDS does not  limit the range of most of  the input parameters because applications often push beyond the  range for which the model has been
validated.  FDS is still used  for research at NIST and elsewhere, and the developers do not presume to know in all cases what the acceptable range
of   any  parameter  is.  Plus,  FDS   solves  the  fundamental conservation  equations  and  is   much  less  susceptible  to  errors resulting
from  input parameters  that  stray  beyond  the limits  of simpler empirical models.  However, the user is warned  that he/she is responsible for
the prescription of all parameters.   The FDS manuals can only provide guidance.

The grid size is the  most important numerical parameter in the model, as it  dictates the spatial  and temporal accuracy of  the discretized partial
differential equations.  The heat  release rate  is  the most important physical parameter,  as it is the source  term in the energy equation.
Property data, like  the thermal conductivity, density, heat of vaporization,  heat capacity, {\em  etc.}, ought to be  assessed in terms of their
influence on  the heat release rate. Validation studies have shown that FDS predicts well the transport of heat and smoke when the HRR is prescribed.
In  such cases, minor changes in the properties of  bounding  surfaces  do  not  have  a  significant  impact  on  the results. However, when the HRR
is not prescribed, but rather predicted by the  model using  the thermophysical properties  of the  fuels, the model output is sensitive to even
minor changes in these properties.

The sensitivity  analyses described in this chapter  are all performed in basically the same way. For a given scenario, best estimates of all the
relevant  physical  and  numerical  parameters are  made,  and  a ``baseline'' simulation is performed. Then, one by one, parameters are varied by a
given percentage, and the changes in predicted results are recorded.  This is  the simplest  form of  sensitivity  analysis. More sophisticated
techniques that involve  the simultaneous  variation of several  parameters  are impractical  with  a  CFD  model because  the computation time is
too long and the number of parameters too large to perform  the  necessary  number  of calculations  to  generate  decent statistics.



\subsection{Grid Sensitivity}

\label{gridsen}

The most  important decision made by a  model user is the  size of the numerical grid. In  general, the finer the numerical  grid, the better the
numerical solution of  the equations. FDS is second-order accurate in  space and  time,  meaning that  halving  the grid  cell size  will decrease
the discretization  error in  the governing  equations  by a factor  of 4.  Because  of  the non-linearity  of  the equations,  the decrease in
discretization error does not necessarily translate into a comparable decrease  in the error of  a given FDS  output quantity. To find out  what
effect a  finer grid has  on the solution,  model users usually  perform some  form of  grid  sensitivity study  in which  the numerical grid  is
systematically refined until  the output quantities do not change  appreciably with each refinement. Of  course, with each halving of  the grid cell
size,  the time required  for the simulation increases by  a factor of $2^4=16$  (a factor of two  for each spatial coordinate, plus  time). In  the
end, a  compromise is  struck between model accuracy and computer capacity.

Some   grid    sensitivity   studies   have    been   documented   and published. Since FDS was  first publicly released in 2000, significant changes
in  the   combustion  and   radiation  routines   have  been incorporated into the model. However, the basic transport algorithm is the  same, as  is
the  critical importance  of  grid sensitivity.  In compiling   sensitivity  studies,   only  those   that   examined  the sensitivity of routines no
longer used have been excluded.

As part of  a project to evaluate  the use of FDS version  1 for large scale   mechanically  ventilated   enclosures,  Friday~\cite{Friday:1}
performed a  sensitivity analysis to find  the approximate calculation time based on varying grid sizes. A propylene fire with a nominal heat release
rate was  modeled in FDS. There was  no mechanical ventilation and  the fire  was assumed  to grow  as a  function of  the  time from ignition
squared.  The  compartment  was   a  3~m  by  3~m  by  6.1~m space. Temperatures  were sampled 12~cm  below the ceiling.  Four grid sizes   were
chosen  for   the   analysis:   30~cm,  15~cm,   10~cm, 7.5~cm. Temperature  estimates were  not found to  change dramatically with different grid
dimensions.

Using FDS  version 1, Bounagui {\em  et al.}~\cite{Bounagui:1} studied the effect of grid size on simulation results to determine the nominal grid
size for future work. A propane burner 0.1~m by 0.1~m was modeled with  a heat  release rate  of  1500~kW.   A similar analysis was performed using
Alpert's ceiling  jet correlation~\cite{SFPE:Alpert}  that also showed better  predictions   with smaller grid sizes.  In a  related study,  Bounagui
{\em  et al.}~\cite{Bounagui:2} used  FDS to  evaluate  the emergency  ventilation  strategies in  the Louis-Hippolyte-La Fontaine Tunnel in
Montreal, Canada.


Xin~\cite{Xin:NFPA2004}  used FDS  to  model a  methane fueled  square burner (1~m  by 1~m) in  the open. Engineering correlations  for plume
centerline temperature and velocity  profiles were compared with model predictions to assess the influence of the numerical grid and the size of the
computational domain. The  results showed that FDS is sensitive to grid size effects, especially  in the region near the fuel surface, and domain
size  effects when the domain width is  less than twice the plume  width.  FDS  uses   a  constant  pressure  assumption  at  open boundaries.  This
assumption  will affect  the plume  behavior  if the boundary of the computational domain is too close to the plume.

Ierardi  and Barnett~\cite{Ierardi:1} used  FDS version  3 to  model a 0.3~m square methane diffusion burner with heat release rate values in the
range of 14.4~kW to 57.5~kW. The physical domain used was 0.6~m by 0.6~m with uniform grid spacings of  15, 10, 7.5, 5, 3, 1.5~cm for all three
coordinate  directions. For both  fire sizes, a grid  spacing of 1.5~cm  was found  to  provide  the best  agreement  when compared  to McCaffrey's
centerline    plume    temperature     and    velocity correlations~\cite{SFPE:Heskestad}.  Two similar  scenarios  that form the basis for Alpert's
ceiling  jet correlation were also modeled with FDS. The first scenario was a  1~m by 1~m, 670~kW ethanol fire under a 7~m   high  unconfined
ceiling.   The  planar   dimensions  of   the computational domain were 14~m by  14~m. Four uniform grid spacings of 50, 33.3, 25, and 20~cm were
used in the modeling. The best agreement for  maximum  ceiling  jet  temperature  was  with  the  33.3~cm  grid spacing. The best  agreement for
maximum ceiling jet  velocity was for the  50~cm grid  spacing. The  second scenario  was a  0.6~m  by 0.6~m 1000~kW ethanol fire under a 7.2~m high
unconfined ceiling. The planar dimensions of  the computational domain  were 14.4~m by  14.4~m. Three uniform  grid  spacings  of  60,  30,  and
20~cm  were  used  in  the modeling. The  results show that  the 60~cm grid spacing  exhibits the best  agreement with  the correlations  for both
maximum  ceiling jet temperature and velocity on a qualitative basis.

Petterson~\cite{Petterson:1} also completed work assessing the optimal grid size for FDS version 2. The FDS model predictions of varying grid sizes
were  compared to two separate fire  experiments: The University of Canterbury  McLeans Island  Tests and the  US Navy Hangar  Tests in Hawaii.  The
first  set  of  tests utilized  a  room with  approximate dimensions of  2.4~m by  3.6~m by  2.4~m and fire  sizes of  55~kW and 110~kW. The  Navy
Hangar  tests were performed  in a  hangar measuring 98~m by 74~m by 15~m in height and had fires in the range of 5.5~MW to 6.6~MW. The results  of
this study indicate that  FDS simulations with grids of 0.15~m had temperature predictions as accurate as models with grids as  small as 0.10~m. Each
of these grid  sizes produced results within   15~\%   of   the   University   of   Canterbury   temperature measurements. The 0.30~m grid  produced
less accurate results. For the comparison of the Navy Hangar tests, grid sizes ranging from 0.60~m to 1.80~m yielded results of comparable accuracy.

Musser~{\em et  al.}~\cite{Musser:1} investigated  the use of  FDS for course grid  modeling of non-fire and fire  scenarios. Determining the
appropriate  grid  size was  found  to  be  especially important  with respect  to heat  transfer  at heated  surfaces.  The convective  heat
transfer  from the  heated surfaces  was most  accurate when  the near surface grid cells were smaller than the depth of the thermal boundary layer.
However, a  finer grid  size  produced better  results at  the expense of computational time. Accurate contaminant dispersal modeling required a
significantly finer grid. The results of her study indicate that  non-fire simulations  can be  completed more  quickly  than fire simulations
because  the time  step is not  limited by the  large flow speeds in a fire plume.


\subsection{Sensitivity of Large Eddy Simulation Parameters}

FDS  uses the  Smagorinsky form  of  the Large  Eddy Simulation  (LES) technique.  This  means  that   instead  of  using  the  actual  fluid
viscosity, the model uses a viscosity of the form
\be
  \mu_{\hbox{\tiny LES}} =  \rho \,  (C_s\, \Delta)^2  \, |S|
\ee
where $C_s$  is an empirical constant, $\Delta$ is a length on the order of the size of a grid  cell,  and  the  deformation   term  $|S|$  is  related  to  the Dissipation Function (see FDS Technical Reference Guide~\cite{FDS_Tech_Guide_5} for details). Related to the ``turbulent  viscosity'' are  comparable
expressions  for  the thermal conductivity  and  material diffusivity:  \be  k_{\hbox{\tiny LES}}  = \frac{\mu_{\hbox{\tiny  LES}}   \;  c_p}{\PR_t}
\quad   ;  \quad  (\rho D)_{\hbox{\tiny  LES}}  =\frac{\mu_{\hbox{\tiny  LES}}}{\SC_t}  \ee  where $\PR_t$ and $\SC_t$ are the turbulent Prandtl and Schmidt numbers, respectively.  Thus, $C_s$, $\PR_t$  and $\SC_t$ are  a set  of  empirical constants.  Most  FDS users
simply use  the default values  of (0.2,0.5,0.5), but some have  explored their effect on the solution of the equations.

In an effort  to validate FDS with some  simple room temperature data, Zhang~{\em et al.}~\cite{Zhang:2}  tried different combinations of the
Smagorinsky parameters,  and suggested the current  default values. Of the  three parameters,  the  Smagorinsky constant  $C_s$  is the  most
sensitive.   Smagorinsky~\cite{Smagorinsky:1}  originally  proposed  a value of 0.23,  but researchers over the past  three decades have used values
ranging  from 0.1  to 0.23. There  are also refinements  of the original  Smagorinsky  model~\cite{Deardorff:1,Germano:1,Lilly:1} that do  not
require the  user  to  prescribe  the constants,  but  rather generate them automatically as part of the numerical scheme.

\subsection{Sensitivity of Radiation Parameters}

Radiative heat  transfer is  included in FDS  via the solution  of the radiation  transport equation for  a non-scattering  gray gas,  and in some
limited  cases using  a wide band  model. The equation  is solved using  a technique  similar to  finite volume  methods  for convective transport,
thus the  name given  to it  is the  Finite  Volume Method (FVM).  There  are  several  limitations  of  the  model.  First,  the absorption
coefficient  for the smoke-laden gas is  a complex function of  its  composition  and   temperature.  Because  of  the  simplified combustion  model,
the  chemical  composition of  the  smokey  gases, especially  the  soot content,  can  effect  both  the absorption  and emission  of thermal
radiation.  Second, the  radiation transport  is discretized via  approximately 100 solid angles. For  targets far away from  a  localized source  of
radiation,  like  a growing  fire,  the discretization can  lead to a non-uniform distribution  of the radiant energy. This can be seen in the
visualization of surface temperatures, where  ``hot spots'' show  the effect  of the  finite number  of solid angles. The  problem can  be lessened
by  the inclusion of  more solid angles, but at  a price of longer computing times.  In most cases, the radiative flux  to far-field targets is  not
as important  as those in the near-field, where coverage by the default number of angles is much better.

Hostikka {\em et al.} examined the sensitivity of the radiation solver to changes in  the assumed soot production, number  of spectral bands, number
of control  angles, and  flame temperature.  Some of  the more interesting findings were:
\begin{itemize}
\item  Changing  the  soot  yield  from 1~\%  to  2~\%  increased  the
radiative flux from a simulated methane burner about 15~\%
\item Lowering  the soot  yield to zero  decreased the  radiative flux
about 20~\%.
\item Increasing  the number of  control angles by  a factor of  3 was
necessary  to  ensure  the  accuracy  of the  model  at  the  discrete measurement locations.
\item Changing the number of spectral  bands from 6 to 10 did not have
a strong effect on the results.
\item Errors of 100~\% in heat  flux were caused by errors of 20~\% in
absolute temperature.
\end{itemize}
The  sensitivity  to  flame   temperature  and  soot  composition  are consistent with  combustion theory, which states that  the source term of the
radiative transport equation  is a function of  the absorption coefficient  multiplied  by the  absolute  temperature  raised to  the fourth  power.
The  number of  control angles  and spectral  bands are user-controlled numerical  parameters whose sensitivities  ought to be checked  for  each
new  scenario.  The  default  values  in  FDS  are appropriate for  most large scale fire  scenarios, but may  need to be refined for  more detailed
simulations  such as a  low-sooting methane burner.


\subsection{Sensitivity of Thermophysical Properties of Solid Fuels}

An  extensive amount  of  verification and  validation  work with  FDS version 4  has been  performed by Hietaniemi,  Hostikka, and  Vaari at VTT,
Finland~\cite{Hietaniemi:1}. The case  studies are  comprised of fire  experiments   ranging  in   scale  from  the   cone  calorimeter (ISO~5660-1)
to  full-scale fire  tests such as  the room  corner test (ISO~9705).  Comparisons are also  made between  FDS results  and data obtained  in the
SBI (Single  Burning Item)  Euro-classification test apparatus (EN  13823) as  well as  data obtained in  two {\em  ad hoc} experimental
configurations:  one is similar  to the room  corner test but has only  partial linings and the other is a  space to study fires in building
cavities.

All of the  case studies involve real materials  whose properties must be prescribed  so as to conform  to the assumption in  FDS that solids are of
uniform composition backed by a material that is either cold or totally insulating. Sensitivity of the various physical properties and the boundary
conditions were tested. Some of the findings were:
\begin{itemize}
\item  The measured  burning  rates of  various  materials often  fell
between two FDS  predictions in which cold or  insulated backings were assumed for the solid surfaces. FDS lacks a multi-layer solid model.
\item  The ignition  time of  upholstery is  sensitive to  the thermal
properties  of the  fabric covering,  but the  steady burning  rate is sensitive to the properties of the underlying foam.
\item Moisture content of wooden fuels is very important and difficult
to measure.
\item Flame spread  over complicated objects, like cables  laid out in
trays, can be modeled if the  surface area of the simplified object is comparable to that  of the real object. This  suggests sensitivity not only to
physical properties,  but also geometry.  It is  difficult to quantify the extent of the geometrical sensitivity.
\end{itemize}
There is  little quantification of  the observed sensitivities  in the study. Fire  growth curves can be  linear to exponential  in form, and small
changes in  fuel  properties  can lead  to  order of  magnitude changes  in heat  release rate  for unconfined  fires. The  subject is
discussed  in the  FDS  Validation Guide (Volume 3 of the Technical Reference Guide).
where it is  noted in many of the studies  that predicting fire growth is difficult.

Recently, Lautenberger, Rein and Fernandez-Pello~\cite{Lautenberger:FSJ} developed a method to automate the
process of  estimating material properties to input  into FDS. The methodology involves simulating a  bench-scale test with the model and iterating
via a  "genetic"  algorithm  to obtain  an  optimal set  of material  properties for  that  particular item.  Such techniques  are necessary because
most bench-scale apparatus do not provide a complete set of thermal properties.



\section{Code Checking}
\label{Code Checking}

An examination of the structure of the computer program can be used to detect potential errors in the numerical solution of the governing equations.
The coding can be verified by a third party either manually or automatically with profiling programs to detect irregularities and
inconsistencies~\cite{ASTM:E1355}.

At NIST and elsewhere, FDS has been compiled and run on computers manufactured by IBM, Hewlett-Packard, Sun Microsystems, Digital Equipment
Corporation, Apple, Silicon Graphics, Dell, Compaq, and various other personal computer vendors. The operating systems on these platforms include
Unix, Linux, Microsoft Windows, and Mac OSX. Compilers used include Lahey Fortran, Digital Visual Fortran, Intel Fortran, IBM XL Fortran, HPUX
Fortran, Forte Fortran for SunOS, the Portland Group Fortran, and several others. Each combination of hardware, operating system and compiler
involves a slightly different set of compiler and run-time options and a rigorous evaluation of the source code to test its compliance with the
Fortran 90 ISO/ANSI standard~\cite{F90}. Through this process, out-dated and potentially harmful code is updated or eliminated, and often the code is
streamlined to improve its optimization on the various machines. However, simply because the FDS source code can be compiled and run on a wide
variety of platforms does not guarantee that the numerics are correct. It is only the starting point in the process because it at least rules out the
possibility that erratic or spurious results are due to the platform on which the code is running.

Beyond hardware issues, there are several useful techniques for checking the FDS source code that have been developed over the years. One of the
best ways is to exploit symmetry. FDS is filled with thousands of lines of code in which the partial derivatives in the conservation equations are
approximated as finite differences. It is very easy in this process to make a mistake. Consider, for example, the finite difference approximation of
the thermal diffusion term in the $ijk$th cell of the three-dimensional grid:
\begin{eqnarray*}
(\nabla \cdot k \nabla T)_{ijk} &\approx&
              \frac{1}{\dx}
         \left[k_{i+\ha,jk}\frac{T_{i+1,jk}-T_{ijk}}{\dx}
              -k_{i-\ha,jk}\frac{T_{ijk}-T_{i-1,jk}}{\dx}\right]+  \nonumber \\
            &&\frac{1}{\dy}
         \left[k_{i,j+\ha,k}\frac{T_{i,j+1,k}-T_{ijk}}{\dy}
              -k_{i,j-\ha,k}\frac{T_{ijk}-T_{i,j-1,k}}{\dy}\right]+ \nonumber \\
            &&\frac{1}{\dz}
         \left[k_{ij,k+\ha}\frac{T_{ij,k+1}-T_{ijk}}{\dz}
              -k_{ij,k-\ha}\frac{T_{ijk}-T_{ij,k-1}}{\dz}\right]
\end{eqnarray*}
which is written as follows in the Fortran source code:
\begin{verbatim}
      DTDX = (TMP(I+1,J,K)-TMP(I,J,K))*RDXN(I)
      KDTDX(I,J,K) = .5*(KP(I+1,J,K)+KP(I,J,K))*DTDX
      DTDY = (TMP(I,J+1,K)-TMP(I,J,K))*RDYN(J)
      KDTDY(I,J,K) = .5*(KP(I,J+1,K)+KP(I,J,K))*DTDY
      DTDZ = (TMP(I,J,K+1)-TMP(I,J,K))*RDZN(K)
      KDTDZ(I,J,K) = .5*(KP(I,J,K+1)+KP(I,J,K))*DTDZ

      DELKDELT = (KDTDX(I,J,K)-KDTDX(I-1,J,K))*RDX(I) +
     .           (KDTDY(I,J,K)-KDTDY(I,J-1,K))*RDY(J) +
     .           (KDTDZ(I,J,K)-KDTDZ(I,J,K-1))*RDZ(K)
\end{verbatim}
This is one of the simpler constructs because the pattern that emerges within the lines of code make it fairly easy to check. However, a mis-typing
of an {\ct I} or a {\ct J}, a plus or a minus sign, or any of a hundred different mistakes can cause the code to fail, or worse produce the wrong
answer. A simple way to eliminate many of these mistakes is to run simple scenarios that have perfectly symmetric initial and boundary conditions.
For example, put a hot cube in the exact center of a larger cold compartment, turn off gravity, and watch the heat diffuse from the hot cube into the
cold gas. Any simple error in the coding of the energy equation will show up almost immediately. Then, turn on gravity, and in the absence of any
coding error, a perfectly symmetric plume will rise from the hot cube. This checks both the coding of the energy and the momentum equations. Similar
checks can be made for all of the three dimensional finite difference routines. So extensive are these types of checks that the release version of
FDS has a routine that generates a tiny amount of random noise in the initial flow field so as to eliminate any false symmetries that might arise in
the numerical solution.

The process of adding new routines to FDS is as follows: typically the routine is written by one person (not necessarily a NIST staffer) who takes
the latest version of the source code, adds the new routine, and writes a theoretical and numerical description for the FDS Technical Reference
Guide, plus a description of the input parameters for the FDS User's Guide. The new version of FDS is then tested at NIST with a number of benchmark
scenarios that exercise the range of the new parameters.  Provisional acceptance of the new routine is based on several factors: (1) it produces more
accurate results when compared to experimental measurement, (2) the theoretical description is sound, and (3) any empirical parameters are obtainable
from the open literature or standard bench-scale apparatus.  If the new routine is accepted, it is added to a test version of the software and
evaluated by external users and/or NIST grantees whose research is related to the subject. Assuming that there are no intractable issues that arise
during the testing period, the new routine eventually becomes part of the release version of FDS.

Even with all the code checking performed at NIST, it is still possible for errors to go unnoticed. One remedy is the fact that the source code for
FDS is publicly released. Although it consists of on the order of 30,000 lines of Fortran statements, various researchers outside of NIST have been
able to work with it, add enhancements needed for very specific applications or for research purposes, and report back to the developers bugs that
have been detected. The source code is organized into 27 separate files, each containing subroutines related to a particular feature of the model,
like the mass, momentum, and energy conservation equations, sprinkler activation and sprays, the pressure solver, {\em etc.} The lengthiest routines
are devoted to input, output and initialization.  Most of those working with the source code do not concern themselves with these lengthy routines
but rather focus on the finite-difference algorithm contained in a few of the more important files. Most serious errors are found in these files, for
they contain the core of the algorithm. The external researchers provide feedback on the organization of the code and its internal documentation,
that is, comments within the source code itself.  Plus, they must compile the code on their own computers, adding to its portability.



\chapter{The Basic Flow Solver}


In this chapter we present test cases aimed at exercising the advective, pressure, and viscous terms, as well as the time integration for non-reacting flows.


\section{2D Analytical Solution to Navier-Stokes}
\label{ns2d}

In this section we present an analytical solution that is useful for confirming the convergence rates of the truncation errors in the discretization of the terms in
the governing equations. Consider the 2D incompressible Navier-Stokes equations
\begin{equation}
\label{eqn_NS}
\frac{\partial \mathbf{u}}{\partial t} + \mathbf{u} \cdot \nabla \mathbf{u} = - \nabla{p} + \nu \nabla^2 \mathbf{u} \,\mbox{,}
\end{equation}
where the velocity is given by $\mathbf{u} = [u, v]^T$, and the kinematic viscosity and pressure are denoted $\nu$ and $p$, respectively.
An analytical solution of these equations is given by \cite{McDermott:NS2D}
\begin{eqnarray}
\label{eqn_usoln}
u(x,y,t) &=& 1 - A\cos(x-t)\sin(y-t)\,e^{-2\nu t} \,\mbox{,} \\
v(x,y,t) &=& 1 + A\sin(x-t)\cos(y-t)\,e^{-2\nu t} \,\mbox{,}
\end{eqnarray}
\begin{equation}
p(x,y,t) = -\frac{A^2}{4} \left[ \cos(2(x-t))+\cos(2(y-t))\right]e^{-4\nu t} \,\mbox{.}
\end{equation}
Here, $A$ represents an arbitrary amplitude and is assumed to take a value of 2 in this example.
Note that this solution satisfies continuity for all time,
\begin{equation}
\label{eqn_divfree}
\nabla\cdot\mathbf{u} = 0 \,\mbox{,}
\end{equation}
is spatially periodic on an interval $2\pi$ in each direction, and is temporally periodic on $2\pi$ if $\nu=0$; otherwise, the solution decays exponentially.
Below we present two series of tests which demonstrate the second-order accuracy of the FDS numerical scheme and thus provide a strong form of code verification
for the advective and viscous terms which are exercised.

The physical domain of the problem is a square of side $L=2\pi$.  The grid spacing is uniform $\delta x = \delta y = L/N$ in each direction
with $N =\{8,16,32,64\}$ for each test series.  The staggered grid locations are denoted $x_i = i \, \delta x$ and $y_j = j \, \delta y$, and the cell
centers are marked by an overbar, $\bar{x}_i = x_i - \delta x/2$ and $\bar{y}_j = y_j - \delta y/2$.

First, we present qualitative results for the case in which $\nu=0$.  Thus, only the advective discretization and the time integration are being tested.
Figure \ref{fig_ns2d_smv} shows the initial and final $(t=2\pi)$ numerical solution for the case $N=64$.
As mentioned, with $\nu=0$ the solution is periodic in time and this figure demonstrates that, as should be the case, the FDS numerical solution is unaltered after one flow-through time.

\begin{figure}[t]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/ns2d_64_start} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/ns2d_64_end} }
   \end{tabular*}
   \caption{Initial and final states of the $u$-component of velocity.}
   \label{fig_ns2d_smv}
\end{figure}

Next, in Figure \ref{fig_ns2d_timehistory}, we show time histories of the $u$-component of velocity at the center of the domain for the case in which $\nu = 0.1$.
It is clearly seen that the FDS solution (thin line) converges to the analytical solution (thick line).
Note that the analytical solution is evaluated at the same location as the FDS staggered grid location for the $u$-component
of velocity, $(x_{N/2},\bar{y}_{N/2})$, which is different in each case, $N =\{8,16,32,64\}$.

\begin{figure}[t]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/ns2d_8_nupt1.pdf} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/ns2d_16_nupt1.pdf} } \\
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/ns2d_32_nupt1.pdf} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/ns2d_64_nupt1.pdf} }
   \end{tabular*}
   \caption{Time history of the $u$-component of velocity half a grid cell below the center of the domain for a range of grid resolutions.
   The domain is a square of side $L = 2\pi$ m.  The $N \times N$ grid is uniform.  Progressing from left to right and top to bottom we have resolutions $N =\{8,16,32,64\}$
   clearly showing convergence of the FDS numerical solution (open circles) to the analytical solution (solid line).
   The case is run with constant properties, $\rho=1$ kg/m$^3$ and $\mu = 0.1$ kg/m/s, and a CFL of 0.25.}
   \label{fig_ns2d_timehistory}
\end{figure}

Figure \ref{fig_ns2d_convergence} is the key quantitative result of this verification test.  In this figure we plot the rms error, $\varepsilon_{\mbox{\scriptsize rms}}$,
in the $u$-component of velocity against the grid spacing.  The error is defined by
\begin{equation}
\label{eqn_rmserror}
\varepsilon_{\mbox{\scriptsize rms}} \equiv \sqrt{ \frac{1}{M} \sum_{k=1}^{M} \left[ U_{ij}^k - u(x_i,\bar{y}_j,t_k) \right]^2 } \,\mbox{,}
\end{equation}
where $M$ is the number of time steps and $k$ is the time step index.  The spatial indices are $(i=N/2,j=N/2)$ and $U_{ij}^k$ represents the FDS value for the $u$-component of
velocity at the staggered storage location for cell $(i,j)$ at time step $k$; $u(x_i,\bar{y}_j,t_k)$ is the analytical solution for the $u$-component at
the corresponding location in space and time.  The figure confirms that the advective terms, the viscous terms, and the time integration in the FDS code are convergent and second-order accurate.

\begin{figure}[t]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1}{ \includegraphics[width=3.2in]{FIGURES/ns2d_error.pdf} } &
      \scalebox{1}{ \includegraphics[width=3.2in]{FIGURES/ns2d_nupt1_error.pdf} }
   \end{tabular*}
   \caption{(Left) Convergence rate for the $u$-component of velocity with $\nu = 0$ showing that the advective terms in the FDS code are second-order accurate.  The triangles represent the rms error in the $u$-component for grid spacings of $\delta x = L/N$ where $L = 2\pi$ m and $N = \{8,16,32,64\}$. The solid line represents first-order accuracy and the dashed line represents second-order accuracy. The simulation is run to a time of $t = 2\pi$~s with a CFL of $0.25$.  The $u$-component at the center of the domain is compared with the analytical solution at the same location.  (Right) Same case, except $\nu=0.1$, showing that the viscous terms in the FDS code are second-order accurate.}
   \label{fig_ns2d_convergence}
\end{figure}



\clearpage

\section{Decaying Isotropic Turbulence}
\label{decaying_isotropic_turbulence}

In this section we present a canonical flow for LES which tests whether the subgrid stress model has been coded properly.
In some cases the difference between verification and validation is not so clear.  Once a model is well-established and validated it may actually be used as a form of verification.  Granted, such a test is not as strong a verification as the convergence study shown in Section \ref{ns2d}.  Nevertheless, these tests are often quite useful in discovering problems within the code.  The case we examine in this section, decaying isotropic turbulence, is highly sensitive to errors in the advective and diffusive terms because the underlying physics is inherently three-dimensional and getting the problem right depends strongly on a delicate balance between vorticity dynamics and dissipation.  An even more subtle yet extremely powerful verification test is also presented in this section when we set both the molecular and turbulent viscosities to zero and confirm that the integrated kinetic energy within the domain remains constant.   In the absence of any form of viscosity, experience has shown that the slightest error in the advective terms or the pressure projection will cause the code to go unstable.  This verification is therefore stronger than one might initially expect.

In this section we test the FDS model against the low Reynolds number (Re) data of Comte-Bellot and Corrsin (CBC) \cite{CBC}. Viscous effects are important in this data set for a well-resolved LES, testing the model's Re dependence.  Following \cite{SdBK}, we use a periodic box of side $L = 9 \times 2\pi$ centimeters ($\approx 0.566$ m) and $\nu = 1.5 \times 10^{-5}$ $\mbox{m}^2/\mbox{s}$ for the kinematic viscosity. The non-dimensional times for this data set are: $x/M = 42$ (initial condition), $98$, and $171$, where $M$ is the characteristic mesh spacing of the CBC wind tunnel and $x$ is the downstream location of the data station. Considering the mean velocity in the CBC wind tunnel experiment, these correspond to dimensional times of $t = 0.00$, $0.28$, and $0.66$ seconds in our simulations.

The initial condition for the FDS simulation is generated by superimposing Fourier modes with random phases such that the spectrum matches that of the initial CBC data.  An iterative procedure is employed where the field is allowed to decay for small time increments subject to Navier-Stokes physics, each wavenumber is then injected with energy to again match the initial filtered CBC spectrum.  The specific filter used here is discussed in \cite{McDermott:2005b}.

To provide the reader with a qualitative sense of the flow, Figure \ref{fig_cbc_smv} shows the initial and final states of the velocity field in the 3D periodic domain.  The flow is unforced and so if viscosity is present the total energy decays with time due to viscous dissipation.  Because the viscous scales are unresolved, a subgrid stress model is required. Here the stress is closed using the gradient diffusion hypothesis and the eddy viscosity is modeled by the constant coefficient Smagorinsky model with the coefficient taken to be $C_s = 0.2$ (see the Technical Reference Guide for further details).

The decay curves for two grid resolutions are shown plotted on the left in Figure \ref{fig_cbc_energy}.  For an LES code such as FDS which uses a physically-based subgrid model, an important verification test is to run this periodic isotropic turbulence simulation in the absence of both molecular and turbulent viscosity.  For so-called ``energy-conserving'' explicit numerics the integrated energy will remain nearly constant in time.  This is demonstrated by the blue line in the top-left plot in Figure \ref{fig_cbc_energy}.  The deviations from identical energy conservation (to machine precision) are due solely to the time discretization (the spatial terms are conservative as discussed in \cite{Morinishi}) and converge to zero as the time step goes to the zero.  Note that strict energy conservation requires implicit time integration \cite{Ham,McDermott:2007b} and, as shown by the red curve on the same plot where only molecular viscosity is present in the simulation, this cost is unwarranted given that the molecular dissipation rate clearly overshadows the relatively insignificant amount of numerical dissipation caused by the explicit method.  The FDS result using the Smagorinsky eddy viscosity (the black solid line) matches the CBC data (red open circles) well for the $32^3$ case (top-left).  However, the FDS results are slightly too dissipative in the $64^3$ case (bottom-left).  This is due to a well-known limitation of the constant coefficient Smagorinsky model: namely, that the eddy viscosity does not converge to zero at the appropriate rate as the filter width (here equivalent to the grid spacing) is decreased.
\begin{figure}[t]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/cbc_0000.pdf} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/cbc_0085.pdf} }
   \end{tabular*}
   \caption{\label{fig_cbc_smv} \small Initial and final states of the isotropic turbulence field.}
\end{figure}

To the right of each decay curve plot in Figure \ref{fig_cbc_energy} is the corresponding spectral data comparison.  The three black solid lines are the CBC spectral data for the points in time corresponding to dimensional times of $t = 0.00$, $0.28$, and $0.66$ seconds in our simulations.  As described above, the initial FDS velocity field (represented by the black dots) is specified to match the CBC data up to the grid Nyquist limit.  From there the spectral energy decays rapidly as discussed in \cite{McDermott:2005b}.  For each of the spectral plots on the right, the results of interest are the values of the red and blue dots and how well these match up with the corresponding CBC data.  For the $32^3$ case (top-right) the results are remarkably good.  Interestingly, the results for the more highly resolved $64^3$ case are not as good.  This is because the viscous scales are rather well-resolved at the later times in the experiment and, as mentioned, it is well-known that the constant coefficient Smagorinsky model is too dissipative under such conditions.

\begin{figure}[t]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/csmag_32_decay.pdf} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/csmag_32_spectra.pdf} } \\
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/csmag_64_decay.pdf} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/csmag_64_spectra.pdf} }
   \end{tabular*}
   \caption{\label{fig_cbc_energy} \small (Left) Time histories of integrated kinetic energy corresponding to the grid resolutions on the right side of the figure.  In the $32^3$ case (top), the CBC data (open circles) are obtained by applying a filter to the CBC energy spectra at the Nyquist limit for an $N=32$ grid.  Similarly, for the $64^3$ case (bottom), the CBC data are obtained from filtered spectra for an $N=64$ grid.  Notice that the integrated FDS results for the $32^3$ case compare better with the filtered CBC data than the $64^3$ results.  This is a well-known limitation of the constant coefficient Smagorinsky model: namely, that the eddy viscosity does not converge to zero at the appropriate rate as the filter width (here equivalent to the grid spacing) is decreased. (Right) Energy spectra for the $32^3$ case (top) and the $64^3$ case (bottom).  The solid black lines are the spectral data of Comte-Bellot and Corrsin at three different points in time corresponding to downstream positions in the turbulent wind tunnel.  The initial condition for the velocity field (spectra shown as black dots) in the FDS simulation is prescribed such that the energy spectrum matches the initial CBC data.  The FDS energy spectra corresponding to the subsequent CBC data are shown by the red and blue dots. The vertical dashed line represents the wavenumber of the grid Nyquist limit. }
\end{figure}

Overall, the agreement between the FDS simulations and the CBC data is satisfactory and any discrepancies can be explained by limitations of the model.  Therefore, as a verification the results here are positive in that nothing points to coding errors.




\clearpage

\section{The Dynamic Smagorinsky Model}
\label{dynamic_smagorinsky_model}

In the previous section, all calculations were performed with a constant and uniform Smagorinsky coefficient, $C_s = 0.2$.  For the canonical case of homogeneous decaying isotropic turbulence -- \emph{at sufficiently high Reynolds number} -- this model is sufficient.  However, we noticed that, even for the isotropic turbulence problem, when the grid Reynolds number is low (i.e., the flow is well-resolved) the constant coefficient model tends to over predict the dissipation of kinetic energy (see Figure \ref{fig_cbc_energy}).  This is because the eddy viscosity does not converge to zero at the proper rate; so long as strain is present in the flow (the magnitude of the stain rate tensor is nonzero), the eddy viscosity will be nonzero.  This violates a guiding principle in LES development: that the method should converge to a DNS if the flow field is sufficiently resolved \cite{McDermott:2007}.

The dynamic procedure for calculating the model coefficient (invoked by setting {\tt DYNSMAG=.TRUE.} on the {\tt MISC} line) alleviates this problem.  The basis of the model is that the coefficient should be the same for two different filter scales within the inertial subrange.  Details of the procedure are explained in the following references \cite{Germano:1991,PinoMartin:2000,Moin:1991,Lund:1997,McDermott:2004}.  Here we present results for the implementation of the dynamic model in FDS.  In Figure~\ref{fig_c_smag} we show contours of the Smagorinsky coefficient $C_s(\mathbf{x},t)$ at a time midway through a $64^3$ simulation of the CBC experiment.  Notice that the coefficient ranges from 0.00 to roughly 0.30 within the domain with the average value falling around 0.17.

\begin{figure}[t]
   \begin{center}
      \includegraphics[height=3.00in]{FIGURES/c_smag.pdf}
      \caption{\label{fig_c_smag} \small Smagorinsky coefficient for a $64^3$ simulation of the CBC experiment.}
   \end{center}
\end{figure}

Next, in Figure \ref{fig_dynsmag_cbc}, we show results for the dynamic model analogous to Figure \ref{fig_cbc_energy}.  For the $32^3$ case the result is not dramatically different than the constant coefficient model.  In fact, one might argue that the $32^3$ constant coefficient results are slightly better.  But there are several reasons why we should not stop here and conclude that the constant coefficient model is superior.  First, as pointed out in Pope Exercise 13.34 \cite{Pope:2000}, $38^3$ is required to resolve 80\% of the total kinetic energy (for this flow) and thus put the cutoff wavenumber within the inertial subrange of turbulent length scales.  Pope recommends that simulations which are under-resolved by this criterion should be termed ``very large-eddy simulations'' -- weather forecasting is a typical example.  For a $32^3$ LES, the test filter width in the dynamic model falls at a resolution of $16^3$, clearly outside the inertial range.  A tacit assumption underlying the original interpretation of the dynamic model is that both the grid filter scale and the test filter scale should fall within the inertial range, since this is the range in which the scales of turbulent motion (in theory) exhibit fractal-like, scale similar behavior (recently the procedure has been derived from other arguments \cite{Pope:LES}).  With this in mind, it is perhaps not surprising that the dynamic model does not perform optimally for the low resolution case.  In the higher resolution $64^3$ case, however, the dynamic model does perform better than the constant coefficient model -- and this is the desired result: we want better performance at higher resolution.  As can be seen from the energy spectra (lower right), the energy near the grid Nyquist limit is more accurately retained by the dynamic model.  This equates to better flow structure with fewer grid cells.  Thus, for practical calculations of engineering interest the small computational overhead of computing the coefficient may recuperated by a reduction is cell count.

\begin{figure}[t]
   \begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/dsmag_32_decay.pdf} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/dsmag_32_spectra.pdf} } \\
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/dsmag_64_decay.pdf} } &
      \scalebox{1.0}{ \includegraphics[width=3.2in]{FIGURES/dsmag_64_spectra.pdf} }
   \end{tabular*}
   \caption{\label{fig_dynsmag_cbc} \small Dynamic Smagorinsky model results (analogous to Figure \ref{fig_cbc_energy}) for integrated kinetic energy (left) and spectra (right).}
\end{figure}



\clearpage

\section{FDS Wall Flows Part I: Straight Channels}
\label{fds_wall_flows1}

%\begin{figure}[t]
%   \begin{center}
%      \includegraphics[height=5.00in]{FIGURES/moody.pdf}
%      \caption{\label{moody} Moody chart.}
%   \end{center}
%\end{figure}

Wall flows are notoriously challenging for large-eddy simulation (LES) \cite{Baggett:1997,Baggett:1998,Cabot:1995,Pope:2000,Sagaut:2001}.  In spite of their promise and sophistication, practical LES codes are resigned to \emph{model} the wall shear stress as opposed to \emph{resolving} the dynamically important length scales near the wall.

In this work we introduce the Werner and Wengle (WW) wall model \cite{Werner:1991} into the NIST Fire Dynamics Simulator (FDS) as a practical first step in developing models for turbulent flow around complex geometry and over complex terrain.  Such models are required in order for FDS to accurately model, for example, tunnel fires, smoke transport in complex architectures, and wildland-urban interface (WUI) fires \cite{WUI}. As a minimum requirement, a wall model should accurately reproduce the mean wall stress for flow in a straight channel.  We verify that this is true for FDS by reproducing the Moody chart, a plot of friction factor versus Reynolds number for pipe flow \cite{Moody:1944}.

The remainder of this article is organized as follows. In Section \ref{formulation} we describe the model formulation. In Section \ref{WW_model} we give an overview of the WW model.  Then, in Section \ref{results}, we conduct a verification study of the wall boundary conditions for laminar and turbulent flows in FDS.  From this study we are able to draw quantitative conclusions in Section \ref{conclusions} about the accuracy of the channel flow simulations.

\subsection{Formulation}
\label{formulation}

Details of the FDS formulation are given in the Technical Guide \cite{FDS_Math_Guide_5}.  Here we provide only the salient components of the model necessary for treatment of constant density channel flow.

The filtered continuity and momentum equations are:
\begin{equation}
\label{eqn_cont}
\frac{\partial \bar{u}_i}{\partial x_i} = 0 \,\mbox{,}
\end{equation}
\begin{equation}
\label{eqn_mom1}
\frac{\partial \bar{u}_i}{\partial t} + \frac{\partial \bar{u}_i \bar{u}_j}{\partial x_j} = -\frac{1}{\rho} \left[ \frac{\mbox{d}p}{\mbox{d}x_i} + \frac{\partial \tilde{p}}{\partial x_i} + \frac{\partial \bar{\tau}_{ij}}{\partial x_j} + \frac{\partial \tau_{ij}^{sgs}}{\partial x_j} \right]\,\mbox{,}
\end{equation}
where $\tau_{ij}^{sgs} \equiv \rho(\overline{u_i u_j} - \bar{u}_i \bar{u}_j)$ is the subgrid-scale (sgs) stress tensor, here modeled by gradient diffusion with dynamic Smagorinsky \cite{Germano:1991} used for the eddy viscosity.  In this work we specify a constant pressure drop $\mbox{d}p/\mbox{d}x$ in the streamwise direction to drive the flow.  The hyrdrodynamic pressure $\tilde{p}$ is obtained from a Poisson equation which enforces (\ref{eqn_cont}).

When (\ref{eqn_mom1}) is integrated over a cell adjacent to the wall in an LES it turns out that the most difficult term to handle is the viscous stress at the wall, e.g. $\bar{\tau}_{xz}|_{z=0}$, because the wall-normal gradient of the streamwise velocity component cannot be resolved.  Note that the sgs stress at the wall is identically zero.  We have, therefore, an entirely different situation than exists in the bulk flow at high Reynolds number where the viscous terms are negligible and the sgs stress is of critical importance.  The quality of the sgs model still influences the wall stress, however, since other components of the sgs tensor affect the value of the near-wall velocity and hence the resulting viscous stress determined by the wall model.  In particular, it is important that the sgs model is \emph{convergent} (in the sense that the LES formulation reduces to a DNS as the filter width becomes small) so that as the grid is refined we can expect more accurate results from the simulation.

The model used for $\tau_w = \bar{\tau}_{xz}|_{z=0}$ in this work is the Werner and Wengle model \cite{Werner:1991} which we describe in more detail below.

\subsection{The Werner and Wengle Wall Model}
\label{WW_model}

An important scaling quantity in the near-wall region is the friction velocity, defined as $u^* \equiv \sqrt{\tau_w/\rho}$.  From the friction velocity we define the nondimensional streamwise velocity $u^+ \equiv u/u^*$ and nondimensional wall-normal distance $z^+ \equiv z/\ell$, where $\ell = \mu/(\rho u^*)$. The law of the wall is then given by \cite{Pope:2000,TennekesLumley}
\begin{eqnarray}
\label{eqn_visclayer} u^+ &=& z^+                \quad\hspace{1.77cm} \mbox{for} \quad z^+ < 5 \,\mbox{,} \\
\label{eqn_loglaw}    u^+ &=& 2.4 \ln z^+ + 5.2  \quad \mbox{for} \quad z^+ > 30 \,\mbox{,}
\end{eqnarray}
The region $5 < z^+ < 30$, where both viscous and inertial stresses are important, is referred to as the buffer layer.  The upper range of the log law depends on the Reynolds number \cite{Pope:2000,Zagarola:1997}.

Werner and Wengle \cite{Werner:1991} propose a simplification to the law of the wall to eliminate the mathematical difficulties of handling the buffer and log layers.  Furthermore, WW suppose that their simplified formula for the streamwise velocity holds \emph{instantaneously} within the LES.  The WW wall law is \cite{Sagaut:2001}
\begin{eqnarray}
\label{eqn_wwlam}  u^+ &=& z^+       \quad\hspace{.73cm} \mbox{for} \quad z^+ \le 11.81 \,\mbox{,}\\
\label{eqn_wwturb} u^+ &=& A (z^+)^B \quad \mbox{for} \quad z^+ > 11.81 \,\mbox{,}
\end{eqnarray}
where $A=8.3$ and $B=1/7$. Note that a power law has been substituted for the log law and the viscous sublayer and the power law region are matched within the buffer region.  A comparison of the log law and the power law is shown in Figure \ref{fig_lawofthewall}.  In the region $11.81 < z^+ < 10^3$ the power law is a good approximation to the log law and for $z^+>10^3$ the power law loosely exhibits wake region behavior for a flow with $\mbox{Re} \approx 5e5$ \cite{Pope:2000,Zagarola:1997}.  As we see below, this functional behavior has consequences for high Re flows.
\begin{figure}
   \begin{center}
      \scalebox{.7}{\includegraphics{FIGURES/lawofthewall.pdf}}
      \caption{\label{fig_lawofthewall} \small The law of the wall.  We have omitted the buffer layer since it is not considered in the WW model.  For $z^+\le 11.81$ we have the viscous sublayer.  For $z^+>11.81$ we show a comparison of the log law (\ref{eqn_loglaw}) (red dashed line) and the WW power law (\ref{eqn_wwturb}) (blue solid line) with $A=8.3$ and $B=1/7$.}
   \end{center}
\end{figure}

For the purposes of adapting the WW model to FDS we suppose that the first off-wall velocity component $\tilde{u}$ represents the WW profile averaged in the wall-normal direction (refer to Figure \ref{fig_nearwall_grid}).  The density is taken as the average of the neighboring cell values and uniform along the face.  The WW model as implemented in FDS is then given by
\begin{eqnarray}
\label{eqn_tauwlam} |\tau_w| &=& \displaystyle \frac{2 \bar{\mu} |\tilde{u}|}{\Delta z} \quad\hspace{4.29cm}\mbox{for} \quad z^+ \le 11.81 \,\mbox{,} \vspace{0.2cm}\\
\label{eqn_tauwturb}|\tau_w| &=& \displaystyle \bar{\rho}\left[\alpha\left(\frac{\bar{\mu}}{\bar{\rho}\Delta z}\right)^\beta + \eta\left(\frac{\bar{\mu}}{\bar{\rho}\Delta z}\right)^B |\tilde{u}|\right]^\gamma       \quad \mbox{for} \quad z^+ > 11.81 \,\mbox{,}
\end{eqnarray}
where
\begin{displaymath}
\begin{array}{lcl}
\alpha &=& \displaystyle \frac{1-B}{2} A^{\frac{1+B}{1-B}} \vspace{0.2cm}\\
\beta  &=& \displaystyle 1+B \vspace{0.2cm}\\
\eta   &=& \displaystyle \frac{1+B}{A} \vspace{0.2cm}\\
\gamma &=& \displaystyle \frac{2}{1+B} \vspace{0.1cm}\\
\end{array}
\end{displaymath}
Note that $\bar{\mu}$ is the average of the \emph{molecular} viscosity from the neighboring cells.

In order to decide which formula to use for the wall stress, (\ref{eqn_tauwlam}) or (\ref{eqn_tauwturb}), we must know $z^+$, which of course depends on $\tau_w$.  As a practical matter of implementation, given that most boundary layers in FDS are under-resolved, we first calculate $\tau_w$ from (\ref{eqn_tauwturb}); we then obtain $z^+ = \sqrt{\tau_w/\bar{\rho}}$ ; if $z^+>11.81$, then the computed value of $\tau_w$ is retained, else $\tau_w$ is taken from (\ref{eqn_tauwlam}), which actually involves no additional computation since the ghost cell value for the velocity is prescribed for a no-slip wall by default.
\begin{figure}
   \begin{center}
      \scalebox{0.12}{\includegraphics{FIGURES/nearwall_grid.pdf}}
      \caption{\label{fig_nearwall_grid} \small Near-wall grid.}
   \end{center}
\end{figure}

\subsection{Results}
\label{results}

\subsubsection{Laminar}
\label{laminar}

As verification of the no-slip boundary condition and further verification of the momentum solver in FDS, we perform a simple 2D laminar (Poiseuille) flow calculation of flow through a straight channel.  The FDS input files are stored in the repository \cite{FDS-SMV_repository} under {\tt poiseuille\_*}. The height of the channel is $H=1$ m and the length of the channel is $L=8$ m.  The number of grid cells in the streamwise direction $x$ is $N_x = 8$.  The number of cells in the wall-normal direction $z$ is varied $N_z = \{8,16,32,64\}$.  The fluid density is $\rho = 1.2$ kg m$^{-3}$ and the viscosity is $0.025$ kg m$^{-1}$ s$^{-1}$.  The mean pressure drop is prescribed to be $\mbox{d}p/\mbox{d}x = -1$ Pa m$^{-1}$ resulting in Re$_H \approx 160$.  The (Moody) friction factor $f$, which satisfies
\begin{equation}
\label{eqn_moodyf}
\Delta p = f \frac{L}{H} \frac{1}{2} \rho \bar{u}^2 \,\mbox{,}
\end{equation}
is determined from the steady state mean velocity $\bar{u}$ which is output by FDS for the specified pressure drop.  The exact friction factor for this flow is $f_{exact} = 24/\mbox{Re}_H$.  The friction factor error $|f-f_{exact}|$ is plotted for a range of grid spacings $\delta z = H/N_z$ in Figure \ref{fig_poiseuille_convergence} demonstrating second-order convergence of the laminar velocity field.
\begin{figure}
   \begin{center}
      \scalebox{.7}{\includegraphics{FIGURES/poiseuille_convergence.pdf}}
      \caption{\label{fig_poiseuille_convergence} \small FDS exhibits second-order convergence for laminar (Poiseuille) flow in a 2D channel.}
   \end{center}
\end{figure}


\subsubsection{Turbulent}
\label{turbulent}

To verify the WW wall model for turbulent flow we perform 3D LES of a square channel with periodic boundaries in the streamwise direction and a constant and uniform mean pressure gradient driving the flow.  The problem set up is nearly identical to the laminar cases of the previous section except here we perform 3D calculations and maintain cubic cells as we refine the grid: we hold the ratio 8:1:1 between $N_x$:$N_y$:$N_z$ for all cases.  The cases shown below are identified by their grid resolution in the $z$ direction.  The velocity field is initially at rest and develops in time to a mean steady state driven by the specified mean pressure gradient.  The presence of a steady state is the result of a balance between the streamwise pressure drop and the integrated wall stress from the WW model.  FDS outputs the planar average velocity in the streamwise direction and once a steady state is reached this value is used to compute the Reynolds number and the friction factor.  Table \ref{tab_zplus} provides a case matrix: nine cases for three values of specified pressure drop and three grid resolutions.  The nominal Reynolds number (obtained post-run) is listed along with the friction factor from the most refined FDS case and the friction factor computed (iteratively) from the Colebrook equation,
\begin{equation}
\label{eqn_colebrook}
\frac{1}{\sqrt{f}} = -2.0 \log_{\scriptsize 10} \left( \frac{\varepsilon/D}{3.7} + \frac{2.51}{\mbox{Re}\sqrt{f}} \right) \,\mbox{,}
\end{equation}
which is a fit to the turbulent range of the Moody chart (see e.g. \cite{MYO}).  The parameter $\varepsilon/D$ is the relative roughness where $D$ is the hydraulic diameter of the pipe or channel and Re is the Reynolds number based on $D$.  For all the cases reported here the hydraulic diameter is equivalent to the channel height, $D=H$, and the walls of the channel are smooth, i.e. $\varepsilon=0$.  FDS input files are stored in the repository \cite{FDS-SMV_repository} as {\tt moody\_*}. To provide a qualitative picture of the flow field, Figure \ref{fig_channel_flow_setup} shows contours of streamwise velocity for the case $\mbox{d}p/\mbox{d}x = -1$ Pa m$^{-1}$ and $N_z=32$.
\begin{table}
\begin{center}
\caption{\label{tab_zplus} \small Case matrix and friction factor results for turbulent channel flow.  The height of the first grid cell $\Delta z$ is given in viscous units $z^+$ for each case.  Additionally, the table gives the nominal Reynolds number Re$_H$ and the FDS friction factor results compared to the Colebrook equation (\ref{eqn_colebrook}).}
\vspace{0.5cm}
\begin{tabular}{|*{8}{l|}}
\hline
$\mbox{d}p/\mbox{d}x$   & \multicolumn{3}{c|}{$z^+$}&  Re$_H$  & $f$ FDS  & $f$ Colebrook & rel. error \\
\hline (Pa/m)       & $N_z=8$ & $N_z=16$ & $N_z=32$ &          & $(N_z=32)$ & Eq. (\ref{eqn_colebrook}) & \% \\
\hline\hline -0.01  & 190              & 95         & 47       & $5.9\times 10^4$  & 0.0212   & 0.0202        & 4.8        \\
\hline       -1.    & $1.9\times 10^3$ & 950        & 470      & $7.5\times 10^5$  & 0.0128   & 0.0122        & 4.6        \\
\hline       -100.  & $1.9\times 10^4$ & $9.5\times 10^3$  & $4.7\times 10^3$  & $9.8\times 10^6$  & 0.0077   & 0.0081        & 6.0\\
\hline
\end{tabular}
\end{center}
\end{table}
\begin{figure}
   \begin{center}
      \scalebox{0.6}{\includegraphics{FIGURES/channel_flow_setup.pdf}}
      \caption{\label{fig_channel_flow_setup} \small LES of square channel flow with smooth walls and periodic streamwise boundaries using dynamic Smagorinsky and the Werner Wengle wall model.  For this image $N_z=32$ and the mean pressure drop is $\mbox{d}p/\mbox{d}x = -1$ Pa m$^{-1}$ resulting in Re$_H = 7.5\times 10^5$ and a friction factor of $f=0.0128$.}
   \end{center}
\end{figure}

In Figure \ref{fig_fds_moody_chart} we replicate the Moody diagram for for both the laminar and turbulent cases presented in this work.  The laminar cases provide the exact result for two different Reynolds numbers and the turbulent cases are converging to the empirical values of the friction factor for smooth pipes. It is interesting the compare the turbulent results in Figure \ref{fig_fds_moody_chart} with the values of $z^+$ shown in Table \ref{tab_zplus}.  Notice from the table that the $z^+$ values for the $\mbox{d}p/\mbox{d}x=-100$ cases are in a range where the power law (\ref{eqn_wwturb}) deviates significantly from the log law (\ref{eqn_loglaw}) (see Figure \ref{fig_lawofthewall}) and this may explain why the results for this high Re case are somewhat grid sensitive.
\begin{figure}
   \begin{center}
      \scalebox{0.9}{\includegraphics{FIGURES/fds_moody_chart.pdf}}
      \caption{\label{fig_fds_moody_chart} \small The FDS Moody Chart: friction factor, $f$, versus Reynolds number, Re. The solid line for $\mbox{Re} < 2000$ is the analytical result for 2D Poiseuille flow, $f=24/\mbox{Re}$. The solid lines for $\mbox{Re}>2000$ (from the Colebrook equation (\ref{eqn_colebrook})) are for turbulent flow at various levels of relative roughness $\varepsilon/D$ shown on the right axis.  Stars are DNS results from FDS at a single grid resolution ($N_z=64$) and the symbols are FDS results for 3D LES with dynamic Smagorinsky and the Werner Wengle wall model at three grid resolutions ($N_z=\{8,16,32\}$).}
   \end{center}
\end{figure}

\subsection{Conclusions}
\label{conclusions}

In this work we have verified the FDS wall model for both laminar and turbulent flow through straight channels.  We have shown that for the laminar (DNS) case FDS is second-order accurate.  It is suggested elsewhere that, as a rule of thumb, 10 \% accuracy is the best that can be expected from friction factor calculations of turbulent flow \cite{MYO}.  We have adapted the Werner and Wengle wall model to variable density flows (though only constant density flows are tested here) for smooth walls and have shown that, when combined with the dynamic model for the eddy viscosity, FDS is capable of reproducing friction factors for a broad range of Reynolds numbers to within 6.0 \% relative accuracy.




\chapter{Thermal Radiation}

The Radiative Transport Equation (RTE) for an absorbing/emitting
and scattering medium is
\be \bs \cdot \nabla I_{\la}(\bx,\bs) =
 -\Big[ \kappa(\bx,\la) + \sigma_s(\bx,\la) \Big] \;
I_\la(\bx,\bs) +B(\bx,\la) + \frac{\sigma_s(\bx,\la)}{4\pi}
\int_{4\pi}\Phi(\bs,\bs') \; I_{\la}(\bx,\bs') \; d\bs'
\label{RTEbasic} \ee
where $I_{\la}(\bx,\bs)$ is the radiation intensity at wavelength
$\la$, $\bs$ is the direction vector of the intensity,
$\kappa(\bx,\la)$ and $\sigma_s(\bx,\la)$ are the local absorption
and scattering coefficients,
respectively, and $B(\bx,\la)$ is the emission source term.
The integral on the
right hand side describes the in-scattering from other directions.
In the case of a non-scattering gas the RTE becomes
\be \bs \cdot \nabla I_{\la}(\bx,\bs) = \kappa(\bx,\la) \; \Big[ I_b(\bx)
- I_\la(\bx,\bs) \Big] \label{RTE} \ee
where $I_b(\bx)$ is the source term given by the Planck function (see below).

In practical simulations the spectral ($\la$) dependence cannot be solved
accurately. Instead, the radiation spectrum is divided into
a relatively small number of bands and a separate RTE is derived for
each band. The band specific RTE is
\be   \bs \cdot \nabla I_n(\bx,\bs) = \kappa_n(\bx) \;
        \left[ I_{b,n}(\bx) - I_n(\bx,\bs) \right],\;\; n = 1...N
\label{bandRTE} \ee
where $I_n$ is the intensity integrated over the band $n$, and $\kappa_n$
is the appropriate mean absorption coefficient inside the band. The
source term can be written as a fraction of the blackbody radiation
\be I_{b,n} = F_n(\la_{\rm min},\la_{\rm max}) \; \sigma \; T^4/\pi \ee
where $\sigma$ is the Stefan-Boltzmann constant.
The calculation of factors $F_n$ is explained in Ref.~\cite{Siegel:1}.
When the intensities corresponding to the bands are known, the total
intensity is calculated by summing over all the bands
\be I(\bx,\bs) = \sum_{n=1}^N I_n(\bx,\bs) \ee

There are numerous examples in the heat transfer literature of exact solutions, for simple configurations of hot and cold objects, of the radiation
transport equation.

\clearpage

\section{Radiation inside a box (\texorpdfstring{{\bf radiation\_in\_a\_box}}{radiation\_in\_a\_box}) }
\label{radiation_in_a_box}

This verification case tests the computation of three-dimensional configuration factor $\Phi$ inside a cube box with one hot wall and five cold (0~K)
walls. An overview of the test geometry is shown here:
\begin{center}
\includegraphics[width=4.0in]{FIGURES/box.pdf}
\end{center}
The configuration factors are calculated at the diagonal of the cold wall opposite to the hot wall. The exact values of the configuration factor from
plane element $dA$ to parallel rectangle $H$ are calculated using the analytical solution~\cite{Siegel:1}

\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline (y,z) & $\Phi_{HdA}$ & (y,z) & $\Phi_{HdA}$ \\ \hline \hline
0.025   &0.1457 & 0.275 &0.2135 \\
0.075   &0.1603 & 0.325 &0.2233 \\
0.125   &0.1748 & 0.375 &0.2311 \\
0.175   &0.1888 & 0.425 &0.2364 \\
0.225   &0.2018 & 0.475 &0.2391 \\ \hline
\end{tabular}
\end{center}

\noindent Different variations of the case include the mesh resolution (20$^3$ and 100$^3$ cells) and the number of radiation angles (50, 100, 300,
1000, 2000). The exact and FDS results are shown here:

\noindent
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{FIGURES/radiation_box_20.pdf} &
\includegraphics[width=3.2in]{FIGURES/radiation_box_100.pdf}
\end{tabular*}





\clearpage

\section{Radiation from a plane layer (\texorpdfstring{{\bf radiation\_plane\_layer}}{radiation\_plane\_layer})}
\label{radiation_plane_layer}

This case tests the computation of three-dimensional radiation from a homogenous, infinitely wide layer of hot gases.  The temperature of
the layer is 1273.15~K and the absorption coefficient, $\kappa$, is varied. The thickness of the layer is fixed at 1~m, and the optical depth is $\tau = (1 \, \kappa)$~m$^{-1}$.
Wall temperatures are set to 0~K. The results are compared against the exact solution $S(\tau)$ presented in~\cite{Zeldovich:1}
\be S(\tau) = S_b\left[1-2E_3(\tau)\right] \ee
where $S_b = \sigma T^4$ is the black-body heat flux from the radiating plane and $E_3(\tau)$ is the exponential
integral function (order 3) of the optical depth $\tau$.

The FDS results are computed at two mesh resolutions in the $x$-direction (I=20 and I=150). For I=20, both one-band and six-band versions are
included to test the correct integration of heat fluxes over multiple bands. For I=20, 2-D versions are also computed (J=1). The limiting case, $\tau=\infty$,
using a solid wall of temperature 1273.15~K, is computed to test the wall heat flux computation. The exact values and FDS predictions of
the wall heat fluxes are given in the table below.

\input{../../Verification/Radiation/radiation_plane_layer.tex}


\clearpage
\section{Wall Internal Radiation (\texorpdfstring{{\bf wall\_internal\_radiation}}{wall\_internal\_radiation}) }
\label{wall_internal_radiation}


In-depth absorption of thermal radiation in a solid is computed using a two-flux model.  In this example, the accuracy of the two-flux model
is tested in the computation of the emissive flux from a homogenous layer of material (thickness $L=$~0.1~m) at 1273.15~K temperature,
surrounded by an ambient temperature of 10~K. The absorption coefficient $\kappa$ is varied to cover a range [0.01, 10] of optical depth
$\tau = \kappa L$.

The exact solutions for radiative flux are the analytical solutions of plane layer emission~\cite{Zeldovich:1}
\be S(\tau) = S_b\left[1-2E_3(\tau)\right] \ee
where $S_b = \sigma T^4$ is the black-body heat flux from the radiating plane and $E_3(\tau)$ is the exponential
integral function (order 3) of optical depth, $\tau$. The exact solutions and FDS results are shown in the table below.

\input{../../Verification/Radiation/wall_internal_radiation.tex}



\clearpage

\section{Radiation Emitted by Hot Spheres (\texorpdfstring{{\bf hot\_spheres}}{hot\_spheres}) }
\label{hot_spheres}

This case tests the calculation of the radiation heat flux from a collection of hot objects. Within two
completely open volumes that are 1~m on a side, hot spheres with a diameter of 1~cm and temperature of 500~$^\circ$C are
situated within a smaller volume that is 0.5~m on a side. One of the open volumes contains 10 spheres, the other contains
50,000. The simulation lasts for
10~s. In the first volume, the heat loss is just the sum
of the areas of the spheres multiplied by $\sigma T^4$ (emissivity is specified as unity in this case). See
the upper left plot in Fig.~\ref{hot_spheres_plot}. In the second
volume, the region is densely packed and it is expected that the collection of spheres will radiate like a solid cube  that is
0.5~m on a side and whose temperature is 500~$^\circ$C. This is just under 30~kW, as
shown in the upper right of Fig.~\ref{hot_spheres_plot}. The plot in the lower left of Fig.~\ref{hot_spheres_plot}
shows the incident heat flux to a gauge positioned at the center of the densely packed volume.
It is expected that this gauge would register a heat flux of
$\sigma T^4=20.26$~kW/m$^2$. Finally, the plot in the lower right of Fig.~\ref{hot_spheres_plot} indicates the
integrated intensity, $4 \sigma T^4=81.04$~kW/m$^2$.


\noindent
\begin{figure}[h]
\begin{tabular*}{\textwidth}{lr}
\includegraphics[width=3.2in]{FIGURES/hot_spheres_rad_loss_1} &
\includegraphics[width=3.2in]{FIGURES/hot_spheres_rad_loss_2} \\
\includegraphics[width=3.2in]{FIGURES/hot_spheres_heat_flux}  &
\includegraphics[width=3.2in]{FIGURES/hot_spheres_intensity}
\end{tabular*}
\caption[Radiation from hot spheres]{The total heat losses, radiative heat flux, and integrated intensity of a collection
of loosely and densely packed radiating spheres.}
\label{hot_spheres_plot}
\end{figure}



\chapter{Species and Combustion}

This chapter contains examples that test the computations related to species concentrations, gas properties and combustion.

\section{Fractional Effective Dose (FED)(\texorpdfstring{{\bf FED\_Device}}{FED\_Device}) }

The Fractional Effective Dose index (FED), developed by Purser~\cite{SFPE:Purser}, is a commonly used measure of human incapasitation
due to the combustion gases.  The present version of FDS uses only the concentrations of the gases CO, CO${}_2$, and O${}_2$ to
calculate the FED value as
\be
\mathrm{FED}_\mathrm{tot} = \mathrm{FED}_\mathrm{CO} \times \mathrm{HV}_\mathrm{CO_2} + \mathrm{FED}_\mathrm{O_2}
\ee
The fraction of an incapacitating dose of CO is calculated as
\be
\mathrm{FED}_\mathrm{CO} = 4.607 \times 10^{-7} \, (C_\mathrm{CO})^{1.036} \ t
\ee
where $t$ is time in seconds and $C_\mathrm{CO}$ is the CO concentration (ppm).  The fraction of an incapacitating dose of low
O${}_2$ hypoxia is calculated as
\be
\mathrm{FED}_\mathrm{O_2} =  \frac{t}{60 \exp \left [ 8.13 - 0.54 \, (20.9 - C_\mathrm{O_2}) \right ] }
\ee
where $C_\mathrm{O_2}$ is the O${}_2$ concentration (volume per cent).  The hyperventilation factor induced by carbon dioxide
is calculated as
\be
\mathrm{HV}_\mathrm{CO_2} = \frac{ \exp( 0.1930 \, C_\mathrm{CO_2} +  2.0004 ) }{7.1}
\ee
where $C_\mathrm{CO_2}$ is the CO${}_2$ concentration (percent).

The FED values were computed from specified constant gas concentrations using an external spreadsheet. The gas concentrations are listed in the
following table and the FDS and spreadsheet predictions of FED values are compared in the figures below.
\begin{figure}[ht]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{FIGURES/FED_Device_O2} &
\includegraphics[width=3.2in]{FIGURES/FED_Device_CO} \\
\includegraphics[width=3.2in]{FIGURES/FED_Device_CO2_CO} &
\includegraphics[width=3.2in]{FIGURES/FED_Device_All}
\end{tabular*}
\caption[The {\bf FED\_Device} test cases.]{Comparison of FED index predictions with spreadsheet computations.}
\label{FED_Device}
\end{figure}




\chapter{Heat Conduction}

This chapter contains examples that test the one-dimensional heat conduction solver in FDS.
A one-dimensional heat conduction equation for the solid phase
temperature $T_s(x,t)$ is applied in the direction $x$ pointing into
the solid (the point $x = 0$ represents the surface)
\be
  \rho_s c_s \; \dod{T_s}{t} = \dod{}{x} k_s \dod{T_s}{x} + \dq_s'''
  \label{1dheat}
\ee
In cylindrical and spherical coordinates, the heat conduction equation is written
\be
  \rho_s c_s \; \dod{T_s}{t} = \frac{1}{r} \, \dod{}{r}
  \left(rk_s \dod{T_s}{r} \right)+\dq_s'''
  \label{1dheatcyl} \quad ; \quad
  \rho_s c_s \; \dod{T_s}{t} = \frac{1}{r^2} \, \dod{}{r}
  \left(r^2k_s \dod{T_s}{r} \right)+\dq_s'''
\ee
FDS offers the user these options, with the assumption that the
obstruction is not actually recti-linear, but rather cylindrical or
spherical in shape. This option is useful in describing the behavior
of small, complicated ``targets'' like cables or heat detection
devices.



\clearpage

\section{Simple Heat Conduction Through a Solid Slab (\texorpdfstring{{\bf heat\_conduction}}{heat\_conduction})}

Analytical solutions of transient, one-dimensional heat conduction through a slab can be found in Refs.~\cite{Drysdale:1} and \cite{Carslaw:1}. Four
cases are examined here. In each, a slab of thickness $L=0.1$~m is exposed on one face to an air temperature of $T_g=120$~$^\circ$C. The other face
is insulated (adiabatic). The convective heat transfer from the gas to the slab is $\dq_c'' = h \, (T_g - T_s)$, where $h$ is constant, and $T_s$ is
the slab face temperature. No thermal radiation is included.
\begin{center}
\begin{tabular}{|c|c|c|c|c|c|}
\hline
Case  &  $k$      & $\rho$       &  $c$          &   $h$         &  Bi     \\
      & (W/m/K)   & (kg/m$^3$)   &  (kJ/kg/K)    &  (W/m$^2$/K)  &  $hL/k$ \\ \hline \hline
A     &   0.1     & 100          &  1            &  100          &  100    \\ \hline
B     &   0.1     & 100          &  1            &  10           &  10     \\ \hline
C     &   1.0     & 1000         &  1            &  10           &  1      \\ \hline
D     &  10.0     & 10000        &  1            &  10           & 0.1     \\ \hline
\end{tabular}
\end{center}

\begin{figure}[ht]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{FIGURES/heat_conduction_a} &
\includegraphics[width=3.2in]{FIGURES/heat_conduction_b} \\
\includegraphics[width=3.2in]{FIGURES/heat_conduction_c} &
\includegraphics[width=3.2in]{FIGURES/heat_conduction_d}
\end{tabular*}
\caption[The {\bf heat\_conduction} test cases.]{Comparison of heat conduction calculations with analytical solutions.}
\label{heat_conduction}
\end{figure}


\clearpage

\section{Temperature-Dependent Thermal Properties (\texorpdfstring{{\bf heat\_conduction\_kc}}{heat\_conduction\_kc})}

This example demonstrates the 1-D heat conduction in cartesian, cylindrical and spherical geometries with temperature-dependent thermal properties.
The cartesian solution was computed using HEATING (version~7.3), a multi-dimensional, finite-difference, general purpose heat transfer
model~\cite{Childs}. The cylindrical and spherical solutions were computed using a commercial finite-element solver, ABAQUS.

The sample of homogenous material is initially at 0~$^\circ$C and at $t>0$ exposed to a gas at 700~$^\circ$C. A fixed heat transfer coefficient of
10~W/m$^2$/K is assumed. The density of the material is 10000~kg/m$^3$. The conductivity and specific heat are functions of temperature with the
following values: $k(0)=0.10$~W/m/K, $k(200)=0.20$~W/m/K, $c(0)=1.0$~kJ/kg/K, $c(100)=1.2$~kJ/kg/K, $c(200)=1.0$~kJ/kg/K. The thickness (radius) of
the sample is 0.01~m. In the cartesian case, the back surface of the material is exposed to a gas at 0~$^\circ$C. In the figure below, the light colored solid
lines are FDS results and the dark lines are the HEATING results. An example input with cylindrical geometry looks like:

\scriptsize
\begin{verbatim}
&MATL ID='MAT_1'
      EMISSIVITY = 0.0
      CONDUCTIVITY_RAMP='K_RAMP'
      SPECIFIC_HEAT_RAMP = 'C_RAMP'
      DENSITY=10000. /

&RAMP ID = 'K_RAMP' T=0,   F= 0.10 /
&RAMP ID = 'K_RAMP' T=100, F= 0.15 /
&RAMP ID = 'K_RAMP' T=200, F= 0.20 /
&RAMP ID = 'C_RAMP' T=0,   F= 1.00 /
&RAMP ID = 'C_RAMP' T=100, F= 1.20 /
&RAMP ID = 'C_RAMP' T=200, F= 1.00 /

&SURF ID='SLAB'
      STRETCH_FACTOR = 1.0
      GEOMETRY = 'CYLINDRICAL'
      MATL_ID='MAT_1'
      THICKNESS=0.01 /
\end{verbatim} \normalsize

\begin{figure}[ht]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{FIGURES/heat_conduction_kc_surf} &
\includegraphics[width=3.2in]{FIGURES/heat_conduction_kc_back}
\end{tabular*}
\caption[The {\bf heat\_conduction\_kc} test case.]{Comparison of heat conduction calculations with a finite-element model.}
\label{heat_conduction_kc}
\end{figure}





\chapter{Pyrolysis}

This chapter tests the routines in FDS that calculate the thermal decomposition of materials. Solid
surfaces can be made up of multiple layers, with each layer consisting of multiple material components.
Each material component may undergo several competing reactions, and
each of these reactions may produce some other solid component
(residue), gaseous fuel, and/or water vapor.


\section{Development of surface emissivity (\texorpdfstring{{\bf emissivity}}{emissivity})}

For thermally thick materials, the surface emissivity is computed as a
mass-weighted sum of the individual values of the emissivity
in the first condensed phase grid cell. In this verification test, the
initial material, having emissivity of 1.0, is converted to another
material, having emissivity of 0.0, at a constant rate of 0.1~s$^{-1}$. As a
result, the surface emissivity should change linearly from 1.0 to 0.0 in 10~s.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=3.5in]{FIGURES/emissivity}
\end{center}
\caption[The {\bf emissivity} test case.]{Testing the emissivity of solid materials.}
\label{emissivity}
\end{figure}



\section{Enthalpy of solid materials (\texorpdfstring{{\bf enthalpy}}{enthalpy})}

Consider a thin plate of conductive material that is exposed on one side to an elevated temperature heat source and exposed on the
other to an ambient temperature void. In the thermally-thin limit, the temperature of the slab is governed by the following equation
\be
   \frac{dT_s}{dt} = \frac{\dq_{\hbox{\tiny front}}'' + \dq_{\hbox{\tiny back}}''}{c_s \, \rho_s \, \delta}
\ee
In this example, the initial exposure to the front side of the slab is
3~kW/m$^2$. The original material (call it A) undergoes a reaction to form material B.  The reaction rate is constant, 0.2~s$^{-1}$, which in this
case means that material A disappears in exactly 5~s. This is achieved by setting $n_s$ and $E$ to 0 and $A$ to 0.2 in the reaction rate term:
\be
    r = \left( \frac{\rho_{s,A}}{\rho_{s0}}\right)^{n_{s}}
    A \; \exp \left(-\frac{E}{RT_s}\right)
\ee
The density and conductivity of both materials are
30~kg/m$^3$ and 10~W/m/K, respectively. The emissivity of front and back is 1.  The specific heat of material A changes from
1.0~kJ/kg/K to 0.1~kJ/kg/K above 80~$^\circ$C, while the specific heat of material B is constant at 1.0~kJ/kg/K. The slab is 1~mm thick.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=3.5in]{FIGURES/enthalpy}
\end{center}
\caption[The {\bf enthalpy} test case.]{Testing the enthalpy of solid materials.}
\label{enthalpy}
\end{figure}

\noindent
Note that the ``analytical'' solution is actually a simple numerical integration of the equations above with a small time step to ensure accuracy.
This example tests a number of features, including the reaction rate, mass weighted specific heats, and radiation boundary conditions. Note that the
convective heat transfer has been turned off, and the correct steady-state temperature is calculated by FDS.


\section{A Simple Two-Step Pyrolysis Example (\texorpdfstring{{\bf two\_step\_solid\_reaction}}{two\_step\_solid\_reaction})}

Before considering actual experimental measurements, it is necessary to check the accuracy of the ordinary differential
equation solver within FDS.
Consider  the simplified set  of ordinary  differential equations  describing the mass
fraction of  three  components of  a  solid material  undergoing thermal
degradation:
\begin{eqnarray}
    \frac{dY_a}{dt} &=&  -K_{ab} Y_a \nonumber  \\
    \frac{dY_b}{dt} &=&   K_{ab} Y_a  -  K_{bc}  Y_b  \\
    \frac{dY_c}{dt} &=&   K_{bc} Y_a
    \nonumber
\end{eqnarray}
where  the  mass  fraction  of  component  $a$  is  1  initially.  The
analytical solution is:
\begin{eqnarray}
    Y_a(t)    &=&    \exp(-K_{ab}t)    \nonumber   \\
    Y_b(t)    &=&    \frac{K_{ab}}{K_{bc}-K_{ab}} \exp(-K_{ab} t)  - \exp(-K_{bc} t) \\
    Y_c(t)    &=&    \left[   K_{ab}    (1-\exp(-K_{bc} t) )    +  K_{bc}*(\exp(-K_{ab} t) -1) \right] / (K_{ab}-K_{bc})
\end{eqnarray}
The analytical and  numerical solution for the parameters $K_{ab} = 0.389$ and $K_{bc} = 0.262$ are shown here:

\begin{figure}[ht]
\begin{center}
\includegraphics[width=3.5in]{FIGURES/two_step_solid_reaction}
\end{center}
\caption[The {\bf two\_step\_solid\_reaction} test case.]{Comparison of a two-step solid pyrolysis calculation with an analytical solution.}
\label{two_step_solid_reaction}
\end{figure}




\clearpage

\section{Interpreting Bench-Scale Measurements}
\label{solid_kinetics}

This section describes a method of determining and applying the values of the kinetic parameters for the thermal
decomposition of a solid, following the methodology described by Lyon~\cite{Lyon:FM2000}.


\subsection{General Theory}

Consider a solid material that is made up of multiple components.
The mass fraction of any component, $Y(t)$, changes in time according to the equation:
\be
   \frac{dY}{dt} = -A \, Y \, \exp \left( -\frac{E}{RT} \right)    \quad ; \quad Y(0) = Y_0  \label{dYdt}
\ee
For bench-scale measurement techniques like TGA (Thermo-Gravimetric Analysis), a small sample of the material is
heated linearly in time at a specified rate, $dT/dt=\beta$. The results are usually expressed as a function of
temperature rather than time; thus, it is convenient to rewrite Eq.~(\ref{dYdt}) as:
\be
   \frac{dY}{dT} = -\frac{A}{\beta} \, Y \, \exp \left( -\frac{E}{RT} \right)    \quad ; \quad Y(T=T_0) = Y_0  \label{dYdT}
\ee
The decomposition rate, $-dY/dt$, peaks at a temperature denoted by $T_p$ with a value denoted by $r_p$.
At this temperature, the second derivative of $Y$ is zero:
\be
   \frac{d^2 Y}{dT^2} = -\frac{A}{\beta} \, \frac{dY}{dT} \, \exp \left( -\frac{E}{RT_p} \right) -
   \frac{A}{\beta} \, Y \, \exp \left( -\frac{E}{RT_p} \right) \, \frac{E}{R T_p^2}
   = -\frac{dY}{dT} \left[ \frac{A}{\beta} \, \exp \left( -\frac{E}{RT_p} \right) - \frac{E}{R T_p^2} \right] = 0  \label{d2YdT2}
\ee
Next, Eq.~(\ref{dYdT}) can be integrated from $Y_0$ to $Y_p$ (the value of $Y$ at the peak), and $T_0$ to $T_p$:
\be
   \int_{Y_0}^{Y_p} \left( \frac{dY'}{Y'} \right) = - \frac{A}{\beta} \int_{T_0}^{T_p} \exp \left( -\frac{E}{RT'} \right) \; dT'
   \approx - \frac{A R T_p^2}{ \beta \, (E+2 R T_p) } \; \exp \left( -\frac{E}{RT_p} \right)
\ee
Using Eq.~(\ref{d2YdT2}) to eliminate $A$ yields:
\be
   \ln \left( \frac{Y_p}{Y_0} \right) = - \frac{E}{E+2 R T_p} \approx -1  \quad \quad (E \gg 2 R T_p)
\ee
or more simply, $Y_p \approx Y_0/e$. Now, the activation energy can be evaluated using Eqs.~(\ref{dYdt}) and (\ref{d2YdT2}):
\be
   E = RT_p^2 \, \frac{A}{\beta} \, \exp \left( -\frac{E}{RT_p} \right) = \frac{RT_p^2}{\beta} \frac{r_p}{Y_p}
   \approx \frac{RT_p^2}{\beta} \frac{e r_p}{Y_0}  \label{E_formula}
\ee
Then $A$ can be evaluated directly from Eq.~(\ref{dYdt}):
\be
   A = \frac{r_p}{Y_p} \, \exp \left( \frac{E}{RT_p} \right) \approx \frac{e r_p}{Y_0} \, \exp \left( \frac{E}{RT_p} \right) \label{A_formula}
\ee
Note that the formulae for $A$ and $E$ are appropriate for multiple-step reactions, where the number of peaks in the reaction
rate curve corresponds to the number of material components, and each component undergoes a single-step reaction that forms
fuel gas and residue.
For each peak, the value of $T_p$ is readily obtained from the plot.
For TGA data, the values of $r_p$ can be obtained directly from inspection of the reaction
rate curve, assuming the units are s$^{-1}$. The values of $Y_0$ can be estimated based on the relative area underneath
the peak.



\subsection{Using Micro-Calorimetry Data (\texorpdfstring{{\bf cable\_11\_mcc}}{cable\_11\_mcc})}
\label{cable_11_mcc}

Add discussion of the micro-calorimeter.

As an example of how to work with MCC data, consider the two plots shown in Fig.~\ref{mcc_plots}. The solid curves in the figures
display the results of micro-calorimetry measurements for the insulation and jacket material of a multi-conductor control
cable (the number 11 has no particular meaning other than to distinguish it from other cables being studied).
\begin{figure}[ht]
\includegraphics[width=3.2in]{FIGURES/cable_11_insulation_mcc}
\includegraphics[width=3.2in]{FIGURES/cable_11_jacket_mcc}
\caption{Results of a micro-calorimetry analysis of a sample of cable insulation (left) and jacket material (right).}
\label{mcc_plots}
\end{figure}
The insulation material exhibits two fairly well-defined peaks, whereas the jacket material exhibits three. Thus, the insulation
material is modeled using two solid components, each undergoing a single-step reaction, plus a solid residue. The jacket
material is modeled using three solid components, plus a residue. The residue yield for the insulation material is
6~\%; for the jacket 49~\%, obtained simply by weighing the sample before and after the micro-calorimetry measurement. It is
not known which reaction produces what fraction of the residue. Rather, it is assumed that each reaction yields the same
residue in the same amount.
The residue yield, denoted $\nu_r$, is very important because the results of the measurement are reported in terms of
the heat release rate {\em per unit mass of the original sample}, {\em i.e.} W/g. The area under the curves in
Fig.~\ref{mcc_plots}, when divided by the heating rate, $\beta$, in units of K/s, represents the total energy released
per unit mass of the original sample. However, if this value is divided by the factor $(1-\nu_r)$, the more conventional
form of the heat of combustion is obtained.

The dashed curves in Fig.~\ref{mcc_plots} are the results of FDS simulations of the MCC measurements. To mimic the
apparatus, a very thin sheet comprised of a mixture of the solid components with an insulated backing is heated at the
rate specified in the experiment (1~K/s or 60~K/min, the units needed in FDS).
For each reaction,
the kinetic parameters are calculated using the formulae (\ref{E_formula}) and (\ref{A_formula}). The values of
$T_p$ are obtained directly from the figures. The value of $r_p/Y_0$ for the $j$th reaction can be found from:
\be
   \left( \frac{r_p}{Y_0} \right)_j = \beta \, \dot{q}(T_{p,j}) \Big/ \int_{T_{j-1}}^{T_j} \dot{q}(T') \, dT'  \label{r_formula}
\ee
where $\dot{q}_{p,j}$ is the value of the $j$th heat release rate peak and the temperature values, $T_j$, are estimates
of the temperature range over which that particular reaction takes place. Note that the temperature ranges ought to be
continuous.
It is important to check the units of all of these quantities because the
results of these experiments are often presented in different ways depending on the particular application. A mistake
in units can result in values of $A$ and/or $E$ that will invariably cause spurious results.

The dashed curves in Fig.~\ref{mcc_plots} are the results of numerically integrating Eq.~(\ref{dYdt}) within FDS for each
material component. A typical input line for FDS that describes a single material component undergoing a single
reaction is given by:

\footnotesize
\begin{verbatim}
&MATL ID                    = 'COMP A'
      EMISSIVITY            = ...
      DENSITY               = ...
      CONDUCTIVITY          = ...
      SPECIFIC_HEAT         = ...
      N_REACTIONS           = 1
      REFERENCE_TEMPERATURE = 300.
      REFERENCE_RATE        = 0.0064
      HEATING_RATE          = 60.
      NU_RESIDUE            = 0.49
      RESIDUE               = 'char'
      NU_FUEL               = 0.51
      HEAT_OF_REACTION      = ... /
\end{verbatim} \normalsize

\noindent Note that only the relevant parameters are shown. The other parameters are not relevant in this
exercise. Table~\ref{cable_parameters} lists all of the kinetic parameters for the cable insulation and jacket
materials. The peak temperatures are easy to estimate, and the values of $r_p/Y_0$ can be fine-tuned to closely match
the data. Note that it is possible to compute values of $A$ and $E$ and input them directly into FDS, rather
than inputting those listed in the table. However, the values of $A$ and $E$ are fairly large numbers and have little
meaning in their own.


\begin{table}[ht]
\begin{center}
\caption{Parameters used to derive the kinetic constants for cable materials. The heating rate for both is
60~$^\circ$C/min.}
\label{cable_parameters}
\begin{tabular}{|l||c|c||c|c|c|}
\hline
Parameter               & \multicolumn{2}{|c|}{Insulation, $\nu_r$=0.06 }  &  \multicolumn{3}{|c|}{Jacket, $\nu_r$=0.49} \\ \cline{2-6}
                        & 1             & 2                 &  1        & 2         & 3              \\ \hline \hline
$T_p$ ($^\circ$C)       & 355           & 485               &  300      & 345       & 450            \\ \hline
$r_p/Y_0$ (s$^{-1}$)    & 0.0384        & 0.2426            &  0.0064   & 0.3500    & 0.0156         \\ \hline
\end{tabular}
\end{center}
\end{table}


\subsection{Using TGA Data (\texorpdfstring{{\bf birch\_tga}}{birch\_tga})}
\label{birch_tga}

This is an example of a comparison of a candidate solid phase model with TGA (Thermo-gravimetric Analysis) data. The sample cases
called {\bf birch\_tga\_1step\_2} and {\bf birch\_tga\_1step\_20} simulate two standard TGA experiments in which small samples of birch wood are heated up slowly at constant
rates of 2~$^\circ$C/min and 20~$^\circ$C/min, respectively. The model of the wood only involves one reaction that converts virgin wood to char and fuel gases. There is
also a reaction in the simulation that does nothing more than evaporate the small amount of moisture in the wood. This evaporation is evident in
Fig.~\ref{fig_birch_tga} near the temperature of 100~$^\circ$C.

\begin{figure}[ht]
   \begin{center}
      \includegraphics[width=3.5in]{FIGURES/birch_tga}
      \caption[An example of TGA data.]{\label{fig_birch_tga}
    Comparison of a solid phase model of birch wood with TGA data.}
   \end{center}
   \end{figure}





\chapter{Droplets}


\section{Water Droplet Evaporation (\texorpdfstring{{\bf water\_evaporation}}{water\_evaporation}) }
\label{water_evaporation}

The test case called {\bf water\_evaporation} involves stationary
water droplets in a box with dimensions of 1~m on a side. The walls of the box
are assumed adiabatic, meaning that there are no leaks or heat losses. The air
within the box is stirred to maintain uniform conditions. Initially, the air temperature is 20~$^\circ$C,
the median volumetric diameter of the droplets is 100~$\mu$m,
the water temperature is 90~$^\circ$C, and the total mass of water droplets is 0.2~kg.
It is expected that a steady-state will be achieved after about 5~s.
Figure~\ref{water_evaporation_plots} displays the average enthalpy, humidity, density, pressure, temperature and mass of water of the gas. The horizontal lines denote the
expected initial and steady-state values, respectively.
The plot of enthalpy includes the gas (reference temperature is 0~K) and the liquid water droplets (reference temperature is 0~$^\circ$C).
The decrease in the enthalpy of the water droplets should equal the increase in the enthalpy of the gas minus the work performed due to increasing pressure. It is the internal
energy of the system that is conserved. The internal energy can be expressed in terms of the enthalpy, pressure and density:
\be e = h - \frac{p}{\rho} \ee
In differential form:
\be de = dh - \frac{1}{\rho} \; dp - p \; d \left(\frac{1}{\rho} \right) = dh - v \; dp - p \; dv \ee
Multiplying by mass and noting that the volume, $V$, is constant yields:
\be dE = dH - V \; dp \ee
The enthalpy decrease of the liquid water droplets is equal to the enthalpy gain of the gas (both expressed in kJ) minus the pressure increase times the volume in units of kPa
and m$^3$, respectively.
Finally, note that in this example that a water droplet will evaporate until the vapor pressure at the droplet surface is in equilibrium with the vapor pressure in the surrounding air. Thus, the relative humidity should be equal to 100~\%, but since FDS does not currently compute condensation, a slight overshoot is not unexpected.

\begin{figure}[ht]
\noindent
\begin{tabular*}{\textwidth}{l@{\extracolsep{\fill}}r}
\includegraphics[width=3.2in]{FIGURES/water_evaporation_enthalpy} &
\includegraphics[width=3.2in]{FIGURES/water_evaporation_humidity} \\
\includegraphics[width=3.2in]{FIGURES/water_evaporation_density} &
\includegraphics[width=3.2in]{FIGURES/water_evaporation_temperature} \\
\includegraphics[width=3.2in]{FIGURES/water_evaporation_pressure} &
\includegraphics[width=3.2in]{FIGURES/water_evaporation_water_mass}
\end{tabular*}
\caption[Sample case {\bf water\_evaporation}.]{Output of the test case called {\bf water\_evaporation}.}
\label{water_evaporation_plots}
\end{figure}








\bibliography{../Bibliography/FDS_refs,../Bibliography/FDS_general,../Bibliography/FDS_mathcomp}


\end{document}
