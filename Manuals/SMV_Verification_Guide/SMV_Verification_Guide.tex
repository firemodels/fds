% $Date$
% $Revision$
% $Author$

\documentclass[11pt,twoside]{book}

%% include commands for bios, titles etc used in multiple documents
\input{../Bibliography/commoncommands}

%\doublespace
\begin{document}

\bibliographystyle{unsrt}
\pagestyle{empty}

\newcommand{\pxtone}{ \frac{\partial x_m}{\partial T_1} }
\newcommand{\pxttwo}{ \frac{\partial x_m}{\partial T_2} }
\newcommand{\pxalpha}{ \frac{\partial x_m}{\partial \alpha} }
\newcommand{\palphatone}{ \frac{\partial \alpha}{\partial T_1} }
\newcommand{\palphattwo}{ \frac{\partial \alpha}{\partial T_2} }
\newcommand{\figoptions}{hbp}

%
% ----------------------  first cover/title page --------------------------
%
\begin{minipage}[t][9in][s]{6.5in}

\huge
\flushright{NIST Special Publication 1017-3}


\vspace{1in}

\Huge
\flushright{Smokeview (Version 6) - A Tool for \\
Visualizing Fire Dynamics Simulation Data\\
Volume III: Verification Guide
}

\vspace{.5in}
\normalsize
\flushright{Glenn P. Forney}

\vfill

%\flushright{\includegraphics[width=4.0in]{FIGURES/nistlogo_1line}}
\flushright{\includegraphics[width=2.in]{FIGURES/nistident_flright_vec}}
\end{minipage}

\newpage

\hspace{5in}
\newpage

%
% ----------------------  second cover/title page --------------------------
%
\begin{minipage}[t][9in][s]{6.5in}

\huge
\flushright{NIST Special Publication 1017-3}

\vspace{1.in}

\Huge
\flushright{Smokeview (Version 6) - A Tool for \\
Visualizing Fire Dynamics Simulation Data\\
Volume III: Verification Guide
}

\vspace{.5in}

\normalsize
\flushright{Glenn P. Forney\\
%\includegraphics[width=1in]{FIGURES/bfrl}  \\
{\em Fire Research Division} \\
{\em Engineering Laboratory}  \\
}

\vspace{.25in}


\flushright{\today \\
Smokeview Version 6 \\
\emph{SVN Repository}~$Revision$}
%
\vfill

\flushright{\includegraphics[width=1in]{FIGURES/doc} }

\titlesigs

\end{minipage}


\date{}

\setlength{\parindent}{0.25in}

\newpage

\begin{minipage}[t][9in][s]{6.5in}


\flushright{Certain commercial entities, equipment, or materials may be identified in this \\
document in order to describe an experimental procedure or concept adequately. Such \\
identification is not intended to imply recommendation or endorsement by the \\
National Institute of Standards and Technology, nor is it intended to imply that the \\
entities, materials, or equipment are necessarily the best available for the purpose.
}

\vspace{3in}


\vspace{3in}

\large
\flushright{\bf National Institute of Standards and Technology Special Publication 1017-3 \\
Natl.~Inst.~Stand.~Technol.~Spec.~Publ.~1017-3, 78 pages (March 2013) \\
CODEN: NSPUE2 }

\vfill

\flushright{U.S. GOVERNMENT PRINTING OFFICE \\
WASHINGTON: 2013 \\
\rule{3.5in}{0.01in} \\
For sale by the Superintendent of Documents, U.S. Government Printing Office \\
Internet: bookstore.gpo.gov -- Phone: (202) 512-1800 -- Fax: (202) 512-2250 \\
Mail: Stop SSOP, Washington, DC 20402-0001 }

\end{minipage}


\frontmatter

\pagestyle{plain}

%---------------------------------------------------------------------------------
%------------------------ Preface ------------------------------------------------
%---------------------------------------------------------------------------------

\chapter{Preface}

Smokeview is a software tool designed to visualize numerical calculations generated by fire models such as the Fire Dynamics Simulator (FDS), a computational fluid dynamics (CFD) model of fire-driven fluid flow or the Consolidated Fire and Smokeview Transport (CFAST) model, a zone fire model. This Guide is Volume 3 of the Smokeview Reference Guides. This guide presents a series of images derived from FDS and Smokeview.  The intent is to to verify that the algorithms used by Smokeview for visualizing data are implemented correctly.  These images are generated automatically through the use of scripts by first running FDS on a series of input cases and then running Smokeview, again using a set of scripts.  The correctness of Smokeview may then be verified more easily as FDS and Smokeview are updated since the reference figures in this document may be generated simply and automatically.

Smokeview and associated documentation for Windows, Linux and Mac OS X may be downloaded from  {\bf \hhref{http://fire.nist.gov/fds}} .

%---------------------------------------------------------------------------------
%------------------------ About the Author ---------------------------------------
%---------------------------------------------------------------------------------

\chapter{About the Author}
\begin{description}
\gforneybio
\end{description}

%---------------------------------------------------------------------------------
%------------------------ Disclaimer ---------------------------------------------
%---------------------------------------------------------------------------------

\chapter{Disclaimer}

The US Department of Commerce makes no warranty, expressed or implied, to users of Smokeview, and accepts no responsibility for its use. Users of Smokeview assume sole responsibility under Federal law for determining the appropriateness of its use in any particular application; for any conclusions drawn from the results of its use; and for any actions taken or not taken as a result of analysis performed using this tools.

Smokeview and the companion program FDS is intended for use only by those competent in the fields of fluid dynamics, thermodynamics, combustion, and heat transfer, and is intended only to supplement the informed judgment of the qualified user. These software packages may or may not have predictive capability when applied to a specific set of factual circumstances. Lack of accurate predictions could lead to erroneous conclusions with regard to fire safety. All results should be evaluated by an informed user.

Throughout this document, the mention of computer hardware or commercial software does not constitute endorsement by NIST, nor does it indicate that the products are necessarily those best suited for the intended purpose.

\cleardoublepage
\tableofcontents
\cleardoublepage

% KEVIN -- consider standardizing the figure captions so that this table is more meaningful.
% GLENN -- figure captions should be clearer now

\listoffigures

\mainmatter

\pagenumbering{arabic}

%
% .............. new section ..............................
%
%\pagestyle{fancy}
%\newcounter{picno}
%\setcounter{picno}{24}
%\newcounter{picnoe}
%\setcounter{picnoe}{24}
%\fancyhead{} \fancyfoot[RO] {
% \setlength{\unitlength}{1mm}
% %\stepcounter{picno}
% \addtocounter{picno}{-1}
% \begin{picture}(0,0)
%   \put(-15,0){
%     \epsfig{height=1.125in,figure=FIGURES/movies/tankfarm_\number\value{picno}.eps}
%   }
% \end{picture}
%}
%
%\fancyfoot[LE]
%{
%  \setlength{\unitlength}{1mm}
%  %\stepcounter{picnoe}{-1}
%  \addtocounter{picnoe}{-1}
%  \begin{picture}(0,0)
%    \put(-15,0){
%      \epsfig{height=1.25in,figure=figures/movies/townhouse3_\number\value{picnoe}.eps}
%    }
%  \end{picture}
%}
%\renewcommand{\headrulewidth}{0.0pt}
%\renewcommand{\footrulewidth}{0.0pt}
%\renewcommand{\footskip}{1.5in}

%---------------------------------------------------------------------------------
%------------------------ Overview ----------------------------------------
%---------------------------------------------------------------------------------
\chapter{Overview}
Smokeview is a scientific software tool designed to visualize numerical predictions generated by fire models such as the Fire Dynamics Simulator (FDS), a computational fluid dynamics (CFD) model of fire-driven fluid flow~\cite{FDS_Math_Guide,FDS_Users_Guide} or the Consolidated Fire and Smoke Transport (CFAST) model, a zone model of compartment fire phenomena~\cite{Jones:2004A}. The feature set and user interface for Smokeview is complex making it difficult to adequately test all of its features manually.  A scripting capability has been added to Smokeview to solve this problem. Many of Smokeview's features may now be run without user intervention through the use of scripts.  A script is simply a text file containing one or more commands.  Smokeview when {\em requested}\ by the user reads in this script and performs the actions listed. Some of these actions are loading data files, setting view points, setting times and most importantly rendering images.  By designing a set of scenarios and corresponding images that demonstrate Smokeview's feature set, one may test Smokeview simply by (1) running one master script file that generates all of the images found in this document and (2) examining these images to ensure that Smokeview is working as expected.

This document then verifies that various Smokeview features are working as intended by presenting a series of  FDS simulation results in the form of Smokeview images.  These images are generated using the various visualization features of Smokeview such as tracer particles, 2D or 3D contours, or realistic smoke.

{\em Verification} in the context of Smokeview is a process to check the correctness of the visualization.  Verification does not imply that the underlying data is correct, only that the data is presented or visualized correctly. A separate document, the FDS Verification Guide~\cite{FDS_Verification_Guide}, describes the verification process of FDS.  One set of scripts is used to run FDS cases and a second set of scripts is used by Smokeview to generate images.  The verification process then becomes much easier to accomplish since the use of scripts (i.e., non-manual methods) guarantees that consistent figures (same view points, same time points, same data files loaded, etc.) are produced as new versions of this verification document are generated using updated versions of FDS and/or Smokeview.  Another way of looking at this verification process is to consider this document and the FDS Verification Guide~\cite{FDS_Verification_Guide} as being a {\em  live}\ (not a static) document, easily updated as algorithms in FDS and/or Smokeview are enhanced and improved.

Details on setting up and running FDS cases may be found in the FDS User's Guide~\cite{FDS_Users_Guide}. Details on visualizing FDS simulated data using Smokeview may be found in the Smokeview User's Guide~\cite{Smokeview_Users_Guide}.  Details on some of the technical aspects used to implement algorithms in Smokeview may be found in the Smokeview Technical Guide~\cite{Smokeview_Tech_Guide}.

The FDS version used to run the cases illustrated  in this document is \lstinputlisting{../SMV_User_Guide/SCRIPT_FIGURES/fds.version}

The Smokeview version used to generate the verification figures in this document is \lstinputlisting{../SMV_User_Guide/SCRIPT_FIGURES/smokeview.version}

FDS generated data is presumed to be correct.  FDS has its own set of verification cases to test the correctness of the data. The purpose of the cases used here is to confirm that data is drawn or visualized correctly. In particular, these cases confirm that correct files are loaded, data is scaled and drawn correctly, geometry is drawn correctly, etc.   Three types of verification cases are presented. The first set are the most important. Those cases verify that data is drawn correctly.  The second set of cases verify that various geometric elements are drawn correctly and the third set verifies that the various options and underlying features are implemented and perform properly.

The FDS input files used for the verification cases are documented in Appendix \ref{fdsinputfiles}.  The Smokeview scripts used to generate the verification figures are documented in Appendix \ref{smvscripts}.  Note that these input files and scripts are located in the FDS Subversion (SVN) repository.  In fact, the entries in the appendices are included directly from the repository, and will therefore be up to date as this document is regenerated.


%---------------------------------------------------------------------------------
%------------------------ Visualization Test Cases %---------------------------------------------------------------------------------

\newcommand{\figheightH}{3.75in}
\newcommand{\figheightD}{2.75in}
\newcommand{\figheightE}{2.5in}
\newcommand{\figheightF}{2.25in}
\newcommand{\figheightG}{1.5in}
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}}

\chapter{Data File Tests}

\begin{figure}[\figoptions]
\begin{center}
\includegraphics[height=3.0in]{SCRIPT_FIGURES/plume5c_bounddef_init}
\end{center}
\caption{The temperatures in the plume5c.fds case are initialized to \SI{600}{\degreeCelsius} within the region outlined in blue.}
\label{figbounddef}%
\end{figure}

The tests in this chapter verify whether visualization types such as surface contours (boundary files), isosurfaces, particles, slice files, 3D smoke files and PLOT3D files are working as intended.  These verification tests all use the same FDS input file, {\tt plume5c.fds} (see Appendix~\ref{FDSplume5c}), to generate the simulation data.  The case models a simple fire plume with two blockages.  The upper blockage is initialized to \SI{600}{\degreeCelsius}.   The lower blockage is initialized to \SI{20}{\degreeCelsius}.  The gas phase is initialized to \SI{600}{\degreeCelsius} within an interior region colored blue as illustrated in Figure~\ref{figbounddef} and \SI{20}{\degreeCelsius} everywhere else.  This is done in order to verify that a known temperature is converted to the proper color (as shown in the color bar).

The verification figures are generated automatically using the Smokeview script file, {\tt plume5c.ssf} (see Appendix \ref{SSFplume5c}).  The use of scripting allows the figures and hence this document to be updated easily as changes are made in FDS, Smokeview or the FDS input data files.  This allows the verification process to be ongoing.

\clearpage

\section{Surface contours (Boundary Files)}
Figure \ref{figboundtest} presents images verifying the display of surface contours or boundary file data. A series of boundary file images are drawn at \SI{2}{s}\ (approximately), \SI{10}{s}\ and \SI{30}{s}\ seconds. The temperature of the upper obstacle is initialized to \SI{600}{\degreeCelsius} hence the red colors for the $t=\SI{0}{s}$ images. The first column of images colors data at cell nodes using temperatures averaged at surrounding cell centers.  The second column of images colors data using data values at cell centers.

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{cccl}
\includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_bound_00} &
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_bound_chop_00} &
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_bound_cell_00}\\
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_bound_10}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_bound_chop_10}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_bound_cell_10}\\
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_bound_30}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_bound_chop_30}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_bound_cell_30}\\
cell averaged  data&chopped data&cell centered data\\
 &&&\raisebox{0.0in}[0pt]{\includegraphics[height=7.0in]{FIGURES/colorbar_20_620}}\\
  \end{tabular}
\end{center}
\caption[Boundary file test of shaded and chopped
contours]{Boundary file test of shaded and chopped contours at \SI{2}{s}, \SI{10}{s} and \SI{30}{s}. The
upper obstacle is initialized to \SI{600}{\degreeCelsius} and should be red
for the $t\approx\SI{2}{s}$ images. For the chopped contours, the
color near the chop boundary should match the color near
\SI{140}{\degreeCelsius} in the colorbar.}
\label{figboundtest}%
\end{figure}

\clearpage

\section{Iso-surfaces}
An isosurface is a three-dimensional surface that defines constant values of a dependent variable. Figures \ref{figisotest} and \ref{figisotest2} present images verifying the display of isosurfaces. A series of temperature isosurfaces are drawn at \SI{0}{s}, \SI{10}{s} and \SI{30}{s}.  A portion of the interior gas temperature is initialized to \SI{600}{\degreeCelsius}, hence.  This is the reason that the rectangular block appears in the first row of images. The first column in Figure \ref{figisotest}\ presents the iso-surface using points. The second column presents the iso-surface using triangulated outlines. The third column presents the iso-surface using a solid surface. Figure \ref{figisotest2} demonstrates color customization using the {\tt ISOCOLORS}\ .ini keyword.

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{ccc}
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_iso_points_00}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_iso_outline_00}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_iso_solid_00}\\
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_iso_points_10}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_iso_outline_10}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_iso_solid_10}\\
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_iso_points_30}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_iso_outline_30}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_iso_solid_30}\\
 point view&outline view&solid view
  \end{tabular}
\end{center}
 \caption[A test showing an isosurface enclosing a region initialized to \SI{600}{\degreeCelsius}]{A test showing an isosurface enclosing a region initialized to \SI{600}{\degreeCelsius} at \SI{0}{s}, \SI{10}{s} and \SI{30}{s}.
The isosurface should surround this region for the $t=\SI{0}{s}$
images.}
\label{figisotest}%
\end{figure}

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{cc}
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_iso_solid_30}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_iso2_solid_30}\\
 solid view - orange&solid view - blue
  \end{tabular}
\end{center}
 \caption[A test showing isosurfaces colored orange and blue using the ISOCOLORS .ini keyword.]{A test showing isosurfaces colored orange and blue using the ISOCOLORS .ini keyword at \SI{30}{s}.  The two isosurfaces are colored orange and blue using the ISOCOLORS .ini keyword.}
\label{figisotest2}%
\end{figure}

\clearpage

\subsection{Sensitivity Analysis}
\begin{figure}[\figoptions]
\begin{center}
\includegraphics[height=3.0in]{FIGURES/linear_interpolationiso}
\end{center}
 \caption{A portion of an iso-surface defined by $f(x,y,z)=T_m$ (for some arbirtrary function $f$)  crossing a line segment at the point $(x_m,y,z)$.
  }
\label{figisointerpiso}%
\end{figure}

Given that data used to generate an isosurface has uncertainty, an important question to consider is how sensitive is the isosurface location to uncertainty in the data used to define it? Figure \ref{figisointerpiso} shows a portion of an iso-surface, $f(x,y,z)=T_m$, passing through a line segment at $(x_m,y,z)$. The line segment is defined by endpoints $(x_1,y,z)$ and $(x_2,y,z)$.  The key step in constructing an isosurface is solving an inverse interpolation problem.   That is, determining the location, $(x_m,y,z)$, between two grid nodes, $(x_1,y,z)$ and $(x_2,y,z)$, where interpolated data takes on a particular value (the isosurface level, $T_m$, being constructed).

\begin{figure}[\figoptions]
\begin{center}
\includegraphics[height=3.0in]{FIGURES/linear_interpolation}
\end{center}
\caption[Diagram setting up an inverse linear interpolation calculation]{Diagram setting up an inverse linear interpolation calculation.  The dependent data values $T_1$ and $T_2$ are known at locations $x_1$ and $x_2$. The inverse interpolation problem is to find the location $x_m$ that has value $T_m$. This is found noting that $(x_m-x_1)/(x_2-x_1)=(T_m-T_1)/(T_2-T_1)$.
 }
\label{figisointerp}%
\end{figure}

Suppose, as illustrated in Figure \ref{figisointerp}, that $(x_1,y,z)$, $T_1$ and $(x_2,y,z)$, $T_2$ represent two known data location, data value pairs and that $T_m$ is also known satisfying $T_1\le T_m \le T_2$.  The inverse interpolation problem then is to find the location $(x_m,y,z)$ that takes on the data value $T_m$.  The location $x_m$ is given by
\begin{eqnarray}
x_m=(1-\alpha)x_1+\alpha x_2
\end{eqnarray}
where
\begin{eqnarray}
\alpha=\frac{T_m-T_1}{T_2-T_1}
\end{eqnarray}

\noindent The sensitivity of $x_m$ due to a change $\Delta T_1$ in $T_1$ and to a change $\Delta T_2$ in $T_2$ is given by
\begin{eqnarray}
\Delta x_m= \pxtone \Delta T_1 + \pxttwo \Delta T_2
\label{eq:sensitivity}
\end{eqnarray}
where
\begin{eqnarray}
\pxtone&=&\pxalpha\palphatone \label{eq:sensfirst}\\
\pxttwo&=&\pxalpha\palphattwo
\end{eqnarray}
and
\begin{eqnarray}
\pxalpha&=&x_2-x_1\\
\palphatone&=&\frac{T_m-T_2}{(T_2-T_1)^2}\\
\palphattwo&=&-\frac{T_m-T_1}{(T_2-T_1)^2}
\label{eq:senslast}
\end{eqnarray}
Equation (\ref{eq:sensitivity}) may be re-written using terms in equations (\ref{eq:sensfirst}) through (\ref{eq:senslast}) to obtain
\begin{eqnarray}
\frac{\Delta x_m}{x_2-x_1}&=&\frac{T_m-T_2}{(T_2-T_1)^2}\Delta T_1-
\frac{T_m-T_1}{(T_2-T_1)^2}\Delta T_2
=-\left(
(1-\alpha)\frac{\Delta T_1}{T_2-T_1}+
\alpha\frac{\Delta T_2}{T_2-T_1}\right)
\label{eq:sensfinal}
\end{eqnarray}

\noindent Equation (\ref{eq:sensfinal}) relates the relative error of $x_m$ to the relative errors of $T_1$ and $T_2$ in terms of the interpolation parameter $\alpha$. The error $\Delta x_m$ may then be bounded to obtain
\begin{eqnarray}
|\Delta x_m|\le
|x_2-x_1|\frac{\max(|\Delta T_1|,|\Delta T_2|)}{|T_2-T_1|}
\end{eqnarray}
\noindent Uncertainty in isosurface location is then proportional to the magnitude of data uncertainty, $\max(|\Delta T_1|,|\Delta T_2|)$, and inversely proportional to the data variation, $|T_2-T_1|$.


\clearpage

\section{Particles}

Figure \ref{figparttest} presents images verifying the display of particles and streaks. Images are drawn at \SI{1}{s}, \SI{10}{s} and \SI{30}{s}. The first column shows particles while the second and third columns shows streaks with duration \SI{0.5}{s} and \SI{1}{s}. Streaks are a good way of visualizing motion in a still image (i.e., on paper) since the streak shows a history of where the particle has been.

\begin{figure}[\figopt
ions]
\begin{center}
\begin{tabular}{ccc}
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_part_01}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_part_streak_01}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_part_streak2_01}\\
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_part_10}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_part_streak_10}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_part_streak2_10}\\
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_part_30}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_part_streak_30}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_part_streak2_30}\\
 points&\SI{0.5}{s} streaks&\SI{1}{s} streaks\\
  \end{tabular}
\end{center}
 \caption[A test showing particles and particle streaks]{A test showing particles and particle streaks at \SI{1}{s}, \SI{10}{s} and \SI{30}{s}}
\label{figparttest}%
\end{figure}


\clearpage

\section{Slices}
Figure \ref{fignodeslicetest} presents images verifying the display of node centered data slices. Images are drawn at \SI{0}{s}, \SI{10}{s} and \SI{30}{s}. A portion of the interior gas temperature is initialized to \SI{600}{\degreeCelsius} corresponding to the red rectangular block appearing in the first row. The first column visualizes all of the data in the slice.  The second column discards or chops data below \SI{140}{\degreeCelsius}. Note that the color near the chopped boundary should match the color in the color bar near \SI{140}{\degreeCelsius}.

Figures \ref{figcellaslicetest} and \ref{figcellbslicetest} present images verifying the display of cell centered data. Images in Figure \ref{figcellaslicetest} are drawn at \SI{0}{s}, \SI{10}{s} and \SI{30}{s}. Images in Figure \ref{figcellbslicetest} tests the transfer of data from FDS to Smokeview.

Figure \ref{figvslicetest} present images verifying the display of vector slices. Again, vector slice file images are drawn at \SI{0}{s}, \SI{10}{s} and \SI{30}{s}. The first column draws all vectors while the second column discards or chops vectors below \SI{140}{\degreeCelsius}.

Figure \ref{figfedslicetest} presents slice file images verifying the computation of fractional effective dose (FED).  FED is a measure of human incapacitation or hazard due to combustion gases\cite{SFPE:Purser}. Images are drawn at \SI{30}{s}, \SI{60}{s} and \SI{120}{s} and \SI{240}{s}. The FED is computed using three data slices with concentration of $1000~\mathrm{ppm}$ for $\mathrm{CO}$ and volume fractions of 0.02 and 0.07 for $\mathrm{CO_2}$ and $\mathrm{O_2}$ respectively. These values result in FED values of 1.5 at \SI{30}{s}, 3.0 at \SI{60}{s}, 6.0 at \SI{120}{s} and 12.0 at \SI{240}{s}.

Figure \ref{figgslicetest} presents images of 3D slices oriented in two different ways. Images are drawn at \SI{0}{s}, \SI{10}{s} and \SI{30}{s}.

Figure \ref{figdiffslicetest} presents images from data differenced by Smokediff.  Smokediff computed the difference between two similar FDS cases and generated slice files. Difference contours from these slice files are displayed at \SI{0}{s}, \SI{10}{s} and \SI{15}{s}.


\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{cccp{1.0in}}
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_slice_00}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_slice_chop_00}\\

 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_slice_10}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_slice_chop_10}\\

 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_slice_30}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_slice_chop_30}\\

 node centered data&node centered chopped data\\
&&\raisebox{0.5in}[0pt]{\includegraphics[height=7.5in]{FIGURES/colorbar_20_620}}\\
 \end{tabular}
\end{center}
 \caption[A test showing shaded and chopped contours of node centered slice file data]{A test showing shaded and chopped contours of node centered slice file data at \SI{0}{s}, \SI{10}{s} and \SI{30}{s}.  A portion of the interior gas temperature is initialized to \SI{600}{\degreeCelsius}.  The slice file in this region should be red for the $t=\SI{0}{s}$ images.  For the chopped contours, the color near the chop boundary should match the color near \SI{140}{\degreeCelsius} in the colorbar.}
\label{fignodeslicetest}%
\end{figure}

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{cccp{1.0in}}
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_slice_cell_00}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_slice_cellchop_00}\\

 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_slice_cell_10}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_slice_cellchop_10}\\

 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_slice_cell_30}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_slice_cellchop_30}\\

 cell centered data&cell centered chopped data\\
 &&\raisebox{0.5in}[0pt]{\includegraphics[height=7.5in]{FIGURES/colorbar_20_620}}\\
 \end{tabular}
\end{center}
 \caption[A test showing shaded and chopped contours of cell centered slice file data]{A test showing shaded and chopped contours of cell centered slice file data at \SI{0}{s}, \SI{10}{s} and \SI{30}{s}.  A portion of the interior gas temperature is initialized to \SI{600}{\degreeCelsius}.  The slice file in this region should be red for the $t=\SI{0}{s}$ images.  For the chopped contours, the color near the chop boundary should match the color near \SI{140}{\degreeCelsius} in the colorbar.}
\label{figcellaslicetest}%
\end{figure}

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{cc}

 \includegraphics[width=2.55in]{SCRIPT_FIGURES/cell_test_z}&
 \includegraphics[width=2.75in]{SCRIPT_FIGURES/cell_test_3D}\\

 a) plan view (top slice)&
 b) 3D view\\
 \vspace{0.01in}\\
 \includegraphics[width=2.55in]{SCRIPT_FIGURES/cell_test_y}&
 \includegraphics[width=3.4in]{SCRIPT_FIGURES/cell_test_x}\\
  c) elevation view (front slice)&
  d) side view (right slice)\\
\end{tabular}
\end{center}
 \caption[A test to demonstrate that cell centered slice file  data is transferred from FDS to Smokeview properly.]{A test to demonstrate that cell centered slice file  data is transferred to Smokeview properly.  Cell values are initialized in FDS to $100*i + 10*j + k$ where $1\le i \le 3$, $1\le j \le 4$ and $1\le k \le 5$.  Cell values displayed should match the $(i,j,k)$ grid cell indices.  The three plots in the 3D view correspond to the plan, elevation and side view plots.}
\label{figcellbslicetest}%
\end{figure}

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{ccl}
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_vslice_00}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_vslicechop_00}\\
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_vslice_10}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_vslicechop_10}\\
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_vslice_30}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_vslicechop_30}\\
 &data chopped below \SI{140}{\degreeCelsius}\\
 &&\raisebox{0.5in}[0pt]{\includegraphics[height=7.5in]{FIGURES/colorbar_20_620}}\\

 \end{tabular}
\end{center}
 \caption[A test showing vector slice file data] {A test showing vector slice file data  at \SI{1}{s}, \SI{10}{s} and \SI{30}{s}. A portion of the interior gas temperature is initialized to \SI{600}{\degreeCelsius}.  The vectors in this region should be red for the $t=\SI{0}{s}$ images. For the chopped contours, the color near the chop boundary should match the color near \SI{140}{\degreeCelsius} in the colorbar.}
\label{figvslicetest}%
\end{figure}

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{ccp{1.0in}}
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/fed_test_030}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/fed_test_060}\\
SI{30}{s}, FED=0.29&\SI{60}{s}, FED=0.59\\
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/fed_test_120}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/fed_test_360}\\
\SI{120}{s}, FED=1.2&3\SI{60}{s}, FED=3.5\\
&&\raisebox{0.25in}[0pt]{\includegraphics[height=5.5in]{../SMV_User_Guide/FIGURES/colorbar_fed}}
 \end{tabular}
\end{center}
 \caption[A test showing cell centered FED slice file data]{A test showing cell centered FED slice file data.  These contours were generated using $\mathrm{CO}$, $\mathrm{CO_2}$ and $\mathrm{O_2}$ data slices. }
\label{figfedslicetest}%
\end{figure}

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{cccp{1.0in}}
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_gslice_00}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_gslice2_00}\\

 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_gslice_10}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_gslice2_10}\\

 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_gslice_30}&
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_gslice2_30}\\

 general orientation&second orientation\\
 &&\raisebox{0.5in}[0pt]{\includegraphics[height=7.5in]{FIGURES/colorbar_20_620}}\\
 \end{tabular}
\end{center}
 \caption[A test showing arbitrarily oriented slice file planes generated from 3D slice files]{A test showing arbitrarily oriented slice file planes generated from 3D slice files at \SI{0}{s}, \SI{10}{s} and \SI{30}{s}.  Two orientations are shown at three time steps. }
\label{figgslicetest}%
\end{figure}

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{cp{1.0in}}
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_diff_slice_00}\\
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_diff_slice_10}\\
 \includegraphics[height=\figheightE]{SCRIPT_FIGURES/plume5c_diff_slice_30}\\
&\raisebox{0.5in}[0pt]{\includegraphics[height=7.5in]{FIGURES/colorbar_tempdiff}}\\
 \end{tabular}
\end{center}
 \caption[A test showing slice contours generated by differencing two cases with smokediff]{A test showing slice contours generated by differencing two cases with smokediff  at \SI{0}{s}, \SI{10}{s} and \SI{30}{s}.}
\label{figdiffslicetest}%
\end{figure}


\clearpage

\section{3D Smoke}

Figure \ref{figsmoketest} presents images verifying the display of 3D smoke and fire (heat release rate per unit volume or HRRPUV). A series of 3D smoke images are drawn at \SI{1}{s}, \SI{10}{s} and \SI{30}{s}.  The images contain semi-transparent slices derived from both soot density and HRRPUV data.

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{ccc}
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_smoke_01}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_smoke_10}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_smoke_30}
\end{tabular}
\end{center}
 \caption{A test showing 3D smoke drawn at  at \SI{1}{s}, \SI{10}{s} and \SI{30}{s}}
\label{figsmoketest}%
\end{figure}


\clearpage

\section{Plot3D}

Figure \ref{figPLOT3Dtest} presents images verifying the display of PLOT3D contours. Three types of contours are available for visualizing PLOT3D data: stepped, continuous and narrow band.  This figure shows stepped and continuous contours. Figure \ref{figPLOT3Dtestvalue} shows stepped contours in at four positions along the y axis. Figure \ref{figPLOT3Dtestline} shows narrow band contours at four positions front to back. Figure \ref{figPLOT3Dtestvector} shows velocity vectors at the same four positions as in Figure \ref{figPLOT3Dtestvalue}. Figure \ref{figPLOT3Dtestiso} shows PLOT3D iso-surfaces for \SI{50}{\degreeCelsius}, \SI{230}{\degreeCelsius}, \SI{410}{\degreeCelsius} and \SI{590}{\degreeCelsius}.

%(KEVIN -- I don't see the line contours)
%GLENN I added a line contour figure (technically not a line contour, I changed how smokeview draws line contours, I take a regular color contour and make portions of it transparent except for a series of solid equally spaced lines)


%KEVIN -- what about all the other PLOT3D images?
%KEVIN -- draw vector plots with longer or clear lines. Hard to interpret as is. Perhaps use a single big plot.
%GLENN - I added references in the text to the other figures.  I made the lines longer and thinner.  I wanted to keep the 4 sub-figures as is to be
%consistent with other figures

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{cc}
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_plot3d_step}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_plot3d_shaded}\\
 step contours&
 continuous contours
 \end{tabular}
\end{center}
 \caption{A test showing PLOT3D stepped and continuous temperature contours.}
\label{figPLOT3Dtest}%
\end{figure}

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{cc}
 \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_y1}&
 \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_y2}\\
 \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_y3}&
 \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_y4}\\
 \end{tabular}
\end{center}
 \caption{A test showing PLOT3D stepped contours at four positions along the y axis.}
\label{figPLOT3Dtestvalue}%
\end{figure}

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{cc}
 \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_l1}&
 \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_l2}\\
 \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_l3}&
 \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_l4}\\
 \end{tabular}
\end{center}
 \caption{A test showing PLOT3D narrow band contours at four positions along the y axis.}
\label{figPLOT3Dtestline}%
\end{figure}

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{cc}
 \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_v1}&
 \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_v2}\\
 \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_v3}&
 \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_v4}\\
 \end{tabular}
\end{center}
 \caption{A test showing PLOT3D vectors shaded by temperature at four positions along the y axis.}
\label{figPLOT3Dtestvector}%
\end{figure}

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{ccl}
 \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_i1}&
 \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_i2}\\
 \SI{50}{\degreeCelsius}&\SI{230}{\degreeCelsius}\\
  \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_i3}&
 \includegraphics[height=\figheightH]{SCRIPT_FIGURES/plume5c_plot3d_i4}\\
 \SI{410}{\degreeCelsius}&\SI{590}{\degreeCelsius}\\
&&\raisebox{0.5in}[0pt]{\includegraphics[height=7.5in]{FIGURES/colorbar_050_590_plot3d_iso}}\\
 \end{tabular}
\end{center}
 \caption{A test showing PLOT3D iso-surfaces for \SI{50}{\degreeCelsius}, \SI{230}{\degreeCelsius}, \SI{410}{\degreeCelsius} and \SI{590}{\degreeCelsius}.}
\label{figPLOT3Dtestiso}%
\end{figure}


%\section{Fire Lines}
%Figure \ref{figfirelinetest} presents images verifying the display of a fire line.
%A fire line is used with wildland fire simulations as an efficient method for visualizing the motion of a fire across the simulation.
%A fire line in the context of Smokeview is just a special case of a temperature slice file.  The fire line slice is formed by setting the min and max temperature bounds to \SI{20}{\degreeCelsius} and \SI{200}{\degreeCelsius} respectively and chopping data below 150\degC.   The fire line slice file can then be made very small using Smokezip to compress it.   Fire line images are drawn at \SI{10}{s}, \SI{20}{s}, \SI{30}{s} and \SI{40}{s}.  The fire lines conform to the hill going through the middle of the scene.
%The FDS input file for this test is {\tt fire\_line.fds}.
%The images for this test were created automatically by running the Smokeview script, {\tt fire\_line.ssf}.

%\begin{figure}[\figoptions]
%\begin{center}
%\begin{tabular}{cc}
%\includegraphics[height=\figheightD]{SCRIPT_FIGURES/fire_line_fireline_10}&
%\includegraphics[height=\figheightD]{SCRIPT_FIGURES/fire_line_fireline_20}\\
%10 s&20 s\\

%\includegraphics[height=\figheightD]{SCRIPT_FIGURES/fire_line_fireline_30}&
%\includegraphics[height=\figheightD]{SCRIPT_FIGURES/fire_line_fireline_40}\\
%30 s&40 s\\

%\end{tabular}
%\end{center}
% \caption[Fire line test]{Fire line test.  The fire line, a region of high temperature, follows the terrain as
% it progresses from left to right.}
%\label{figfirelinetest}%
%\end{figure}


\chapter{Smoke Visualization Tests}

Correct smoke visualization requires that smoke flow be both computed and drawn correctly. The FDS Verification Guide~\cite{FDS_Verification_Guide} addresses computation in terms of soot/smoke production, transport, etc. A verification of how smoke is drawn is addressed in this chapter. More precisely, given a known density and distribution of soot, does the smoke drawn by Smokeview match how {\em theory}\ predicts it should appear.  Presently, the main interest is in how smoke obscures objects in the background.  Visualization effects due to light scattering are not modeled except to consider the smoke albedo when drawing its grey level.

The smoke drawing verification problem is partitioned into two steps. The first step, documented in Section \ref{sect:record_smoke}, is to verify that Smokeview can record the correct grey level of smoke as it is drawn on the screen. This step is necessary because screen colors, in this case the smoke obscuration levels to be verified, are not directly accessible to Smokeview. They must be retrieved from the video card buffers. The second step, documented in Section \ref{sect:verify_smoke}, is to verify that Smokeview can draw the correct shade of grey given a known soot density level
within the scene.
\section{Recording Smoke Levels}
\label{sect:record_smoke}

Smokeview does not have direct access to colors drawn on the screen.  Smokeview passes vertex colors to the video driver. The video driver in turn fills in interpolated colors within these vertices. To obtain these colors, Smokeview must `read' them back in after they are drawn.  A further complication is that smoke is drawn in Smokeview using a physical coordinate system. The smoke opacity levels are retrieved using the screen coordinate system, ie. at particular pixel locations. It is this transformation process, from physical to screen coordinates, that is verified in this step.

In the case of 3D smoke visualization, these colors represent smoke opacity levels.  To obtain these levels and thereby verifying that they are correct, Smokeview makes use of a special sensor or device named {\em smoke\_sensor}\ which Smokeview uses to obtain color values at the sensor location. This device behaves like other FDS devices but has the additional property that when used by Smokeview, it displays the grey level as viewed by the observer.  This grey level is displayed as a number between 0 and 255.

The user places a device of type {\tt smoke\_sensor}\ at a particular $(x, y, z)$ location. Smokeview displays the sensor as a white disk with color (255,255,255) always oriented towards the observer. When drawing smoke that resides between the sensor and the observer (your eye), the smoke sensor is partially obscured by the smoke.  Smokeview then alters the smoke sensor color according to how much and how thick the intervening smoke is.  It does this by blending each smoke plane one plane at a time using the color and opacity levels of that plane. The grey level is simply Smokeview's computation of the integrated {\em smoke thickness}\ along a path between the sensor location and the eye.  The colors displayed are the result computations performed by the video card using OpenGL, the graphics library used by Smokeview to visualize FDS scenarios.

Figure \ref{figsmokesensor} illustrates an initial test of this process.  It verifies that Smokeview can transform the sensor location from physical `FDS' coordinates to screen coordinates (pixel locations) and further can correctly record the grey level at those screen coordinates even when surrounded by other objects with different colors.  In this case, the smoke sensor is white and there is no intervening smoke.  The background is a neutral grey with grey level of 128.  The value displayed over the sensor then should always be 255 not 128 no matter how the scene is oriented.  If Smokeview made an error determining the sensor screen coordinates the grey level displayed would be 128 (grey level of the the adjacent grey background) not 255 (grey level of the sensor).

%KEVIN -- I don't understand this figure. The red dot confuses things, and the white dot is too small.
%GLENN - I removed the red dot and simplified the figure.  I added some clarifying text to the above paragraphs to put the figures into a better context.

\begin{figure}[\figoptions]
\begin{center}
 \centering
\begin{tabular}{cc}
\includegraphics[width=3.0in]{SCRIPT_FIGURES/smoke_sensor}&
 \end{tabular}
\end{center}
\caption[A test verifying that the Smokeview smoke\_sensor object is working properly]
{A test verifying that Smokeview can correctly transform the physical $(x,y,z)$ location of the smoke\_sensor object to its equivalent screen coordinates where the underlying smoke obscuration level is retrieved. A small white (255,255,255) smoke\_sensor appears in front of a grey (128,128,128) obstacle. The value displayed should be 255,  the value recorded by Smokeview.  If the physical to screen transformation is performed incorrectly a value of 128 will be displayed (since it will pick up a color elsewhere).
}
\label{figsmokesensor}%
\end{figure}

Figure \ref{figgraysquare} shows two colorbars, both containing shades of grey.  One shows white and near-white shades, the other shows black and near black shades.  This figure illustrates the difficulty one has in distinguishing nearly equal shades and by inference the difficulty in distinguishing two smoke scenes drawn using nearly the same {\em amounts}\ of smoke.  When comparing a computed smoke shade with the actual (as in Figure \ref{figsmoketest2}) one must keep in mind the eye's inability to distinguish nearly equal shades of grey.

\begin{figure}[\figoptions]
\begin{center}
 \centering
\begin{tabular}{c}
\includegraphics[width=6.0in]{FIGURES/graysquares_black}\\
\includegraphics[width=6.0in]{FIGURES/graysquares_white}\\
 \end{tabular}
\end{center}
 \caption[Shade of grey resolution test.]{Shade of grey resolution test.  The number within each square represents the shade of grey used to color that square,  0 for black and 255 for white.  Adjacent squares are drawn with nearly equal shades  testing the ability of sensors such as the eye, computer monitor or the printed page  to distinguish them.
 }
\label{figgraysquare}%
\end{figure}

\section{Verifying Smoke Levels}
\label{sect:verify_smoke}

Smoke levels are verified in Smokeview by setting up an FDS case with a constant smoke density throughout the domain.  A smoke density $S=\SI{79.67}{mg/m^3}$ and mass extinction coefficient $K=\SI{8700}{m^2}$ are chosen in Eq. \ref{eq:Beers} to generate opacity levels 192, 128, 64, 32, 16 and 8 at path lengths $\Delta x = \SI{0.4}{m}, \SI{1}{m}, \SI{2}{m}, \SI{3}{m}, \SI{4}{m} , \SI{5}{m}$
\begin{equation}
\alpha = 255 \; \exp(-K \, S \, \Delta x)
\label{eq:Beers}
\end{equation}
where $\alpha$ is a scaled opacity (from 0 to 255 rather than the usual 0 to 1).

Figure \ref{figsmoketestgeom} shows a side view of the numerical smoke box used to perform this test.  In addition to the walls surrounding the box, this box consists of  six parallel walls within the box spaced 1.0~m apart.  The widths increase from one wall to the next (from front to back) so that when looking at the box from the front a different distance or path length occurs between the observer and the portion of the wall that is visible. Again, the spacing between the walls, the distance between the walls and the observer and the initial soot densities is chosen so that the computed smoke obscurations work out to {\em nice}\ values.

\begin{figure}[\figoptions]
\begin{center}
 \centering
\begin{tabular}{c}
 \includegraphics[height=4.0in]{SCRIPT_FIGURES/smoke_test_side}
 \end{tabular}
\end{center}
 \caption[Side view of numerical smoke test compartment.]{Side view of the numerical smoke test compartment.  Walls are placed at \SI{0.4}{m}, \SI{1}{m}, \SI{2}{m}, \SI{3}{m}, \SI{4}{m} , \SI{5}{m} from the front to make the theoretical grey levels work out to 192, 128, 64, 32, 16 and 8.}
\label{figsmoketestgeom}%
\end{figure}

Figure \ref{figsmoketest2} shows quantitative tests of the smoke opacity calculation performed in Smokeview for two different FDS grid resolutions and three different skip levels\footnote{Smokeview allows one to skip grid planes when visualizing smoke.  The smoke opacity is adjusted by Smokeview to account for the skips.}. This figure also gives the predicted shades of grey based upon the specified soot densities, mass extinction coefficient and path lengths.  The smoke visualization algorithm is verified then if the shades of grey in the Smokeview visualizations match the corresponding predicted shades of grey.  Each shaded rectangle is accompanied by a numerical value that can also be used to judge whether the visualization is verified.

The numbers displayed in this Figure \ref{figsmoketest2} represent the shade of the underlying rectangle.  These numbers may be verified by using a program such as Adobe Photoshop to examine the pixel values of this rectangular region.  The numbers are verified when they match the pixel values as reported by Photoshop or any other program that can report image values.

When soot densities are constant, smoke grey level or opacity, $\alpha$ may be computed by using Eq.~(\ref{eq:Beers}).  Solving Eq.~(\ref{eq:Beers}) for $\Delta x$ gives
\begin{eqnarray}
\label{eq:deltaX}
\Delta x = -\frac{\ln(\alpha/255)}{K \, S}
\end{eqnarray}
Path lengths (smoke sensor locations) are chosen to obtain grey levels, $\alpha$, of 192, 128, 64, 32, 16 and 8.  These path lengths may be found by substituting these grey levels into Eq.~ (\ref{eq:deltaX}) to obtain $\Delta x$ values of 0.41~m, 1.0~m, 2.0~m, 3.0~m, 4.0~m and 5.0~m respectively.  The walls in {\tt smoketest2.fds} are placed at these distances from the front of the simulation domain. Comparing the Smokeview generated smoke levels with theoretical values one finds as expected that better results are achieved when using a more refined grid (0.1~m rather than 0.2~m) and using all planes (no skipping).

\begin{figure}[\figoptions]
\begin{center}
 \centering
\begin{tabular}{rcc}
 planes&0.1 m grid&0.2 m grid\\
 \raisebox{0.5in}{all} &
 \includegraphics[height=1.20in]{SCRIPT_FIGURES/smoke_test_all}&
 \includegraphics[height=1.20in]{SCRIPT_FIGURES/smoke_test2_all}\\ \\
 \raisebox{0.5in}{every 2nd} &
 \includegraphics[height=1.20in]{SCRIPT_FIGURES/smoke_test_every2}&
 \includegraphics[height=1.20in]{SCRIPT_FIGURES/smoke_test2_every2}\\ \\
 \raisebox{0.5in}{every 3rd} &
 \includegraphics[height=1.20in]{SCRIPT_FIGURES/smoke_test_every3}&
  \includegraphics[height=1.20in]{SCRIPT_FIGURES/smoke_test2_every3}\\ \\
\raisebox{0.35in}{theoretical} &
 \multicolumn{2}{c}{\includegraphics[height=0.75in]{FIGURES/graysquares}}\\
 \end{tabular}
\end{center}
 \caption[A test verifying the smoke opacity calculation]{A test verifying the smoke opacity calculation.  This test simplifies
  the general case by assuming a uniform distribution of smoke.  The test is repeated for two grid resolutions and three grid spacings.  The FDS input file is set up to result in theoretical grey levels of 8, 16, 32, 64, 128 and 192 for the different regions of the test.}
\label{figsmoketest2}%
\end{figure}




\chapter{Other Tests}

\section{Obstacles}
Figures \ref{figobsttest} and \ref{figtransparency} test different methods for displaying obstacles. Figure \ref{figobsttest} shows obstacles drawn as solids, as outlines or hidden. Figure \ref{figtransparency} shows obstacles drawn transparently. The left view shows the opaque obstacle drawn in front (and blocking) a portion of the transparent obstacle behind.  The center view shows both obstacles unobscured.  The right view shows the transparent blockage drawn in front with the opaque blockage visible behind. The images for this test were created automatically by running the Smokeview script, {\tt plume5c.ssf}\ (see Appendix \ref{SSFplume5c}).

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{ccc}
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_solid}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_outline}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_hidden}\\
 solid view of obstacles&
 outline view of obstacles&
 obstacles hidden\\

 \end{tabular}
\end{center}
 \caption{A test showing 3 drawing modes for representing blockages: solid, outline and hidden}
\label{figobsttest}%
\end{figure}

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{ccc}
 \includegraphics[width=2.0in]{SCRIPT_FIGURES/transparency_left}&
 \includegraphics[width=2.0in]{SCRIPT_FIGURES/transparency_center}&
 \includegraphics[width=2.0in]{SCRIPT_FIGURES/transparency_right}\\
 left view - opaque obstacle in front&
 center view - both obstacles visible&
 right view - transparent obstacle in front\\
 \end{tabular}
\end{center}
 \caption{A test showing that transparent objects are drawn properly}
\label{figtransparency}%
\end{figure}


\clearpage

\section{Devices}

The case illustrated in Figure \ref{figsprinkmany} tests how well Smokeview can display many devices. This figure shows a series of sprinklers with three different levels of detail.  Smokeview should be able to smoothly rotate this scene on computers with good video cards. The images for this test were created automatically by running the Smokeview script, {\tt sprinkler\_many.ssf}\ (see Appendix \ref{SSFspinklermany}).

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{ccc}
 \includegraphics[width=2.0in]{SCRIPT_FIGURES/sprink_many_view1}&
 \includegraphics[width=2.0in]{SCRIPT_FIGURES/sprink_many_view2}&
 \includegraphics[width=2.0in]{SCRIPT_FIGURES/sprink_many_view3}\\

 \end{tabular}
\end{center}
 \caption{A test showing that devices are drawn properly}
\label{figsprinkmany}%
\end{figure}


\clearpage

\section{Vents}
Figure \ref{figventtest} tests vent display.  This figure shows three different levels of vent visibility: all vents displayed, only non-open vents displayed and all vents hidden. The images for this test were created automatically by running the Smokeview script,
{\tt plume5c.ssf}\ (see Appendix \ref{SSFplume5c}).

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{ccc}
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_allvents}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_noopen}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_novents}\\
 show all vents&
 hide open vents&
 hide all vents\\

 \end{tabular}
\end{center}
 \caption{A test showing 3 modes for drawing vents: show all vents, hide open vents  and hide all vents}
\label{figventtest}%
\end{figure}


\clearpage

\section{Conversion to Color}

Smokeview converts data values obtained from an FDS calculation to color using a linear scaling of the form
\begin{equation}
C_i=255 \; \frac{V_i-V_{\min}}{V_{\max}-V_{\min}}
\end{equation}
where $C_i$ is an index into a color table between 0 and 255, $V_{\min}$ and $V_{\max}$  are data bounds, and $V_i$ is a data value to be converted. Figure \ref{figcolorconv} presents images verifying the conversion of data to colors. The input file, {\tt colorconv.fds}\ (see Appendix \ref{FDScolorconv}), was set up so that initially the left half of the domain (it is a 2D case) is \SI{20}{\degreeCelsius} and the right half is \SI{100}{\degreeCelsius}. The images for this test were created automatically by running the Smokeview script, {\tt colorconv.ssf}\ (see Appendix \ref{SSFcolorconv}).

A second color conversion test involves the use of the colorbar to highlight portions of the data.  The case was set up so that the vertical slice aligns with the colorbar.  The gas temperatures were defined to increase from \SI{20}{\degreeCelsius} to \SI{100}{\degreeCelsius} from the floor to the ceiling.  As a result, when one selects the colorbar, the selected region in the colorbar should match the selected region in the vertical slice. The images for this test were created automatically by running the Smokeview script, {\tt colorbar.ssf}\ (see Appendix \ref{SSFcolorbar}).

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{cccl}
 \includegraphics[width=\figheightG]{SCRIPT_FIGURES/colorconv_slice_00000}&
 \includegraphics[width=\figheightG]{SCRIPT_FIGURES/colorconv_slice_00025}&
 \includegraphics[width=\figheightG]{SCRIPT_FIGURES/colorconv_slice_00050}\\
 \includegraphics[width=\figheightG]{SCRIPT_FIGURES/colorconv_slice_00075}&
 \includegraphics[width=\figheightG]{SCRIPT_FIGURES/colorconv_slice_00100}&
 \includegraphics[width=\figheightG]{SCRIPT_FIGURES/colorconv_slice_00125}\\
 \includegraphics[width=\figheightG]{SCRIPT_FIGURES/colorconv_slice_00150}&
 \includegraphics[width=\figheightG]{SCRIPT_FIGURES/colorconv_slice_00175}&
 \includegraphics[width=\figheightG]{SCRIPT_FIGURES/colorconv_slice_00200}\\
 \includegraphics[width=\figheightG]{SCRIPT_FIGURES/colorconv_slice_00225}&
 \includegraphics[width=\figheightG]{SCRIPT_FIGURES/colorconv_slice_00250}&
 \includegraphics[width=\figheightG]{SCRIPT_FIGURES/colorconv_slice_00275}\\
 \includegraphics[width=\figheightG]{SCRIPT_FIGURES/colorconv_slice_00300}&
 \includegraphics[width=\figheightG]{SCRIPT_FIGURES/colorconv_slice_00325}&
 \includegraphics[width=\figheightG]{SCRIPT_FIGURES/colorconv_slice_02000}\\
&&&\raisebox{0.0in}[0pt]{\includegraphics[height=8.0in]{FIGURES/colorbar_20_100}}\\
\end{tabular}
\end{center}
 \caption[A test showing that data is converted to color properly]{A test showing that data is converted to color properly.  Temperature between \SI{20}{\degreeCelsius} and \SI{100}{\degreeCelsius} are
 converted to colors between blue and red.}
\label{figcolorconv}%
\end{figure}

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{c}
 \includegraphics[height=2.75in]{SCRIPT_FIGURES/colorbar_low}\\
 \includegraphics[height=2.75in]{SCRIPT_FIGURES/colorbar_med}\\
 \includegraphics[height=2.75in]{SCRIPT_FIGURES/colorbar_high}\\
 \end{tabular}
\end{center}
 \caption[A test showing that data is converted to color properly]{A test showing that data is converted to color properly.  Temperature between \SI{20}{\degreeCelsius} and \SI{100}{\degreeCelsius} are  converted to colors between blue and red.  The highlighted region in the colorbar matches the highlighted region in the vertical slice.  }
\label{figcolorconv2}%
\end{figure}


\clearpage

\section{GPU Test}

Figure \ref{figgputest} tests whether Smokeview produces similar images when using the GPU and CPU for drawing 3D smoke.  The first column shows CPU generated images at \SI{5}{s}, \SI{10}{s} and \SI{30}{s} while the second column shows GPU generated images at the same times.  The corresponding images in each column should be similar.

\begin{figure}[\figoptions]
\begin{center}
\begin{tabular}{cc}
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_smoke_nongpu_05}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_smoke_gpu_05}\\
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_smoke_nongpu_10}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_smoke_gpu_10}\\
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_smoke_nongpu_30}&
 \includegraphics[height=\figheightD]{SCRIPT_FIGURES/plume5c_smoke_gpu_30}\\
 CPU generated&GPU generated\\
 \end{tabular}
\end{center}
 \caption{A test showing that the GPU is properly used to draw smoke}
\label{figgputest}%
\end{figure}


% KEVIN -- is this section really needed? I suggest this kind of discussion be put in the Tech Guide. The verification guide is just a work horse.
% GLENN -- removed


\bibliography{../Bibliography/FDS_refs,../Bibliography/FDS_general,../Bibliography/FDS_mathcomp,../Bibliography/sv_fire,../Bibliography/sv_graphics}
\addcontentsline{toc}{chapter}{References}

\appendix
\addcontentsline{toc}{chapter}{Appendices}

\chapter{Input Files}
\label{fdsinputfiles}

\section{plume5c}
\label{FDSplume5c}
\fdsinput{plume5c.fds}

\section{smoke\_sensor}
\label{FDSsmokesensor}
\fdsinput{smoke_sensor.fds}

\section{smoke\_test}
\label{FDSsmoketest}
\fdsinput{smoke_test.fds}

\section{smoke\_test2}
\label{FDSsmoketest2}
\fdsinput{smoke_test2.fds}

\section{transparency}
\label{FDStransparency}
\fdsinput{transparency.fds}

\section{colorbar}
\label{FDScolorbar}
\fdsinput{colorbar.fds}

\section{colorconv}
\label{FDScolorconv}
\fdsinput{colorconv.fds}

\chapter{Smokeview Scripts}
\label{smvscripts}

\section{plume5c}
\label{SSFplume5c}
\fdsinput{plume5c.ssf}

\section{smoke\_sensor}
\label{SSFsmokesensor}
\fdsinput{smoke_sensor.ssf}

\section{smoke\_test}
\label{SSFsmoketest}
\fdsinput{smoke_test.ssf}

\section{smoke\_test2}
\label{SSFsmoketest2}
\fdsinput{smoke_test2.ssf}

\section{sprinkler\_many}
\label{SSFspinklermany}
\fdsinput{sprinkler_many.ssf}

\section{transparency}
\label{SSFtransparency}
\fdsinput{transparency.ssf}

\section{colorbar}
\label{SSFcolorbar}
\fdsinput{colorbar.ssf}

\section{colorconv}
\label{SSFcolorconv}
\fdsinput{colorconv.ssf}

\end{document}
