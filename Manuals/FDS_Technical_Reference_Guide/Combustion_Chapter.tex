\chapter{Combustion (Chemically Reacting Flows)}

\label{combustionsection}

FDS can model multiple, simultaneous chemical reactions.  FDS uses one of two approaches to computing the reaction rate for a chemical reaction.  The first approach is a mixing-controlled reaction rate.  In this approach, the reaction rate is computed based on the local mixing.  That is the reactants (e.g. fuel and air) react inifintely fast at the rate that the underlying gas transport mixes them together.  For the second model, individual gas species react according to
specified Arrhenius reaction parameters. This latter model is most often used in a
direct numerical simulation (DNS) where the diffusion of fuel and oxygen can be
modeled directly.
However, most often for large eddy simulations (LES), where the grid is not
fine enough to resolve the diffusion of fuel and oxygen,
the mixing-controlled combustion model is assumed.  A single FDS simulation can contain a mix of reaction rate types.

\section{Mixing-Controlled Reaction-Rate Model}

For an infinitely-fast reaction, reactant species in a given grid cell are converted to product species at a rate determined by a
characteristic mixing time.  It is assumed that the
grid resolution is too coarse to resolve the flame sheet and compute directly the reaction rate.  Instead, if any grid cell contains all the reactants of the the chemical reaction and the temperature of the grid cell meets certain criteria, the consumption rate of fuel is given by~\cite{Poinsot:TNC}
\be \dm_f''' = -\rho \min \left( Y_\F , \frac{Y_\OTWO}{s}, \beta \frac{Y_{\hbox{\tiny P}}}{1+s} \right) \; \left( 1 - e^{-\dt/\tau} \right)   \quad ; \quad
   s=\frac{W_\F}{\nu_{\OTWO} W_{\OTWO} }  \label{EDC} \ee
Here, $\tau$ is a mixing time scale and $\beta$ is an empirical parameter equal to 1.

\subsection{A Mixing-Controlled Reaction, but with Local Extinction}

\label{extinction}

The physical limitation of the mixing-controlled reaction model described in the previous section is that it assumes that fuel and oxygen burn instantaneously when mixed. For large-scale, well-ventilated
fires, this is a good assumption. However, if a fire is in an
under-ventilated compartment, or if a suppression agent like water
mist or CO$_2$ is introduced, or if the shear layer between fuel and oxidizing streams
has a sufficiently large local strain rate,
fuel and oxygen may mix but may not burn.
The physical mechanisms underlying these phenomena are complex, and
even simplified models still rely on an accurate prediction
of the flame temperature and local strain rate.
Subgrid-scale modeling of gas phase suppression and
extinction is still an area of active research in the combustion
community.

Simple empirical rules can be used to predict local
extinction based on the species and temperature present in the flame sheet.  The FDS extinction model consists of two parts. The first part, checks to see if the local temperature is above an auto-ignition temperature for the fuel.  If the temperature is too low, then combustion will not occur.  Note that this temperature is by default set to absolute zero so that typical users do not need to specify an ignition source.  The second part uses the concept of a limiting flame temperature.  If the local combustion cannot raise the local temperature above the limiting flame temperature, then combustion will not occur.  This is done in the following steps:

\begin{enumerate}
\item Search over all reactant species to find the limiting species and express that species in terms of the reaction's fuel:

\be \Delta Z_\F = \min_{i \; = \; reactant} \left(\frac{Z_i W_\F}{W_i \nu_i} \right) \ee
\item Remove that amount of fuel from the local gas, the resulting gas is the "air" for the reaction.
\item Search over all the non-fuel reactant species in the "air" to determine the limiting reactant.  This defines how much air is required to burn the fuel:

\be \Delta Z_{Air} = \min_{i \; = \; non-fuel \; reactant} \left(\frac{\Delta Z_\F W_i \nu_i}{Z_i W_\F} \right) \ee

\item Compute the enthalpy for the fuel and the air at both the current temperature and the limiting flame temperature.
\item Combustion is allowed if 

\be \Delta Z_{Air} h_{air}(T)+\Delta Z_F \left( h_\F(T)+\Delta H_\F \right) > \Delta Z_{Air} h_{air}(T_{LFT})+ \Delta Z_\F h_\F(T_{LFT}) \ee

\end{enumerate}

\subsection{Simplified Chemistry}

\label{simplechemistry}

Most ordinary combustibles can be represented by the simple single-step reaction:

\be  \mathrm{C_xH_yO_zN_a} +  \nu_\OTWO \, \mathrm{O_2}  \rightarrow  \nu_\COTWO \, \mathrm{CO_2} + \nu_\HTWOO \, \mathrm{H_2O} + \nu_\CO \, \mathrm{CO} +
     \nu_\So \, \mathrm{S}  + \nu_\NTWO \, \mathrm{N_2}  \label{stoich}
\ee
Note that the nitrogen in the fuel molecule is assumed to form $\mathrm{N_2}$ only. Soot is assumed to be a mixture of carbon and hydrogen with the hydrogen atomic
fraction given by $X_\Hy$. The stoichiometric coefficient, $\nu_\So$, represents the amount of fuel that is converted to soot. It is related to the
{\em soot yield}, $y_\So$, via the relation:
\be
   \nu_\So = \frac{W_\F}{W_\So} \; y_\So  \quad ; \quad  W_\So = X_\Hy W_\Hy + (1 - X_\Hy) W_\C  \label{soot_yield}
\ee
Likewise, the stoichiometric coefficient of CO, $\nu_\CO$, is related to the CO {\em yield}, $y_\CO$, via:
\be
   \nu_\CO = \frac{W_\F}{W_\CO} \; y_\CO  \label{CO_yield}
\ee
The yields of soot and CO are based on ``well-ventilated'' or ``post-flame'' measurements. The increased production of CO and soot in an under-ventilated
compartment will be addressed in the following sections.

This reaction can also be represented as:

\be  \mathrm{Fuel} +  \nu_\mathrm{Air} \, \mathrm{Air}  \rightarrow  \mathrm{Products}\label{stoichair}
\ee

Air is a lumped species consisting of a mixture of nitrogen, oxygen, water vapor, and carbon dioxide (carbon dioxide is included to attenuate radiation over large distances and water vapor is included for attenuation and to support simulations with sprinklers).  Products is a lumped species consisting of all the products listed in \ref{stoich} plus the nitrogen, water vapor, and carbon dioxide from the Air that reacted with the fuel.  If we allow for the presence of a diluent gas in the fuel stream, then the Fuel becomes a lumped species consisting of fuel and diluent.  We name these species $Z_0$ for Air, $Z_1$ for Fuel, and $Z_2$ for Products.  When using simple chemistry, $Z_1$ and $Z_2$ are tracked explicitly and $Z_0$ is tracked implicitly as the background species.  The mass fractions of the component gases in these species are given as:

\noindent
$Z_0$: Air
\begin{eqnarray}
Y_{\NTWO}(Z_0) & = & Y_\NTWO^\infty\\*[.1in]
Y_{\OTWO}(Z_0) & = & Y_\OTWO^\infty\\*[.1in]
Y_{\COTWO}(Z_0) & = & Y_\COTWO^\infty\\*[.1in]
Y_{\HTWOO}(Z_0) & = & Y_\HTWOO^\infty
\end{eqnarray}
$Z_1$: Fuel
\begin{eqnarray}
Y_{\F}(Z_1) & = & Y_\F
\end{eqnarray}
$Z_2$: Products
\begin{eqnarray}
Y_{\NTWO}(Z_2) & = & \frac{\nu_{Air} W_{Air}  Y_\NTWO^\infty +\nu_{\NTWO} W_{\NTWO}}{W_F + \nu_{Air} W_{Air}}\\*[.1in]
Y_{\COTWO}(Z_2) & = & \frac{\nu_{Air} W_{Air}  Y_\COTWO^\infty +\nu_{\COTWO} W_{\COTWO}}{W_F + \nu_{Air} W_{Air}}\\*[.1in]
Y_{\HTWOO}(Z_2) & = & \frac{\nu_{Air} W_{Air}  Y_\HTWOO^\infty +\nu_{\HTWOO} W_{\HTWOO}}{W_F + \nu_{Air} W_{Air}}\\*[.1in]
Y_{\CO}(Z_2) & = & \frac{\nu_{\CO} W_{\CO}}{W_F + \nu_{Air} W_{Air}}\\*[.1in]
Y_{\So}(Z_2) & = & \frac{\nu_{\So} W_{\So}}{W_F + \nu_{Air} W_{Air}}
\end{eqnarray}
Species yields of combinations of $Z_0$, $Z_1$, and $Z_2$ are given as:
\be
Y_\alpha(Z_0,Z_1,Z_2)=Y_\alpha(Z_0) \, (1 - Z_1 - Z_2) + Y_\alpha(Z_1) \, Z_1 + Y_\alpha(Z_2) \, Z_2
\ee
The stoichiometric coefficients in the $Z_2$ species yields are:

\parbox{2.5in}{
\begin{eqnarray*}  \nu_\NTWO  &=& \frac{\hbox{a}}{2}\\*[.1in]
                  \nu_\OTWO  &=& \nu_\COTWO + \frac{\nu_\CO+\nu_\HTWOO-\hbox{z}}{2}\\*[.1in]
                  \nu_\COTWO &=& \hbox{x} - \nu_\CO - (1-X_\Hy) \nu_\So  \\*[.1in]
\end{eqnarray*} }
\hfill \parbox{3.5in}{\begin{eqnarray}
                  \nu_\HTWOO &=& \frac{\hbox{y}}{2}- X_\Hy \nu_\So\\*[.1in]
                  \nu_\CO    &=& \frac{W_\F}{W_\CO} \; y_\CO \\*[.1in]
                  \nu_\So    &=& \frac{W_\F}{W_\So} \; y_\So
\end{eqnarray} }
Remember that x is the number of carbon atoms, y is the number of hydrogen atoms, z is the number of oxygen atoms, and a is the number of nitrogen atoms in the fuel molecule.
It is important to note that the definitions of $Z_0$, $Z_1$, and $Z_2$ do not imply anything regarding the rate of combustion, only that the combustion occurs in a single step.

\subsection{CO Production (Two-Step Reaction with Extinction)}

\label{co_production}

The previous section describes the ``complete'' reaction as the conversion of fuel to
products such that the production rate of each product species is proportional to the fuel consumption rate.
This means that for each fuel molecule, fixed amounts of CO$_2$, H$_2$O, CO, and soot are formed and these products
persist in the plume indefinitely with no further reaction. This is not an unreasonable assumption if
the purpose of the fire simulation is to assess the impact of the fire on the larger space.
However, in under-ventilated fires, soot and CO are produced at higher rates,
and exist within the fuel-rich flame envelope at higher concentrations,
than would otherwise be predicted with a single set of fixed yields that are based on post-flame measurements. To account for the
production of CO and its eventual oxidation at the flame envelope or within a hot upper layer,
an additional reaction is now needed:
\begin{eqnarray}
\mathrm{C_xH_yO_zN_a} +  \nu_\OTWO' \mathrm{O_2}  &\rightarrow&  \nu_\HTWOO \mathrm{H_2O} + (\nu_\CO'+ \nu_\CO) \, \mathrm{CO} +
     \nu_\So \, \mathrm{S}  + \nu_\NTWO \, \mathrm{N_2}   \\*[.1in]
\nu_\CO' \; \Big[ \mathrm{CO} + \ha \mathrm{O_2}  &\rightarrow&  \mathrm{CO_2}  \Big]
\label{3reac} \end{eqnarray}
The brackets around the second reaction are there merely to emphasize that the sum of the two reactions equal Eq.~(\ref{stoich}).
There are two stoichiometric coefficients for CO -- the first, $\nu_\CO'=\hbox{x}-(1-X_\Hy) \nu_\So-\nu_\CO$,
represents CO that is produced in the first
step of the reaction that can potentially be converted to CO$_2$ assuming the conditions are favorable. $\nu_\CO'$ is equivalent to $\nu_\COTWO$ in
Eq.~(\ref{stoich}). The second coefficient, $\nu_\CO$,
is the so-called ``well-ventilated,'' or ``post-flame,'' value that was introduced in the previous section. The proposed model of CO production
still does not contain the necessary kinetic mechanism to predict the ``post-flame'' concentration of CO without the prescription of the
measured value of the post-flame CO yield. Rather, the proposed model includes the production of large amounts of CO in the first step of a two-step
reaction, followed by a partial conversion to CO$_2$ if there is a sufficient amount of oxygen present.

To describe the composition of the gas species, an additional lumped species is required bringing the total to four lumped species.  We can rewrite the above two step reaction as:

\begin{eqnarray}
Fuel + \nu_{Air,1} Air &\rightarrow&  Incomplete \; Products\\*[.1in]
Incomplete \; Products + \nu_{Air,2} Air &\rightarrow&  Complete \; Products
\label{4lumped}
\end{eqnarray}

It can be seen from this that the four lumped species are: $Z_0$ for Air, $Z_1$ for Fuel, $Z_2$ for the products of incomplete combustion, and $Z_3$ for the products of complete combustion.  The species yields are:

$Z_0$: Air

\begin{eqnarray}
Y_{\NTWO}(Z_0) & = & Y_\NTWO^\infty\\*[.1in]
Y_{\OTWO}(Z_0) & = & Y_\OTWO^\infty\\*[.1in]
Y_{\COTWO}(Z_0) & = & Y_\COTWO^\infty\\*[.1in]
Y_{\HTWOO}(Z_0) & = & Y_\HTWOO^\infty
\end{eqnarray}

$Z_1$: Fuel

\begin{eqnarray}
Y_{\F}(Z_1) & = & Y_\F
\end{eqnarray}

$Z_2$: Products of Incomplete Combustion

\begin{eqnarray}
Y_{\NTWO}(Z_2) & = & \frac{\nu_{Air,1} W_{Air} Y_\NTWO^\infty +\nu_{\NTWO} W_{\NTWO}}{W_F + \nu_{Air} W_{Air}}\\*[.1in]
Y_{\COTWO}(Z_2) & = & \frac{\nu_{Air} W_{Air} Y_\COTWO^\infty}{W_F + \nu_{Air} W_{Air}} \\*[.1in]
Y_{\HTWOO}(Z_2) & = & \frac{\nu_{Air} W_{Air}  Y_\HTWOO^\infty +\nu_{\HTWOO} W_{\HTWOO}}{W_F + \nu_{Air} W_{Air}}\\*[.1in]
Y_{\CO}(Z_2) & = & \frac{\nu_{\CO'} W_{\CO}}{W_F + \nu_{Air} W_{Air}}\\*[.1in]
Y_{\So}(Z_2) & = & \frac{\nu_{\So} W_{\So}}{W_F + \nu_{Air} W_{Air}}
\end{eqnarray}

$Z_3$: Products of Complete Combustion

\begin{eqnarray}
Y_{\NTWO}(Z_2) & = & \frac{\nu_{Air,2} W_{Air}  Y_\NTWO^\infty +\nu_{\NTWO} W_{\NTWO}}{W_F + \nu_{Air} W_{Air}}\\*[.1in]
Y_{\COTWO}(Z_2) & = & \frac{\nu_{Air} W_{Air}  Y_\COTWO^\infty +\nu_{\COTWO} W_{\COTWO}}{W_F + \nu_{Air} W_{Air}}\\*[.1in]
Y_{\HTWOO}(Z_2) & = & \frac{\nu_{Air} W_{Air}  Y_\HTWOO^\infty +\nu_{\HTWOO} W_{\HTWOO}}{W_F + \nu_{Air} W_{Air}}\\*[.1in]
Y_{\CO}(Z_2) & = & \frac{\nu_\CO W_{\CO}}{W_F + \nu_{Air} W_{Air}}\\*[.1in]
Y_{\So}(Z_2) & = & \frac{\nu_{\So} W_{\So}}{W_F + \nu_{Air} W_{Air}}
\end{eqnarray}


The stoichiometric coefficients are defined:

\parbox{2.5in}{
\begin{eqnarray*} \nu_\NTWO  &=& \frac{\hbox{a}}{2}\\*[.1in]
                  \nu_\OTWO' &=& \frac{\nu_\CO'+\nu_\HTWOO-z}{2}\\*[.1in]
                  \nu_\OTWO  &=& \nu_\COTWO + \frac{\nu_\CO+\nu_\HTWOO-z}{2}\\*[.1in]
                  \nu_\COTWO &=& \hbox{x} - (1-X_\Hy) \nu_\So \\*[.1in]
                  \nu_\M     &=& \hbox{b} \end{eqnarray*} }
\hfill \parbox{3.5in}{\begin{eqnarray}
                  \nu_\HTWOO &=& \frac{\hbox{y}}{2}- X_\Hy \nu_\So\\*[.1in]
                  \nu_\CO'   &=& x - \nu_\CO - (1-X_\Hy) \nu_\So \\*[.1in]
                  \nu_\CO    &=& \frac{W_\F}{W_\CO} \; y_\CO \\*[.1in]
                  \nu_\So    &=& \frac{W_\F}{W_\So} \; y_\So
\end{eqnarray} }
Although these formulae appear complicated, most are determined directly from the composition of the fuel molecule. The only information
expected of the modeler are the fuel composition, the soot and CO yields, and the atomic fraction of hydrogen in the soot.


\subsubsection{One-Step, Fast Reaction}





\subsubsection{Two-Step, Fast-Slow Reaction}

When the mixture fraction is divided into three components, $Z_1$, $Z_2$, and $Z_3$, there are two chemical
reactions that convert $Z_1$ to $Z_2$ and $Z_2$ to $Z_3$.  Recall from Section~\ref{co_production}
that this represents two-step combustion (fuel to CO and CO to CO$_2$).
The first step occurs as it does for the two-parameter mixture fraction with a modified heat of combustion that
accounts for the conversion of fuel to CO rather than CO$_2$.
The second step is performed for all grid cells that contain CO and O$_2$.   If $\dq''' \neq 0$ in a grid
cell after the first step, then additional heat is released according to
\be \dq_{\CO}''' = \min \left[ \frac{ \max \left( \rho Z_2 , s \rho Y_\OTWO \right) }{\dt} \,
  \Delta H_\CO \; , \; \dq_{\max}'''-\dq'''  \right]     \ee
If $\dq'''=0$ after the first step, then it is presumed that the cell is out of the combustion region (say in the upper layer of
smoke-filled compartment), and a finite-rate reaction computation is performed to convert CO to CO$_2$ (see the next section for
a discussion of the algorithm for computing a finite-rate reaction).  The $\dq'''_{CO}$ computed using the finite-rate
reaction is still limited by $\dq_{\max}'''$.  Once $\dq'''_{\CO}$ is computed the mixture fraction variables are updated:
\be {Z_2}^{n+1} = {Z_2}^n - \frac {\dq'''_{\CO}{\Delta t}}{\rho \, \Delta H_{\CO}} \quad ; \quad
{Z_3}^{n+1} = {Z_3}^n + \frac {\dq'''_{\CO}{\Delta t}}{\rho \, \Delta H_{\CO}} \ee



\newpage
\section{Arrhenius Reaction Rate Model}

There are conditions under which the local temperature and species concentrations support the computation of reaction using these quantities.  One set of conditions is where the reacting regions of the flow can be considered a well-stirred reactor.  The other is during a DNS calculation.  In the first case rather than a reacting surface, there is a reacting volume.  In the second case, the fine grid resolution enables the direct modeling of the diffusion of chemical species (fuel,
oxygen, and combustion products).  This allows the flame to be resolved in a DNS calculation.  Under conditions where the local gas
temperatures can be used to determine the reaction kinetics, Arrhenius rates can be used.  The general form of the rate expression is

\be \frac{d[X_\F]}{dt}    = -A \; \prod \left([X_i]^{a_i} \right) T^n \; e^{-E/RT_{ijk}} \label{Arrheniusrateeqn} \ee

note that the rate expression can be dependent on temperature and that the rate can be dependent upon species that do not directly participate in the reaction.  Since FDS solves for mass fractions of lumped species rather than mole fractions of individual species, the only "species" that can be consumed or created are the lumped speces.  However, any of the primitive species components of those lumped species could particpate as a collision species.  Therefore, rather than $\frac{d[X_\F]}{dt}$,  FDS must solve for $\frac{dZ_\F}{dt}$.  Additionally since it is quicker to determine $Y_i$ rather than $X_i$, the relation $[X_i]=\frac{Y_i \rho}{W_i}$ is used.  Combined these result in a modified rate equation:

\be \frac{dZ_\F}{dt}    = -A_{mod} \rho^{\sum (a_i) -1} \; \prod \left(Y_i^{a_i} \right) T^n \; e^{-E/RT_{ijk}} \;\;\; A_{mod} = A \prod \left(W_i^{-a_i} \right) \label{Arrheniusratemode} \ee

\section{Time Integration of Chemical Reactions}

\subsection{Single Step, Mixing-Controlled Reaction Rates}

When a single step chemistry model is being used with mixing-controlled reaction rates, an analytic integration over the timestep is possible. There are two solutions depending upon the reaction rate being fuel/oxidizer limited or product limited.  For the case where the reaction rate is given by the fuel or oxidizer mass fraction the integrated fuel mass loss is:

\be Z^{n+1}_{\F} - Z^{n}_{\F} = \min \left(Z^{n}_{\F},Z^{n}_A \frac{W_F}{W_A \nu_A} \right) \left(1 - e^{\frac{-\Delta t^n}{\tau}} \right) \ee

For the case where the reaction rate is given by the product mass fraction, the integrated fuel mass loss rate is in two parts as during the time integration the reaction rate will shift from being determined from the products to being determined from the fuel or oxidizer:

\begin{eqnarray}
Z^{n+}_{\F} - Z^{n}_{\F} & = & Z^n_P \frac{W_{\F}}{\nu_P W_P}  \left(e^{\frac{-\Delta t^n_2}{\tau}} -1 \right) \\*[.1in]
Z^{n+1}_{\F} - Z^{n+}_{\F} & = &  \min \left(Z^{n}_{\F},Z^{n}_A \frac{W_{\F}}{W_A \nu_A} \right) \left(1 - e^{\frac{\Delta t^n_2-\Delta t^n}{\tau}} \right) \\*[.1in]
\Delta t^n_2 & = & \tau \log \left( \frac{Z^n_P W_{\F}}{\nu_P W_P} +\min \left(Z^n_{\F},Z^n_A \frac{W_{\F}}{W_A \nu_A} \right) \right)
\end{eqnarray}

\subsection{Other Chemistry Models}

For anything other than single step chemistry with mixing-controlled reaction rates an ODE solver is employed.  A variety of ODE solvers are inlcuded within FDS.  These include explicit Euler and second order Runge-Kutta methods.  Since chemical timescales are often fast with respect to the hydrodynamic timescales, these solvers all use subtimesteps during time integration of the chemical reactions.  Time integration is halted once no reactants are present of if the local heat release rate exceeds maximum allowable values.


\section{Heat Release Rate}

The discussion of the various reaction mechanisms above is essentially book-keeping, the accounting of the gas
molecules formed in the combustion process. But what of the heat released?

Each chemical reaction in FDS must be defined with a fuel and a heat of combustion.  "Fuel" in this case merely denotes which species the heat of combstion is based upon.  During time integration of the reactions, there is a time integration of the heat release rate.  While the mixing controlled reaction rate  in Eq.~(\ref{EDC}) is an easily computed and robust subgrid-scale model of and the Arrhenius rate is certainly a robust model when applicable, there is still a need, in certain situations, to put an upper bound on the local heat release rate per unit volume. The reason for
this is that FDS is applied over length scales ranging from millimeters to tens of meters, and the resolution of the numerical grid
is sometimes too coarse to expect the simple mixing time model to work effectively.
A scaling analysis of pool fires by Orloff and De Ris~\cite{Orloff:19th_Symposium} suggests that the spatial average of the
heat release rate of a fire is approximately 1200~kW/m$^3$. FDS uses by default a value of 2500~kW/m$^3$ as an upper bound\footnote{Note that
for DNS, FDS imposes a less restrictive upper bound on the local heat release rate per unit volume. It is
\be \dq_{\max}''' = 200/\dx + 2500 \quad \hbox{kW/m}^3 \ee
The value of 200~kW/m$^2$ is an upper bound on the heat release rate per unit area of flame sheet.}
on the local value of the heat release rate per unit volume. Typically, this bound only affects fires whose value of $Q^*$
is less than one\footnote{The non-dimensional quantity, $Q^*$, is a measure of the fire's heat release rate divided by the
area of its base. It is expressed as $Q^*=\dQ/(\rho_\infty c_p T_\infty \sqrt{g D} D^2)$.}.

